/*!CK:3160309399!*//*1425596643,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["cgHkd"]); }

__d("MercuryActionStatus",[],function(a,b,c,d,e,f){e.exports={UNSENT:0,SUCCESS:1,UNCONFIRMED:3,FAILED_UNKNOWN_REASON:4,UNABLE_TO_CONFIRM:5,RESENT:6,RESENDING:7,ERROR:10};},null);
__d("MercuryActionType",[],function(a,b,c,d,e,f){e.exports={LOG_MESSAGE:"ma-type:log-message",USER_GENERATED_MESSAGE:"ma-type:user-generated-message",CHANGE_READ_STATUS:"ma-type:change_read_status",MARK_THREAD_SEEN:"ma-type:mark_thread_seen",CHANGE_MUTE_SETTINGS:"ma-type:change-mute-settings",CLEAR_CHAT:"ma-type:clear_chat",SEND_MESSAGE:"ma-type:send-message",UPDATE_ACTION_ID:"ma-type:update-action-id",DELETE_MESSAGES:"ma-type:delete-messages",MARK_MESSAGES_SPAM:"ma-type:mark-messages-spam",DELETE_THREAD:"ma-type:delete-thread",CHANGE_ARCHIVED_STATUS:"ma-type:change-archived-status",CHANGE_FOLDER:"ma-type:change-folder",ADD_PARTICIPANTS:"ma-type:add-participants",CANCEL_ATTACHMENT_PLACEHOLDER:"ma-type:cancel-attachment-placeholder",CONFIRM_ATTACHMENT_PLACEHOLDER:"ma-type:confirm-attachment-placeholder",ADD_SHARE_DATA_TO_EXISTING_MESSAGE:"ma-type:add-share-data-to-existing-message",UNPIN_THREAD:"ma-type:unpin-thread"};},null);
__d("MercuryAPIArgsSource",[],function(a,b,c,d,e,f){e.exports={CHAT:"chat",JEWEL:"jewel",MERCURY:"mercury",WEBMESSENGER:"web_messenger"};},null);
__d("MercuryAttachmentContentType",[],function(a,b,c,d,e,f){e.exports={PHOTO:"attach:image",VIDEO:"attach:video",MUSIC:"attach:music",VOICE:"attach:voice",TEXT:"attach:text",MSWORD:"attach:ms:word",MSXLS:"attach:ms:xls",MSPPT:"attach:ms:ppt",ORION:"attach:orion",SHOERACK_INVITATION:"attach:shoerackinvite",UNKNOWN:"attach:unknown"};},null);
__d("MercuryAttachmentType",[],function(a,b,c,d,e,f){e.exports={ERROR:"error",FILE:"file",PHOTO:"photo",STICKER:"sticker",SHARE:"share",UNKNOWN:"unknown",VIDEO:"video",ANIMATED_IMAGE:"animated_image"};},null);
__d("MercuryAudioType",[],function(a,b,c,d,e,f){e.exports={AudioClip:"fb_voice_message",VoiceMessageWithTranscript:"fb_voice_message_with_transcript"};},null);
__d("MercuryErrorType",[],function(a,b,c,d,e,f){e.exports={SERVER:1,TRANSPORT:2,TIMEOUT:3};},null);
__d("MercuryGenericConstants",[],function(a,b,c,d,e,f){e.exports={MAX_THREAD_NAME_LENGTH:250};},null);
__d("MercuryGlobalActionType",[],function(a,b,c,d,e,f){e.exports={MARK_ALL_READ:"mga-type:mark-all-read"};},null);
__d("MercuryLogMessageType",[],function(a,b,c,d,e,f){e.exports={SUBSCRIBE:"log:subscribe",UNSUBSCRIBE:"log:unsubscribe",VIDEO_CALL:"log:video-call",PHONE_CALL:"log:phone-call",THREAD_NAME:"log:thread-name",THREAD_IMAGE:"log:thread-image",SERVER_ERROR:"log:error-msg",LIVE_LISTEN:"log:live-listen",WALLPAPER:"log:wallpaper",ORION:"log:orion",SWITCH_TO_WORK:"log:switch",PAGE_REPLY:"log:page-reply"};},null);
__d("MercuryMessageSourceTags",[],function(a,b,c,d,e,f){e.exports={CHAT:"source:chat",EMAIL:"source:email",MESSENGER:"source:messenger",MOBILE:"source:mobile"};},null);
__d("MercuryParticipantTypes",[],function(a,b,c,d,e,f){e.exports={USER:"user",THREAD:"thread",EVENT:"event",PAGE:"page",FRIEND:"friend"};},null);
__d("MercuryPayloadSource",[],function(a,b,c,d,e,f){e.exports={UNKNOWN:"unknown",CLIENT_CHANNEL_MESSAGE:"client_channel_message",CLIENT_SEND_MESSAGE:"client_send_message",CLIENT_CHANGE_ARCHIVED_STATUS:"client_change-archived_status",CLIENT_CHANGE_FOLDER:"client_change_folder",CLIENT_CHANGE_MUTE_SETTINGS:"client_change_mute_settings",CLIENT_CHANGE_READ_STATUS:"client_change_read_status",CLIENT_MARK_THREAD_SEEN:"client_mark_thread_seen",CLIENT_ADD_PARTICIPANTS:"client_add_participants",CLIENT_FETCH_PARTICIPANTS:"client_fetch_participants",CLIENT_CLEAR_CHAT:"client_clear_chat",CLIENT_DELETE_MESSAGES:"client_delete_messages",CLIENT_MARK_MESSAGES_SPAM:"client_mark_messages_spam",CLIENT_DELETE_THREAD:"client_delete_thread",CLIENT_HANDLE_ERROR:"client_handle_error",CLIENT_UNPIN_THREAD:"client_unpin_thread",SERVER_INITIAL_DATA:"server_initial_data",SERVER_SEND_MESSAGE:"server_send_message",SERVER_CONFIRM_MESSAGES:"server_confirm_messages",SERVER_CHANGE_ARCHIVED_STATUS:"server_change_archived_status",SERVER_CHANGE_READ_STATUS:"server_change_read_status",SERVER_MARK_FOLDER_READ:"server_mark_folder_read",SERVER_MARK_SEEN:"server_mark_seen",SERVER_FETCH_PARTICIPANTS:"server_fetch_participants",SERVER_FETCH_THREAD_INFO:"server_fetch_thread_info",SERVER_FETCH_THREADLIST_INFO:"server_fetch_threadlist_info",SERVER_STANDALONE_NOTIFICATIONS:"server_standalone_notifications",SERVER_THREAD_SYNC:"server_thread_sync",SERVER_TAB_PRESENCE:"server_tab_presence",SERVER_UNREAD_THREADS:"server_unread_threads",SERVER_SEARCH:"server_search",SERVER_ADD_SHARE_DATA_TO_EXISTING_MESSAGE:"server_add_share_data_to_existing_message"};},null);
__d("MercurySendMessageFields",[],function(a,b,c,d,e,f){e.exports={AUTO_RETRY_CNT:"auto_retry_cnt",MANUAL_RETRY_CNT:"manual_retry_cnt"};},null);
__d("MercurySourceType",[],function(a,b,c,d,e,f){e.exports={CHAT_ORCA:"source:chat:orca",CHAT_IPHONE:"source:chat:iphone",CHAT_JABBER:"source:chat:jabber",CHAT_MEEBO:"source:chat:meebo",CHAT_WEB:"source:chat:web",CHAT_TEST:"source:chat:test",CHAT:"source:chat",EMAIL:"source:email",GIGABOXX_API:"source:gigaboxx:api",GIGABOXX_BLAST:"source:gigaboxx:blast",GIGABOXX_EMAIL_REPLY:"source:gigaboxx:emailreply",GIGABOXX_MOBILE:"source:gigaboxx:mobile",GIGABOXX_WAP:"source:gigaboxx:wap",GIGABOXX_WEB:"source:gigaboxx:web",LEIA:"source:leia",MESSENGER_WEB:"source:messenger:web",SAM_UFI:"source:sam:ufi",SHARE_DIALOG:"source:share:dialog",SEND_PLUGIN:"source:sendplugin",SMS:"source:sms",TEST:"source:test",TITAN_WAP:"source:titan:wap",TITAN_M_BASIC:"source:titan:m_basic",TITAN_M_FREE:"source:titan:m_free_basic",TITAN_M_JAPAN:"source:titan:m_japan",TITAN_M_MINI:"source:titan:m_mini",TITAN_M_TOUCH:"source:titan:m_touch",TITAN_M_APP:"source:titan:m_app",TITAN_M_TABLET:"source:titan:m_tablet",TITAN_M_ZERO:"source:titan:m_zero",TITAN_M_TALK:"source:titan:m_talk",TITAN_WEB:"source:titan:web",TITAN_FACEWEB_ANDROID:"source:titan:faceweb_android",TITAN_FACEWEB_BUFFY:"source:titan:faceweb_buffy",TITAN_FACEWEB_IPAD:"source:titan:faceweb_ipad",TITAN_FACEWEB_IPHONE:"source:titan:faceweb_iphone",TITAN_FACEWEB_UNKNOWN:"source:titan:faceweb_unknown",TITAN_API:"source:titan:api",TITAN_API_MOBILE:"source:titan:api_mobile",TITAN_ORCA:"source:titan:orca",TITAN_EMAIL_REPLY:"source:titan:emailreply",MOBILE:"source:mobile",PAGE_PLATFORM_API:"source:page_platform_api",UNKNOWN:"source:unknown",WEB:"source:web",HELPCENTER:"source:helpcenter",NEW_SHARE_DIALOG:"source:share:dialog:new",PAID_PROMOTION:"source:paid_promotion",BUFFY_SMS:"source:buffy:sms",WEBRTC_MOBILE:"source:webrtc:mobile",MESSENGER_COMMERCE:"source:messenger:commerce"};},null);
__d("MercuryThreadMode",[],function(a,b,c,d,e,f){e.exports={EMAIL_ORIGINATED:1,TITAN_ORIGINATED:2,OBJECT_ORIGINATED:3};},null);
__d("MercuryTimePassed",[],function(a,b,c,d,e,f){e.exports={TODAY:0,WEEK_AGO:1,MONTH_AGO:2,CURRENT_YEAR:3,OTHER_YEAR:4};},null);
__d("MessagingEvent",[],function(a,b,c,d,e,f){e.exports={DELETE:"delete",DELETE_MESSAGES:"delete_messages",DELIVER:"deliver",ERROR:"error",READ:"read",REPORT_SPAM:"report_spam",REPORT_SPAM_MESSAGES:"report_spam_messages",UNMARK_SPAM:"unmark_spam",SUBSCRIBE:"subscribe",CHANGE_MUTE_SETTINGS:"change_mute_settings",TAG:"tag",UNREAD:"unread",UNSUBSCRIBE:"unsubscribe",DELIVER_LOG:"deliver_log",MORE_THREADS:"more_threads",READ_ALL:"read_all",READ_RECEIPT:"read_receipt",DELIVERY_RECEIPT:"delivery_receipt",SENT_PUSH:"sent_push",DELIVER_FAST_PAST:"deliver_fast_path",MESSENGER_STATUS:"messenger_status",UPDATE_PINNED_THREADS:"update_pinned_threads"};},null);
__d("MessagingTag",[],function(a,b,c,d,e,f){e.exports={GROUPS:"groups",UNREAD:"unread",ACTION_ARCHIVED:"action:archived",INBOX:"inbox",OTHER:"other",EVENT:"event",SENT:"sent",SMS_MUTE:"sms_mute",SPAM:"spam",UPDATES:"broadcasts_inbox",BCC:"header:bcc",FILTERED_CONTENT:"filtered_content",UNAVAILABLE_ATTACHMENT:"unavailable_attachment",ARCHIVED:"archived",EMAIL:"email",VOICEMAIL:"voicemail",SPAM_SPOOFING:"spam:spoofing",SPOOF_WARNING:"MTA:spoof_warning",SMS_TAG_ROOT:"SMSShortcode:",APP_ID_ROOT:"app_id:",DOMAIN_AUTH_PASS:"MTA:dmarc:pass",DOMAIN_AUTH_FAIL:"MTA:dmarc:fail",MTA_SYSTEM_MESSAGE:"MTA:system_message",EMAIL_MESSAGE:"source:email"};},null);
__d("PagesMessagingConst",[],function(a,b,c,d,e,f){e.exports={LOAD_MESSAGE_THREAD_URI:"\/ajax\/pages\/messages\/load_message_thread.php",ASYNC_ENDPOINT:"\/ajax\/messaging\/async.php"};},null);
__d("PhotoResizeModeConst",[],function(a,b,c,d,e,f){e.exports={CONTAIN:"s",COVER:"p"};},null);
__d("PUWErrorCodes",[],function(a,b,c,d,e,f){e.exports={BAD_JPEG:9901,WORKER_TERMINATED:9902,UNKNOWN_RESIZE_ERROR:9903,WORKER_ABORT:9904};},null);
__d("SyncRequestStatusEnum",[],function(a,b,c,d,e,f){e.exports={PENDING:0,ACCEPTED:1,REJECTED:2,EXPIRED:3,CANCELED:4,namesByValue:["PENDING","ACCEPTED","REJECTED","EXPIRED","CANCELED"]};},null);
__d("AdsPagerConstants",["keyMirror"],function(a,b,c,d,e,f,g){var h=g({ADD_PAGE:null,PAGE_TRANSITION:null,REQUEST_PAGE:null}),i=g({VIEW_ACTION:null,SERVER_ACTION:null});e.exports={ActionTypes:h,PayloadSources:i};},null);
__d("AdsPagerDispatcher",["AdsPagerConstants","Dispatcher","copyProperties"],function(a,b,c,d,e,f,g,h,i){'use strict';var j=g.PayloadSources;function k(m){return function(n){this.dispatch({payloadSource:m,action:n});};}var l=i(new h(),{handleUpdateFromViewAction:k(j.VIEW_ACTION),handleUpdateFromServerAction:k(j.SERVER_ACTION)});e.exports=l;},null);
__d("mergeObjects",["copyProperties"],function(a,b,c,d,e,f,g){function h(){var i={};for(var j=0;j<arguments.length;j++)g(i,arguments[j]);return i;}e.exports=h;},null);
__d("AdsRefreshHandler",["AdsMouseStateStore","AdsPagerDispatcher","AdsPagerConstants","Arbiter","Animation","DOM","Event","SubscriptionsHandler","UIPagelet","csx","debounceAcrossTransitions","mergeObjects"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){var s=g.STATES,t=600;function u(v,w,x){"use strict";if(!x.data||!x.pid)return;this.$AdsRefreshHandler0=v;this.$AdsRefreshHandler1=Date.now();this.$AdsRefreshHandler2=w;this.$AdsRefreshHandler3=x;this.$AdsRefreshHandler4=0;this.$AdsRefreshHandler5=false;this.$AdsRefreshHandler6=true;this.$AdsRefreshHandler7=q(this.reloadAdsIfNeeded.bind(this),this.$AdsRefreshHandler2.delay);this.$AdsRefreshHandler8=new n();this.$AdsRefreshHandler8.addSubscriptions(m.listen(this.$AdsRefreshHandler0,'mouseenter',this.setMouseOver.bind(this,true)),m.listen(this.$AdsRefreshHandler0,'mouseleave',this.setMouseOver.bind(this,false)),g.subscribe('change',this.onMouseStateStoreChange.bind(this)),j.subscribe('AdsPreferencesDialog/opened',this.stopRefreshingRHC.bind(this)),j.subscribe('AdsPreferencesDialog/closed',this.startRefreshingRHC.bind(this)));h.register(this.handlePageDispatch.bind(this));}u.prototype.handlePageDispatch=function(v){"use strict";var w=v.action||{};if(w.actionType===i.ActionTypes.REQUEST_PAGE)this.reloadAds();};u.prototype.setMouseOver=function(v){"use strict";this.$AdsRefreshHandler9=v;};u.prototype.subscribeDefaultEventsForRefresh=function(){"use strict";this.$AdsRefreshHandler8.addSubscriptions(m.listen(window,'scroll',this.$AdsRefreshHandler7),m.listen(window,'resize',this.$AdsRefreshHandler7));return this;};u.prototype.reloadWithDebounce=function(){"use strict";this.$AdsRefreshHandler7();};u.prototype.reloadWithoutDebounce=function(){"use strict";this.reloadAdsIfNeeded();};u.prototype.stopRefreshingRHC=function(v,w){"use strict";this.$AdsRefreshHandler6=false;};u.prototype.startRefreshingRHC=function(v,w){"use strict";this.$AdsRefreshHandler1=Date.now();this.$AdsRefreshHandler6=true;};u.prototype.forceLoadIfEnoughTimePassed=function(v){"use strict";if(Date.now()-this.$AdsRefreshHandler1>v)this.reloadAds();};u.prototype.containsPremium=function(){"use strict";var v=l.scry(this.$AdsRefreshHandler0,"div._4u8");return !!v.filter(function(w){return JSON.parse(w.getAttribute('data-ad')).segment==='premium';}).length;};u.prototype.reloadAdsIfNeeded=function(){"use strict";if(!this.$AdsRefreshHandler0)return;j.inform('AdsRefreshHandler/CheckingReload');if(this.$AdsRefreshHandler2.stateRefresh){this.reloadAdsIfNeededStateBased();return;}if(this.containsPremium()||this.$AdsRefreshHandler9||!this.$AdsRefreshHandler2.interval)return;if(Date.now()-this.$AdsRefreshHandler1>=this.$AdsRefreshHandler2.interval)this.reloadAds();};u.prototype.reloadAdsIfNeededStateBased=function(){"use strict";if(Date.now()-this.$AdsRefreshHandler1<this.$AdsRefreshHandler2.interval)return;if(this.containsPremium())return;if(!this.$AdsRefreshHandler2.interval)return;this.$AdsRefreshHandler5=true;j.inform('AdsRefreshHandler/RefreshScheduled');this.checkScheduledRefresh();};u.prototype.getRefreshScheduled=function(){"use strict";return this.$AdsRefreshHandler5;};u.prototype.onMouseStateStoreChange=function(){"use strict";this.checkScheduledRefresh();};u.prototype.checkScheduledRefresh=function(){"use strict";if(!this.$AdsRefreshHandler5)return;if(this.$AdsRefreshHandler9)return;var v=g.getState(),w=false;switch(v){case s.HOVER:case s.NO_INTENT:w=true;break;default:break;}if(!w)return;this.$AdsRefreshHandler5=false;this.reloadAds();};u.prototype.reloadAds=function(){"use strict";if(!this.$AdsRefreshHandler0)return;this.$AdsRefreshHandler1=Date.now();if(!this.$AdsRefreshHandler6)return;var v=this.$AdsRefreshHandler3&&this.$AdsRefreshHandler3.data,w=r(v,{refresh_num:++this.$AdsRefreshHandler4});o.loadFromEndpoint('WebEgoPane',this.$AdsRefreshHandler0,{dom_id:l.getID(this.$AdsRefreshHandler0),pid:this.$AdsRefreshHandler3.pid,data:w},{bundle:false,handler:this.onLoadHandler.bind(this)});j.inform('AdsRefreshHandler/AdsLoading');};u.prototype.onLoadHandler=function(){"use strict";j.inform('AdsRefreshHandler/AdsLoaded');if(!this.$AdsRefreshHandler2.fade)return;(new k(this.$AdsRefreshHandler0)).from('opacity',0).to('opacity',1).duration(t).go();};u.prototype.cleanup=function(){"use strict";this.$AdsRefreshHandler0=null;this.$AdsRefreshHandler8.release();this.$AdsRefreshHandler7.reset();};e.exports=u;},null);
__d("HomeRHCAdsBasicRefresh",["AdsRefreshHandler","Arbiter","NavigationMessage","Run","SubscriptionsHandler","ge"],function(a,b,c,d,e,f,g,h,i,j,k,l){var m,n,o,p;function q(){if(m){m.cleanup();m=null;}if(n){n.release();n=null;}o=null;}function r(){var u=l(p);if(u&&o){u.appendChild(o);o=null;}}function s(u,v){o=v;m&&m.forceLoadIfEnoughTimePassed(0);}var t={init:function(u,v,w){p=u;m=new g(l(u),v,w).subscribeDefaultEventsForRefresh();n=new k();n.addSubscriptions(h.subscribe(i.NAVIGATION_BEGIN,q),h.subscribe('ProfileQuestionAnswered',s),h.subscribe('AdsRefreshHandler/AdsLoaded',r));j.onLeave(q);}};e.exports=t;},null);
__d("ChatConfig",["ChatConfigInitialData","copyProperties"],function(a,b,c,d,e,f,g,h){var i={},j={get:function(k,l){return k in i?i[k]:l;},set:function(k){if(arguments.length>1){var l={};l[k]=arguments[1];k=l;}h(i,k);},getDebugInfo:function(){return i;}};j.set(g);e.exports=j;},null);
__d("SystemEvents",["Arbiter","ErrorUtils","SystemEventsInitialData","UserAgent_DEPRECATED","copyProperties","setIntervalAcrossTransitions"],function(a,b,c,d,e,f,g,h,i,j,k,l){var m=new g(),n=[],o=1000;l(function(){for(var y=0;y<n.length;y++)n[y]();},o);function p(){return (/c_user=(\d+)/.test(document.cookie)&&RegExp.$1)||0;}function q(){return i.ORIGINAL_USER_ID;}var r=q(),s=navigator.onLine;function t(){if(!s){s=true;m.inform(m.ONLINE,s);}}function u(){if(s){s=false;m.inform(m.ONLINE,s);}}if(j.ie()){if(j.ie()>=11){window.addEventListener('online',t,false);window.addEventListener('offline',u,false);}else if(j.ie()>=8){window.attachEvent('onload',function(){document.body.ononline=t;document.body.onoffline=u;});}else n.push(function(){(navigator.onLine?t:u)();});}else if(window.addEventListener)if(!j.chrome()){window.addEventListener('online',t,false);window.addEventListener('offline',u,false);}var v=r;n.push(function(){var y=p();if(v!=y){m.inform(m.USER,y);v=y;}});var w=Date.now();function x(){var y=Date.now(),z=y-w,aa=z<0||z>10000;w=y;if(aa)m.inform(m.TIME_TRAVEL,z);return aa;}n.push(x);n.push(function(){if(window.onerror!=h.onerror)window.onerror=h.onerror;});k(m,{USER:'SystemEvents/USER',ONLINE:'SystemEvents/ONLINE',TIME_TRAVEL:'SystemEvents/TIME_TRAVEL',isPageOwner:function(y){return (y||p())==r;},isOnline:function(){return j.chrome()||s;},checkTimeTravel:x});e.exports=m;},null);
__d("ChannelSubdomain",["Event","JSLogger","Run","setTimeoutAcrossTransitions","LogHistory","WebStorage"],function(a,b,c,d,e,f,g,h,i,j){var k=b('LogHistory').getInstance('channel'),l=b('WebStorage').getLocalStorage(),m=h.create('channel'),n='channel_sub:',o=7,p=100*1000,q=null,r;function s(){if(r){clearTimeout(r);r=null;}if(l&&q!=null)l.removeItem(n+q);q=null;}function t(u,v,w){var x=(u-1)*o;if(w){if(r)clearTimeout(r);q=r=null;}if(v==null)v=Math.floor(Math.random()*x);if(q==null)if(l){var y=[];for(var z=0;z<l.length;z++){var aa=l.key(z);if(aa.indexOf(n)===0){var ba=parseInt(aa.substr(n.length),10);y[ba]=parseInt(l.getItem(aa),10);}}var ca=Date.now()-p;for(z=0;z<x;z++){var da=(z+v)%x;if(!y[da]||y[da]<ca){q=da;break;}}if(q!=null){var ea=function(){try{l.setItem(n+q,Date.now());}catch(fa){k.warn('subdomain set failed',fa.message);}r=j(ea,p/2);};ea();}else{k.warn('no channel subdomain',y);m.error('subdomain_overflow');}if(typeof window.onpageshow!='undefined'){g.listen(window,'pagehide',s);}else i.onUnload(s);}else q=v;return q==null?null:q%o;}e.exports={allocate:t,clear:s};},null);
__d("DocRPC",["ErrorUtils"],function(a,b,c,d,e,f,g){var h={_apis:{},_dispatch:function(i){var j;try{i=JSON.parse(i);}catch(k){throw new Error('DocRPC unparsable dispatch: "'+i+'"');}if(h._apis.hasOwnProperty(i.api)){var l=h._apis[i.api];if(l[i.method])j=g.applyWithGuard(l[i.method],l,i.args);}if(j===(void 0))j=null;return JSON.stringify(j);},publish:function(i,j){h._apis[j]=i;},proxy:function(i,j,k){var l={};k.forEach(function(m){l[m]=function(){var n={api:j,method:m,args:Array.prototype.slice.call(arguments)},o;try{if(i.closed)throw new Error('DocRPC window closed');o=i.DocRPC._dispatch(JSON.stringify(n));}catch(p){g.reportError(p);return;}if(typeof(o)=='string')try{o=JSON.parse(o);}catch(p){throw new Error('DocRPC '+j+'.'+m+' unparsable return: "'+o+'"');}return o;};});return l;}};e.exports=a.DocRPC=h;},null);
__d("ChannelTransport",["copyProperties","bind","AjaxRequest","URI","JSLogger","DocRPC","ChannelConstants","setTimeoutAcrossTransitions"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){var o=k.create('channel');function p(){return (1048576*Math.random()|0).toString(36);}function q(z,aa){var ba=z.subdomain;ba=ba===null?'':(ba+'-');var ca=new j(aa).setDomain(ba+z.host+'.facebook.com').setPort(z.port).setSecure(j().isSecure());return ca;}function r(z){var aa={partition:z.partition,cb:p()};if(z.sticky_token)aa.sticky_token=z.sticky_token;var ba=q(z,'/p').setQueryData(aa);o.log('start_p',{uri:ba.toString()});var ca=new i('GET',ba);if(i.supportsCORS())ca.xhr.withCredentials=true;var da=function(ea){o.log('finish_p',{xhr:ea.toJSON?ea.toJSON():ea});};ca.timeout=z.P_TIMEOUT;ca.onError=ca.onSuccess=da;ca.send();}function s(z,aa,ba){var ca=new Image(),da=0,ea=function(ha){ca.abort();return ha?aa():ba();};ca.onload=function(){o.log('ping_ok',{duration:Date.now()-da});ea(true);};ca.onerror=function(){r(z);ea(false);};var fa=n(ca.onerror,10000);ca.abort=function(){if(fa){clearTimeout(fa);fa=null;}ca.onload=ca.onerror=null;};var ga={partition:z.partition,cb:p()};if(z.sticky_token)ga.sticky_token=z.sticky_token;if(z.sticky_pool)ga.sticky_pool=z.sticky_pool;if(z.lastRequestErrorReason){ga.reason=z.lastRequestErrorReason;z.lastRequestErrorReason=null;}if(z.uid&&z.viewerUid){ga.uid=z.uid;ga.viewer_uid=z.viewerUid;}if(z.watchdog&&z.watchdog.enabled)ga.wtc=z.watchdog.doSerialize();da=Date.now();ca.src=q(z,'/ping').setQueryData(ga);return ca;}function t(z){var aa={channel:z.user_channel,partition:z.partition,clientid:z.sessionID,cb:p(),cap:0,uid:z.uid,viewer_uid:z.viewerUid};if(z.sticky_token)aa.sticky_token=z.sticky_token;if(z.sticky_pool)aa.sticky_pool=z.sticky_pool;if(z.is_offline){aa.state='offline';}else aa.state='active';if(aa.state===z.lastPresenceState)return;z.lastPresenceState=aa.state;if(z.profile)aa.profile=z.profile;if(z.capabilities)aa.cap=z.capabilities;var ba=q(z,'/active_ping').setQueryData(aa),ca=new i('GET',ba);if(i.supportsCORS())ca.xhr.withCredentials=true;ca.onError=function(da){o.warn('active_ping_error');};ca.onSuccess=function(da){o.log('active_ping_ok');};ca.timeout=z.P_TIMEOUT;ca.send();}function u(z,aa,ba,ca){var da=new Date(),ea=-1;if(z.userActive>0){ea=(da-z.userActive)/1000|0;if(ea<0)o.warn('idle_regression',{idleTime:ea,now:da.getTime(),userActive:z.userActive});}var fa={channel:z.user_channel,seq:z.seq,partition:z.partition,clientid:z.sessionID,cb:p(),idle:ea,cap:0};if(!!z.watchdog&&z.watchdog.enabled)fa.wtc=z.watchdog.doSerialize();if(z.uid&&z.viewerUid){fa.uid=z.uid;fa.viewer_uid=z.viewerUid;}if(z.sticky_token)fa.sticky_token=z.sticky_token;if(z.sticky_pool)fa.sticky_pool=z.sticky_pool;if('trace_id' in z)fa.traceid=z.trace_id;if(z.is_offline){fa.state='offline';}else if(z.userActive>0&&ea<60)fa.state='active';z.lastPresenceState=fa.state;if(z.streamingCapable){fa.mode='stream';fa.format='json';}if(z.profile)fa.profile=z.profile;if(z.capabilities)fa.cap=z.capabilities;var ga=q(z,'/pull').setQueryData(fa),ha=z.fantail_enabled?'POST':'GET',ia=new i(ha,ga);if(i.supportsCORS())ia.xhr.withCredentials=true;ia.timeout=z.streamingCapable?z.STREAMING_TIMEOUT:z.LONGPOLL_TIMEOUT;ia.onJSON=aa;ia.onSuccess=ba;ia.onError=function(){var la=(this.status==12002&&this._time>=z.MIN_12002_TIMEOUT)||(this.status==504&&this._time>=z.MIN_504_TIMEOUT),ma=la?ba:ca;return ma&&ma.apply(this,arguments);};if(z.fantail_logs&&z.fantail_logs.length>0){var ja={};for(var ka=0;ka<z.fantail_logs.length;ka++)g(ja,z.fantail_logs[ka]);ia.send(ja);z.fantail_logs=[];}else ia.send();z.inStreaming=z.streamingCapable;return ia;}function v(z){this.manager=z;(this.init&&this.init());}function w(z){v.apply(this,arguments);}g(w.prototype,{logName:'CORS',enterState:function(z,aa){if(this._request){this._request.abort();this._request=null;}if(z=='init')n(h(this.manager,'exitState',{status:m.OK,stateId:aa.stateId}),3000);if(!/pull|ping/.test(z))return;var ba=this.manager;if(z=='ping'){this._request=s(aa,h(ba,'exitState',{status:m.OK,stateId:aa.stateId}),h(ba,'exitState',{status:m.ERROR,stateId:aa.stateId}));}else if(z=='pull')this._request=u(aa,h(ba,'_processTransportData',aa.stateId),h(ba,'exitState',{status:m.OK,stateId:aa.stateId}),h(ba,'exitState',{status:m.ERROR,stateId:aa.stateId}));}});function x(z){o.log('iframe_init_constructor');v.apply(this,arguments);this._iframe=document.createElement('iframe');this._iframe.style.display='none';document.body.appendChild(this._iframe);l.publish(this,'outerTransport');}g(x.prototype,{logName:'iframe',_initIframe:function(z){o.log('iframe_init_start');window.onchanneliframeready=function(){o.log('iframe_resources');return z.resources;};window.onchanneliframeloaded=function(){o.log('iframe_loaded');};if(z){this._iframeURI=q(z,z.path);if(z.resources){var aa=this._iframeURI.getDomain();z.resources=z.resources.map(function(da){var ea=j(da);if(ea.getPath().startsWith('/intern/rsrc.php')&&ea.getQueryData().origin!==(void 0))return ea.addQueryData('origin',aa).toString();return da;});}if(z.bustIframe){var ba={partition:z.partition,cb:p()};this._iframeURI.setQueryData(ba);}}else this._iframeURI='about:blank';this._iframeProxy=null;try{this._iframe.contentWindow.location.replace(this._iframeURI);o.log('iframe_uri_set');}catch(ca){o.error('iframe_uri_set_error',ca);this.exitState({status:m.ERROR,stateId:z.stateId},ca+'');}},enterState:function(z,aa){if(z=='init'){this._initIframe(aa);}else if(/idle|ping|pull/.test(z)){if(this._iframeProxy){this._iframeProxy.enterState.apply(this._iframeProxy,arguments);}else if(z!='idle')this.exitState({status:m.ERROR,stateId:aa.stateId},'iframe not yet loaded');}else if(z=='shutdown')this._initIframe();},_processTransportData:function(){this.manager._processTransportData.apply(this.manager,arguments);},exitState:function(z){if(this.manager.state=='init'&&z.status==m.OK)this._iframeProxy=l.proxy(this._iframe.contentWindow,'innerTransport',['enterState'],(this._iframeURI+'').replace(/iframe.*/,''));if(/ping|pull/.test(this.manager.state)&&!this._iframeProxy)return;this.manager.exitState.apply(this.manager,arguments);}});function y(){this.init=this.init.bind(this);v.apply(this,arguments);}g(y.prototype,{logName:'iframe(inner)',init:function(){l.publish(this,'innerTransport');try{var aa=l.proxy(window.parent,'outerTransport',['_processTransportData','exitState'],top.DocRPC.origin);g(this,aa);this.exitState({status:m.OK,stateId:1e+06});}catch(z){o.error('iframe_inner_init_error',z);}},enterState:function(z,aa){if(this._request){this._request.abort();this._request=null;}if(z=='ping'){this._request=s(aa,h(this,'exitState',{status:m.OK,stateId:aa.stateId}),h(this,'exitState',{status:m.ERROR,stateId:aa.stateId}));}else if(z=='pull')this._request=u(aa,h(this,'_processTransportData',aa.stateId),h(this,'exitState',{status:m.OK,stateId:aa.stateId}),h(this,'exitState',{status:m.ERROR,stateId:aa.stateId}));}});e.exports={getURI:q,Transport:v,CORSTransport:w,IframeTransport:x,IframeInnerTransport:y,sendActivePing:t};},null);
__d("PresencePrivacy",["Arbiter","AsyncRequest","ChannelConstants","CurrentUser","PresencePrivacyInitialData","JSLogger","PresenceUtil","copyProperties"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){var o='/ajax/chat/privacy/settings.php',p='/ajax/chat/privacy/online_policy.php',q='/ajax/chat/privacy/visibility.php',r='friend_visibility',s='visibility',t='online_policy',u=n({},k.privacyData),v=k.visibility,w=n({},k.privacyData),x=v,y=k.onlinePolicy,z=y,aa=[],ba=false;function ca(){return l.create('blackbird');}var da=n(new g(),{WHITELISTED:1,BLACKLISTED:-1,UNLISTED:0,ONLINE:1,OFFLINE:0,ONLINE_TO_WHITELIST:0,ONLINE_TO_BLACKLIST:1});function ea(qa){var ra;for(ra in qa){var sa=qa[ra];if(ra==j.getID()){ca().error('set_viewer_visibility');throw new Error("Invalid to set current user's visibility");}switch(sa){case da.WHITELISTED:case da.BLACKLISTED:case da.UNLISTED:break;default:ca().error('set_invalid_friend_visibility',{id:ra,value:sa});throw new Error("Invalid state: "+sa);}}for(ra in qa)u[ra]=qa[ra];da.inform('privacy-changed');}function fa(qa,ra){var sa={};sa[qa]=ra;ea(sa);}function ga(qa){switch(qa){case da.ONLINE:case da.OFFLINE:break;default:ca().error('set_invalid_visibility',{value:qa});throw new Error("Invalid visibility: "+qa);}v=qa;da.inform('privacy-changed');da.inform('privacy-user-presence-changed');g.inform('chat/visibility-changed',{sender:this});}function ha(qa){switch(qa){case da.ONLINE_TO_WHITELIST:case da.ONLINE_TO_BLACKLIST:break;default:throw new Error("Invalid default online policy: "+qa);}y=qa;da.inform('privacy-user-presence-changed');da.inform('privacy-changed');}function ia(qa,ra){ba=true;qa.send();}function ja(qa,ra){aa.push({request:qa,data:ra});if(!ba){var sa=aa.shift();ia(sa.request,sa.data);}}function ka(qa,ra){var sa=qa.type;if(sa===r){var ta=ra.payload.user_availabilities;if(!Array.isArray(ta)){da.inform('privacy-availability-changed',{user_availabilities:ta});for(var ua in qa.settings)w[ua]=qa.settings[ua];}}else{if(sa===s){x=qa.visibility;}else if(sa===t)z=qa.online_policy;da.inform('privacy-user-presence-response');}ca().log('set_update_response',{data:qa,response:ra});}function la(qa,ra){if(v!==x)ga(x);if(y!==z)ha(z);n(u,w);da.inform('privacy-changed');aa=[];ca().log('set_error_response',{data:qa,response:ra});}function ma(qa){ba=false;if(aa.length>0){var ra=aa.shift();ia(ra.request,ra.data);}}function na(qa,ra){if(m!=null){var sa=qa.getData();sa.window_id=m.getSessionID();qa.setData(sa);}qa.setHandler(ka.bind(this,ra)).setErrorHandler(la.bind(this,ra)).setTransportErrorHandler(la.bind(this,ra)).setFinallyHandler(ma.bind(this)).setAllowCrossPageTransition(true);return qa;}function oa(qa,ra,sa){return na(new h(qa).setData(ra),sa);}function pa(qa,ra){var sa=ra.obj;if(sa.viewer_id!=j.getID()){ca().error('invalid_viewer_for_channel_message',{type:qa,data:ra});throw new Error("Viewer got from the channel is not the real viewer");}if(sa.window_id===m.getSessionID())return;var ta=sa.data;if(sa.event=='access_control_entry'){ta.target_ids.forEach(function(va){fa(va,ta.setting);w[va]=ta.setting;});}else{if(sa.event=='visibility_update'){var ua=!!ta.visibility?da.ONLINE:da.OFFLINE;ga(ua);x=ua;}else if(sa.event=='online_policy_update'){ha(ta.online_policy);z=ta.online_policy;}da.inform('privacy-user-presence-response');}ca().log('channel_message_received',{data:ra.obj});}n(da,{WHITELISTED:1,BLACKLISTED:-1,UNLISTED:0,ONLINE:1,OFFLINE:0,ONLINE_TO_WHITELIST:0,ONLINE_TO_BLACKLIST:1,init:function(qa,ra,sa){},setVisibility:function(qa){x=v;ga(qa);var ra={visibility:qa},sa={type:s,visibility:qa},ta=oa(q,ra,sa);ja(ta,sa);ca().log('set_visibility',{data:ra});return qa;},getVisibility:function(){return v;},setOnlinePolicy:function(qa){z=y;ha(qa);var ra={online_policy:qa},sa={type:t,online_policy:qa},ta=oa(p,ra,sa);ja(ta,sa);ca().log('set_online_policy',{data:ra});return qa;},getOnlinePolicy:function(){return y;},getFriendVisibility:function(qa){return u[qa]||da.UNLISTED;},isUserOffline:function(){return this.getVisibility()===da.OFFLINE;},allows:function(qa){if(this.isUserOffline())return false;var ra=this.getOnlinePolicy();return ra===da.ONLINE_TO_WHITELIST?u[qa]==da.WHITELISTED:u[qa]!=da.BLACKLISTED;},setFriendsVisibility:function(qa,ra){if(qa.length>0){var sa={};for(var ta=0;ta<qa.length;ta++){var ua=qa[ta];w[ua]=u[ua];sa[ua]=ra;}ea(sa);var va=ra;if(va==da.UNLISTED)va=w[qa[0]];var wa={users:qa,setting:ra,setting_type:va},xa={type:r,settings:sa},ya=oa(o,wa,xa);ja(ya,xa);ca().log('set_friend_visibility',{data:wa});}return ra;},setFriendVisibilityMap:function(qa,ra){for(var sa in qa)w[sa]=u[sa];ea(qa);var ta={type:r,settings:qa};ja(na(ra,ta),ta);ca().log('set_friend_visibility_from_map',{data:qa});},allow:function(qa){if(this.allows(qa)){ca().error('allow_already_allowed');throw new Error("allow() should only be called for users that "+"are not already allowed");}if(this.getVisibility()===da.OFFLINE){ca().error('allow_called_while_offline');throw new Error("allow() should only be called when the user is already online");}var ra=this.getOnlinePolicy()===da.ONLINE_TO_WHITELIST?da.WHITELISTED:da.UNLISTED;return this.setFriendsVisibility([qa],ra);},disallow:function(qa){if(!this.allows(qa)){ca().error('disallow_already_disallowed');throw new Error("disallow() should only be called for users that "+"are not already disallowed");}if(this.getVisibility()===da.OFFLINE){ca().error('disallow_called_while_offline');throw new Error("disallow() should only be called when the user is already online");}var ra=this.getOnlinePolicy()===da.ONLINE_TO_BLACKLIST?da.BLACKLISTED:da.UNLISTED;return this.setFriendsVisibility([qa],ra);},getBlacklist:function(){var qa=[];for(var ra in u)if(u[ra]===da.BLACKLISTED)qa.push(ra);return qa;},getWhitelist:function(){var qa=[];for(var ra in u)if(u[ra]===da.WHITELISTED)qa.push(ra);return qa;},getMapForTest:function(){return u;},setMapForTest:function(qa){u=qa;}});da.inform('privacy-changed');da.inform('privacy-user-presence-changed',g.BEHAVIOR_STATE);ca().log('initialized',{visibility:v,policy:y});g.subscribe(l.DUMP_EVENT,function(qa,ra){ra.presence_privacy={initial:k.privacyData,current:u};});g.subscribe(i.getArbiterType('privacy_changed'),pa.bind(this));g.subscribe(i.ON_CONFIG,function(qa,ra){var sa=ra.getConfig('visibility',null);if(sa!==null&&typeof(sa)!=='undefined'){var ta=sa?da.ONLINE:da.OFFLINE;ga(ta);ca().log('config_visibility',{vis:ta});}}.bind(this));a.PresencePrivacy=e.exports=da;},3);
__d("ChatVisibility",["Arbiter","JSLogger","PresencePrivacy"],function(a,b,c,d,e,f,g,h,i){var j={isOnline:function(){return i.getVisibility()===i.ONLINE;},hasBlackbirdEnabled:function(){return this.isVisibleToMostFriends()||this.isVisibleToSomeFriends();},isVisibleToMostFriends:function(){return i.getOnlinePolicy()===i.ONLINE_TO_BLACKLIST&&i.getBlacklist().length>0;},isVisibleToSomeFriends:function(){return i.getOnlinePolicy()===i.ONLINE_TO_WHITELIST&&i.getWhitelist().length>0;},goOnline:function(k){if(i.getVisibility()===i.OFFLINE){h.create('blackbird').log('chat_go_online');i.setVisibility(i.ONLINE);g.inform('chat-visibility/go-online');}k&&k();},goOffline:function(k){if(i.getVisibility()===i.ONLINE){h.create('blackbird').log('chat_go_offline');i.setVisibility(i.OFFLINE);g.inform('chat-visibility/go-offline');}k&&k();},toggleVisibility:function(){if(j.isOnline()){j.goOffline();}else j.goOnline();}};e.exports=j;},null);
__d("MovingStat",[],function(a,b,c,d,e,f){function g(h){h=h||60000;var i={t:new Date(),count:0,v:0},j=i,k=0,l=0;function m(){var n=new Date()-h;while(j&&j.next&&j.t<n){k-=j.v;l-=j.count;j=j.next;}}this.add=function(n){k+=n;l++;var o=new Date();if(o-i.t<1000){i.v+=n;i.count++;}else{i.next={t:o,v:n,count:1};i=i.next;m();}};this.tally=function(n){n=n||1000;m();return {sum:k,count:l,timeAverage:k*n/h};};}e.exports=g;},null);
__d("Dcode",[],function(a,b,c,d,e,f){var g,h={},i={_:'%',A:'%2',B:'000',C:'%7d',D:'%7b%22',E:'%2c%22',F:'%22%3a',G:'%2c%22ut%22%3a1',H:'%2c%22bls%22%3a',I:'%2c%22n%22%3a%22%',J:'%22%3a%7b%22i%22%3a0%7d',K:'%2c%22pt%22%3a0%2c%22vis%22%3a',L:'%2c%22ch%22%3a%7b%22h%22%3a%22',M:'%7b%22v%22%3a2%2c%22time%22%3a1',N:'.channel%22%2c%22sub%22%3a%5b',O:'%2c%22sb%22%3a1%2c%22t%22%3a%5b',P:'%2c%22ud%22%3a100%2c%22lc%22%3a0',Q:'%5d%2c%22f%22%3anull%2c%22uct%22%3a',R:'.channel%22%2c%22sub%22%3a%5b1%5d',S:'%22%2c%22m%22%3a0%7d%2c%7b%22i%22%3a',T:'%2c%22blc%22%3a1%2c%22snd%22%3a1%2c%22ct%22%3a',U:'%2c%22blc%22%3a0%2c%22snd%22%3a1%2c%22ct%22%3a',V:'%2c%22blc%22%3a0%2c%22snd%22%3a0%2c%22ct%22%3a',W:'%2c%22s%22%3a0%2c%22blo%22%3a0%7d%2c%22bl%22%3a%7b%22ac%22%3a',X:'%2c%22ri%22%3a0%7d%2c%22state%22%3a%7b%22p%22%3a0%2c%22ut%22%3a1',Y:'%2c%22pt%22%3a0%2c%22vis%22%3a1%2c%22bls%22%3a0%2c%22blc%22%3a0%2c%22snd%22%3a1%2c%22ct%22%3a',Z:'%2c%22sb%22%3a1%2c%22t%22%3a%5b%5d%2c%22f%22%3anull%2c%22uct%22%3a0%2c%22s%22%3a0%2c%22blo%22%3a0%7d%2c%22bl%22%3a%7b%22ac%22%3a'};(function(){var k=[];for(var l in i){h[i[l]]=l;k.push(i[l]);}k.reverse();g=new RegExp(k.join("|"),'g');})();var j={encode:function(k){return encodeURIComponent(k).replace(/([_A-Z])|%../g,function(l,m){return m?'%'+m.charCodeAt(0).toString(16):l;}).toLowerCase().replace(g,function(l){return h[l];});},decode:function(k){return decodeURIComponent(k.replace(/[_A-Z]/g,function(l){return i[l];}));}};e.exports=j;},null);
__d("PresenceCookieManager",["Cookie","CurrentUser","Dcode","ErrorUtils","JSLogger","PresenceInitialData","PresenceUtil","URI"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){var o=l.cookieVersion,p=l.dictEncode,q='presence',r={},s=null,t=null,u=k.create('presence_cookie');function v(){try{var z=g.get(q);if(s!==z){s=z;t=null;if(z&&z.charAt(0)=='E')z=i.decode(z.substring(1));if(z)t=JSON.parse(z);}if(t&&(!t.user||t.user===h.getID()))return t;}catch(y){u.warn('getcookie_error',y);}return null;}function w(){return parseInt(Date.now()/1000,10);}var x={register:function(y,z){r[y]=z;},store:function(){var y=v();if(y&&y.v&&o<y.v){u.debug('stale_cookie',o);return;}var z={v:o,time:w(),user:h.getID()};for(var aa in r)z[aa]=j.applyWithGuard(r[aa],r,[y&&y[aa]],function(ea){ea.presence_subcookie=aa;});var ba=JSON.stringify(z);if(p)ba='E'+i.encode(ba);if(m.hasUserCookie()){var ca=ba.length;if(ca>1024)u.warn('big_cookie',ca);var da=n.getRequestURI(false).isSecure()&&!!g.get('csm');g.set(q,ba,null,null,da);}},clear:function(){g.clear(q);},getSubCookie:function(y){var z=v();if(!z)return null;return z[y];}};e.exports=x;},null);
__d("PresenceState",["Arbiter","ErrorUtils","JSLogger","PresenceCookieManager","copyProperties","debounceAcrossTransitions","setIntervalAcrossTransitions","PresenceInitialData"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){var o=n.cookiePollInterval||2000,p=[],q=[],r=null,s=null,t=0,u=null,v=0,w=['sb2','t2','lm2','uct2','tr','tw','at','wml'],x=i.create('presence_state');function y(){return j.getSubCookie('state');}function z(){t=Date.now();j.store();da(s);}var aa=l(z,0);function ba(ia){if(typeof ia=='undefined'||isNaN(ia)||ia==Number.POSITIVE_INFINITY||ia==Number.NEGATIVE_INFINITY)ia=0;return ia;}function ca(ia){var ja={};if(ia){w.forEach(function(ma){ja[ma]=ia[ma];});if(t<ia.ut)x.error('new_cookie',{cookie_time:ia.ut,local_time:t});}ja.ut=t;for(var ka=0,la=p.length;ka<la;ka++)h.applyWithGuard(p[ka],null,[ja]);s=ja;return s;}function da(ia){v++;t=ba(ia.ut);if(!r)r=m(ga,o);s=ia;if(u===null)u=ia;for(var ja=0,ka=q.length;ja<ka;ja++)h.applyWithGuard(q[ja],null,[ia]);v--;}function ea(ia){if(ia&&ia.ut)if(t<ia.ut){return true;}else if(ia.ut<t)x.error('old_cookie',{cookie_time:ia.ut,local_time:t});return false;}function fa(){var ia=y();if(ea(ia))s=ia;return s;}function ga(){var ia=y();if(ea(ia))da(ia);}j.register('state',ca);g.subscribe(i.DUMP_EVENT,function(ia,ja){ja.presence_state={initial:k({},u),state:k({},s),update_time:t,sync_paused:v,poll_time:o};});(function(){var ia=fa();if(ia){da(ia);}else{x.debug('no_cookie_initial');da(ca());return;}})();var ha={doSync:function(ia){if(v)return;if(ia){z();}else aa();},registerStateStorer:function(ia){p.push(ia);},registerStateLoader:function(ia){q.push(ia);},get:function(){return fa();},getInitial:function(){return u;},verifyNumber:ba};e.exports=ha;},null);
__d("ActiveXSupport",["UserAgent_DEPRECATED"],function(a,b,c,d,e,f,g){var h=null,i={isSupported:function(){if(h!==null)return h;try{if(g.ie()>=11){h=!!new ActiveXObject("htmlfile");}else h=!!window.ActiveXObject&&!!new ActiveXObject("htmlfile");}catch(j){h=false;}return h;}};e.exports=i;},null);
__d("FBRTCStruct",[],function(a,b,c,d,e,f){var g=function(i,j,k){var l,m;if(typeof i=='string'||i instanceof String){m=i;l=i;}else for(var n in i)if(i.hasOwnProperty(n))if(n==='index'){k=i[n];}else{m=n;l=i[n];}j[m]=k;j.strNames[k]=l;};function h(i){"use strict";this.strNames=[];for(var j=0;j<i.length;j++)g(i[j],this,j);}e.exports=h;},null);
__d("FBRTCConstants",["FBRTCStruct"],function(a,b,c,d,e,f,g){var h={OFFER:'offer',ANSWER:'answer',ICE_CANDIDATE:'ice_candidate',OK:'ok',PING:'ping',HANGUP:'hang_up',OTHER_DISMISS:'other_dismiss',MSG_ACK:'msg_ack',PRANSWER:'pranswer',ICERESTART_OFFER:'icerestart_offer',ICERESTART_ANSWER:'icerestart_answer',PCRESTART_OFFER:'pcrestart_offer',PCRESTART_ANSWER:'pcrestart_answer',OFFER_ACK:'offer_ack',OFFER_NACK:'offer_nack',ANSWER_ACK:'answer_ack',SET_VIDEO:'set_video'},i=new g([{IGNORE_CALL:'IgnoreCall'},{HANGUP_CALL:'HangupCall'},{IN_ANOTHER_CALL:'InAnotherCall'},{ACCEPT_AFTER_HANGUP:'CallEndAcceptAfterHangUp'},{NO_ANSWER_TIMEOUT:'NoAnswerTimeout'},{INCOMING_TIMEOUT:'IncomingTimeout'},{OTHER_INSTANCE_HANDLED:'OtherInstanceHandled'},{SIGNALING_MESSAGE_FAILED:'SignalingMessageFailed'},{CONNECTION_DROPPED:'ConnectionDropped'},{CLIENT_INTERRUPTED:'ClientInterrupted'},{WEBRTC_ERROR:'WebRTCError'},{CLIENT_ERROR:'ClientError'},{NO_PERMISSION:'NoPermission'},{OTHER_NOT_CAPABLE:'OtherNotCapable'},{NO_UI_ERROR:'NoUIShown'},{UNSUPPORTED_VERSION:'VersionUnsupported'},{CALLER_NOT_VISIBLE:'CallerNotVisible'},{CARRIER_BLOCKED:'CarrierBlocked'},{OTHER_CARRIER_BLOCKED:'OtherCarrierBlocked'}]),j={HANG_UP:1,TOGGLE_MUTE_AUDIO:2,TOGGLE_MUTE_VIDEO:3,TOGGLE_FULL_SCREEN:4,TOGGLE_SELF_VIEW:5,SUBMIT_STAR_RATING:6,SUBMIT_FEEDBACK:7,SHOW_SETTINGS:8,START_CALL:9},k={PayloadType:h,CallEndReason:i,UIEventType:j,endCallReasonFromString:function(l){return i.strNames.indexOf(l);},callEndReasonString:function(l){if(l<0||l>i.strNames.length)return 'Unknown';return i.strNames[l];},fullCallEndReasonString:function(l,m){return this.callEndReasonString(l)+'_'+(m?'remote':'local');}};e.exports=k;},null);
__d("FBRTCIceStatsParser",[],function(a,b,c,d,e,f){var g=null;h.getInstance=function(){"use strict";if(!g)g=new h();return g;};function h(){"use strict";}h.prototype.extractIceInfo=function(i){"use strict";var j=[],k=i.split("\r\n");for(var l=0;l<k.length;l++){var m=k[l];if(this.$FBRTCIceStatsParser0(m))j.push({gen:this.$FBRTCIceStatsParser1(m),type:this.$FBRTCIceStatsParser2(m)});}return j;};h.prototype.$FBRTCIceStatsParser0=function(i){"use strict";return (i.indexOf('candidate:')>-1);};h.prototype.$FBRTCIceStatsParser1=function(i){"use strict";var j=0,k=i.match(/generation (\d+)/);if(k)j=parseInt(k[1],10);return j;};h.prototype.$FBRTCIceStatsParser2=function(i){"use strict";var j=i.match(/typ (host|relay|srflx|prflx)/);if(j){return j[1];}else return 'unknown';};e.exports=h;},null);
__d("FBRTCLogger",["Log","LogHistory","MarauderLogger","formatDate","pageID"],function(a,b,c,d,e,f,g,h,i,j,k){var l='webrtc',m='sent_message',n='received_message',o='send_succeeded',p='send_failed',q='info',r='call_action',s='client_event',t='client_error',u='type',v='msg_id',w='ack_msg_id',x='call_id',y='from',z='to',aa='content',ba='tag',ca='peer_id',da='error_code',ea='trigger',fa='endcallstats',ga=null;ha.getInstance=function(){"use strict";if(!ga)ga=new ha();return ga;};function ha(){"use strict";this.$FBRTCLogger0=h.getInstance(l);}ha.prototype.logToConsole=function(ia){"use strict";var ja='Console';this.$FBRTCLogger1(null,null,ja,ia);this.$FBRTCLogger0.log(ja,ia);};ha.prototype.logReceivedMessage=function(ia,ja,ka){"use strict";var la={};la[y]=ia;la[x]=ja;la[u]=ka.type;la[v]=ka.msg_id;if(ka.sdp)la[aa]=ka.sdp;if(ka.ack_id)la[w]=ka.ack_id;this.$FBRTCLogger2(n,la);this.$FBRTCLogger1(ia,ja,'Received',ka.type+', '+ka.msg_id);};ha.prototype.logSentMessage=function(ia,ja,ka){"use strict";var la={};la[z]=ia;la[x]=ja;la[u]=ka.type;la[v]=ka.msg_id;if(ka.sdp)la[aa]=ka.sdp;if(ka.ack_id)la[w]=ka.ack_id;this.$FBRTCLogger2(m,la);this.$FBRTCLogger1(ia,ja,'Sent',ka.type+', '+ka.msg_id);};ha.prototype.logSentMessageSuccess=function(ia,ja,ka,la){"use strict";var ma={};ma[ca]=ia;ma[x]=ja;ma[u]=ka;ma[v]=la;this.$FBRTCLogger2(o,ma);};ha.prototype.logSentMessageFailure=function(ia,ja,ka,la,ma){"use strict";var na={};na[ca]=ia;na[x]=ja;na[u]=ka;na[v]=la;na[da]=ma;this.$FBRTCLogger2(p,na);this.$FBRTCLogger1(ia,ja,'Send Failed',ka+', '+ma);};ha.prototype.logCallAction=function(ia,ja,ka,la,ma){"use strict";var na={};na[ca]=ia;na[x]=ja;na[r]=ka;na[aa]=la;if(ma)na[ea]=ma;this.$FBRTCLogger2(r,na);this.$FBRTCLogger1(ia,ja,'CallAction',ka+', '+la);};ha.prototype.logEvent=function(ia,ja,event){"use strict";var ka={};ka[ca]=ia;ka[x]=ja;ka[aa]=event;this.$FBRTCLogger2(s,ka);this.$FBRTCLogger1(ia,ja,'Event',event);};ha.prototype.logInfo=function(ia,ja,ka){"use strict";var la={};la[ca]=ia;la[x]=ja;la[aa]=ka;this.$FBRTCLogger2(q,la);this.$FBRTCLogger1(ia,ja,'Info',ka);};ha.prototype.logError=function(ia,ja,ka){"use strict";var la={};la[ca]=ia;la[x]=ja;la[aa]=ka;this.$FBRTCLogger2(t,la);this.$FBRTCLogger1(ia,ja,'Error',ka);};ha.prototype.logErrorWithoutID=function(ia){"use strict";this.logError(null,null,ia);};ha.prototype.logEndCallSummary=function(ia){"use strict";if(!ia)return;var ja={};ja[ca]=ia.peerID;ja[x]=ia.callID;ja[ba]=fa;ja[aa]=ia.toString();var ka=ia.getExtraInfo();for(var la in ka)if(ka.hasOwnProperty(la))ja[la]=ka[la];this.$FBRTCLogger2(q,ja);this.$FBRTCLogger1(ia.peerID,ia.callID,'Call Summary',ja);};ha.prototype.$FBRTCLogger2=function(ia,ja){"use strict";ja.page_id=k;this.$FBRTCLogger0.log(ia,ja);i.log(ia,l,ja);};ha.prototype.$FBRTCLogger1=function(ia,ja,ka,la){"use strict";};ha.CallAction={START_CALL:'start_call',RECEIVED_CALL:'received_call',ANSWER_CALL:'answer_call',END_CALL:'end_call',DENIED_PERMISSION:'denied_permission',SET_MUTE:'set_mute',SET_VIDEO_ON:'set_video_on',SET_SELF_VIEW_ON:'set_self_view_on',SET_FULLSCREEN_ON:'set_fullscreen_on',START_SKYPE:'start_skype',TRY_NEW:'try_new',OPEN_POPUP:'open_popup',POPUP_OPENED:'popup_opened',AUTO_DISABLE_VIDEO:'auto_disable_video',FAILED_GETTING_URI:'failed_getting_uri',OLD_URI:'old_uri'};ha.Trigger={ADMIN_MESSAGE:'admin_message',CHAT_TAB_ICON:'chat_tab_icon',CHAT_TAB_ICON_TOUR:'chat_tab_icon_tour',SKYPE_DEPRECATION_DIALOG:'skype_deprecation_dialog',REDIAL_BUTTON:'redial_button',RETURN_CALL:'return_call',WEB_MESSENGER:'web_messenger',POPUP_CALL_START_BUTTON:'popup_start_call_button',UNKNOWN:'unknown'};ha.Key={DEVICE_INFO:'device_info',RATING:'rating5',RATING_SHOWN:'rating_shown',SURVEY_CHOICE:'survey_choice',SURVEY_DETAILS:'survey_details',SURVEY_SHOWN:'survey_shown',INITIATED_BY_PAGE_ID:'initiated_by_page_id',PEER_IS_MOBILE:'peer_is_mobile'};e.exports=ha;},null);
__d("FBRTCCallSummary",["FBRTCConstants","FBRTCIceStatsParser","FBRTCLogger","UserAgentData","copyProperties","performanceNow"],function(a,b,c,d,e,f,g,h,i,j,k,l){var m={CALL_STARTED:'started',POPUP_OPENED:'opened',SENT_OFFER:'s_o',RECV_OFFER:'r_o',SENT_OFFER_ACK:'s_oack',RECV_OFFER_ACK:'r_oack',SENT_RETRIED_OFFER:'s_o2',RECV_RETRIED_OFFER:'r_o2',SENT_RETRIED_OFFER_ACK:'s_oack2',RECV_RETRIED_OFFER_ACK:'r_oack2',SENT_PRANSWER:'s_pr',RECV_PRANSWER:'r_pr',NETWORK_READY:'network_ready',SENT_ANSWER:'s_a',RECV_ANSWER:'r_a',SENT_ANSWER_ACK:'s_aack',RECV_ANSWER_ACK:'r_aack',SENT_RETRIED_ANSWER:'s_a2',RECV_RETRIED_ANSWER:'r_a2',SENT_RETRIED_ANSWER_ACK:'s_aack2',RECV_RETRIED_ANSWER_ACK:'r_aack2',SENT_OK:'s_ok',RECV_OK:'r_ok',CALL_CONNECTED:'connected',CALL_ENDED:'ended'};n.CURRENT_SUMMARY_VERSION=10;function n(o){"use strict";this.peerID=o.peerID;this.callID=o.callID;this.$FBRTCCallSummary0=o.isCaller;this.$FBRTCCallSummary1=(new Date()).valueOf();this.$FBRTCCallSummary2=null;this.$FBRTCCallSummary3={};this.$FBRTCCallSummary4=null;this.$FBRTCCallSummary5=null;this.$FBRTCCallSummary6=null;this.$FBRTCCallSummary7=null;this.$FBRTCCallSummary8=null;this.$FBRTCCallSummary9=null;this.$FBRTCCallSummarya={};this.$FBRTCCallSummaryb={};this.$FBRTCCallSummaryc={};this.$FBRTCCallSummaryd={};this.$FBRTCCallSummarye={};this.$FBRTCCallSummaryf={};this.$FBRTCCallSummaryg=l();this.$FBRTCCallSummaryh=0;this.$FBRTCCallSummaryi={};this.$FBRTCCallSummaryj=0;this.$FBRTCCallSummaryk={};this.addExtraInfo(i.Key.DEVICE_INFO,this.$FBRTCCallSummaryl());this.$FBRTCCallSummarym();this.$FBRTCCallSummaryn=h.getInstance();}n.prototype.toJsonString=function(){"use strict";this.$FBRTCCallSummary8=(new Date()).valueOf();return JSON.stringify({version:n.CURRENT_SUMMARY_VERSION,peerID:this.peerID,callID:this.callID,isCaller:this.$FBRTCCallSummary0,startTime:this.$FBRTCCallSummary1,trigger:this.$FBRTCCallSummary2,signalingTime:this.$FBRTCCallSummary3,endCallReason:this.$FBRTCCallSummary4,endCallSubreason:this.$FBRTCCallSummary5,isRemoteEnded:this.$FBRTCCallSummary6,lastUpdatedTime:this.$FBRTCCallSummary7,lastSerializedTime:this.$FBRTCCallSummary8,unsetOnRetrieve:this.$FBRTCCallSummary9,openCount:this.$FBRTCCallSummaryj,extraInfo:this.$FBRTCCallSummaryk,pcStats:this.$FBRTCCallSummarya,captureStats:this.$FBRTCCallSummaryb,gen0IceSentCount:this.$FBRTCCallSummaryc,gen0IceReceivedCount:this.$FBRTCCallSummaryd,iceSentCount:this.$FBRTCCallSummarye,iceReceivedCount:this.$FBRTCCallSummaryf,newSignalingTime:this.$FBRTCCallSummaryi,accumulatedCallTime:this.$FBRTCCallSummaryo()});};n.fromJsonString=function(o){"use strict";var p;try{p=JSON.parse(o);}catch(q){return null;}if(p.version!==n.CURRENT_SUMMARY_VERSION)return null;if(!p.hasOwnProperty('peerID')||!p.hasOwnProperty('callID')||!p.hasOwnProperty('isCaller')||!p.hasOwnProperty('startTime')||!p.hasOwnProperty('trigger')||!p.hasOwnProperty('signalingTime')||!p.hasOwnProperty('endCallReason')||!p.hasOwnProperty('isRemoteEnded')||!p.hasOwnProperty('lastUpdatedTime')||!p.hasOwnProperty('lastSerializedTime'))return null;var r=new n({peerID:p.peerID,callID:p.callID,isCaller:p.isCaller});r.$FBRTCCallSummary1=p.startTime;r.$FBRTCCallSummary2=p.trigger;r.$FBRTCCallSummary3=p.signalingTime;r.$FBRTCCallSummary4=p.endCallReason;r.$FBRTCCallSummary5=p.endCallSubreason;r.$FBRTCCallSummary6=p.isRemoteEnded;r.$FBRTCCallSummary7=p.lastUpdatedTime;r.$FBRTCCallSummary8=p.lastSerializedTime;if(p.unsetOnRetrieve)r.$FBRTCCallSummary9=p.unsetOnRetrieve;if(p.openCount)r.$FBRTCCallSummaryj=p.openCount;if(p.extraInfo)r.$FBRTCCallSummaryk=p.extraInfo;if(p.pcStats)r.$FBRTCCallSummarya=p.pcStats;if(p.captureStats)r.$FBRTCCallSummaryb=p.captureStats;if(p.gen0IceSentCount)r.$FBRTCCallSummaryc=p.gen0IceSentCount;if(p.gen0IceReceivedCount)r.$FBRTCCallSummaryd=p.gen0IceReceivedCount;if(p.iceSentCount)r.$FBRTCCallSummarye=p.iceSentCount;if(p.iceReceivedCount)r.$FBRTCCallSummaryf=p.iceReceivedCount;if(p.newSignalingTime)r.$FBRTCCallSummaryi=p.newSignalingTime;if(p.accumulatedCallTime)r.$FBRTCCallSummaryh=p.accumulatedCallTime;return r;};n.restoreOrInitialize=function(o,p,q,r,s){"use strict";var t=o.retrieveCallSummary(p,q);if(!t){t=new n({peerID:p,callID:q,isCaller:r});if(s){t.onFullMessageReceived({msg:s});t.onOfferAckSent(s);}else t.onCallStarted(i.Trigger.UNKNOWN);i.getInstance().logError(p,q,'Missing call summary from storage');}else if(t.$FBRTCCallSummary9){t.$FBRTCCallSummary4=null;t.$FBRTCCallSummary5=null;t.$FBRTCCallSummary6=null;delete t.$FBRTCCallSummary3[m.CALL_ENDED];delete t.$FBRTCCallSummaryi[m.CALL_ENDED];t.$FBRTCCallSummary9=null;}return t;};n.logSavedSummaries=function(o){"use strict";var p=o.getLoggableSummaries(),q=p.length;if(q<=0)return;var r=i.getInstance(),s=[];for(var t=0;t<q;t++){var u=p[t];r.logEndCallSummary(u);s.push({peerID:u.peerID,callID:u.callID});}o.removeCallSummaries(s);r.logToConsole('Logged pending summaries: '+q);};n.prototype.save=function(o){"use strict";o.storeCallSummary(this.peerID,this.callID,this);};n.prototype.getLastUpdatedTime=function(){"use strict";return this.$FBRTCCallSummary7;};n.prototype.setLastUpdatedTime=function(o){"use strict";this.$FBRTCCallSummary7=o;};n.prototype.getExtraInfo=function(){"use strict";return this.$FBRTCCallSummaryk;};n.prototype.addExtraInfo=function(o,p){"use strict";this.$FBRTCCallSummaryk[o]=p;this.$FBRTCCallSummarym();};n.prototype.onCallStarted=function(o){"use strict";this.$FBRTCCallSummary2=o;this.$FBRTCCallSummaryp(m.CALL_STARTED);this.$FBRTCCallSummarym();};n.prototype.onPopupOpened=function(){"use strict";this.$FBRTCCallSummaryp(m.POPUP_OPENED);this.$FBRTCCallSummaryj++;this.$FBRTCCallSummarym();};n.prototype.setPcStats=function(o){"use strict";this.$FBRTCCallSummarya=o;this.$FBRTCCallSummarym();};n.prototype.setVideoCaptureStats=function(o,p){"use strict";this.$FBRTCCallSummaryb={w:o,h:p};this.$FBRTCCallSummarym();};n.prototype.onOfferAckSent=function(o){"use strict";this.onMessageSent({type:g.PayloadType.OFFER_ACK,flag:o.flag});};n.prototype.onMessageSent=function(o){"use strict";var p=o.flag===1;switch(o.type){case g.PayloadType.OFFER:this.$FBRTCCallSummaryq(p,m.SENT_OFFER,m.SENT_RETRIED_OFFER);this.$FBRTCCallSummaryr(o,this.$FBRTCCallSummaryc,this.$FBRTCCallSummarye);break;case g.PayloadType.ANSWER:this.$FBRTCCallSummaryq(p,m.SENT_ANSWER,m.SENT_RETRIED_ANSWER);this.$FBRTCCallSummaryr(o,this.$FBRTCCallSummaryc,this.$FBRTCCallSummarye);break;case g.PayloadType.OK:this.$FBRTCCallSummaryp(m.SENT_OK);break;case g.PayloadType.PRANSWER:this.$FBRTCCallSummaryp(m.SENT_PRANSWER);break;case g.PayloadType.OFFER_ACK:this.$FBRTCCallSummaryq(p,m.SENT_OFFER_ACK,m.SENT_RETRIED_OFFER_ACK);break;case g.PayloadType.ANSWER_ACK:this.$FBRTCCallSummaryq(p,m.SENT_ANSWER_ACK,m.SENT_RETRIED_ANSWER_ACK);break;case g.PayloadType.ICE_CANDIDATE:this.$FBRTCCallSummaryr(o,this.$FBRTCCallSummaryc,this.$FBRTCCallSummarye);break;default:}this.$FBRTCCallSummarym();};n.prototype.$FBRTCCallSummaryr=function(o,p,q){"use strict";var r=null,s=null,t=this.$FBRTCCallSummaryn.extractIceInfo(o.sdp);for(var u=0;u<t.length;u++){r=t[u].gen;s=t[u].type;if(r===0)this.$FBRTCCallSummarys(p,s);this.$FBRTCCallSummarys(q,s);}};n.prototype.$FBRTCCallSummarys=function(o,p){"use strict";if(!o[p]){o[p]=1;}else o[p]=o[p]+1;};n.prototype.$FBRTCCallSummaryt=function(o){"use strict";if(o.isFromMobile())this.addExtraInfo(i.Key.PEER_IS_MOBILE,'1');};n.prototype.onFullMessageReceived=function(o){"use strict";var p=o.msg,q=p.flag===1;switch(p.type){case g.PayloadType.OFFER:this.$FBRTCCallSummaryt(o);this.$FBRTCCallSummaryq(q,m.RECV_OFFER,m.RECV_RETRIED_OFFER);this.$FBRTCCallSummaryr(p,this.$FBRTCCallSummaryd,this.$FBRTCCallSummaryf);break;case g.PayloadType.ANSWER:this.$FBRTCCallSummaryt(o);this.$FBRTCCallSummaryq(q,m.RECV_ANSWER,m.RECV_RETRIED_ANSWER);this.$FBRTCCallSummaryr(p,this.$FBRTCCallSummaryd,this.$FBRTCCallSummaryf);break;case g.PayloadType.OK:this.$FBRTCCallSummaryp(m.RECV_OK);break;case g.PayloadType.PRANSWER:this.$FBRTCCallSummaryp(m.RECV_PRANSWER);break;case g.PayloadType.OFFER_ACK:this.$FBRTCCallSummaryq(q,m.RECV_OFFER_ACK,m.RECV_RETRIED_OFFER_ACK);break;case g.PayloadType.ANSWER_ACK:this.$FBRTCCallSummaryq(q,m.RECV_ANSWER_ACK,m.RECV_RETRIED_ANSWER_ACK);break;case g.PayloadType.ICE_CANDIDATE:this.$FBRTCCallSummaryr(p,this.$FBRTCCallSummaryd,this.$FBRTCCallSummaryf);break;default:}this.$FBRTCCallSummarym();};n.prototype.onCallConnected=function(){"use strict";this.$FBRTCCallSummaryp(m.NETWORK_READY);this.$FBRTCCallSummaryp(m.CALL_CONNECTED);this.$FBRTCCallSummarym();};n.prototype.onCallEnded=function(o,p,q,r){"use strict";this.$FBRTCCallSummary9=q;this.$FBRTCCallSummary4=o;this.$FBRTCCallSummary5=r;this.$FBRTCCallSummary6=p;this.$FBRTCCallSummaryp(m.CALL_ENDED);this.$FBRTCCallSummarym();};n.prototype.toString=function(){"use strict";var o={};o.core_metrics=this.$FBRTCCallSummaryu();o.time_series=null;return JSON.stringify(o);};n.prototype.$FBRTCCallSummaryu=function(){"use strict";var o={};o.ver=n.CURRENT_SUMMARY_VERSION;o.caller=this.$FBRTCCallSummary0;o.conn=this.$FBRTCCallSummaryv();o.peer_id=this.peerID;o.has_video=true;o.open_count=this.$FBRTCCallSummaryj;o.signaling=this.$FBRTCCallSummaryw();o.sender=this.$FBRTCCallSummaryx();o.receiver=this.$FBRTCCallSummaryy();o.end=this.$FBRTCCallSummaryz();o.video=this.$FBRTCCallSummaryA();return o;};n.prototype.$FBRTCCallSummaryv=function(){"use strict";var o={dtls:1};if(this.$FBRTCCallSummarya.sender&&this.$FBRTCCallSummarya.sender.rtt)o.rtt=this.$FBRTCCallSummarya.sender.rtt;return o;};n.prototype.$FBRTCCallSummaryw=function(){"use strict";var o={};if(this.$FBRTCCallSummary2)o.trigger=this.$FBRTCCallSummary2;o.start_time=this.$FBRTCCallSummary1;o.time_from_start=this.$FBRTCCallSummary3;var p=this.$FBRTCCallSummary3[m.CALL_CONNECTED],q=this.$FBRTCCallSummary3[m.CALL_ENDED];if(p){if(!q)if(this.$FBRTCCallSummary8){q=this.$FBRTCCallSummary8-this.$FBRTCCallSummary1;}else q=this.$FBRTCCallSummaryB();var r=q-p;if(r>0)o.duration=r;}o.new_time_from_start=this.$FBRTCCallSummaryi;p=this.$FBRTCCallSummaryi[m.CALL_CONNECTED];q=this.$FBRTCCallSummaryi[m.CALL_ENDED];if(p){if(!q)if(this.$FBRTCCallSummaryh>0){q=this.$FBRTCCallSummaryh;}else q=this.$FBRTCCallSummaryo();r=q-p;if(r>0)o.new_duration=r;}return o;};n.prototype.$FBRTCCallSummaryx=function(){"use strict";var o={};if(this.$FBRTCCallSummaryc)o.ice_g0=this.$FBRTCCallSummaryc;if(this.$FBRTCCallSummarye)o.ice=this.$FBRTCCallSummarye;if(this.$FBRTCCallSummarya.sender)k(o,this.$FBRTCCallSummarya.sender);return o;};n.prototype.$FBRTCCallSummaryy=function(){"use strict";var o={};if(this.$FBRTCCallSummaryd)o.ice_g0=this.$FBRTCCallSummaryd;if(this.$FBRTCCallSummaryf)o.ice=this.$FBRTCCallSummaryf;return o;};n.prototype.$FBRTCCallSummaryz=function(){"use strict";var o={};if(this.$FBRTCCallSummary4!==null){o.end_call_reason_string=g.callEndReasonString(this.$FBRTCCallSummary4);if(this.$FBRTCCallSummary5!==null)o.end_call_subreason_string=this.$FBRTCCallSummary5;o.remote_ended=this.$FBRTCCallSummary6;}if(this.$FBRTCCallSummarya.end)k(o,this.$FBRTCCallSummarya.end);return o;};n.prototype.$FBRTCCallSummaryA=function(){"use strict";var o={capture:{}};if(this.$FBRTCCallSummarya.video&&this.$FBRTCCallSummarya.video.sender)k(o,this.$FBRTCCallSummarya.video.sender);if(this.$FBRTCCallSummaryb)k(o.capture,this.$FBRTCCallSummaryb);return {sender:o};};n.prototype.$FBRTCCallSummaryB=function(){"use strict";return (new Date()).valueOf()-this.$FBRTCCallSummary1;};n.prototype.$FBRTCCallSummaryo=function(){"use strict";var o=l()-this.$FBRTCCallSummaryg;return Math.floor(this.$FBRTCCallSummaryh+o);};n.prototype.$FBRTCCallSummaryp=function(o){"use strict";if(this.$FBRTCCallSummary3[o])return;this.$FBRTCCallSummary3[o]=this.$FBRTCCallSummaryB();this.$FBRTCCallSummaryi[o]=this.$FBRTCCallSummaryo();};n.prototype.$FBRTCCallSummaryq=function(o,p,q){"use strict";if(o){this.$FBRTCCallSummaryp(q);}else this.$FBRTCCallSummaryp(p);};n.prototype.$FBRTCCallSummarym=function(){"use strict";this.$FBRTCCallSummary7=(new Date()).valueOf();};n.prototype.$FBRTCCallSummaryl=function(){"use strict";return {device:j.deviceName,os:j.platformName,os_version:j.platformFullVersion,browser:j.browserName,browser_version:j.browserFullVersion,screen_height:window.screen.availHeight,screen_width:window.screen.availWidth};};e.exports=n;},null);
__d("FBRTCCallSummaryStore",["CacheStorage","FBRTCCallSummary","FBRTCLogger","areEqual"],function(a,b,c,d,e,f,g,h,i,j){var k='localstorage',l='RTC_CALL_SUMMARY_',m='summary',n=2000,o=3,p=3*60*1000,q=null;r.getInstance=function(){"use strict";if(!q)q=new r();return q;};function r(){"use strict";this.$FBRTCCallSummaryStore0=new g(k,l);this.$FBRTCCallSummaryStore1=i.getInstance();}r.prototype.storeCallSummary=function(s,t,u){"use strict";var v=this;this.$FBRTCCallSummaryStore2(function(w){if(!w[s])w[s]={};var x=w[s][t];if(x){var y=v.$FBRTCCallSummaryStore3(x);if(y&&y.getLastUpdatedTime()>u.getLastUpdatedTime()){v.$FBRTCCallSummaryStore1.logToConsole('Outdated summaries');return null;}}w[s][t]=v.$FBRTCCallSummaryStore4(u);return w;},v.$FBRTCCallSummaryStore1.logError.bind(v.$FBRTCCallSummaryStore1,s,t));};r.prototype.retrieveCallSummary=function(s,t){"use strict";var u=this.$FBRTCCallSummaryStore5(),v=null;if(u[s])v=u[s][t];if(v){return this.$FBRTCCallSummaryStore3(v);}else return null;};r.prototype.removeCallSummary=function(s,t){"use strict";this.removeCallSummaries([{peerID:s,callID:t}]);};r.prototype.removeCallSummaries=function(s){"use strict";var t=this;this.$FBRTCCallSummaryStore2(function(u){var v=s.length;for(var w=0;w<v;w++){var x=s[w].peerID,y=s[w].callID;if(u[x]&&u[x][y]){delete u[x][y];if(t.$FBRTCCallSummaryStore6(u[x]))delete u[x];}}return u;},t.$FBRTCCallSummaryStore1.logError.bind(t.$FBRTCCallSummaryStore1,null,null));};r.prototype.getLoggableSummaries=function(){"use strict";var s=this.$FBRTCCallSummaryStore5(),t=[];for(var u in s)if(s.hasOwnProperty(u))for(var v in s[u])if(s[u].hasOwnProperty(v)){var w=this.$FBRTCCallSummaryStore3(s[u][v],p);if(w)t.push(w);}return t;};r.prototype.$FBRTCCallSummaryStore6=function(s){"use strict";for(var t in s)if(s.hasOwnProperty(t))return false;return true;};r.prototype.$FBRTCCallSummaryStore4=function(s){"use strict";var t={__t:Date.now(),__d:s.toJsonString()};return t;};r.prototype.$FBRTCCallSummaryStore3=function(s,t){"use strict";if(s)if(!t||(Date.now()-s.__t>=t))return h.fromJsonString(s.__d);return null;};r.prototype.$FBRTCCallSummaryStore5=function(){"use strict";var s=this.$FBRTCCallSummaryStore0.get(m)||{};return s;};r.prototype.$FBRTCCallSummaryStore2=function(s,t,u,v){"use strict";if(u===(void 0)||u===null)u=o;var w=this.$FBRTCCallSummaryStore5(),x=this.$FBRTCCallSummaryStore5(),y=s(w);if(y===null)return;var z=this.$FBRTCCallSummaryStore5();if(j(x,z)){this.$FBRTCCallSummaryStore0.set(m,y);this.$FBRTCCallSummaryStore1.logToConsole('Updated summaries');}else if(u>0){t('Retry lock');if(v){var aa=this;setTimeout(function(){aa.$FBRTCCallSummaryStore2(s,t,u-1,true);},n);}else this.$FBRTCCallSummaryStore2(s,t,u-1,true);}else t('Failed to lock');};e.exports=r;},null);
__d("FBRTCUtils",["emptyFunction","randomInt","AsyncRequest"],function(a,b,c,d,e,f,g,h,i){var j=6000,k={attachMediaStream:function(l,m){if(window.webkitRTCPeerConnection){l.src=window.webkitURL.createObjectURL(m);}else{l.mozSrcObject=m;l.play();}},reattachMediaStream:function(l,m){if(window.webkitRTCPeerConnection){l.src=m.src;}else{l.mozSrcObject=m.mozSrcObject;l.play();}},generateRandomInt:function(){return h(0,4294967294)+1;},aboutEqual:function(l,m){return (l-m)<.01&&(m-l)<.01;},sendServerRequest:function(l,m,n,o,p,q){m=m||g;n=n||g;o=o||false;p=p||j;q=q||{};var r=new i().setURI(l).setData(q).setAllowCrossPageTransition(true).setHandler(m).setErrorHandler(n).setTimeoutHandler(p,function(){n();});if(o)r.setOption('asynchronous',false);r.send();}};e.exports=k;},null);
__d("XVideoCallInitController",["XController"],function(a,b,c,d,e,f){e.exports=b("XController").create("\/videocall\/init\/",{peer_id:{type:"Int",required:true},call_id:{type:"Int",required:true},is_caller:{type:"Bool",defaultValue:false}});},null);
__d("XVideoCallController",["XController"],function(a,b,c,d,e,f){e.exports=b("XController").create("\/videocall\/incall\/",{peer_id:{type:"Int",required:true},call_id:{type:"Int"},is_caller:{type:"Bool",defaultValue:false}});},null);
__d("FBRTCUrlManager",["FBRTCLogger","FBRTCUtils","XVideoCallInitController","XVideoCallController"],function(a,b,c,d,e,f,g,h,i,j){var k=3,l=function(p,q,r){g.getInstance().logCallAction(p,q,g.CallAction.OLD_URI);return j.getURIBuilder().setInt('peer_id',p).setInt('call_id',q).setBool('is_caller',r).getURI();},m=function(p,q,r,s,t,u){if(u===(void 0)||u===null)u=k;var v=i.getURIBuilder().setInt('peer_id',p).setInt('call_id',q).setBool('is_caller',r).getURI();h.sendServerRequest(v,function(w){s(w.payload.uri);},function(w){if(u>0){m(p,q,r,s,t,u-1);}else s(l(p,q,r));});},n=function(p){window.history.replaceState({},'',p);},o={init:function(p){this._peerID=p;},onCallStarted:function(){n(l(this._peerID));},getCallUri:m};e.exports=o;},null);
__d("FBRTCCallUI",["Cookie","UserAgent","FBRTCCallSummary","FBRTCCallSummaryStore","FBRTCConstants","FBRTCLogger","FBRTCUrlManager","pageID"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){var o=null,p={openAsCaller:function(q,r,s){if(!o&&window.rtcCallChildWindow){o=window.rtcCallChildWindow;window.rtcCallChildWindow=null;}if(this._shouldFocusCallWindow(q)){o.focus();return;}if(this._shouldCloseCallWindow())o.close();l.getInstance().logCallAction(q,r,l.CallAction.START_CALL,null,s);var t=new i({peerID:q,callID:r,isCaller:true});t.onCallStarted(s);this._open(q,r,true,t,false);},openAsCallee:function(q,r,s,t){this._open(q,r,false,s,t);},_shouldFocusCallWindow:function(q){return o&&!o.closed&&o.rtcCallInProgessWith===q;},_shouldCloseCallWindow:function(){return o&&!o.closed&&!o.rtcCallInProgessWith;},_open:function(q,r,s,t,u){g.clear('vcpwn');g.clear('vctid');var v=this._windowPosition(),w=['menubar=no','location=no','scrollbars=no','status=no','personalbar=no',v.height,v.width,v.top,v.left].join(',');if(this._isSparkBrowser())w='';t.addExtraInfo(l.Key.INITIATED_BY_PAGE_ID,n);t.onCallEnded(k.CallEndReason.CLIENT_ERROR,false,true,'PopupPending');t.save(j.getInstance());if(!u){o=window.open('','Video Call',w);this._setUri(o,q,r,s);}else{l.getInstance().logCallAction(q,r,l.CallAction.OPEN_POPUP);o=window.open(u,'Video Call',w);}if(window.focus)o.focus();},_setUri:function(q,r,s,t){m.getCallUri(r,s,t,function(u){l.getInstance().logCallAction(r,s,l.CallAction.OPEN_POPUP);q.location=u;},function(){l.getInstance().logCallAction(r,s,l.CallAction.FAILED_GETTING_URI);});},_windowPosition:function(){var q=933,r=700,s,t,u,v;if(window.innerWidth!==(void 0)){t=window.innerWidth;s=window.innerHeight;}else{t=screen.width;s=screen.height;}if(window.screenLeft!==(void 0)){u=window.screenLeft;v=window.screenTop;}else{u=window.screenX;v=window.screenY;}var w=Math.floor(((t/2)-(q/2))+u),x=Math.floor(((s/2)-(r/2))+v);return {height:'height='+r.toString(),width:'width='+q.toString(),top:'top='+x.toString(),left:'left='+w.toString()};},_isSparkBrowser:function(){return h.isBrowser('Chrome < 34')&&h.isBrowser('Chrome > 33');}};e.exports=p;},null);
__d("XBrowserNotSupportedDialogController",["XController"],function(a,b,c,d,e,f){e.exports=b("XController").create("\/videocall\/browser_not_supported\/",{user_id:{type:"Int"},warning:{type:"Bool",defaultValue:false},__asyncDialog:{type:"Int"}});},null);
__d("swfobject",["AsyncRequest","Bootloader","CSS","copyProperties","htmlSpecialChars"],function(a,b,c,d,e,f,g,h,i,j,k){if(typeof l=="undefined")var l={};if(typeof l.util=="undefined")l.util={};if(typeof l.SWFObjectUtil=="undefined")l.SWFObjectUtil={};l.SWFObject=function(n,o,p,q,r,s,t,u,v,w){if(!document.getElementById)return;this.DETECT_KEY=w?w:'detectflash';this.skipDetect=l.util.getRequestParameter(this.DETECT_KEY);this.params={};this.variables={};this.attributes=[];this.fallback_html='';this.fallback_js_fcn=function(){};if(n)this.setAttribute('swf',n);if(o)this.setAttribute('id',o);if(p)this.setAttribute('width',p);if(q)this.setAttribute('height',q);this.installedVer=l.SWFObjectUtil.getPlayerVersion();if(r){if(!(r instanceof Array))r=[r];var x;r.forEach(function(aa){x=new l.PlayerVersion(aa.toString().split('.'));if(x.major==this.installedVer.major){this.setAttribute('version',x);return;}else if(!this.getAttribute('version')||x.major<this.getAttribute('version').major)this.setAttribute('version',x);}.bind(this));}if(!window.opera&&document.all&&this.installedVer.major>7)if(!l.unloadSet){l.SWFObjectUtil.prepUnload=function(){var aa=function(){},ba=function(){};window.attachEvent("onunload",l.SWFObjectUtil.cleanupSWFs);};window.attachEvent("onbeforeunload",l.SWFObjectUtil.prepUnload);l.unloadSet=true;}if(s)this.addParam('bgcolor',s);var y=t?t:'high';this.addParam('quality',y);this.setAttribute('useExpressInstall',false);this.setAttribute('doExpressInstall',false);var z=(u)?u:window.location;this.setAttribute('xiRedirectUrl',z);this.setAttribute('redirectUrl','');if(v)this.setAttribute('redirectUrl',v);};l.SWFObject.ieWorkaroundApplied=false;l.SWFObject.ensureIEWorkaroundAttached=function(){if(!l.SWFObject.ieWorkaroundApplied&&document.attachEvent){l.SWFObject.ieWorkaroundApplied=true;document.attachEvent('onpropertychange',l.SWFObject.onDocumentPropertyChange);}};l.SWFObject.onDocumentPropertyChange=function(event){if(event.propertyName=="title"){var n=document.title;if(n!=null&&n.indexOf('#!')!=-1){n=n.substring(0,n.indexOf('#!'));document.title=n;}}};j(l.SWFObject.prototype,{useExpressInstall:function(n){this.xiSWFPath=!n?"/swf/expressinstall.swf":n;this.setAttribute('useExpressInstall',true);},setAttribute:function(n,o){this.attributes[n]=o;},getAttribute:function(n){return this.attributes[n]||"";},addParam:function(n,o){this.params[n]=o;},getParams:function(){return this.params;},addVariable:function(n,o){this.variables[n]=o;},getVariable:function(n){return this.variables[n]||"";},getVariables:function(){return this.variables;},getVariablePairs:function(){var n=[],o,p=this.getVariables();for(o in p)n[n.length]=o+"="+p[o];return n.join('&');},getSWFHTML:function(){var n,o,p;if(navigator.plugins&&navigator.mimeTypes&&navigator.mimeTypes.length){if(this.getAttribute("doExpressInstall")){this.addVariable("MMplayerType","PlugIn");this.setAttribute('swf',this.xiSWFPath);}o={type:'application/x-shockwave-flash',src:this.getAttribute('swf'),width:this.getAttribute('width'),height:this.getAttribute('height'),style:this.getAttribute('style')||'display: block;',id:this.getAttribute('id'),name:this.getAttribute('id')};var q=this.getParams();for(var r in q)o[r]=q[r];p=this.getVariablePairs();if(p)o.flashvars=p;n=m('embed',o,null);}else{if(this.getAttribute("doExpressInstall")){this.addVariable("MMplayerType","ActiveX");this.setAttribute('swf',this.xiSWFPath);}o={id:this.getAttribute('id'),classid:'clsid:D27CDB6E-AE6D-11cf-96B8-444553540000',width:this.getAttribute('width'),height:this.getAttribute('height'),style:this.getAttribute('style')||'display: block;'};var s=m('param',{name:'movie',value:this.getAttribute('swf')},null),q=this.getParams();for(var r in q)s+=m('param',{name:r,value:q[r]},null);p=this.getVariablePairs();if(p)s+=m('param',{name:'flashvars',value:p},null);n=m('object',o,s);}return n;},write:function(n){if(this.getAttribute('useExpressInstall')){var o=new l.PlayerVersion([6,0,65]);if(this.installedVer.versionIsValid(o)&&!this.installedVer.versionIsValid(this.getAttribute('version'))){this.setAttribute('doExpressInstall',true);this.addVariable("MMredirectURL",escape(this.getAttribute('xiRedirectUrl')));document.title=document.title.slice(0,47)+" - Flash Player Installation";this.addVariable("MMdoctitle",document.title);}}var p=(typeof n=='string')?document.getElementById(n):n;if(!p)return false;i.addClass(p,'swfObject');p.setAttribute('data-swfid',this.getAttribute('id'));if(this.skipDetect||this.getAttribute('doExpressInstall')||this.installedVer.versionIsValid(this.getAttribute('version'))){l.SWFObject.ensureIEWorkaroundAttached();p.innerHTML=this.getSWFHTML();return true;}else{if(this.getAttribute('redirectUrl')!="")document.location.replace(this.getAttribute('redirectUrl'));var q=this.getAttribute('version').major+'.'+this.getAttribute('version').minor+'.'+this.getAttribute('version').release+'.'+this.getAttribute('version').build,r=this.installedVer.major+'.'+this.installedVer.minor+'.'+this.installedVer.release+'.'+this.installedVer.build;this.fallback_js_fcn(r,q);p.innerHTML=this.fallback_html;}return false;}});l.SWFObjectUtil.getPlayerVersion=function(){var n=new l.PlayerVersion([0,0,0,0]),o;if(navigator.plugins&&navigator.mimeTypes.length){for(var p=0;p<navigator.plugins.length;p++)try{var r=navigator.plugins[p];if(r.name=='Shockwave Flash'){o=new l.PlayerVersion(r.description.replace(/([a-zA-Z]|\s)+/,"").replace(/(\s+(r|d)|\s+b[0-9]+)/,".").split("."));if(typeof n=='undefined'||o.major>n.major||(o.major==n.major&&(o.minor>n.minor||(o.minor==n.minor&&(o.release>n.release||(o.release==n.release&&o.build>n.build))))))n=o;}}catch(q){}}else if(navigator.userAgent&&navigator.userAgent.indexOf("Windows CE")>=0){var s=1,t=3;while(s)try{t++;s=new ActiveXObject("ShockwaveFlash.ShockwaveFlash."+t);n=new l.PlayerVersion([t,0,0]);}catch(u){s=null;}}else{try{var s=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.7");}catch(v){try{var s=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.6");n=new l.PlayerVersion([6,0,21]);s.AllowScriptAccess="always";}catch(w){if(n.major==6)return n;}try{s=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");}catch(x){}}if(s!=null)n=new l.PlayerVersion(s.GetVariable("$version").split(" ")[1].split(","));}return n;};l.PlayerVersion=function(n){this.major=n[0]!=null?parseInt(n[0],10):0;this.minor=n[1]!=null?parseInt(n[1],10):0;this.release=n[2]!=null?parseInt(n[2],10):0;this.build=n[3]!=null?parseInt(n[3],10):0;};l.PlayerVersion.prototype.versionIsValid=function(n){if(this.major<n.major)return false;if(this.major>n.major)return true;if(this.minor<n.minor)return false;if(this.minor>n.minor)return true;if(this.release<n.release)return false;if(this.release>n.release)return true;if(this.build<n.build)return false;return true;};l.util={getRequestParameter:function(n){var o=document.location.search||document.location.hash;if(n==null)return o;if(o){var p=o.substring(1).split("&");for(var q=0;q<p.length;q++)if(p[q].substring(0,p[q].indexOf("="))==n)return p[q].substring((p[q].indexOf("=")+1));}return "";}};l.SWFObjectUtil.cleanupSWFs=function(){var n=document.getElementsByTagName("OBJECT");for(var o=n.length-1;o>=0;o--){n[o].style.display='none';for(var p in n[o])if(typeof n[o][p]=='function')n[o][p]=function(){};}};if(!document.getElementById&&document.all)document.getElementById=function(n){return document.all[n];};l.spawn_flash_update_dialog=function(){new g().setURI('/ajax/flash_update_dialog.php').setMethod('GET').setReadOnly(true).send();};l.showFlashErrorDialog=function(n,o){h.loadModules(["ErrorDialog"],function(p){p.show(n,o);});};function m(n,o,p){var q=/^[A-Za-z0-9\-]+$/;if(!n.match(q))throw new Error('Invalid tag '+n);var r='<'+n;for(var s in o){if(!s.match(q))throw new Error('Invalid attr '+s);r+=' '+s+'="'+k(o[s])+'"';}if(p===null){return r+'/>';}else return r+'>'+p+'</'+n+'>';}e.exports=a.deconcept||l;},null);
__d("SoundPlayer",["Arbiter","URI","createArrayFromMixed","swfobject"],function(a,b,c,d,e,f,g,h,i){var j=b('swfobject').SWFObject,k={},l=null,m=false,n='so_sound_player',o='/swf/SoundPlayer.swf?v=1',p='10.0.22.87',q=null;function r(z){var aa=h(z);if(!aa.getDomain())return h().setPath(aa.getPath()).toString();return z;}function s(z){var aa=h(z).getPath();if(/\.mp3$/.test(aa))return 'audio/mpeg';if(/\.og[ga]$/.test(aa))return 'audio/ogg';return '';}function t(){if(!q){var z=document.createElement('audio');if(!z||!z.canPlayType)return null;z.setAttribute('preload','auto');document.body.appendChild(z);q=z;}return q;}function u(){var z=document[n]||window[n];if(z)if(!z.playSound&&z.length)z=z[0];return (z&&z.playSound&&z.loopSound)?z:null;}function v(){return m;}function w(z,aa,ba){l={path:z,sync:aa,loop:ba};}function x(){m=true;if(l){var z=u();if(l.loop){z.loopSound(l.path,l.sync);}else z.playSound(l.path,l.sync);}}var y={init:function(z){z=i(z);var aa;for(var ba=0;ba<z.length;++ba){aa=z[ba];if(k[aa])return;}var ca=t();for(ba=0;ca&&ba<z.length;++ba){aa=z[ba];if(ca.canPlayType(aa)){k[aa]=true;return;}}k['audio/mpeg']=true;if(u())return;try{g.registerCallback(x,['sound/player_ready','sound/ready']);var ea=document.createElement('div');ea.id='sound_player_holder';document.body.appendChild(ea);var fa=new j(o,n,'1px','1px',[p],'#ffffff');fa.addParam('allowscriptaccess','always');fa.addParam('wmode','transparent');fa.addVariable('swf_id',n);fa.fallback_html=' ';fa.write(ea.id);window[n]=fa;g.inform('sound/player_ready');}catch(da){}},play:function(z,aa){z=i(z);var ba=t(),ca,da;for(var ea=0;ba&&ea<z.length;++ea){ca=z[ea];da=s(ca);if(!ba.canPlayType(da))continue;y.init([da]);ba.src=r(ca);if(aa){ba.setAttribute('loop','');}else ba.removeAttribute('loop');ba.play();return;}for(ea=0;ea<z.length;++ea){ca=r(z[ea]);da=s(ca);if(da!='audio/mpeg')continue;y.init([da]);var fa=u();if(!v()){w(ca,true,aa);return;}else if(fa){if(aa){fa.loopSound(ca,true);}else fa.playSound(ca,true);return;}}},stop:function(z){z=i(z);for(var aa=0;aa<z.length;++aa){var ba=r(z[aa]),ca=t(),da=u();if(ca&&ca.src==ba){ca.pause();ca.removeAttribute('src');}else da&&da.stopSound(ba);}}};e.exports=y;},null);
__d("SoundSynchronizer",["SoundPlayer","WebStorage","createArrayFromMixed"],function(a,b,c,d,e,f,g,h,i){var j='fb_sounds_playing3';function k(){var o=h.getLocalStorage();if(o)try{var q=o[j];if(q){q=JSON.parse(q);if(Array.isArray(q))return q;}}catch(p){}return [];}function l(o){var p=h.getLocalStorage();if(p){var q=k();q.push(o);while(q.length>5)q.shift();try{p[j]=JSON.stringify(q);}catch(r){}}}function m(o){return k().some(function(p){return p===o;});}var n={play:function(o,p,q){o=i(o);p=p||(o[0]+Math.floor(Date.now()/1000));if(m(p))return;g.play(o,q);l(p);},isSupported:function(){return !!h.getLocalStorage();}};e.exports=n;},null);
__d("SoundRPC",["Event","SoundSynchronizer"],function(a,b,c,d,e,f,g,h){function i(k,l,m){h.play(k,l,m);}var j={playLocal:i,playRemote:function(k,l,m,n){var o={paths:l,sync:m,loop:n};k.postMessage(JSON.stringify(o),'*');},supportsRPC:function(){return !!window.postMessage;},_listen:function(){g.listen(window,'message',function(k){if(!/\.facebook.com$/.test(k.origin))return;var l=JSON.parse(k.data||'{}');i(l.paths,l.sync,l.loop);});}};e.exports=j;},null);
__d("Sound",["SoundInitialData","SoundPlayer","SoundRPC","SoundSynchronizer","URI","UserAgent_DEPRECATED","isFacebookURI"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n=null,o={init:function(s){if(!n)h.init(s);},play:function(s,t,u){if(n){i.playRemote(n.contentWindow,s,t,false);}else i.playLocal(s,t,u);},stop:function(s){if(!n)h.stop(s);}},p=new k(location.href);if(p.getSubdomain()&&p.getSubdomain()!=='www')p.setSubdomain('www');var q=p.getDomain();function r(){if(l.ie()<9)return false;if(g.RPC_DISABLED)return false;return j.isSupported()&&i.supportsRPC();}if(m(p)&&location.host!==q&&r()){n=document.createElement('iframe');n.setAttribute('src','//'+q+'/sound_iframe.php');n.style.display='none';document.body.appendChild(n);}e.exports=o;},null);
__d("FBRTCSoundController",["MercuryConfig","Sound"],function(a,b,c,d,e,f,g,h){var i=[g.ringtone_mp3_url,g.ringtone_ogg_url],j={playIncomingRingtone:function(k,l,m){var n=['incoming_ringtone',k.toString(),l.toString()].join('_');h.play(i,n,m);},stopIncomingRingtone:function(){h.stop(i);}};e.exports=j;},null);
__d("FBRTCUnsupportedBrowserMessage",["AsyncDialog","AsyncRequest","XBrowserNotSupportedDialogController","FBRTCSoundController"],function(a,b,c,d,e,f,g,h,i,j){var k={_dialog:null,warnForOutgoingCall:function(l){var m=i.getURIBuilder().setBool('warning',true).getURI();this._presentDialog(m,l);},showForOutgoingCall:function(){var l=i.getURIBuilder().getURI();this._presentDialog(l);},showForIncomingCall:function(l,m){j.playIncomingRingtone(l,m,false);var n=i.getURIBuilder().setInt('user_id',m).getURI();this._presentDialog(n);},dismiss:function(){if(this._dialog)this._dialog.hide();},_presentDialog:function(l,m){if(this._dialog)return;var n=new h(l);g.send(n,function(o){this._dialog=o;o.subscribe('hide',function(){this._dialog=null;if(m)m();}.bind(this));}.bind(this));}};e.exports=k;},null);
__d("AvailableListConstants",["fbt"],function(a,b,c,d,e,f,g){var h={ON_AVAILABILITY_CHANGED:'buddylist/availability-changed',ON_UPDATE_ERROR:'buddylist/update-error',ON_UPDATED:'buddylist/updated',ON_CHAT_NOTIFICATION_CHANGED:'chat-notification-changed',OFFLINE:0,IDLE:1,ACTIVE:2,MOBILE:3,WEB_STATUS:'webStatus',FB_APP_STATUS:'fbAppStatus',MESSENGER_STATUS:'messengerStatus',OTHER_STATUS:'otherStatus',ACTIVE_ON_WEB:"Web",ACTIVE_ON_MOBILE:"Mobile",LEGACY_OVERLAY_OFFLINE:-1,LEGACY_OVERLAY_ONLINE:0,LEGACY_OVERLAY_IDLE:1,STATUS_ACTIVE:'active',STATUS_IDLE:'idle',STATUS_OFFLINE:'offline',legacyStatusMap:{'0':2,'1':1,'-1':0,'2':3},reverseLegacyStatusMap:{0:-1,1:1,2:0,3:2}};a.AvailableListConstants=e.exports=h;},null);
__d("LastMobileActiveTimes",["ServerTime","fbt"],function(a,b,c,d,e,f,g,h){var i={};function j(n){if(!n||n<0)return '';var o=(g.get()/1000)-n,p=Math.floor(o/60),q=Math.floor(p/60),r=Math.floor(q/24);if(p<=1){return h._("{count}m",[h.param("count",1)]);}else if(p<60){return h._("{count}m",[h.param("count",p)]);}else if(q<24){return h._("{count}h",[h.param("count",q)]);}else if(r<3){return h._("{count}d",[h.param("count",r)]);}else return '';}function k(n,o){if(!(n in i)||i[n]<o)i[n]=o;}function l(n){if(n in i){return i[n];}else return 0;}var m={update:function(n){for(var o in n)k(o,n[o]);},getShortDisplay:function(n){return j(l(n));},get:function(n){return l(n);}};e.exports=m;},null);
__d("PresenceStatus",["AvailableListConstants","BanzaiODS","ChatVisibility","CurrentUser","LastMobileActiveTimes","LogHistory","PresencePrivacy","ServerTime","createObjectFrom"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){h.setEntitySample('presence',.0001);var p=l.getInstance('presence_status'),q={},r={},s={},t={},u={},v={},w={},x={resetPresenceData:function(){r={};s={};w={};v={};u={};},reset:function(){x.resetPresenceData();t={};},get:function(y){if(y==j.getID())return i.isOnline()?g.ACTIVE:g.OFFLINE;var z=g.OFFLINE;if(y in r)z=r[y];if(z===g.OFFLINE||z===g.IDLE)if(t[y])z=g.MOBILE;if(!m.allows(y))z=g.OFFLINE;return z;},getCapabilities:function(y){var z=x.get(y);if(z==g.OFFLINE)return 0;var aa=s[y];return aa?aa:0;},getDetailedActivePresence:function(y){var z=w[y];if(!z)return g.ACTIVE_ON_WEB;var aa=z[g.WEB_STATUS],ba=z[g.FB_APP_STATUS],ca=z[g.MESSENGER_STATUS],da=z[g.OTHER_STATUS];if(ba===g.STATUS_ACTIVE||ca===g.STATUS_ACTIVE){return g.ACTIVE_ON_MOBILE;}else if(aa===g.STATUS_ACTIVE||da===g.STATUS_ACTIVE){return g.ACTIVE_ON_WEB;}else{if(!q[y]){p.error('inconsistent_presence',{id:y,presence:x.getDebugInfo(y)});h.bumpEntityKey('presence','inconsistent_presence');q[y]=true;}return null;}},isMessengerUser:function(y){var z=w[y];if(z)if(z[g.MESSENGER_STATUS]==g.STATUS_ACTIVE)return true;return t[y];},hasDetailedPresenceData:function(y){return w[y]!=null;},getGroup:function(y){return y.some(function(z){if(z==j.getID())return false;return (x.get(z)===g.ACTIVE);})?g.ACTIVE:g.OFFLINE;},set:function(y,z,aa,ba,ca,da){if(y==j.getID())return false;switch(z){case g.OFFLINE:case g.IDLE:case g.ACTIVE:case g.MOBILE:break;default:return false;}var ea=x.get(y),fa=ea!=z;if((fa&&ea==g.ACTIVE)||(z==g.ACTIVE)){var ga={};ga[y]=n.get()/1000;k.update(ga);}var ha=false;if(!fa&&ca)ha=x.getCapabilities(y)!=ca;if(aa){u[y]=n.get();v[y]=ba;}r[y]=z;if(ca)s[y]=ca;if(da)w[y]=da;return fa||ha;},setMobileFriends:function(y){t=o(y);},getOnlineIDs:function(){var y,z=[];for(y in r)if(x.get(y)===g.ACTIVE)z.push(y);return z;},getAvailableIDs:function(){var y=x.getOnlineIDs(),z;for(z in t){if(r[z])continue;y.push(z);}return y;},getOnlineCount:function(){return x.getOnlineIDs().length;},getPresenceStats:function(){var y=0,z=0,aa=0,ba=0,ca=0;for(var da in r){y+=1;switch(x.get(da)){case g.OFFLINE:z+=1;break;case g.IDLE:aa+=1;break;case g.ACTIVE:ba+=1;break;case g.MOBILE:ca+=1;break;default:break;}}return {total:y,offline:z,idle:aa,active:ba,mobile:ca};},getDebugInfo:function(y){return {id:y,presence:r[y],detailedPresence:w[y],overlaySource:v[y],overlayTime:u[y],mobile:t[y]};}};e.exports=x;},null);
__d("FBRTCCore",["Arbiter","ChannelConstants","FBRTCCallUI","FBRTCUnsupportedBrowserMessage","mixInEventEmitter","PresenceStatus","PresencePrivacy","UserAgent","randomInt","invariant"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){var q=false,r={startOutgoingCall:function(s,t){p(!isNaN(parseInt(s,10)));if(q)return;q=true;setTimeout(function(){q=false;},1000);if(this.isWebrtcSupported()){var u=this._generateCallID();i.openAsCaller(s,u,t);}else j.showForOutgoingCall();},isAvailableForWebrtcCalling:function(s){var t=l.getCapabilities(s),u=h.CAPABILITY_VOIP_INTEROP|h.CAPABILITY_VIDEO,v=t&u;return v!==0;},isWebrtcSupported:function(){return (n.isBrowser('Chrome >= 28')||n.isBrowser('Firefox >= 25')||n.isBrowser('Opera >= 20'));},_generateCallID:function(){return o(0,4294967295);},buddyCallabilityChanged:function(){this.emit('callabilityChanged');}};g.subscribe(['buddylist/availability-changed'],function(s,t){r.buddyCallabilityChanged();});m.subscribe(['privacy-changed','privacy-availability-changed'],function(s,t){r.buddyCallabilityChanged();});k(r,{callabilityChanged:true});e.exports=r;},null);
__d("VideoCallSupport",["ActiveXSupport","ChannelConstants","ChatVisibility","FBRTCCore","MercuryConfig","UserAgent"],function(a,b,c,d,e,f,g,h,i,j,k,l){var m={isSkypeDeprecated:function(){return k.SkypeDeprecated;},isSendWebrtcSupported:function(){if(this.isSkypeDeprecated())return k.SendNewVCGK;return k.SendNewVCGK&&m.isWebrtcSupported();},isReceiveWebrtcSupported:function(){return k.ReceiveNewVCGK;},isSkypeCallSupported:function(){if(this.isSkypeDeprecated())return false;if(l.isPlatform('Windows')){if(l.isBrowser('IE >= 9')&&l.isBrowserArchitecture('32')){return g.isSupported();}else return ((l.isBrowser('IE >= 7')&&l.isBrowserArchitecture('32'))||l.isBrowser('Firefox >= 3.6')||l.isBrowser('Chrome >= 5')||l.isBrowser('Opera >= 12'));}else if(l.isPlatform('Mac OS X > 10.5'))return (l.isEngine('WebKit >= 500')||l.isBrowser('Firefox >= 3.6')||l.isBrowser('Chrome >= 5')||l.isBrowser('Opera >= 12'));return false;},isVideoCallSupported:function(){return (m.isSendWebrtcSupported()||m.isSkypeCallSupported());},isPluginInstalled:function(p){if(p==='undefined')p=true;var q=false;if(m.isSkypeCallSupported())if(n()){var r=null;try{r=new ActiveXObject('SkypeLimited.SkypeWebPlugin');q=!!r;}catch(s){}r=null;}else q=o(p);return q;},isWebrtcSupported:function(){return j.isWebrtcSupported();},getCapabilities:function(){var p=0;if(m.isReceiveWebrtcSupported()&&i.isOnline())p=h.CAPABILITY_VOIP_INTEROP;return p;}};function n(){return l.isBrowser('IE');}function o(p){if(!navigator)return null;if(p)navigator.plugins.refresh(false);var q=navigator.mimeTypes['application/skypesdk-plugin'];return q&&q.enabledPlugin;}e.exports=m;},null);
__d("RTISession",["URI","AjaxRequest","copyProperties","invariant","ErrorUtils"],function(a,b,c,d,e,f,g,h,i,j,k){'use strict';var l='.facebook.com';function m(n,o,p,q,r,s,t,u,v){j(n);j(q);j(r);this.domain=n;this.port=o;this.edgePoolName=p;this.stickyToken=q;this.loggedInId=r;this.accountId=s;this.clientProfile=t||'desktop';this.clientId=u;this.capabilities=v;}m.prototype.issueRequest=function(n,o,p,q,r){j(n);j(o);j(q);var s=this.domain.length-l.length,t=s>0&&this.domain.indexOf(l,s)!==-1,u=t?this.domain:this.domain+l,v=(1048576*Math.random()|0).toString(36),w={cb:v,sticky_token:this.stickyToken,uid:this.loggedInId,viewer_uid:this.accountId,sticky_pool:this.edgePoolName,profile:this.clientProfile,clientid:this.clientId,cap:this.capabilities};for(var x in w)j(!o[x]);i(w,o);var y=new g(n).setDomain(u).setPort(this.port).setSecure(g().isSecure()).setQueryData(w),z=p?'POST':'GET',aa=new h(z,y);aa.timeout=r?r*1000:30000;if(aa.xhr)aa.xhr.withCredentials=true;var ba={};aa.onSuccess=function(){};aa.onJSON=(function(){ba.data=aa.json;ba.error=null;k.applyWithGuard(q,this,[ba]);}).bind(this);aa.onError=(function(){ba.data=null;ba.error=aa.errorType||'error';k.applyWithGuard(q,this,[ba]);}).bind(this);aa.send(JSON.stringify(p));};e.exports=m;},null);
__d("ChannelManager",["AjaxRequest","Arbiter","AsyncRequest","ChannelConstants","ChannelInitialData","ChannelSubdomain","ChannelTransport","ChatVisibility","DTSG","Env","FBAjaxRequest","ISB","JSLogger","MessagingRealtimeConstants","MovingStat","PresenceCookieManager","PresenceState","PresenceUtil","SystemEvents","URI","UserActivity","VideoCallSupport","RTISession","copyProperties","createArrayFromMixed","setIntervalAcrossTransitions","setTimeoutAcrossTransitions","WebStorage"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga){var ha=b('WebStorage').getSessionStorage(),ia='chproxy_base_sess',ja,ka=s.create('channel'),la=null;function ma(ya){la=ya;}var na={idle:{ok:'init!'},init:{ok:'pull!',error:'reconnect',sys_online:'init',sys_timetravel:'init'},pull:{ok:'pull!',error:'ping',error_missing:'pull',error_msg_type:'pull',refresh_0:'reconnect',refresh_110:'reconnect',refresh_111:'reconnect',refresh_112:'pull',refresh_113:'pull',refresh_117:'reconnect'},ping:{ok:'pull!',error:'ping',error_stale:'reconnect!'},reconnect:{ok:'init!',error:'reconnect',sys_online:'reconnect',sys_timetravel:'reconnect'},shutdown:{},_all:{error_max:'shutdown!',error_shutdown:'shutdown!',sys_owner:'reconnect',sys_nonowner:'idle!',sys_online:'ping',sys_offline:'idle!',sys_timetravel:'ping'}},oa={reconnectOverrideTimeMillis:Date.now(),userActive:Date.now(),lastPresenceState:null,lastRequestErrorReason:null,fantail_logs:[],sessionID:(Math.random()*2147483648|0).toString(16),capabilities:ba.getCapabilities(),streamingCapable:false,inStreaming:false,LONGPOLL_TIMEOUT:60000,STREAMING_TIMEOUT:60000,P_TIMEOUT:30000,IFRAME_LOAD_TIMEOUT:30000,MIN_RETRY_INTERVAL:5000,MAX_RETRY_INTERVAL:320000,MIN_12002_TIMEOUT:9000,MIN_504_TIMEOUT:20000,STALL_THRESHOLD:180000,JUMPSTART_THRESHOLD:90000,MIN_INIT_PROBE_DELAY:3000,INIT_PROBE_DELAY_RANDOMIZE_RANGE:12000,CHANNEL_PROXY_REPORTING_MIN_INTERVAL:10000,PROBE_DELAY:60000,PROBE_HEARTBEATS_INTERVAL_LOW:1000,PROBE_HEARTBEATS_INTERVAL_HIGH:5000,STREAMING_EXIT_STATE_ON_CONTINUE:false,FANTAIL_QUEUE_CAPACITY:50},pa={MAX_CONTINUOUS_PULL_FAILS:3,enabled:false,uptimeMillis:Date.now(),timeInGoodStatesStartMillis:Date.now(),timeInGoodStatesMillis:0,initialized:false,firstPullSentTimeMillis:Date.now(),accumulatedPullTimeMillis:0,pullStartTimeMillis:0,pingCount:0,pullCount:0,continuousPullFails:0,getTimeSinceFirstPullSentSeconds:function(){return (Date.now()-this.firstPullSentTimeMillis)/1000;},getUptimeSeconds:function(){return (Date.now()-this.uptimeMillis)/1000;},getAccumulatedPullTimeSeconds:function(){var ya=this.accumulatedPullTimeMillis,za=Date.now();if(this.pullStartTimeMillis>0&&za-this.pullStartTimeMillis<=oa.LONGPOLL_TIMEOUT)ya+=(za-this.pullStartTimeMillis);var ab=ya/1000;if(ab>=this.getTimeSinceFirstPullSentSeconds())this.initialize();return ab;},getPingToPullRatio:function(){return this.pullCount===0?0:this.pingCount/this.pullCount;},reportPullSent:function(){if(!this.enabled)return;if(!this.initialized)this.initialize();this.pullStartTimeMillis=Date.now();},initialize:function(){this.initialized=true;this.firstPullSentTimeMillis=Date.now();this.pullStartTimeMillis=0;this.accumulatedPullTimeMillis=0;this.pingCount=0;this.pullCount=0;this.timeInGoodStatesStartMillis=Date.now();this.timeInGoodStatesMillis=0;this.uptimeMillis=Date.now();},reportPullReturned:function(ya,za){if(!this.enabled)return;if(this.pullStartTimeMillis>0){this.accumulatedPullTimeMillis+=(Date.now()-this.pullStartTimeMillis);if(ya){this.pullCount++;this.continuousPullFails=0;}else this.continuousPullFails++;}this.pullStartTimeMillis=0;},reportPingSent:function(){if(!this.enabled)return;this.pingCount++;},isGoodState:function(ya){return ya.indexOf('pull')===0||ya.indexOf('init')===0||ya.indexOf('idle')===0;},getTotalTimeInGoodStatesSeconds:function(){var ya=this.timeInGoodStatesMillis;if(this.timeInGoodStatesStartMillis>0)ya+=(Date.now()-this.timeInGoodStatesStartMillis);return ya/1000;},clientEnteredState:function(ya){if(!this.enabled)return;var za=this.isGoodState(ya);if(za&&this.timeInGoodStatesStartMillis===0){this.timeInGoodStatesStartMillis=Date.now();}else if(!za&&this.timeInGoodStatesStartMillis>0){this.timeInGoodStatesMillis=Date.now()-this.timeInGoodStatesStartMillis;this.timeInGoodStatesStartMillis=0;}},transportEnteredState:function(ya){if(!this.enabled)return;if(ya.indexOf('pull')===0){this.reportPullSent();}else if(ya.indexOf('ping')===0&&oa.lastRequestErrorReason!==j.SYS_TIMETRAVEL&&oa.lastRequestErrorReason!==j.SYS_ONLINE&&oa.lastRequestErrorReason!==j.SYS_OWNER&&oa.lastRequestErrorReason!==j.SYS_NONOWNER)this.reportPingSent();},doSerialize:function(){if(!this.enabled)return "";return (this.getTimeSinceFirstPullSentSeconds()).toFixed(0)+','+(this.getAccumulatedPullTimeSeconds()).toFixed(0)+','+(this.getPingToPullRatio()).toFixed(3)+','+(this.getUptimeSeconds()).toFixed(0)+','+(this.getTotalTimeInGoodStatesSeconds()).toFixed(0);}},qa=1,ra={},sa=0;function ta(){return i.lastSuccessTime?Math.round((Date.now()-i.lastSuccessTime)/1000):-1;}function ua(){var ya={};if(ja.getConfig('host'))ya[ja.getConfig('user_channel')]=ja.getConfig('seq',0);return ya;}function va(){var ya=Date.now(),za=Date.now(),ab={total:0},bb='idle',cb=false;y.subscribe([y.USER,y.ONLINE,y.TIME_TRAVEL],function(fb,gb){xa(true);za=null;ja.lastPullTime=Date.now();var hb;switch(fb){case y.USER:hb=y.isPageOwner()?j.SYS_OWNER:j.SYS_NONOWNER;break;case y.ONLINE:hb=gb?j.SYS_ONLINE:j.SYS_OFFLINE;break;case y.TIME_TRAVEL:hb=j.SYS_TIMETRAVEL;break;}ja.exitState({status:hb,stateId:qa});});var db=function(fb,gb){var hb=Date.now(),ib;if(gb){ya=hb;ib=gb.nextState||gb.state;}else ib=bb;y.checkTimeTravel();if(za){var jb=Math.round((hb-za)/1000);if(jb>0){ab[bb]=(ab[bb]||0)+jb;ab.total+=jb;}}bb=ib;za=hb;if(!fb){ab.lastSuccessTime=ta();ab.online=y.isOnline();ka.log('rollup',ab);}};h.subscribe(j.ON_ENTER_STATE,db);fa(db,60000);h.subscribe(s.DUMP_EVENT,function(fb,gb){gb.channelRollup=ab;});var eb=function(){if(ja.isShutdown()||ja.shouldIdle())return;y.checkTimeTravel();var fb=Date.now()-(ja.lastPullTime||p.start);if(!cb&&fb>oa.STALL_THRESHOLD){var gb=ta();ka.error('stall',{lastSuccessTime:gb,rollupState:bb});cb=true;}var hb=Date.now()-ya;if(ja.state=='pull'&&hb>oa.JUMPSTART_THRESHOLD){ya=null;ka.warn('jumpstart',{state:ja.state,dormant:hb});ja.enterState('init');}};fa(eb,10000);}function wa(){var ya=Date.now(),za=1;function ab(){ga(ab,za*1000);var fb=ja.state;if(fb=='idle'&&ja.shouldIdle())return;ka.bump('conn_t',za);if(fb=='pull')ka.bump('conn_t_pull',za);}ab();var bb=[15,30,60,120,240],cb=false,db=false;function eb(fb){ga(function(){ka.rate('pullenter_'+fb,cb);ka.rate('pullexit_'+fb,db);},fb*1000);}while(bb.length)eb(bb.shift());h.subscribe(j.ON_ENTER_STATE,function(fb,gb){if(gb.state=='pull')cb=true;ya=Date.now();});h.subscribe(j.ON_EXIT_STATE,function(fb,gb){if(gb.state!='pull'||!ya)return;var hb='other';if(gb.status==j.OK){db=true;hb='ok';}else if(gb.xhr&&gb.xhr.errorType){hb=/ar:(\w+)/.test(gb.xhr.errorType)&&RegExp.$1;}else if(/^sys_/.test(gb.status))return;var ib=(Date.now()-ya)/1000;if(ib<0){return;}else if(ib>3600)ib=3600;ka.bump('conn_num');ka.bump('conn_exit',ib);ka.bump('conn_num_'+hb);ka.bump('conn_exit_'+hb,ib);});}function xa(ya){if(ya){sa=0;ra={};}else sa++;}ja={state:'idle',nextState:null,proxyDown:false,lastPullTime:Date.now(),lastReportOnMisguidedMsgTime:Date.now(),heartbeats:[],setTestCallback:ma,backoff:false,init:function(ya){this.init=function(){};this._logFantail('client initialized',j.FANTAIL_INFO);var za=!!oa.use_sticky_session,ab=null;if(za&&ha){for(var bb=0;bb<ha.length;bb++){var cb=ha.key(bb);if(cb.indexOf(ia)===0){ab=ha.getItem(cb);break;}}if(!ab){ab=oa.sessionID;ha.setItem(ia,ab);}}pa.enabled=!!oa.watchdog_enabled;oa.watchdog=pa;if(typeof(aa)!='undefined'){aa.subscribe(function(){oa.userActive=Date.now();m.sendActivePing(oa);}.bind(this));}else ka.error('user_activity_undefined');v.register('ch',ua);var db=this.getConfig('max_conn',2);oa.subdomain=l.allocate(db);if(ab&&ab.length&&ab.trim())oa.sessionID=ab;this._logFantail('using session id: '+oa.sessionID,j.FANTAIL_INFO);this._transportRate=new u(30000);var eb=(g.supportsCORS()&&!oa.forceIframe)?'CORSTransport':'IframeTransport';this.transport=new m[eb](this);if(ya)this.enterState.apply(this,arguments);h.subscribe(s.DUMP_EVENT,function(event,gb){gb.transportRate=this._transportRate.tally();gb.transportType=eb;gb.transportVersion=2;}.bind(this));va();wa();if(ja.getConfig('tryStreaming')&&ja.getConfig('host')&&g.supportsCORS()&&!oa.forceIframe){var fb=oa.MIN_INIT_PROBE_DELAY+Math.random()*oa.INIT_PROBE_DELAY_RANDOMIZE_RANGE;ga(this._probeTest,fb);}},configure:function(){var ya=ea(arguments);ka.log('configure',ya);ya.forEach(da.bind(null,oa));h.inform(j.ON_CONFIG,this);},getConfig:function(ya,za){return ya in oa?oa[ya]:za;},getCompleteConfig:function(){return oa;},getWatchdog:function(){return pa;},isShutdown:function(){return this.state=='shutdown';},shouldIdle:function(){return !(y.isPageOwner()&&y.isOnline());},_sendIframeError:function(ya){var za=new i().setURI('/ajax/presence/reconnect.php').setData({reason:ya,fb_dtsg:o.getToken()}).setOption('suppressErrorHandlerWarning',true).setOption('retries',1).setMethod('GET').setReadOnly(true).setAllowCrossPageTransition(true);za.specifiesWriteRequiredParams()&&za.send();},_getDelay:function(){var ya=Math.min(oa.MIN_RETRY_INTERVAL*Math.pow(2,Math.max(0,sa-1)),oa.MAX_RETRY_INTERVAL);if(this.proxyDown&&'proxy_down_delay_millis' in oa)ya=oa.proxy_down_delay_millis;this.proxyDown=false;return Math.floor(ya*(1+Math.random()*.5));},enterState:function(){if(this._inEnterState)ka.warn('enterstate_recursion');this._inEnterState=true;try{this._enterState.apply(this,arguments);this._inEnterState=false;}catch(ya){this._inEnterState=false;throw ya;}},_enterState:function(ya){if((ya.indexOf('pull')===0||ya.indexOf('ping')===0||ya.indexOf('shutdown')===0)&&!!oa.active_config_refresh){var za=Date.now(),ab=(za-oa.reconnectOverrideTimeMillis)/1000;if('config_refresh_seconds' in oa&&oa.config_refresh_seconds>0&&ab>oa.config_refresh_seconds){ya='reconnect';this._logFantail('forcing reconnect to refresh config'+' - this is normal behavior',j.FANTAIL_DEBUG);}}if(ya.indexOf('reconnect')===0)oa.reconnectOverrideTimeMillis=Date.now();var bb=this.backoff?this._getDelay():0;this.backoff=false;var cb=ea(arguments);if(this.isShutdown()){this._logFantail('not executing state due to shutdown mode: '+ya,j.FANTAIL_WARN);return;}if(ya!='idle!'&&this.shouldIdle()){this._logFantail('forced idleness',j.FANTAIL_WARN);return;}qa++;oa.stateId=qa;clearTimeout(this._deferredTransition);this._deferredTransition=null;this.transport.enterState('idle');this.state='idle';this.nextState=null;if(/!$/.test(ya)){var db=this._transportRate.tally().timeAverage,eb=ja.getConfig('MAX_CHANNEL_STATES_PER_SEC',1);if(db>=eb){if(!this._throttled){this._throttled=true;ka.warn('throttled');}ka.bump('throttle');bb=1000/eb;}}else if(!(/#$/.test(ya)))bb=this._getDelay();ya=ya.replace(/\W*$/,'');if(!na[ya]){this._logFantail('invalid state: '+ya,j.FANTAIL_ERROR);throw new Error('invalid state:'+ya);}var fb;if(bb<=0){fb={state:ya};this._transportRate.add(1);this.state=ya;var gb=this['_enter_'+this.state];if(gb){cb.shift();gb.apply(this,cb);}if(/init|idle|pull|ping/.test(this.state)){if(oa.streamingCapable&&/pull/.test(this.state))this.heartbeats=[];pa.transportEnteredState(ya);pa.clientEnteredState(ya);oa.is_offline=!n.isOnline();oa.capabilities=ba.getCapabilities();this._logFantail('entering transport state: '+this.state,j.FANTAIL_INFO);this.transport.enterState(this.state,oa);if(this.state=='ping'){fb.url=m.getURI(oa).toString();fb.port=oa.port||'undefined';}}}else{this.state='idle';this.nextState=ya;fb={state:this.state,delay:bb,nextState:ya};cb[0]=ya+'#';this._deferredTransition=ga((function(){this._deferredTransition=null;this.enterState.apply(this,cb);}).bind(this),bb);}if(/pull/.test(ya)){fb.client_id=oa.sessionID;fb.streaming=oa.inStreaming;}ka.log('enter_'+this.state,fb);h.inform(j.ON_ENTER_STATE,fb);},exitState:function(ya,za){var ab=ya.stateId,bb=ya.status;if((bb==j.SYS_TIMETRAVEL||bb==j.SYS_ONLINE||bb==j.SYS_NONOWNER||bb==j.SYS_OWNER)&&pa)pa.initialize();if(this.isShutdown()||ab<qa)return;var cb=ea(arguments),db=this.state;cb[0]=ya.status;var eb={state:db,status:bb};if(/pull/.test(db)){eb.client_id=oa.sessionID;eb.streaming=oa.inStreaming;}if(/ping/.test(db)&&bb!=j.OK)eb.url=m.getURI(oa).toString();if(this.nextState)eb.nextState=this.nextState;if(za&&za.errorType){oa.lastRequestErrorReason=za.errorType;eb.xhr=za.toJSON?za.toJSON():za;if(za.errorType==g.SERVICE_UNAVAILABLE){this._logFantail('got 5xx http status code, setting long delay',j.FANTAIL_ERROR);this.proxyDown=true;}delete eb.xhr.json;}else if(bb!=j.OK)oa.lastRequestErrorReason=bb;if(za&&za.json){if(za.json.t)eb.t=za.json.t;if(za.json.reason)eb.reason=za.json.reason;if(za.json.seq)eb.seq=za.json.seq;}ka.log('exit_'+db,eb);h.inform(j.ON_EXIT_STATE,eb);var fb=this['_exit_'+db];if(fb)bb=fb.apply(this,cb)||bb;if(bb!=j.OK){xa();ra[db]=(ra[db]||0)+1;}var gb=na[this.nextState||db][bb]||na._all[bb],hb=gb&&gb.replace(/!*$/,'');if(!hb){ka.error('terminal_transition',eb);this._shutdownHint=j.HINT_INVALID_STATE;gb='shutdown!';this._logFantail('entering shutdown state',j.FANTAIL_ERROR);}this._lastState=db;this._lastStatus=bb;this.enterState(gb);},_processTransportData:function(ya,za){var ab=za.json,bb=ab.t;if('s' in ab){ab.seq=ab.s;delete ab.s;}if(ab.u&&oa.user&&ab.u!=oa.user){ka.warn('misguided_msg',{user:oa.user,target:ab.u});this._reportProxyMisguidedMsg(ab.u,oa.user);return;}var cb=oa.seq;if('seq' in ab){oa.seq=ab.seq;w.doSync();}switch(bb){case 'continue':if(oa.inStreaming&&this.heartbeats.length<1){oa.streamingCapable=false;ka.log('switch_to_longpoll');ga(this._probeTest,oa.PROBE_DELAY);}xa(true);if(!oa.inStreaming||oa.STREAMING_EXIT_STATE_ON_CONTINUE)this.exitState({status:j.OK,stateId:ya});break;case 'refresh':case 'refreshDelay':this._logFantail('got refresh with reason: '+ab.reason,j.FANTAIL_INFO);this.exitState({status:'refresh_'+(ab.reason||0),stateId:ya},za);break;case 'backoff':this._logFantail('server told client to back off',j.FANTAIL_WARN);xa();this.backoff=true;break;case 'lb':var db=ab.lb_info;if(db){oa.sticky_token=db.sticky;if('pool' in db){oa.sticky_pool=db.pool;}else oa.host=db.vip;if(g.supportsCORS()&&!oa.forceIframe){var eb=oa.subdomain===null?oa.host:(oa.subdomain+'-'+oa.host),fb=new ca(eb,oa.port,oa.sticky_pool,oa.sticky_token,oa.uid,oa.viewer_uid,oa.profile,oa.sessionID,oa.capabilities);h.inform(j.RTI_SESSION,fb);}}else ka.error('bad lb info');break;case 'test_streaming':ga(this._probeTest,500);break;case 'fullReload':v.clear();ka.log('invalid_history');h.inform(j.ON_INVALID_HISTORY);xa(true);this._logFantail('full reload incurred',j.FANTAIL_INFO);this.exitState({status:j.ERROR_MISSING,stateId:ya},za);break;case 'msg':var gb,hb,ib,jb;xa(true);if('tr' in ab)oa.trace_id=ab.tr;hb=ab.ms;ib=oa.seq-hb.length;for(gb=0;gb<hb.length;gb++,ib++)if(ib>=cb){jb=hb[gb];if(jb.type){var kb=j.getArbiterType(jb.type);if(jb.type==='messaging'){var lb={type:'messaging',event:jb.event};if(jb.message){lb.inbox_unread=jb.unread_counts&&jb.unread_counts.inbox;lb.tid=jb.message.tid;lb.mid=jb.message.mid;this._logFantail('got message with id: '+jb.message.mid,j.FANTAIL_INFO);}ka.debug('message',lb);}else if(jb.type==='m_messaging'){ka.debug('message',{type:'m_messaging',tid:jb.tid,mid:jb.uuid});}else if(jb.type==='pages_messaging'){if(jb.unread_counts&&jb.unread_counts.inbox)h.inform(j.getArbiterType('pages_inbox_count_update'),{page_id:jb[t.VIEWER_FBID],inbox_unread:jb.unread_counts.inbox});}else if(jb.type==='skywalker'){kb=j.SKYWALKER;}else ka.debug('message',{type:jb.type});h.inform(kb,{obj:jb});}}else ka.warn('seq_regression',{seq:ib,last_seq:cb,messages:hb.length});break;case 'heartbeat':if(oa.inStreaming){var mb=Date.now();if(this.heartbeats.length>0){var nb=mb-this.heartbeats[this.heartbeats.length-1];ka.log('heartbeat_interval',{client_id:oa.sessionID,interval:nb});}this.heartbeats.push(mb);}break;default:this._logFantail('got an unknown protocol message: '+bb,j.FANTAIL_ERROR);ka.error('unknown_msg_type',{type:bb});break;}},_enter_init:function(){if(ra.init>=ja.getConfig('MAX_INIT_FAILS',2))return setTimeout(this.exitState.bind(this,{status:j.ERROR_MAX,stateId:qa}),0);this._initTimer=ga(this.exitState.bind(this,{status:j.ERROR,stateId:qa},'timeout'),oa.IFRAME_LOAD_TIMEOUT);},_enter_reconnect:function(ya){this._logFantail('entered reconnect with reason: '+ya,j.FANTAIL_INFO);var za=qa;if(!x.hasUserCookie()){this._logFantail('user has no cookie???',j.FANTAIL_WARN);ka.warn('no_user_cookie');setTimeout(function(){ja._shutdownHint=j.HINT_AUTH;ja.exitState({status:j.ERROR_SHUTDOWN,stateId:za});},0);return;}var ab={reason:ya,fb_dtsg:o.getToken()};if(r.token)ab.fb_isb=r.token;if(la)la(ab);var bb=new q('GET','/ajax/presence/reconnect.php',ab);bb.onSuccess=(function(){ja.configure(bb.json);v.store();this.exitState({status:j.OK,stateId:za});}).bind(this);bb.onError=(function(){var cb=bb.json&&bb.json.error;this._logFantail('reconnect error: '+bb.errorType,j.FANTAIL_ERROR);if(bb.errorType==g.TRANSPORT_ERROR||bb.errorType==g.PROXY_ERROR||bb.errorType==g.SERVICE_UNAVAILABLE)this._shutdownHint=j.HINT_CONN;if(cb&&cb==1356007){this._shutdownHint=j.HINT_MAINT;}else if(cb==1357001||cb==1357004||cb==1348009){this._shutdownHint=j.HINT_AUTH;}else this._shutdownHint=null;this.exitState({status:this._shutdownHint?j.ERROR_SHUTDOWN:j.ERROR,stateId:za},bb);}).bind(this);bb.send();},_enter_shutdown:function(){h.inform(j.ON_SHUTDOWN,{reason:this._shutdownHint});if(!!oa.shutdown_recovery_enabled&&'shutdown_recovery_interval_seconds' in oa&&oa.shutdown_recovery_interval_seconds>0){var ya=oa.shutdown_recovery_interval_seconds*1000;ga((function(){h.inform(j.ATTEMPT_RECONNECT);this.state='reconnect!';this.enterState('reconnect!');}).bind(this),ya);}},_exit_init:function(ya){if(this._initTimer)this._initTimer=clearTimeout(this._initTimer);if(ya==j.ERROR_MAX)this._sendIframeError(j.reason_IFrameLoadGiveUp);},_exit_pull:function(ya,za){var ab=ya==j.OK;pa.reportPullReturned(ab,this);if(ab){this.lastPullTime=Date.now();}else{var bb="exit status: "+ya;if(za&&za.errorType)bb+=" ajax request error: "+za.errorType;this._logFantail('pull failed with status: '+bb,j.FANTAIL_ERROR);}},_exit_ping:function(ya){if(ya==j.OK){var za=Date.now()-(this.lastPullTime||p.start);if(za>oa.STALL_THRESHOLD){this._logFantail('didnt complete a successful pull for too long',j.FANTAIL_ERROR);return j.ERROR_STALE;}}else this._logFantail('ping failed with status: '+ya,j.FANTAIL_ERROR);},_reportProxyMisguidedMsg:function(ya,za){this._logFantail('misguided message to '+za+' meant for '+ya,j.FANTAIL_ERROR);var ab=Date.now();if(ab-this.lastReportOnMisguidedMsgTime<=oa.CHANNEL_PROXY_REPORTING_MIN_INTERVAL)return;this.lastReportOnMisguidedMsgTime=ab;var bb={received_uid:ya,expected_uid:za};if(oa.sticky_token)bb.sticky_token=oa.sticky_token;var cb=new z('/err_misguided_msg').setDomain(oa.host+'.facebook.com').setPort(oa.port).setSecure(z().isSecure()).setQueryData(bb),db=new g('GET',cb);if(g.supportsCORS())db.xhr.withCredentials=true;db.onSuccess=function(eb){};db.onError=function(eb){};db.onJSON=function(eb,fb){};db.send();},_probeTest:function(){oa.streamingCapable=false;var ya=[],za={mode:'stream',format:'json'};if(oa.sticky_token)za.sticky_token=oa.sticky_token;var ab=new z('/probe').setDomain(oa.host+'.facebook.com').setPort(oa.port).setSecure(z().isSecure()).setQueryData(za),bb=new g('GET',ab);bb.onJSON=function(cb,db){if(cb&&cb.json&&cb.json.t==='heartbeat'){ya.push(Date.now());if(ya.length>=2){var eb=ya[1]-ya[0];if(eb>=oa.PROBE_HEARTBEATS_INTERVAL_LOW&&eb<=oa.PROBE_HEARTBEATS_INTERVAL_HIGH){oa.streamingCapable=true;ka.log('switch_to_streaming');}ka.log('probe_ok',{time:eb});}}};bb.onSuccess=function(cb){if(ya.length!=2){oa.streamingCapable=false;ka.error('probe_error',{error:'beats.length = '+ya.length});}};bb.onError=function(cb){oa.streamingCapable=false;ka.error('probe_error',cb);};ka.log('probe_request');bb.send();},_logFantail:function(ya,za){var ab=oa.fantail_queue_capacity||oa.FANTAIL_QUEUE_CAPACITY;if(!oa.fantail_enabled||oa.fantail_logs.length>ab)return;var bb='fantail queue size exceeded',cb=j.FANTAIL_WARN;if(oa.fantail_logs.length<ab){bb=ya;cb=za;}var db=oa.fantail_logs.length,eb={};eb['time'+db]=Date.now();eb['log'+db]=bb;eb['severity'+db]=cb;oa.fantail_logs.push(eb);}};e.exports=ja;if(k.channelConfig){ja.configure(k.channelConfig);if(/shutdown/.test(k.state))ja._shutdownHint=j[k.reason];ja.init(k.state,k.reason);}},null);
__d("ChannelConnection",["Arbiter","copyProperties","ChatConfig","Run","SystemEvents","ChannelConstants","ChannelManager","JSLogger","setTimeoutAcrossTransitions"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){var p=n.create('channel_connection'),q=null,r=null,s=null,t=null,u=0,v=h(new g(),{CONNECTED:'chat-connection/connected',RECONNECTING:'chat-connection/reconnecting',SHUTDOWN:'chat-connection/shutdown',MUTE_WARNING:'chat-connection/mute',UNMUTE_WARNING:'chat-connection/unmute'});function w(){if(r){clearTimeout(r);r=null;}}function x(){w();p.log('unmute_warning');v.inform(v.UNMUTE_WARNING);}function y(ba){w();r=o(x,ba);p.log('mute_warning',{time:ba});v.inform(v.MUTE_WARNING);}function z(){if(s){clearTimeout(s);s=null;}}function aa(ba,ca){z();if(ba===l.ON_ENTER_STATE&&(ca.nextState||ca.state)==='pull'){if(t!==v.CONNECTED){p.log('connected');var da=!t;t=v.CONNECTED;u=0;v.inform(v.CONNECTED,{init:da});}}else if(ba===l.ON_ENTER_STATE&&((ca.nextState||ca.state)==='ping'||(!ca.nextState&&ca.state==='idle'))){s=o(function(){var ea=null;if(!(ca.state==='idle'&&!ca.nextState))ea=(ca.delay||0);p.log('reconnecting',{delay:ea});if(v.disconnected())p.log('reconnecting_ui',{delay:ea});t=v.RECONNECTING;(ca.state==='idle')&&u++;if(u>1){v.inform(v.RECONNECTING,ea);}else if(!ca.nextState&&ca.state==='idle')aa(ba,ca);},500);}else if(ba===l.ON_SHUTDOWN){p.log('shutdown',{reason:ca.reason});t=v.SHUTDOWN;u=0;v.inform(v.SHUTDOWN,ca.reason);}}if(m.isShutdown()){aa(l.ON_SHUTDOWN,m._shutdownHint);}else aa(l.ON_ENTER_STATE,{state:m.state,nextState:m.nextState,delay:0});h(v,{disconnected:function(){return t===v.SHUTDOWN||(t===v.RECONNECTING&&!r&&u>1);},isShutdown:function(){return t===v.SHUTDOWN;},reconnect:function(ba){if(m.state==='ping'||m.isShutdown())return;p.log('reconnect',{now:ba});v.inform(v.RECONNECTING,0);if(!!ba){if(q!==null){clearTimeout(q);q=null;}m.enterState('ping!');}else if(!q)q=o(function(){m.enterState('ping!');q=null;},i.get('channel_manual_reconnect_defer_msec'));},unmuteWarning:x});g.subscribe([l.ON_ENTER_STATE,l.ON_SHUTDOWN],aa);g.subscribe(l.ATTEMPT_RECONNECT,function(){if(v.disconnected())v.reconnect();});k.subscribe(k.TIME_TRAVEL,function(){v.reconnect();y(i.get('mute_warning_time_msec'));});j.onBeforeUnload(z,false);e.exports=v;},null);
__d("ChatContexts",[],function(a,b,c,d,e,f){var g={};function h(k){var l=k?k.subtext:'';return l;}function i(k,l){g[k]=l;}var j={get:function(k){if(k in g){return g[k];}else return null;},update:function(k){for(var l in k)i(l,k[l]);},getShortDisplay:function(k){return h(j.get(k));}};e.exports=j;},null);
__d("Poller",["ArbiterMixin","AsyncRequest","CurrentUser","copyProperties","emptyFunction","mixin","setTimeoutAcrossTransitions"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n=l(g);for(var o in n)if(n.hasOwnProperty(o))q[o]=n[o];var p=n===null?null:n.prototype;q.prototype=Object.create(p);q.prototype.constructor=q;q.__superConstructor__=n;function q(t){"use strict";this._config=j({clearOnQuicklingEvents:true,setupRequest:k,interval:null,maxRequests:Infinity,dontStart:false},t);this._handle=null;if(!this._config.dontStart)this.start();}q.prototype.start=function(){"use strict";if(this._polling)return this;this._requests=0;this.request();return this;};q.prototype.stop=function(){"use strict";this._cancelRequest();return this;};q.prototype.mute=function(){"use strict";this._muted=true;return this;};q.prototype.resume=function(){"use strict";if(this._muted){this._muted=false;if(this._handle===null&&this._polling)return this.request();}return this;};q.prototype.skip=function(){"use strict";this._skip=true;return this;};q.prototype.reset=function(){"use strict";return this.stop().start();};q.prototype.request=function(){"use strict";this._cancelRequest();this._polling=true;if(!s())return this._done();if(this._muted)return this;if(++this._requests>this._config.maxRequests)return this._done();var t=new h();t.setIsBackgroundRequest(true);var u=false;t.setInitialHandler(function(){return !u;});this._cancelRequest=function(){u=true;this._cleanup();}.bind(this);t.setFinallyHandler(r.bind(this));t.setInitialHandler=k;t.setFinallyHandler=k;this._config.setupRequest(t,this);if(this._skip){this._skip=false;setTimeout(r.bind(this),0);}else t.send();return this;};q.prototype.isPolling=function(){"use strict";return this._polling;};q.prototype.isMuted=function(){"use strict";return this._muted;};q.prototype.setInterval=function(t){"use strict";if(t){this._config.interval=t;this.start();}};q.prototype.getInterval=function(){"use strict";return this._config.interval;};q.prototype._cleanup=function(){"use strict";if(this._handle!==null)clearTimeout(this._handle);this._handle=null;this._cancelRequest=k;this._polling=false;};q.prototype._done=function(){"use strict";this._cleanup();this.inform('done',{sender:this});return this;};q.MIN_INTERVAL=2000;j(q.prototype,{_config:null,_requests:0,_muted:false,_polling:false,_skip:false,_cancelRequest:k});function r(){if(!this._polling)return;if(this._requests<this._config.maxRequests){var t=this._config.interval;t=typeof t==='function'?t(this._requests):t;t=(t>q.MIN_INTERVAL)?t:q.MIN_INTERVAL;if(this._config.clearOnQuicklingEvents){this._handle=setTimeout(this.request.bind(this),t);}else this._handle=m(this.request.bind(this),t);}else this._done();}function s(){return i.isLoggedInNow();}e.exports=q;},null);
__d("PresencePoller",["AvailableListConstants","AvailableListInitialData","BanzaiODS","ChannelConnection","ChatContexts","ChatVisibility","CurrentUser","JSLogger","LastMobileActiveTimes","Poller","PresencePrivacy","PresenceStatus","ServerTime","ShortProfiles","UserActivity","copyProperties","debounceAcrossTransitions"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w){var x=5,y='/ajax/chat/buddy_list.php',z=1800000,aa=h.pollInterval,ba=h.lazyPollInterval,ca=h.lazyThreshold,da=n.create('available_list'),ea='presence_poller';i.setEntitySample(ea,.01);function fa(ga){"use strict";this.$PresencePoller0=ga;this.$PresencePoller1=false;this.$PresencePoller2=h.chatNotif;this.$PresencePoller3=new p({interval:aa,setupRequest:this.$PresencePoller4.bind(this),clearOnQuicklingEvents:false,dontStart:true});if(l.isOnline()){this.$PresencePoller5=Date.now();this.$PresencePoller6=Date.now();this.$PresencePoller7=Date.now();this.$PresencePoller8=h.updateTime;}else{this.$PresencePoller5=0;this.$PresencePoller8=0;this.$PresencePoller6=0;this.$PresencePoller7=0;}this.$PresencePoller9=0;this.$PresencePollera('available_initial_data',h.updateTime,h.availableList,h.lastActiveTimes,h.mobileFriends);u.subscribe(function(ha,ia){if(ia.idleness>aa)this.forceUpdate();}.bind(this));q.subscribe('privacy-user-presence-changed',function(){this.forceUpdate();}.bind(this));}fa.prototype.start=function(){"use strict";setTimeout(this.$PresencePoller3.start.bind(this.$PresencePoller3),0);};fa.prototype.restart=function(){"use strict";if(this.$PresencePoller3.isMuted()){this.$PresencePoller3.resume();this.forceUpdate();}};fa.prototype.stop=function(){"use strict";this.$PresencePoller3.mute();};fa.prototype.forceUpdate=function(){"use strict";this.$PresencePoller3.request();};fa.prototype.getIsUserIdle=function(){"use strict";return this.$PresencePoller1;};fa.prototype.getWebChatNotification=function(){"use strict";return this.$PresencePoller2;};fa.prototype.getCallback=function(){"use strict";return this.$PresencePoller0;};fa.prototype.$PresencePollerb=function(){"use strict";return w(function(){this.$PresencePoller0(g.ON_AVAILABILITY_CHANGED);}.bind(this),0)();};fa.prototype.$PresencePollera=function(ga,ha,ia,ja,ka){"use strict";this.$PresencePoller8=ha;if(!Array.isArray(ia)){r.resetPresenceData();for(var la in ia)r.set(la,ia[la].a,false,ga,ia[la].c,ia[la].p);}if(ja)o.update(ja);if(ka)r.setMobileFriends(ka);this.$PresencePollerb();};fa.prototype.$PresencePoller4=function(ga){"use strict";if(j.isShutdown()||!l.isOnline()){this.$PresencePoller3.skip();i.bumpEntityKey(ea,'skip.offline');return;}if(Date.now()-this.$PresencePoller5<aa){this.$PresencePoller3.skip();i.bumpEntityKey(ea,'skip.recent');return;}i.bumpEntityKey(ea,'request');this.$PresencePoller5=Date.now();var ha=Date.now()-this.$PresencePoller7,ia=t.getCachedProfileIDs().join(",");ga.setHandler(this.$PresencePollerc.bind(this)).setErrorHandler(this.$PresencePollerd.bind(this)).setOption('suppressErrorAlerts',true).setOption('retries',1).setData({user:m.getID(),cached_user_info_ids:ia,fetch_mobile:(ha>z)}).setURI(y).setAllowCrossPageTransition(true);};fa.prototype.$PresencePollerc=function(ga){"use strict";var ha=ga.getPayload(),ia=ha.buddy_list;if(!ia){this.$PresencePollerd(ga);return;}i.bumpEntityKey(ea,'response');this.$PresencePollere();this.$PresencePoller6=Date.now();s.update(ha.time);if(ia.mobile_friends)this.$PresencePoller7=Date.now();this.$PresencePoller9=0;this.$PresencePollerf();var ja=ia.userInfos;if(ja)t.setMulti(ja);var ka=ia.chatContexts;ka&&k.update(ka);this.$PresencePoller1=ia.userIsIdle;if(ia.chatNotif!==(void 0)){this.$PresencePoller2=ia.chatNotif;this.$PresencePoller0(g.ON_CHAT_NOTIFICATION_CHANGED,this.$PresencePoller2);}this.$PresencePollera('buddy_list_poller',ha.time,ia.nowAvailableList,ia.last_active_times,ia.mobile_friends);};fa.prototype.$PresencePollerd=function(ga){"use strict";i.bumpEntityKey(ea,'error');if(ga.getError()==1356007)return;this.$PresencePoller9++;if(this.$PresencePoller9>=x)this.$PresencePoller0(g.ON_UPDATE_ERROR);};fa.prototype.$PresencePollerf=function(){"use strict";var ga=u.isActive(ca)?aa:ba;i.bumpEntityKey(ea,'period.'+ga);this.$PresencePoller3.setInterval(ga);};fa.prototype.$PresencePollere=function(){"use strict";var ga=Date.now(),ha=ga-this.$PresencePoller6;da.log('buddylist_presence_stats',v({duration:ha},r.getPresenceStats()));};e.exports=fa;},null);
__d("TypingStates",[],function(a,b,c,d,e,f){var g={INACTIVE:0,TYPING:1,QUITTING:2};e.exports=g;},null);
__d("AvailableList",["Arbiter","ArbiterMixin","AsyncRequest","AvailableListConstants","BanzaiODS","ChannelConnection","ChannelConstants","ChatConfig","ChatVisibility","JSLogger","LastMobileActiveTimes","PresencePoller","PresencePrivacy","PresenceStatus","ServerTime","ShortProfiles","TypingStates","copyProperties","debounceAcrossTransitions","emptyFunction"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z){k.setEntitySample('presence',.0001);var aa=x({},j,h);aa.subscribe([j.ON_AVAILABILITY_CHANGED,j.ON_UPDATE_ERROR],function(ja,ka){g.inform(ja,ka);});var ba=y(function(){aa.inform(j.ON_AVAILABILITY_CHANGED);},0);function ca(ja,ka,la,ma,na,oa){var pa=t.set(ja,ka,la,ma,na,oa);if(pa)ba();}function da(ja){var ka=ja.payload.availability||{};for(var la in ka)ca(la,ka[la].a,true,'mercury_tabs',ka[la].c,ka[la].p);}function ea(){ia.restart();}function fa(){ia.stop();}function ga(ja){var ka=aa.getDebugInfo(ja),la=(ka.presence==j.ACTIVE),ma=new i('/ajax/mercury/tabs_presence.php').setData({target_id:ja,to_online:la,presence_source:ka.overlaySource,presence_time:ka.overlayTime}).setHandler(da).setErrorHandler(z).setAllowCrossPageTransition(true).send();}function ha(ja,ka){ka.chat_config=n.getDebugInfo();ka.available_list_debug_info={};t.getAvailableIDs().forEach(function(la){ka.available_list_debug_info[la]=aa.getDebugInfo(la);});ka.available_list_poll_interval=aa._poller&&aa._poller.getInterval();}var ia=new r(function(event){aa.inform(event);});x(aa,{get:function(ja){return t.get(ja);},updateForID:function(ja){ga(ja);},getWebChatNotification:function(){return ia.getWebChatNotification();},isUserIdle:function(){return ia.getIsUserIdle();},isReady:function(){return true;},set:function(ja,ka,la,ma,na){ca(ja,ka,true,la,ma,na);},update:function(){ia.forceUpdate();},isIdle:function(ja){return aa.get(ja)==j.IDLE;},getDebugInfo:function(ja){var ka=t.getDebugInfo(ja),la=v.getNow(ja);if(la)ka.name=la.name;return ka;}});ia.start();g.subscribe(p.DUMP_EVENT,ha);g.subscribe('chat-visibility/go-online',ea);g.subscribe('chat-visibility/go-offline',fa);s.subscribe(['privacy-changed','privacy-availability-changed','privacy-user-presence-response'],ba);l.subscribe([l.CONNECTED,l.RECONNECTING,l.SHUTDOWN,l.MUTE_WARNING,l.UNMUTE_WARNING],ba);g.subscribe(m.getArbiterType('buddylist_overlay'),function(ja,ka){var la={},ma=ka.obj.overlay;for(var na in ma){aa.set(na,ma[na].a,ma[na].s||'channel',ma[na].vc,ma[na].p);if(ma[na].la)la[na]=ma[na].la;}q.update(la);});g.subscribe([m.getArbiterType('typ'),m.getArbiterType('ttyp')],function(ja,ka){var la=ka.obj;if(la.st===w.TYPING){var ma=la.from;if(o.isOnline()){k.bumpEntityKey('presence','stale_presence_check_typing');var na=t.get(ma);if(na!=j.ACTIVE){var oa=q.get(ma)*1000,pa=u.get();if(!oa){k.bumpEntityKey('presence','no_detailed_presence_typing');}else if(pa-oa>5*60*1000){var qa='stale_presence_typing',ra=pa-oa;if(ra<10*60*1000){qa+='600';}else if(ra<60*60*1000)qa+='3600';k.bumpEntityKey('presence',qa);}}}aa.set(ma,j.ACTIVE,'channel-typing');}});g.subscribe(m.getArbiterType('messaging'),function(ja,ka){if(!o.isOnline())return;var la=ka.obj;if(la.message&&la.message.timestamp&&la.message.sender_fbid){var ma=u.get(),na=la.message.timestamp;if(ma-na<2*60*1000){k.bumpEntityKey('presence','stale_presence_check');var oa=la.message.sender_fbid,pa=t.get(oa);if(pa==j.ACTIVE)return;var qa=q.get(oa)*1000;if(!qa){k.bumpEntityKey('presence','no_detailed_presence');}else if(na-qa>5*60*1000){var ra='stale_presence',sa=na-qa;if(sa<10*60*1000){ra+='600';}else if(sa<60*60*1000)ra+='3600';k.bumpEntityKey('presence',ra);}}}});a.AvailableList=e.exports=aa;},null);
__d("ChatImpressionLogger",["AsyncSignal","requireWeak","ChatConfig","ChatVisibility","Poller","PresencePrivacy","PresenceStatus","debounceAcrossTransitions","copyProperties"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){var p=null;h(['AvailableList'],function(v){return p=v;});var q=null;function r(){if(!q)return '';return q.getCachedSortedList().toString();}function s(){if(!q||!p)return '';var v=[],w=q.getCachedSortedList();for(var x=0;x<w.length;x++)v[x]=p.get(w[x]);return v.toString();}function t(v){v.setURI('/ajax/chat/imps_logging.php').setData({list_availability:s(),sorted_list:r(),source:'periodical_imps'});}var u={init:function(v){q=v;var w=i.get('chat_impression_logging_periodical',0);if(w){var x=i.get('periodical_impression_logging_config.interval'),y=new k({interval:x,setupRequest:t,clearOnQuicklingEvents:false,dontStart:true});l.subscribe('privacy-user-presence-changed',n(function(){if(j.isOnline()){y.start();}else y.stop();}));}this.init=function(){};},logImpression:function(v,w,x){var y=i.get('chat_impression_logging_with_click'),z={list_availability:y?s():'',sorted_list:y?r():'',source:v,target:w,target_presence:m.get(w),viewport_width:document.body.clientWidth};new g('/ajax/chat/ct.php',o(z,x)).send();}};e.exports=u;},null);
__d("ChatWelcomeMessage",["ImmutableObject"],function(a,b,c,d,e,f,g){'use strict';function h(){this.$ChatWelcomeMessage0={};}h.prototype.setWelcomeMessage=function(j,k,l){this.$ChatWelcomeMessage0[j]=new g({timestamp:Date.now(),thread_id:j,author:k,body:l});};h.prototype.getWelcomeMessage=function(j){return this.$ChatWelcomeMessage0[j];};var i=new h();e.exports=i;},null);
__d("MercuryIDs",[],function(a,b,c,d,e,f){var g={isValid:function(h){if(!h||typeof h!=='string')return false;return (/^\w{3,12}:/.test(h));},isValidThreadID:function(h){if(!g.isValid(h))return false;var i=g.tokenize(h);switch(i.type){case 'user':case 'group':case 'thread':case 'root':case 'pending':return true;default:return false;}},tokenize:function(h){if(!this.isValid(h))throw ("bad_id_format "+h);var i=h.indexOf(':');return {type:h.substr(0,i),value:h.substr(i+1)};},getUserIDFromParticipantID:function(h){if(!this.isValid(h))throw ("bad_id_format "+h);var i=g.tokenize(h),j=i.type,k=i.value;if(j!='fbid')return null;return k;},getParticipantIDFromUserID:function(h){if(isNaN(h))throw ("Not a user ID: "+h);return 'fbid:'+h;},getUserIDFromThreadID:function(h){if(!this.isCanonical(h))return null;return this.tokenize(h).value;},getThreadIDFromUserID:function(h){return 'user:'+h;},getThreadIDFromParticipantID:function(h){var i=this.getUserIDFromParticipantID(h);return i?this.getThreadIDFromUserID(i):null;},getParticipantIDFromFromThreadID:function(h){return this.getParticipantIDFromUserID(this.getUserIDFromThreadID(h)||'');},isCanonical:function(h){return this.isValid(h)&&this.tokenize(h).type==='user';},isMultichat:function(h){return this.isValid(h)&&this.tokenize(h).type!=='user';}};e.exports=g;},null);
__d("MercuryAssert",["MercuryIDs"],function(a,b,c,d,e,f,g){e.exports={isParticipantID:function(h){if(!g.isValid(h))throw ("bad_participant_id "+h);},allParticipantIDs:function(h){h.forEach(this.isParticipantID);},isUserParticipantID:function(h){var i=g.tokenize(h);if(i.type!='fbid')throw ("bad_user_id "+h);},isEmailParticipantID:function(h){var i=g.tokenize(h);if(i.type!='email')throw ("bad_email_id "+h);},allThreadID:function(h){h.forEach(this.isThreadID);},isThreadID:function(h){if(!g.isValid(h))throw ("bad_thread_id "+h);}};},null);
__d("MercuryAttachment",["MercuryAttachmentContentType","MercuryAttachmentType","MercuryAudioType"],function(a,b,c,d,e,f,g,h,i){var j={getAttachIconClass:function(k){switch(k){case g.PHOTO:return 'MercuryPhotoIcon';case g.VIDEO:return 'MercuryVideoIcon';case g.MUSIC:return 'MercuryMusicIcon';case g.VOICE:return 'MercuryVoiceIcon';case g.TEXT:return 'MercuryTextIcon';case g.MSWORD:return 'MercuryMSWordIcon';case g.MSXLS:return 'MercuryMSXLSIcon';case g.MSPPT:return 'MercuryMSPPTIcon';}return 'MercuryDefaultIcon';},getAttachIconClassByMime:function(k){if(k.startsWith('image')){return 'MercuryPhotoIcon';}else if(k.startsWith('video')){return 'MercuryVideoIcon';}else if(k.startsWith('audio')){return 'MercuryMusicIcon';}else if(k.startsWith('text/plain')){return 'MercuryTextIcon';}else return 'MercuryDefaultIcon';},getAttachTypeByMime:function(k){if(k.startsWith('image')){return g.PHOTO;}else if(k.startsWith('video')){return g.VIDEO;}else if(k.startsWith('audio')){return g.MUSIC;}else if(k.startsWith('text/plain')){return g.TEXT;}else return g.UNKNOWN;},convertRaw:function(k){var l=[];for(var m=0;m<k.length;m++){var n=k[m];if(n.attach_type===h.PHOTO){l.push(n);}else if(n.filename){var o=j.getAttachTypeByMime(n.filetype),p={};p.attach_type=h.FILE;p.name=n.filename;p.icon_type=o;p.url='';l.push(p);}}return l;},get:function(k){var l=[];if(k.attachments){l=k.attachments;}else if(k.raw_attachments)l=this.convertRaw(k.raw_attachments);if(!(k.attachments&&k.attachments.length>0)){if(k.sticker_id)return l.concat([{attach_type:h.STICKER}]);if(k.preview_attachments&&k.preview_attachments.length>0)return l.concat(k.preview_attachments);}return l;},isVoiceMessage:function(k){return (k===i.AudioClip||k===i.VoiceMessageWithTranscript);}};e.exports=j;},null);
__d("MercurySingletonMixin",["CurrentUser"],function(a,b,c,d,e,f,g){var h={_getInstances:function(){if(!this._instances)this._instances={};return this._instances;},get:function(){return this.getForFBID(g.getID());},getForFBID:function(i){var j=this._getInstances();if(!j[i])j[i]=new this(i);return j[i];}};e.exports=h;},null);
__d("ReportState",["ErrorUtils","invariant"],function(a,b,c,d,e,f,g,h){var i={};function j(l,m){h(!i[l]);i[l]=m;}function k(){var l={};Object.keys(i).forEach(function(m){try{l[m]=i[m]();}catch(n){g.reportError('ReportState: callback threw an error.');}});return l;}e.exports={registerCallback:j,getState:k};},null);
__d("MercuryMessageClientState",[],function(a,b,c,d,e,f){var g={DO_NOT_SEND_TO_SERVER:'do_not_send_to_server',SEND_TO_SERVER:'send_to_server'};e.exports=g;},null);
__d("MercurySendAttemptLogger",["Banzai","BanzaiLogger","MercuryAttachmentType","MercurySendMessageFields"],function(a,b,c,d,e,f,g,h,i,j){var k=h.create({retry:true}),l=g.isEnabled('mercury_send_attempt_logging'),m=function(o){if(!o.has_attachment)return null;if(o.sticker_id)return i.STICKER;if((o.image_ids&&o.image_ids.length)||(o.photo_fbids&&o.photo_fbids.length))return i.PHOTO;if(o.raw_attachments&&o.raw_attachments.length)return i.FILE;if(o.content_attachment)return i.SHARE;return i.UNKNOWN;},n={log:function(o){if(!l)return;var p={message_id:o.message_id,timestamp_client:Date.now(),attempt_num:o[j.MANUAL_RETRY_CNT],first_attachment_type:m(o),source:o.source,auto_retry_cnt:o[j.AUTO_RETRY_CNT]};k.log('MercurySendAttemptLoggerConfig',p);}};e.exports=n;},null);
__d("MercurySendErrorLogger",["Banzai","BanzaiLogger"],function(a,b,c,d,e,f,g,h){var i=h.create({retry:true}),j=g.isEnabled('mercury_send_error_logging'),k={log:function(l){if(!j)return;var m={message_id:l.message_id,timestamp_client:Date.now(),error_type:l.error_data.type,error_code:l.error_data.code,error_description:l.error_data.description,is_transient:l.error_data.is_transient};i.log('MercurySendErrorLoggerConfig',m);}};e.exports=k;},null);
__d("MercuryServerSendMessageQueueSimulatedError",["AsyncRequest","AsyncResponse","copyProperties"],function(a,b,c,d,e,f,g,h,i){var j=9999,k={create:function(l){var m=new g(this.endpoint_uri).setData({message_batch:[l],client:this.client}),n=new h(m,{});i(n,{error:j,silentError:false,transientError:true,request:m});return n;}};e.exports=k;},null);
__d("MercuryServerSendMessageQueue",["BanzaiODS","LogHistory","MercuryLoggingHelper","MercuryServerDispatcher","MercuryServerSendMessageQueueSimulatedError"],function(a,b,c,d,e,f,g,h,i,j,k){var l='/ajax/mercury/send_messages.php',m=h.getInstance('mercury_server_send_message_queue');function n(o,p,q,r){"use strict";this.sender_id=o;this.queue_id=p;this.$MercuryServerSendMessageQueue0=q.success_handler;this.$MercuryServerSendMessageQueue1=q.error_handler;this.$MercuryServerSendMessageQueue2=q.transport_error_handler;this.$MercuryServerSendMessageQueue3=q.timeout_handler;this.client=r;var s={};s[l]={request_user_id:this.sender_id,endpoint_id:this.queue_id,mode:j.IMMEDIATE,handler:this.handleSuccess.bind(this),error_handler:this.handleError.bind(this),transport_error_handler:this.handleTransportError.bind(this),timeout:q.timeout,timeout_handler:this.handleTimeout.bind(this),connection_retries:q.connection_retries,send_attempt_logging_handler:q.send_attempt_logging_handler,auto_retries:q.auto_retries};j.registerEndpoints(s);this.pending_message=null;this.queue=[];}n.prototype.enqueue=function(o){"use strict";this.queue.push(o);this.$MercuryServerSendMessageQueue4();};n.prototype.$MercuryServerSendMessageQueue4=function(){"use strict";if(this.pending_message||!this.queue.length){if(this.pending_message)this.$MercuryServerSendMessageQueue5();return;}this.pending_message=this.queue.shift();j.trySend(l,{message_batch:[this.pending_message],client:this.client},null,this.sender_id,this.queue_id);};n.prototype.$MercuryServerSendMessageQueue6=function(){"use strict";while(this.queue.length)this.$MercuryServerSendMessageQueue7(this.queue.shift());};n.prototype.$MercuryServerSendMessageQueue7=function(o){"use strict";this.$MercuryServerSendMessageQueue1(k.create(o));m.error('mark_as_failed',{fbid:this.sender_id,queue_id:this.queue_id,message:i.obfuscateMessage(o)});};n.prototype.handleSuccess=function(o,p){"use strict";this.$MercuryServerSendMessageQueue0(o,p);this.pending_message=null;this.$MercuryServerSendMessageQueue4();};n.prototype.handleError=function(o){"use strict";this.$MercuryServerSendMessageQueue1(o);this.$MercuryServerSendMessageQueue6();this.pending_message=null;};n.prototype.handleTransportError=function(o){"use strict";this.$MercuryServerSendMessageQueue2(o);this.$MercuryServerSendMessageQueue6();this.pending_message=null;};n.prototype.handleTimeout=function(o){"use strict";this.$MercuryServerSendMessageQueue3(o);this.$MercuryServerSendMessageQueue6();this.pending_message=null;};n.prototype.$MercuryServerSendMessageQueue5=function(){"use strict";m.debug('maybe_send_next_pending_message',{fbid:this.sender_id,queue_id:this.queue_id,pending_message:i.obfuscateMessage(this.pending_message),queue:this.queue.map(function(p){return i.obfuscateMessage(p);})});var o='send_queue.delayed.queue_length.'+this.queue.length.toString();g.bumpEntityKey('chat.web',o);};e.exports=n;},null);
__d("MercuryServerSendMessageQueueRouter",["BanzaiODS","LogHistory","Map","MercuryServerSendMessageQueue","MercurySingletonMixin"],function(a,b,c,d,e,f,g,h,i,j,k){var l=h.getInstance('mercury_server_send_message_queue_router'),m='chat.web.send_queue_router';g.setEntitySample(m,.1);function n(o){"use strict";this.fbid=o;this.queues=new i();}n.prototype.enqueue=function(o,p,q,r){"use strict";if(!this.queues.has(o)){this.queues.set(o,new j(this.fbid,o,p,q));l.debug('added queue',{fbid:this.fbid,queue_id:o});g.bumpEntityKey(m,'new_queue');}this.queues.get(o).enqueue(r);};Object.assign(n,k);e.exports=n;},null);
__d("MercuryMessageIDs",["KeyedCallbackManager"],function(a,b,c,d,e,f,g){var h=new g(),i={getServerIDs:function(j,k){var l=j.filter(function(n){return n.indexOf('mail.projektitan.com')!==-1;}),m=function(n){var o=j.map(function(p){return n[p]?n[p]:p;});k(o);};return h.executeOrEnqueue(l,m);},addServerID:function(j,k){h.setResource(j,k);}};e.exports=i;},null);
__d("MessagingReliabilityLogger",["PresenceUtil","MercuryServerDispatcher","MessagingReliabilityLoggerInitialData","isEmpty","setTimeoutAcrossTransitions"],function(a,b,c,d,e,f,g,h,i,j,k){var l='/ajax/mercury/client_reliability.php',m=60000;function n(t,u){var v={app:i.app,categories:JSON.stringify(t)};if(!j(u))v.extra=JSON.stringify(u);return v;}function o(t,u,v,w){if(t[u]===(void 0))t[u]={};if(t[u][v]===(void 0))t[u][v]=0;t[u][v]+=w;}function p(t,u,v,w){if(t[u]===(void 0))t[u]={};if(t[u][v]===(void 0))t[u][v]=[];for(var x=0;x<w.length;++x)t[u][v].push(w[x]);}function q(t,u){if((t&&!t.categories)||(u&&!u.categories))return;var v=t?JSON.parse(t.categories):{},w=t&&t.extra?JSON.parse(t.extra):{},x=JSON.parse(u.categories),y=u.extra?JSON.parse(u.extra):{};for(var z in x){var aa=x[z],ba=y[z];for(var ca in aa){o(v,z,ca,aa[ca]);if(ba!==(void 0)){var da=ba[ca];if(da!==(void 0))p(w,z,ca,da);}}}return n(v,w);}var r={};r[l]={mode:h.BATCH_SUCCESSIVE_PIGGYBACK_ON_ERROR,batch_function:q};h.registerEndpoints(r);var s={addEntry:function(t,u,v){if(!i.enabled)return;var w={};o(w,t,u,1);var x={};if(v!==(void 0))p(x,t,u,[v]);h.trySend(l,n(w,x));}};(function t(){s.addEntry('page_event','active',g.getSessionID());k(t,m);})();e.exports=s;},null);
__d("MercuryServerSendMessageQueueOptions",[],function(a,b,c,d,e,f){function g(h,i,j,k,l,m,n,o){"use strict";this.success_handler=h;this.error_handler=i;this.transport_error_handler=j;this.timeout_handler=k;this.send_attempt_logging_handler=l;this.timeout=m;this.connection_retries=n;this.auto_retries=o;}e.exports=g;},null);
__d("MercuryThreadInformer",["ArbiterMixin","LogHistory","MercuryAssert","MercuryLoggingHelper","MercurySingletonMixin","copyProperties","mapObject","mixin"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){'use strict';var o=h.getInstance('mercury_informer'),p=n(g);for(var q in p)if(p.hasOwnProperty(q))s[q]=p[q];var r=p===null?null:p.prototype;s.prototype=Object.create(r);s.prototype.constructor=s;s.__superConstructor__=p;function s(u){this.$MercuryThreadInformer0=u;this.$MercuryThreadInformer1={};this.$MercuryThreadInformer2={};this.$MercuryThreadInformer3={};this.$MercuryThreadInformer4=false;this.$MercuryThreadInformer5=false;this.$MercuryThreadInformer6=false;this.$MercuryThreadInformer7={};this.$MercuryThreadInformer8={};this.$MercuryThreadInformer9={};this.$MercuryThreadInformera=0;}s.prototype.updatedThread=function(u){this.$MercuryThreadInformer2[u]=true;this.$MercuryThreadInformerb();};s.prototype.deletedThread=function(u){this.$MercuryThreadInformer1[u]=true;this.$MercuryThreadInformerb();};s.prototype.updatedThreadlist=function(){this.$MercuryThreadInformer4=true;this.$MercuryThreadInformerb();};s.prototype.updatedUnseenState=function(){this.$MercuryThreadInformer5=true;this.$MercuryThreadInformerb();};s.prototype.updatedUnreadState=function(){this.$MercuryThreadInformer6=true;this.$MercuryThreadInformerb();};s.prototype.changedThreadReadState=function(u,v,w){if(!this.$MercuryThreadInformer3[u]||this.$MercuryThreadInformer3[u].timestamp<w)this.$MercuryThreadInformer3[u]={mark_as_read:v,timestamp:w};this.$MercuryThreadInformerb();};s.prototype.receivedMessage=function(u){i.isThreadID(u.thread_id);var v=u.thread_id;if(!this.$MercuryThreadInformer7[v])this.$MercuryThreadInformer7[v]=[];this.$MercuryThreadInformer7[v].push(u);this.updatedThread(v);};s.prototype.reorderedMessages=function(u,v){this.$MercuryThreadInformer8[u]={source:v};this.$MercuryThreadInformerb();};s.prototype.updatedMessage=function(u,v,w){if(!this.$MercuryThreadInformer9[u])this.$MercuryThreadInformer9[u]={};this.$MercuryThreadInformer9[u][v]={source:w};this.updatedThread(u);};s.prototype.synchronizeInforms=function(u){this.$MercuryThreadInformera++;try{u();}catch(v){throw v;}finally{this.$MercuryThreadInformera--;this.$MercuryThreadInformerb();}};s.prototype.listen=function(u,v){return this.subscribe('threads-updated',function(w,x){if(x[u])v(u);});};s.prototype.$MercuryThreadInformerb=function(){if(!this.$MercuryThreadInformera){var u=this.$MercuryThreadInformer1,v=this.$MercuryThreadInformer2,w=this.$MercuryThreadInformer3,x=this.$MercuryThreadInformer4,y=this.$MercuryThreadInformer5,z=this.$MercuryThreadInformer6,aa=this.$MercuryThreadInformer7,ba=this.$MercuryThreadInformer8,ca=this.$MercuryThreadInformer9;this.$MercuryThreadInformer1={};this.$MercuryThreadInformer2={};this.$MercuryThreadInformer3={};this.$MercuryThreadInformer4=false;this.$MercuryThreadInformer5=false;this.$MercuryThreadInformer6=false;this.$MercuryThreadInformer7={};this.$MercuryThreadInformer8={};this.$MercuryThreadInformer9={};var da=Object.keys(v);if(da.length||x)this.$MercuryThreadInformerc('threadlist-updated',da);if(da.length)this.$MercuryThreadInformerc('threads-updated',v);for(var ea in w){this.$MercuryThreadInformerc('thread-read-changed',w);break;}for(ea in u){this.$MercuryThreadInformerc('threads-deleted',u);break;}if(y)this.$MercuryThreadInformerc('unseen-updated',null);if(z)this.$MercuryThreadInformerc('unread-updated',null);for(ea in aa){this.$MercuryThreadInformerc('messages-received',aa);break;}for(ea in ba){this.$MercuryThreadInformerc('messages-reordered',ba);break;}for(ea in ca){this.$MercuryThreadInformerc('messages-updated',ca);break;}}};s.prototype.$MercuryThreadInformerc=function(u,v){t(u,v);this.inform(u,v);};function t(u,v){var w=v;if(u=='messages-received')w=m(w,function(x){return x.map(function(y){return j.obfuscateMessage(y);});});o.debug(u,w);}l(s,k);e.exports=s;},null);
__d("MercuryServerRequests",["Arbiter","ArbiterMixin","AsyncResponse","BanzaiLogger","BanzaiODS","ChannelConstants","CurrentUser","KeyedCallbackManager","LogHistory","MercuryActionStatus","MercuryActionType","MercuryAPIArgsSource","MercuryAssert","MercuryErrorType","MercuryGlobalActionType","MercuryIDs","MercuryLoggingHelper","MercuryLogMessageType","MercuryMessageClientState","MercuryPayloadSource","MercurySendAttemptLogger","MercurySendErrorLogger","MercuryServerRequestsConfig","MercuryServerSendMessageQueueRouter","MercurySingletonMixin","MercurySourceType","MercuryThreadlistConstants","MercuryMessageIDs","MessagingConfig","MessagingReliabilityLogger","MessagingTag","MercuryServerDispatcher","MercuryServerSendMessageQueueOptions","MercuryThreadInformer","copyProperties","createObjectFrom","setTimeoutAcrossTransitions"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma,na,oa,pa,qa){"use strict";var ra=o.getInstance('mercury_server'),sa=r.MERCURY;function ta(ec,fc){if(fc)ec._lastActionTimestamp=Math.max(ec._lastActionTimestamp,fc);}function ua(ec,fc){var gc=fc.thread_fbid;if(fc.canonical_fbid)gc=fc.canonical_fbid;var hc=ec._FBIDToClientIDs.getResource(gc);if(!hc){if(fc.canonical_fbid){hc='user:'+fc.canonical_fbid;}else if(fc.root_message_threading_id)hc='root:'+fc.root_message_threading_id;hc=hc||'thread:'+gc;if(gc)gc=gc.toString();wa(ec,gc,hc);if(fc.thread_id)va(ec,fc.thread_id,hc);}fc.thread_id=hc;}function va(ec,fc,gc){ec._serverToClientIDs.setResource(fc,gc);ec._clientToServerIDs.setResource(gc,fc);ec._newlyAddedClientIDs[fc]=gc;}function wa(ec,fc,gc){ec._clientIDToFBIDs.setResource(gc,fc);ec._FBIDToClientIDs.setResource(fc,gc);ec._newlyAddedClientIDs[fc]=gc;}function xa(ec,fc,gc){var hc=ec._clientIDToFBIDs.executeOrEnqueue(fc,gc),ic=ec._clientIDToFBIDs.getUnavailableResources(hc),jc=v.tokenize(fc);if(ic.length&&jc.type!='root')ec.fetchThreadData(ic);}function ya(ec,fc){return ec._clientIDToFBIDs.getResource(fc);}function za(ec,fc){return !!ec._FBIDToClientIDs.getResource(fc);}function ab(ec,fc){var gc=ec._serverToClientIDs.getResource(fc);if(typeof gc=='undefined')ra.warn('no_client_thread_id',{server_id:fc});return gc;}function bb(ec,fc){var gc=ec._FBIDToClientIDs.getResource(fc);if(typeof gc=='undefined')ra.warn('no_client_thread_id',{thread_fbid:fc});return gc;}function cb(ec,fc,gc){ec._FBIDToClientIDs.executeOrEnqueue(fc,gc);ec.ensureThreadIsFetched(fc);}function db(ec){return ec.thread_fbid||ec.thread_id||ec.client_thread_id;}function eb(ec,fc,gc){if(fc.action_type!=q.SEND_MESSAGE)return;var hc=fc.thread_fbid;if(fc.other_user_fbid)hc=fc.other_user_fbid;var ic=fc.client_thread_id;if(!ic)ic=bb(ec,hc);var jc=null;if(ic)jc=v.tokenize(ic).type;gb(ec,fc,gc==='success');if(fc.status===p.ERROR){ba.log(fc);}else ja.addEntry('send_'+jc,gc,hc+','+fc.message_id);}function fb(ec){return ec.getError()?'_'+ec.getError():'';}function gb(ec,fc,gc){if(Math.floor(Math.random()*20)===0)if(fc.client_message_id in ec._sentMessagesTimestamp){var hc=ec._sentMessagesTimestamp[fc.client_message_id],ic=Date.now()-hc,jc=fc.client_thread_id;if(!jc)jc=bb(ec,fc.thread_fbid);j.log('WebMessagingLatencyLoggerConfig',{has_attachment:fc.attachments&&fc.attachments.length>0,latency:ic,is_canonical:!v.isMultichat(jc),send_successful:gc,source:'client'});}}function hb(ec,fc){var gc=null;switch(fc.status){case p.SUCCESS:gc='success';break;case p.FAILED_UNKNOWN_REASON:gc='confirmed_error';break;case p.UNABLE_TO_CONFIRM:gc='confirm_error';break;default:return;}eb(ec,fc,gc);}function ib(ec,fc){(fc.threads||[]).forEach(function(pc){ua(ec,pc);delete ec._fetchingThreads[pc.thread_id];var qc=ya(ec,pc.thread_id);delete ec._fetchingThreads[qc];ta(ec,pc.timestamp);});(fc.ordered_threadlists||[]).forEach(function(pc){var qc=pc.thread_fbids||[];qc=qc.concat(pc.other_user_fbids||[]);pc.thread_ids=qc.map(bb.bind(null,ec));});if(fc.pinned_threads&&fc.pinned_threads.thread_fbids)fc.pinned_threads.thread_fbids=fc.pinned_threads.thread_fbids.map(bb.bind(null,ec));fc.actions=fc.actions||[];fc.actions.forEach(function(pc){hb(ec,pc);var qc=pc.thread_fbid;if(pc.other_user_fbid)qc=pc.other_user_fbid;if(pc.status&&pc.status!=p.SUCCESS&&!qc){pc.thread_id=pc.client_thread_id;return;}if(pc.action_type==q.SEND_MESSAGE&&pc.client_thread_id&&qc)wa(ec,qc.toString(),pc.client_thread_id);var rc=pc.thread_id;if(qc){pc.thread_id=za(ec,qc)?bb(ec,qc):null;}else if(pc.client_thread_id)pc.thread_id=pc.client_thread_id;if(!pc.thread_id)pc.server_thread_id=rc;if(!fc.payload_source||!fc.payload_source.startsWith('server'))ta(ec,pc.timestamp);});if(fc.end_of_history){var gc=[];for(var hc=0;hc<fc.end_of_history.length;hc++){var ic=fc.end_of_history[hc];if(ic.type=='user'){gc.push('user:'+ic.fbid);}else if(ic.type=='thread'&&za(ec,ic.fbid))gc.push(bb(ec,ic.fbid));}fc.end_of_history=gc;}if(fc.roger){var jc={};for(var kc in fc.roger){var lc=ec._FBIDToClientIDs.getResource(kc);if(lc){var mc=fc.roger[kc];jc[lc]={};for(var nc in mc)if(mc.hasOwnProperty(nc)){var oc=v.getParticipantIDFromUserID(nc);jc[lc][oc]=mc[nc];}}}fc.roger=jc;}}function jb(ec){if(ec._pendingUpdates&&ec._pendingUpdates.length){var fc=ec._pendingUpdates[0];ec._pendingUpdates=ec._pendingUpdates.slice(1);ec.handleUpdate(fc);}}function kb(ec,fc){var gc=oa({},ec),hc;if(fc.threads){if(!gc.threads)gc.threads={};for(hc in fc.threads)gc.threads[hc]=Object.keys(pa((gc.threads[hc]||[]).concat(fc.threads[hc])));}if(fc.messages){if(!gc.messages)gc.messages={};for(hc in fc.messages){if(!gc.messages[hc])gc.messages[hc]={};for(var ic in fc.messages[hc])if(gc.messages[hc][ic]){gc.messages[hc][ic]=nb(gc.messages[hc][ic],fc.messages[hc][ic]);}else gc.messages[hc][ic]=fc.messages[hc][ic];}}gc.client=ec.client||fc.client;return gc;}function lb(ec,fc){var gc=oa(pa(ec.folders,true),pa(fc.folders,true)),hc=ec.client||fc.client;return {folders:Object.keys(gc),client:hc};}function mb(ec,fc){for(var gc in fc)if(ec[gc]&&typeof ec[gc]==='object'){ec[gc]=nb(ec[gc],fc[gc]);}else if(fc[gc]&&typeof fc[gc]==='object'){var hc={};oa(hc,fc[gc]);ec[gc]=hc;}return ec;}function nb(ec,fc){var gc=ec.offset<fc.offset?ec.offset:fc.offset,hc=ec.offset+ec.limit,ic=fc.offset+fc.limit,jc=(hc>ic)?hc:ic,kc=jc-gc;return {offset:gc,limit:kc};}function ob(ec,fc){var gc=ec.client||fc.client,hc={ids:{},client:gc};oa(hc.ids,ec.ids);oa(hc.ids,fc.ids);return hc;}function pb(ec,fc){var gc={},hc,ic=ec.client||fc.client;delete ec.client;delete fc.client;for(hc in ec)oa(gc,pa(ec[hc],hc));for(hc in fc)oa(gc,pa(fc[hc],hc));var jc={client:ic};for(var kc in gc){hc=gc[kc];if(!jc[hc])jc[hc]=[];jc[hc].push(kc);}return jc;}function qb(ec,fc){var gc=ec.client||fc.client,hc=pa(ec.ids,true),ic=pa(fc.ids,true),jc=oa(hc,ic);return {ids:Object.keys(jc),client:gc};}function rb(ec){this._fbid=ec;this._lastActionTimestamp=0;this._serverToClientIDs=new n();this._clientToServerIDs=new n();this._FBIDToClientIDs=new n();this._clientIDToFBIDs=new n();this._pendingUpdates=[];this._fetchingThreads={};this._newlyAddedClientIDs={};this._sentMessagesTimestamp={};this._sendMessageQueueOptions=new ma(ub,yb,zb,ac,aa.log,ca.sendMessageTimeout,ia.SEND_CONNECTION_RETRIES,ca.maxAutoRetries);cc(this);}oa(rb.prototype,h,{getServerThreadID:function(ec,fc){s.isThreadID(ec);xa(this,ec,fc);},getThreadFBID:function(ec,fc){s.isThreadID(ec);xa(this,ec,fc);},getClientThreadID:function(ec,fc){cb(this,ec,fc);},getClientThreadIDNow:function(ec){return bb(this,ec);},getServerThreadIDNow:function(ec){return ya(this,ec);},getClientThreadIDForPermalinks:function(ec){return ab(this,ec);},convertThreadIDIfAvailable:function(ec){var fc=this._FBIDToClientIDs.getResource(ec);if(fc===(void 0)){return ec;}else return fc;},isUser:function(ec){return ec<2.2e+09||(ec>=1e+14&&ec<=100099999989999)||(ec>=8.9e+13&&ec<=89999999999999)||(ec>=6.000001e+13&&ec<=60000019999999);},canLinkExternally:function(ec){s.isThreadID(ec);var fc=v.tokenize(ec);return (fc.type=='user')||!!ya(this,ec);},fetchThreadlistInfo:function(ec,fc,gc,hc,ic){gc=gc||ka.INBOX;ic=ic||sa;var jc=hc?la.IMMEDIATE:null,kc={client:ic};kc[gc]={offset:ec,limit:fc,filter:hc};dc(this,'/ajax/mercury/threadlist_info.php',kc,jc);},fetchPinnedThreads:function(){dc(this,'/mercury/pinned_threads/',{});},fetchUnseenThreadIDs:function(ec,fc){fc=fc||sa;this.fetchThreadlistInfo(ga.RECENT_THREAD_OFFSET,ga.JEWEL_THREAD_COUNT,ec,null,fc);},fetchUnreadThreadIDs:function(ec,fc){fc=fc||sa;dc(this,'/ajax/mercury/unread_threads.php',{folders:[ec],client:fc});},fetchMissedMessages:function(ec,fc){fc=fc||sa;var gc={last_action_timestamp:this._lastActionTimestamp,folders:ec,client:fc};gc.last_action_timestamp=this._lastActionTimestamp;dc(this,'/ajax/mercury/thread_sync.php',gc);},fetchThreadData:function(ec,fc){fc=fc||sa;s.allThreadID(ec);var gc={threads:{},client:fc},hc=[],ic=[];ec.forEach(function(kc){if(this._fetchingThreads[kc])return;this._fetchingThreads[kc]=true;var lc=ya(this,kc),mc=v.tokenize(kc);if(mc.type=='user'){hc.push(mc.value);gc.threads.user_ids=hc;}else if(mc.type=='thread'){if(lc){ic.push(lc);}else ic.push(mc.value);gc.threads.thread_fbids=ic;}else if(mc.type!='root'&&mc.type!='pending')throw new Error('Unknown thread type',mc);}.bind(this));this.inform("fetch-thread-data",gc);for(var jc in gc.threads){dc(this,'/ajax/mercury/thread_info.php',gc);break;}},ensureThreadIsFetched:function(ec,fc){fc=fc||sa;if(!this._FBIDToClientIDs.getResource(ec)&&!this._fetchingThreads[ec]){this._fetchingThreads[ec]=true;dc(this,'/ajax/mercury/thread_info.php',{threads:{thread_fbids:[ec]},client:fc});}},fetchThreadMessages:function(ec,fc,gc,hc,ic){s.isThreadID(ec);ic=ic||sa;var jc,kc,lc=v.tokenize(ec),mc=ya(this,ec),nc=false;if(mc){jc=mc;kc=(lc.type=='user')?'user_ids':'thread_fbids';}else{jc=lc.value;switch(lc.type){case 'user':kc='user_ids';nc=true;break;case 'thread':kc='thread_fbids';break;}}var oc={messages:{},threads:{},client:ic};if(kc){oc.messages[kc]={};oc.messages[kc][jc]={offset:fc,limit:gc};if(nc)oc.threads[kc]=[jc];dc(this,'/ajax/mercury/thread_info.php',oc,hc);}else xa(this,ec,function(pc){oc.messages.thread_fbids={};oc.messages.thread_fbids[pc]={offset:fc,limit:gc};dc(this,'/ajax/mercury/thread_info.php',oc,hc);}.bind(this));},handleThreadInfoError:function(ec){var fc=ec.getRequest().getData(),gc=[];if(fc.messages){for(var hc in fc.messages.thread_fbids)gc.push(sb(bb(this,hc)));for(var ic in fc.messages.user_ids)gc.push(sb('user:'+ic));for(var jc in fc.messages.group_ids)gc.push(sb('group:'+jc));}if(gc.length)this.handleUpdate({actions:gc,from_client:true,payload_source:z.CLIENT_CHANNEL_MESSAGE});if(fc.threads&&(fc.threads.user_ids||fc.threads.group_ids||fc.threads.thread_ids)){var kc=5,lc=true;if(!fc.retry_count){fc.retry_count=0;if(fc.messages)delete fc.messages;}else if(fc.retry_count>=kc){lc=false;(fc.threads.thread_ids||[]).forEach(function(nc){if(nc in this._fetchingThreads)delete this._fetchingThreads[nc];}.bind(this));}if(lc){var mc=fc.retry_count*1000;qa(function(){ra.log('retry_thread',fc);dc(this,'/ajax/mercury/thread_info.php',fc);}.bind(this),mc);fc.retry_count++;}}},markFolderAsRead:function(ec){dc(this,'/ajax/mercury/mark_folder_as_read.php',{folder:ec});var fc=[{action_type:u.MARK_ALL_READ,action_id:null,folder:ec}];this.handleUpdate({global_actions:fc,from_client:true,payload_source:z.CLIENT_CHANGE_READ_STATUS});},changeThreadReadStatus:function(ec,fc,gc){s.isThreadID(ec);xa(this,ec,function(hc){var ic={ids:{},source:gc};ic.ids[hc]=fc;dc(this,'/ajax/mercury/change_read_status.php',ic);}.bind(this));},changeThreadArchivedStatus:function(ec,fc,gc){s.isThreadID(ec);xa(this,ec,function(hc){var ic={ids:{},source:gc};ic.ids[hc]=fc;dc(this,'/ajax/mercury/change_archived_status.php',ic);}.bind(this));},changeThreadFolder:function(ec,fc){s.isThreadID(ec);xa(this,ec,function(gc){var hc={};hc[fc]=[gc];dc(this,'/ajax/mercury/move_thread.php',hc);}.bind(this));},changeMutingOnThread:function(ec,fc){s.isThreadID(ec);xa(this,ec,function(gc){dc(this,'/ajax/mercury/change_mute_thread.php',{thread_fbid:gc,mute_settings:fc,payload_source:sa});}.bind(this));},markThreadSpam:function(ec,fc){s.isThreadID(ec);xa(this,ec,function(gc){dc(this,'/ajax/mercury/mark_spam.php',{id:gc,source:fc});}.bind(this));},markMessagesSpam:function(ec,fc){ha.getServerIDs(fc||[],function(gc){dc(this,'/ajax/mercury/mark_spam_messages.php',{message_ids:gc});}.bind(this));},unmarkThreadSpam:function(ec,fc){s.isThreadID(ec);xa(this,ec,function(gc){dc(this,'/ajax/mercury/unmark_spam.php',{id:gc,source:fc});}.bind(this));},deleteThread:function(ec,fc){s.isThreadID(ec);xa(this,ec,function(gc){var hc={ids:[gc],source:fc};dc(this,'/ajax/mercury/delete_thread.php',hc);}.bind(this));},unpinThread:function(ec){s.isThreadID(ec);xa(this,ec,function(fc){dc(this,'/mercury/unpin_thread/',{id:fc});}.bind(this));},deleteMessages:function(ec,fc){ha.getServerIDs(fc||[],function(gc){dc(this,'/ajax/mercury/delete_messages.php',{message_ids:gc});}.bind(this));},sendDeliveryReceipts:function(ec){ha.getServerIDs(ec||[],function(fc){dc(this,'/ajax/mercury/delivery_receipts.php',{message_ids:fc});}.bind(this));},clearChat:function(ec,fc,gc){s.isThreadID(ec);dc(this,'/ajax/chat/settings.php',{clear_history_id:fc});var hc=[{action_type:q.CLEAR_CHAT,action_id:null,thread_id:ec,clear_time:gc}];this.handleUpdate({actions:hc,from_client:true,payload_source:z.CLIENT_CLEAR_CHAT});k.bumpEntityKey('chat.web','chat.clear_window');},sendNewMessage:function(ec,fc){fc=fc||sa;if(!ec.client_state||ec.client_state==y.SEND_TO_SERVER)ha.getServerIDs(ec.forward_message_ids||[],function(gc){var hc=v.tokenize(ec.thread_id),ic=hc.type,jc=oa({},ec);jc.forward_message_ids=gc;if((ic=='root'&&hc.value==jc.message_id)||(ic=='user')){jc.client_thread_id=jc.thread_id;jc.thread_id=null;this._sendNewMessageToServer(jc,fc);}else xa(this,jc.thread_id,function(kc){hc=v.tokenize(jc.thread_id);if(hc.type=='user'){jc.other_user_fbid=hc.values;}else jc.thread_fbid=kc;jc.thread_id=null;this._sendNewMessageToServer(jc);}.bind(this));}.bind(this));},_sendNewMessageToServer:function(ec,fc){g.inform(l.ATTEMPT_RECONNECT);fc=fc||sa;this._sentMessagesTimestamp[ec.message_id]=Date.now();da.getForFBID(this._fbid).enqueue(db(ec),this._sendMessageQueueOptions,fc,ec);},requestMessageConfirmation:function(ec,fc){fc=fc||sa;var gc={},hc={};for(var ic in ec){var jc=ya(this,ic);if(jc){gc[jc]=ec[ic];}else{var kc=ec[ic];for(var lc=0;lc<kc.length;lc++)hc[kc[lc]]=ic;}}var mc=Object.keys(gc),nc=Object.keys(hc);if(mc.length||nc.length)dc(this,'/ajax/mercury/confirm_messages.php',{thread_message_map:gc,local_messages:hc,client:fc});},handleMessageConfirmError:function(ec){var fc=ec.getRequest().getData().thread_message_map,gc=ec.getRequest().getData().local_messages;if(!fc&&!gc)return;var hc=[];for(var ic in fc){var jc=fc[ic];jc.forEach(function(mc){hc.push({action_type:q.SEND_MESSAGE,client_message_id:mc,message_id:mc,client_thread_id:null,thread_fbid:ic,status:p.UNABLE_TO_CONFIRM});});}for(var kc in gc){var lc=gc[kc];hc.push({action_type:q.SEND_MESSAGE,client_message_id:kc,message_id:kc,client_thread_id:lc,thread_fbid:null,status:p.UNABLE_TO_CONFIRM});}if(hc.length)this.handleUpdate({actions:hc,payload_source:z.CLIENT_HANDLE_ERROR});},markSeen:function(){var ec=this._lastActionTimestamp;dc(this,'/ajax/mercury/mark_seen.php',{seen_timestamp:ec});},handleRoger:function(ec){var fc=ec.thread_fbid?this._FBIDToClientIDs.getResource(ec.thread_fbid):v.getThreadIDFromUserID(ec.reader);if(fc){var gc=v.getParticipantIDFromUserID(ec.reader),hc={};hc[fc]={};hc[fc][gc]=ec.time;this.inform('update-roger',hc);}},handleUpdateWaitForThread:function(ec,fc,gc){gc=gc||sa;var hc=this._FBIDToClientIDs.getResource(fc);if(hc){this.handleUpdate(ec);return;}this._FBIDToClientIDs.executeOrEnqueue(fc,function(){this._pendingUpdates.push(ec);}.bind(this));if(!this._fetchingThreads[fc]){this._fetchingThreads[fc]=true;var ic={threads:{thread_fbids:[fc]},client:gc};if(this.isUser(fc))ic={threads:{user_ids:[fc]},client:gc};dc(this,'/ajax/mercury/thread_info.php',ic);}},handleUpdate:function(ec){var fc=[];if(ec&&ec.threads)for(var gc=0;gc<ec.threads.length;gc++){if(!ec.threads[gc].snippet_attachments)continue;for(var hc=0;hc<ec.threads[gc].snippet_attachments.length;hc++)if(ec.threads[gc].snippet_attachments[hc].share_xhp){fc.push({i:gc,j:hc,xhp:ec.threads[gc].snippet_attachments[hc].share_xhp});ec.threads[gc].snippet_attachments[hc].share_xhp="HTMLDivElement not shown: object contains circular "+"reference, which was breaking JSON.stringify. "+"Look at MercuryServerRequests.handleUpdate";}}var ic={actions:[],threads:[]};if(ec){if(ec.actions)ic.actions=ec.actions.map(function(lc){return w.obfuscateMessage(lc);});if(ec.threads)ic.threads=ec.threads.map(function(lc){return w.obfuscateThread(lc);});}var jc=oa({},ec,ic);ra.debug('update:'+ec.payload_source,{payload:jc,from_client:ec.from_client});for(var kc=0;kc<fc.length;kc++)ec.threads[fc[kc].i].snippet_attachments[fc[kc].j].share_xhp=fc[kc].xhp;for(kc in ec){na.getForFBID(this._fbid).synchronizeInforms(function(){if(!ec.from_client){ib(this,ec);this.inform('payload-preprocessed',ec);}this.inform('update-thread-ids',this._newlyAddedClientIDs);this._newlyAddedClientIDs={};this.inform('update-participants',ec);this.inform('update-threads',ec);this.inform('update-unread',ec);this.inform('update-threadlist',ec);this.inform('update-pinned-threads',ec);this.inform('update-messages',ec);this.inform('update-unseen',ec);this.inform('update-typing-state',ec);this.inform('update-roger',ec.roger);this.inform('model-update-completed',null);jb(this);}.bind(this));break;}},_handleSendMessageErrorCommon:function(ec,fc,gc,hc){ra.debug('handle_send_message_error_common',{reliability_error_status:gc,request_error_status:fc});var ic=ec.getData(),jc=ic.message_batch,kc=jc.map(function(mc){var nc={action_type:q.SEND_MESSAGE,thread_fbid:mc.thread_fbid,client_message_id:mc.message_id,message_id:mc.message_id,client_thread_id:mc.client_thread_id,status:fc,error_data:hc};return nc;});kc.forEach(function(mc){eb(this,mc,gc);},this);var lc={actions:kc,payload_source:z.CLIENT_HANDLE_ERROR};this.handleUpdate(lc);},handleSendMessageError:function(ec){var fc=ec.getPayload(),gc=null,hc=null;if(fc&&fc.error_payload){gc=p.UNCONFIRMED;hc='send_error';}else{gc=p.ERROR;hc='request_error'+fb(ec);}var ic=ec.error;if(ic===1404102)i.verboseErrorHandler(ec);var jc=/<.*>/.test(ec.getErrorDescription())?ec.getErrorSummary():ec.getErrorDescription();this._handleSendMessageErrorCommon(ec.getRequest(),gc,hc,{type:t.SERVER,code:ec.getError(),description:jc,is_transient:ec.isTransient()});},handleSendMessageTransportError:function(ec){this._handleSendMessageErrorCommon(ec.getRequest(),p.ERROR,'transport_error'+fb(ec),{type:t.TRANSPORT,code:ec.getError(),is_transient:true});},handleSendMessageTimeout:function(ec){this._handleSendMessageErrorCommon(ec,p.ERROR,'transport_timeout',{type:t.TIMEOUT,is_transient:true});},getLastActionTimestamp:function(){return this._lastActionTimestamp;}});oa(rb,ea);function sb(ec){return {action_type:q.LOG_MESSAGE,thread_id:ec,message_id:ec,timestamp:Date.now(),timestamp_absolute:'',timestamp_relative:'',is_unread:false,source:fa.UNKNOWN,log_message_type:x.SERVER_ERROR,log_message_data:{}};}function tb(ec){var fc=ec.getData(),gc=fc.request_user_id?fc.request_user_id:m.getID();return rb.getForFBID(gc);}function ub(ec,fc){tb(fc).handleUpdate(ec);}function vb(ec,fc){var gc={};oa(gc,ec.ids);oa(gc,fc.ids);var hc=ec.client||fc.client;return {ids:gc,client:hc};}function wb(ec,fc){return fc;}function xb(ec){var fc=tb(ec.getRequest());fc.handleThreadInfoError(ec);}function yb(ec){var fc=tb(ec.getRequest());fc.handleSendMessageError(ec);}function zb(ec){var fc=tb(ec.getRequest());fc.handleSendMessageTransportError(ec);}function ac(ec){var fc=tb(ec);fc.handleSendMessageTimeout(ec);}function bc(ec){var fc=tb(ec.getRequest());fc.handleMessageConfirmError(ec);}function cc(ec){var fc={'/ajax/mercury/thread_sync.php':{request_user_id:ec._fbid,mode:la.IDEMPOTENT,handler:ub},'/ajax/mercury/thread_info.php':{request_user_id:ec._fbid,mode:la.BATCH_DEFERRED_MULTI,batch_function:kb,handler:ub,error_handler:xb},'/ajax/mercury/mark_folder_as_read.php':{request_user_id:ec._fbid,mode:la.IMMEDIATE,handler:ub},'/ajax/mercury/change_read_status.php':{request_user_id:ec._fbid,mode:la.BATCH_SUCCESSIVE,batch_function:vb,handler:ub},'/ajax/mercury/mark_seen.php':{request_user_id:ec._fbid,mode:la.BATCH_SUCCESSIVE,batch_function:wb,handler:ub},'/ajax/mercury/confirm_messages.php':{request_user_id:ec._fbid,mode:la.IMMEDIATE,handler:ub,error_handler:bc},'/ajax/mercury/threadlist_info.php':{request_user_id:ec._fbid,mode:la.BATCH_SUCCESSIVE_UNIQUE,batch_function:mb,handler:ub},'/ajax/mercury/mark_spam.php':{request_user_id:ec._fbid,mode:la.IMMEDIATE,handler:ub},'/ajax/mercury/mark_spam_messages.php':{request_user_id:ec._fbid,mode:la.IMMEDIATE,handler:ub},'/ajax/mercury/unmark_spam.php':{request_user_id:ec._fbid,mode:la.IMMEDIATE,handler:ub},'/ajax/mercury/unread_threads.php':{request_user_id:ec._fbid,mode:la.BATCH_SUCCESSIVE_UNIQUE,batch_function:lb,handler:ub},'/ajax/chat/settings.php':{request_user_id:ec._fbid,mode:la.IMMEDIATE},'/ajax/mercury/change_archived_status.php':{request_user_id:ec._fbid,mode:la.BATCH_SUCCESSIVE,batch_function:ob,handler:ub},'/ajax/mercury/delete_thread.php':{request_user_id:ec._fbid,mode:la.BATCH_SUCCESSIVE,batch_function:qb,handler:ub},'/ajax/mercury/delete_messages.php':{request_user_id:ec._fbid,mode:la.IMMEDIATE,handler:ub},'/ajax/mercury/delivery_receipts.php':{request_user_id:ec._fbid,mode:la.IMMEDIATE,handler:ub},'/ajax/mercury/move_thread.php':{request_user_id:ec._fbid,mode:la.BATCH_SUCCESSIVE,batch_function:pb,handler:ub},'/ajax/mercury/change_mute_thread.php':{request_user_id:ec._fbid,mode:la.IMMEDIATE,handler:ub},'/mercury/pinned_threads/':{request_user_id:ec._fbid,mode:la.BATCH_SUCCESSIVE_UNIQUE,handler:ub},'/mercury/unpin_thread/':{request_user_id:ec._fbid,mode:la.IMMEDIATE,handler:ub}};la.registerEndpoints(fc);}function dc(ec,fc,gc,hc){la.trySend(fc,gc,hc,ec._fbid);}e.exports=rb;},null);
__d("MercuryThreads",["EventEmitter","ImmutableObject","KeyedCallbackManager","LogHistory","Map","MercuryActionType","MercuryAssert","MercuryAttachment","MercuryGlobalActionType","MercuryIDs","MercuryLogMessageType","MercuryLoggingHelper","MercuryPayloadSource","MercurySingletonMixin","MercuryThreadMode","MessagingTag","ReportState","MercuryServerRequests","Set","MercuryThreadInformer","setImmediate"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa){'use strict';var ba=new g(),ca=j.getInstance('mercury_threads');function da(ea){this.$MercuryThreads0=ea;this.$MercuryThreads1=x.getForFBID(this.$MercuryThreads0);this.$MercuryThreads2=z.getForFBID(this.$MercuryThreads0);this.$MercuryThreads3=p.getParticipantIDFromUserID(this.$MercuryThreads0);this.$MercuryThreads4=false;this.$MercuryThreads5=new i();this.$MercuryThreads6=new y();this.$MercuryThreads7=false;this.$MercuryThreads8=new y();this.$MercuryThreads9=new y();this.$MercuryThreadsa();}da.prototype.getThreadMetaNow=function(ea){m.isThreadID(ea);return this.$MercuryThreads5.getResource(ea);};da.prototype.getOrFetch=function(ea){var fa=this.getThreadMetaNow(ea);if(!fa&&!this.$MercuryThreads9.has(ea))this.$MercuryThreads8.add(ea);if(this.$MercuryThreads8.size>0&&!this.$MercuryThreads7)this.$MercuryThreadsb();return fa;};da.prototype.$MercuryThreadsb=function(){if(this.$MercuryThreads7)return;this.$MercuryThreads7=true;aa(function(){this.$MercuryThreads7=false;this.$MercuryThreads8.forEach(function(ea){return this.$MercuryThreads9.add(ea);}.bind(this));this.getMultiThreadMeta(Array.from(this.$MercuryThreads8),function(ea){for(var fa in ea)ea.hasOwnProperty(fa)&&this.$MercuryThreads9["delete"](fa);}.bind(this));this.$MercuryThreads8.clear();}.bind(this));};da.prototype.getThreadMeta=function(ea,fa,ga){return this.getMultiThreadMeta([ea],function(ha){return fa(ha[ea]);},ga);};da.prototype.getMultiThreadMeta=function(ea,fa,ga){m.allThreadID(ea);var ha=this.$MercuryThreads5.executeOrEnqueue(ea,fa),ia=this.$MercuryThreads5.getUnavailableResources(ha);if(ia.length){var ja=[];for(var ka=0;ka<ia.length;ka++){var la=ia[ka],ma=p.tokenize(la),na=ma.type,oa=ma.value;if(na=='user'){this.createNewLocalThread(la,[this.$MercuryThreads3,p.getParticipantIDFromUserID(oa)]);}else ja.push(la);}if(ja.length)this.$MercuryThreads1.fetchThreadData(ja,ga);}return ha;};da.addListener=function(ea,fa){return ba.addListener(ea,fa);};da.prototype.unsubscribe=function(ea){this.$MercuryThreads5.unsubscribe(ea);};da.prototype.getCanonicalThreadToParticipant=function(ea,fa,ga,ha){var ia=p.getThreadIDFromParticipantID(ea),ja=this.$MercuryThreads5.getResource(ia);if(typeof ja=='undefined'){ja=this.createNewLocalThread(ia,[this.$MercuryThreads3,ea],fa);!ha&&this.$MercuryThreads1.fetchThreadData([ia],ga);}return ja;};da.prototype.createNewLocalThread=function(ea,fa,ga){var ha=this.$MercuryThreads5.getResource(ea);if(!ha){var ia=p.tokenize(ea),ja=ia.type,ka=ia.value;ha=new h({thread_id:ea,last_action_id:null,participants:Array.from(fa),name:null,snippet:'',snippet_has_attachment:false,snippet_sender:null,unread_count:ga?ga:0,message_count:0,image_src:null,timestamp_absolute:null,timestamp_relative:null,timestamp:null,canonical_fbid:ja==='user'?ka:null,is_canonical_user:ja=='user',is_canonical:this.$MercuryThreadsc(fa),is_subscribed:true,root_message_threading_id:null,folder:v.INBOX,is_archived:false,mode:u.TITAN_ORIGINATED});this.$MercuryThreads5.setResource(ea,ha);}return ha;};da.prototype.isEmptyLocalThread=function(ea){var fa=this.$MercuryThreads5.getResource(ea);if(!fa)return false;var ga=p.tokenize(ea),ha=ga.type;return ha=='root'&&!fa.timestamp;};da.prototype.isNewEmptyLocalThread=function(ea){if(!this.isEmptyLocalThread(ea))return false;var fa=this.$MercuryThreads5.getResource(ea);return !!fa.participants&&fa.participants.length===0;};da.prototype.canReply=function(ea){var fa=this.$MercuryThreads5.getResource(ea);return !!(fa&&fa.is_subscribed&&fa.mode!=u.OBJECT_ORIGINATED&&!fa.has_email_participant&&!fa.read_only&&(fa.recipients_loadable||fa.recipients_loadable===(void 0)));};da.prototype.$MercuryThreadsd=function(ea,fa){if(!ea||!ea.length)return;var ga=new k(),ha=new k(),ia=new k(),ja=[];for(var ka=0;ka<ea.length;ka++){var la=ea[ka];if(la.is_forward)continue;var ma=la.action_type;if(ma==l.LOG_MESSAGE&&la.log_message_type==q.SERVER_ERROR)continue;var na=!!(la.sync_id||la.action_id),oa=la.thread_id;m.isThreadID(oa);var pa=this.$MercuryThreads5.getResource(oa);if(!pa&&!na&&ma==l.USER_GENERATED_MESSAGE){pa=this.$MercuryThreadse(la);this.$MercuryThreads5.setResource(oa,pa);}if(!pa)continue;if(ma==l.LOG_MESSAGE||ma==l.USER_GENERATED_MESSAGE)na=!fa;if(pa.server_timestamp&&la.timestamp<=pa.server_timestamp&&na)continue;if(!ia.has(oa))ia.set(oa,Object.assign({},pa));this.$MercuryThreadsf(ia.get(oa),la,fa);if(ma==l.USER_GENERATED_MESSAGE)ga.set(oa,la);if(ma==l.USER_GENERATED_MESSAGE||ma==l.LOG_MESSAGE||ma==l.SEND_MESSAGE)if(la&&la.timestamp&&(!ha.has(oa)||la.timestamp>ha.get(oa).timestamp))ha.set(oa,la);}ia.forEach(function(qa,ra){var sa=ga.get(ra);if(sa)this.$MercuryThreadsg(qa,sa);var ta=ha.get(ra),ua=qa.timestamp;if(ta){if(ta.timestamp>ua)Object.assign(qa,{timestamp_absolute:ta.timestamp_absolute,timestamp_relative:ta.timestamp_relative,timestamp:ta.timestamp});var va=qa.server_timestamp;if(!fa&&ta.timestamp>va)qa.server_timestamp=ta.timestamp;}var wa=new h(qa);this.$MercuryThreads5.setResource(ra,wa);ja.push(r.obfuscateThread(wa));}.bind(this),this);ja.length&&ca.debug('threads_updated',{threads:ja});};da.prototype.$MercuryThreadsf=function(ea,fa,ga){var ha=fa.action_type;if(ha==l.USER_GENERATED_MESSAGE||ha==l.LOG_MESSAGE){fa.is_unread&&ea.unread_count++;ea.message_count++;ea.is_archived=false;}switch(ha){case l.DELETE_THREAD:ea.message_count=0;this.$MercuryThreadsh(fa.thread_id);break;case l.USER_GENERATED_MESSAGE:if(ea.last_read_timestamp>=fa.timestamp)this.$MercuryThreadsi(ea,fa,true);this.$MercuryThreadsj(ea,fa.author);break;case l.SEND_MESSAGE:var ia=fa.log_message_type;if(ia==q.THREAD_IMAGE)ea.image_src=fa.log_message_data.image?fa.log_message_data.image.preview_url:null;ea.snippet_attachments=fa.attachments;break;case l.LOG_MESSAGE:var ia=fa.log_message_type;if(ia==q.SUBSCRIBE){this.$MercuryThreadsk(ea,fa.log_message_data.added_participants);}else if(ia==q.UNSUBSCRIBE){this.$MercuryThreadsl(ea,fa.log_message_data.removed_participants);}else if(ia==q.THREAD_IMAGE){if(!ga)ea.image_src=fa.log_message_data.image?fa.log_message_data.image.preview_url:null;}else if(ia==q.THREAD_NAME)ea.name=fa.log_message_data.name;break;case l.CHANGE_READ_STATUS:var ja=this.$MercuryThreadsi(ea,fa,fa.mark_as_read);if(ja&&fa.timestamp)ea.last_read_timestamp=fa.timestamp;if(ja&&ga)this.$MercuryThreads1.changeThreadReadStatus(ea.thread_id,fa.mark_as_read,fa.source);break;case l.CLEAR_CHAT:this.$MercuryThreadsm(ea,fa.clear_time);break;case l.CHANGE_ARCHIVED_STATUS:if(ea.is_archived!=fa.archived){ea.is_archived=fa.archived;this.$MercuryThreadsn(fa.thread_id);}break;case l.CHANGE_FOLDER:if(ea.folder!=fa.new_folder){ea.folder=fa.new_folder;this.$MercuryThreadsn(fa.thread_id);}break;case l.DELETE_MESSAGES:if(ga){ea.snippet='...';ea.snippet_has_attachment=false;ea.snippet_attachments=null;ea.snippet_sender=null;ea.is_forwarded_snippet=false;this.$MercuryThreadsn(fa.thread_id);}else if(fa.message_ids)ea.message_count=ea.message_count-fa.message_ids.length;break;case l.CHANGE_MUTE_SETTINGS:if(fa.mute_settings!==(void 0)){var ka=this.$MercuryThreads0+'@facebook.com';if(ea.mute_settings){if(fa.mute_settings){var la={};la[ka]=fa.mute_settings;ea.mute_settings=Object.assign({},ea.mute_settings,la);}else{ea.mute_settings=Object.assign({},ea.mute_settings);delete ea.mute_settings[ka];}this.$MercuryThreadsn(ea.thread_id);}}break;case l.ADD_PARTICIPANTS:this.$MercuryThreadsk(ea,fa.participants);this.$MercuryThreadsn(ea.thread_id);break;}};da.prototype.$MercuryThreadse=function(ea){var fa=p.tokenize(ea.thread_id),ga=fa.type,ha=fa.value,ia=this.$MercuryThreadsc(ea.specific_to_list);return new h({thread_id:ea.thread_id,last_action_id:null,participants:ea.specific_to_list,name:null,snippet:ea.body,snippet_has_attachment:false,snippet_attachments:[],snippet_sender:ea.author,unread_count:0,message_count:0,image_src:null,timestamp_absolute:ea.timestamp_absolute,timestamp_relative:ea.timestamp_relative,timestamp:ea.timestamp,canonical_fbid:ga==='user'?ha:null,is_canonical_user:ga==='user',is_canonical:ia,is_subscribed:true,root_message_threading_id:ea.message_id,folder:v.INBOX,is_archived:false,mode:u.TITAN_ORIGINATED});};da.prototype.$MercuryThreadsi=function(ea,fa,ga){if(fa.timestamp)this.$MercuryThreadso(ea.thread_id,ga,fa.timestamp);if(!ea||!ea.thread_id)return false;if(!ea.timestamp){this.$MercuryThreads6.add(ea.thread_id);return false;}var ha=!ea.unread_count;if(ga==ha)return false;ea.unread_count=ga?0:1;this.$MercuryThreadsn(ea.thread_id);return true;};da.prototype.$MercuryThreadsp=function(ea){var fa=this.$MercuryThreads5.getAllResources();for(var ga in fa)if(fa.hasOwnProperty(ga)){var ha=fa[ga];if(ha.folder==ea){this.$MercuryThreads5.setResource(ga,h.setProperty(ha,'unread_count',0));this.$MercuryThreadsn(ga);}}};da.prototype.$MercuryThreadsm=function(ea,fa){if(!ea||ea.chat_clear_time===fa)return;ea.chat_clear_time=fa;this.$MercuryThreads2.reorderedMessages(ea.thread_id);};da.prototype.$MercuryThreadsk=function(ea,fa){var ga=new y(ea.participants);ea.participants=Array.from(ea.participants);fa.forEach(function(ha){if(!ga.has(ha)){ea.participants.push(ha);if(ha===this.$MercuryThreads3)ea.is_subscribed=true;}}.bind(this));};da.prototype.$MercuryThreadsl=function(ea,fa){var ga=new y(fa);ea.participants=ea.participants.filter(function(ha){return !ga.has(ha);});if(ga.has(this.$MercuryThreads3))ea.is_subscribed=false;};da.prototype.$MercuryThreadsj=function(ea,fa){if(ea.participants[0]!=fa){ea.participants=ea.participants.filter(function(ga){return ga!=fa;});ea.participants.unshift(fa);}};da.prototype.$MercuryThreadsg=function(ea,fa){var ga=fa.body,ha=fa.subject,ia='';if(ha){ha=ha.toLowerCase();if(ga.slice(0,ha.length).toLowerCase()==ha){ia=ga;}else if(ga){ia=ha+' \u00B7 '+ga;}else ia=ha;}else ia=ga;ea.snippet=ia;ea.snippet_has_attachment=fa.has_attachment;if(fa.raw_attachments&&fa.raw_attachments.length>0){var ja=n.convertRaw(fa.raw_attachments);ea.snippet_attachments=ja;}else ea.snippet_attachments=fa.attachments;ea.is_forwarded_snippet=!!fa.forward_count;ea.snippet_sender=fa.author;};da.prototype.$MercuryThreadsc=function(ea){return ea.filter(function(fa){return fa!=this.$MercuryThreads3;}.bind(this)).length<=1;};da.prototype.$MercuryThreadsa=function(){this.$MercuryThreads1.subscribe('update-threads',function(ea,fa){var ga=(fa.actions||[]).filter(function(ha){return ha.thread_id;});if(fa.threads&&fa.payload_source==s.SERVER_FETCH_THREAD_INFO)fa.threads.forEach(function(ha){var ia=ha.thread_id;if(this.$MercuryThreads6.has(ia)){this.$MercuryThreads6["delete"](ia);if(ha.unread_count)this.$MercuryThreads1.changeThreadReadStatus(ha.thread_id,true);}}.bind(this));this.$MercuryThreadsq(fa.threads);this.$MercuryThreadsd(ga,fa.from_client);fa.threads&&fa.threads.forEach(function(ha){this.$MercuryThreadsn(ha.thread_id);}.bind(this));if(fa.global_actions)fa.global_actions.forEach(function(ha){if(ha.action_type==o.MARK_ALL_READ)this.$MercuryThreadsp(ha.folder);}.bind(this));if(this.$MercuryThreads4){this.$MercuryThreads4=false;ba.emit('change');}}.bind(this));};da.prototype.$MercuryThreadsq=function(ea){if(!ea||!ea.length)return;var fa={},ga=[];ea.forEach(function(ha){var ia=new h(ha);fa[ha.thread_id]=ia;ga.push(r.obfuscateThread(ia));});ga.length&&ca.debug('threads_added',{threads:ga});this.$MercuryThreads5.addResourcesAndExecute(fa);};da.prototype.$MercuryThreadsn=function(ea){this.$MercuryThreads4=true;this.$MercuryThreads2.updatedThread(ea);};da.prototype.$MercuryThreadsh=function(ea){this.$MercuryThreads4=true;this.$MercuryThreads2.deletedThread(ea);};da.prototype.$MercuryThreadso=function(ea,fa,ga){this.$MercuryThreads4=true;this.$MercuryThreads2.changedThreadReadState(ea,fa,ga);};da.prototype.dumpResourcesDO_NOT_USE=function(){return this.$MercuryThreads5.dumpResources();};Object.assign(da,t);w.registerCallback('mercury-threads',function(){var ea={};ea.threads={};var fa=da._getInstances();for(var ga in fa)ea.threads[ga]=fa[ga].dumpResourcesDO_NOT_USE();return ea;});e.exports=da;},null);
__d("WebMessengerPermalinkConstants",["URI"],function(a,b,c,d,e,f,g){var h={ARCHIVED_PATH:'/messages/archived',BASE_PATH:'/messages',OTHER_PATH:'/messages/other',SPAM_PATH:'/messages/spam',COMPOSE_POSTFIX_PATH:'/new',SEARCH_POSTFIX_PATH:'/search',TID_POSTFIX_PARTIAL_PATH:'/conversation-',overriddenVanities:'(archived|other|spam|new|search|conversation-.*)',getURIPathForThreadID:function(i,j){return (j||h.BASE_PATH)+h.TID_POSTFIX_PARTIAL_PATH+g.encodeComponent(g.encodeComponent(i));},getThreadIDFromURI:function(i){var j=i.getPath().match(h.BASE_PATH+'(/[^/]*)*'+h.TID_POSTFIX_PARTIAL_PATH+'([^/]+)');if(j){var k=g.decodeComponent(g.decodeComponent(j[2]));return k;}},getURIPathForIDOrVanity:function(i,j){if(i.match('^'+h.overriddenVanities+'$'))i='.'+i;return (j||h.BASE_PATH)+'/'+i;},getUserIDOrVanity:function(i){var j=i.match(h.BASE_PATH+'.*/([^/]+)/?$'),k=j&&j[1],l=h.overriddenVanities;if(!k||k.match('^'+l+'$')){return false;}else if(k.match('^\\.'+l+'$')){return k.substr(1);}else return k;}};e.exports=h;},null);
__d("ChatTypeaheadConstants",[],function(a,b,c,d,e,f){var g={USER_TYPE:'user',THREAD_TYPE:'thread',FRIEND_TYPE:'friend',NON_FRIEND_TYPE:'non_friend',FB4C_TYPE:'fb4c',PAGE_TYPE:'page',HEADER_TYPE:'header'};e.exports=g;},null);
__d("ChatOpenTab",["Event","requireWeak","ChatWelcomeMessage","ContextualThing","DOM","csx","cx","MercuryIDs","Parent","curry"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){var q=null;h(['ChatApp'],function(aa){return q=aa;});var r=null;h(['ChatTabModel'],function(aa){return r=aa;});var s=716,t='messaging_tracking';function u(){d(['Toggler'],function(aa){var ba=aa.getInstance(k.scry(document,"div._1z4y")[0]);if(ba&&ba.getActive())ba.hide();});}function v(aa,ba){d(['LogHistory','MercuryThreads','WebMessengerPermalinkConstants','goURI'],function(ca,da,ea,fa){da.get().getThreadMeta(aa,function(ga){if(q&&q.isInitialized()){q.tabController.openTab(aa,q.tabsViewport,ba);}else fa(ea.getURIPathForThreadID(aa));if(!z.canOpenTab())ca.getInstance('mercury').error('Unable to open chat tab',ga);});});if(document.documentElement.clientHeight<=s)u();}function w(aa,ba,ca,da){g.listen(aa,'click',function(ea){if(z.canOpenTab()){da(ba,ca);return ea.kill();}});}function x(aa,ba,ca,da){var ea={referrer:aa||'',message_thread_id:ba,message_view:'chat',timestamp_send:Date.now()};if(ca!==(void 0))ea.message_target_ids=[ca];d(['ChatImpressionLogger'],function(fa){fa.logImpression(aa,ca,da);});d(['Banzai'],function(fa){fa.post(t,ea,{delay:0,retry:true});});}function y(aa){var ba=j.getContext(aa);return (ba&&o.byClass(ba,"_3qw")!==null);}var z={canOpenTab:function(){return q&&!q.isHidden();},openEmptyTab:function(aa,ba,ca){if(z.canOpenTab()&&r){var da=r.getEmptyTab();v(da);x(ba,da,null,ca);u();return da;}return null;},listenOpenEmptyTab:function(aa,ba){w(aa,null,ba,z.openEmptyTab);},openThread:function(aa,ba,ca,da){d(['MercuryServerRequests'],function(ea){if(n.isValid(aa)){v(aa);}else ea.get().getClientThreadID(aa,function(fa){return v(fa,da);});x(ba,aa,null,ca);u();});},listenOpenThread:function(aa,ba,ca){w(aa,ba,ca,z.openThread);},openUserTab:function(aa,ba,ca){var da=n.getThreadIDFromUserID(aa);v(da);x(ba,da,aa,ca);return true;},openPageTab:function(aa,ba,ca){d(['MercuryThreads'],function(da){var ea=n.getThreadIDFromUserID(ba);da.get().getThreadMeta(ea,function(fa){if(aa&&aa.length>0){var ga=(Date.now()-fa.timestamp)/1000,ha=ga/3600;if(fa.message_count===0||ha>24)i.setWelcomeMessage(ea,n.getParticipantIDFromUserID(ba),aa);}});v(ea);x(ca,ea,ba);});return true;},listenOpenUserTab:function(aa,ba,ca){if(!y(aa))w(aa,ba,ca,z.openUserTab);},listenOpenPageTab:function(aa,ba,ca,da){if(!y(aa))w(aa,ba,da,p(z.openPageTab,ca));},openTabByType:function(aa,ba,ca){d(['ChatTypeaheadConstants','MercuryParticipantTypes'],function(da,ea){if(ba===da.THREAD_TYPE){if(aa){z.openThread(aa,ca);}else z.openEmptyTab(null,ca);}else if(!ba||ba===ea.FRIEND||ba===da.FRIEND_TYPE||ba===da.PAGE_TYPE||ba===da.USER_TYPE)z.openUserTab(aa,ca);});}};e.exports=z;},null);
__d("NotificationConstants",[],function(a,b,c,d,e,f){e.exports={PayloadSourceType:{UNKNOWN:0,USER_ACTION:1,LIVE_SEND:2,ENDPOINT:3,INITIAL_LOAD:4,OTHER_APPLICATION:5,SYNC:6}};},null);
__d("NotificationTokens",["CurrentUser"],function(a,b,c,d,e,f,g){var h={tokenizeIDs:function(i){return i.map(function(j){return g.getID()+':'+j;});},untokenizeIDs:function(i){return i.map(function(j){return j.split(':')[1];});}};e.exports=h;},null);
__d("NotificationUpdates",["Arbiter","ChannelConstants","JSLogger","NotificationConstants","NotificationTokens","LiveTimer","copyProperties","createObjectFrom"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){var o={},p={},q={},r={},s=[],t=0,u=i.create('notification_updates');function v(){if(t)return;var z=o,aa=p,ba=q,ca=r;o={};p={};q={};r={};x('notifications-updated',z);if(Object.keys(aa).length)x('seen-state-updated',aa);if(Object.keys(ba).length)x('read-state-updated',ba);if(Object.keys(ca).length)x('hidden-state-updated',ca);s.pop();}function w(){if(s.length)return s[s.length-1];return j.PayloadSourceType.UNKNOWN;}function x(event,z){y.inform(event,{updates:z,source:w()});}g.subscribe(h.getArbiterType('notification_json'),function(z,aa){var ba=Date.now(),ca=aa.obj.nodes;if(ca){ca.forEach(function(da){da.receivedTime=ba;});u.debug('notifications_received',ca);y.handleUpdate(j.PayloadSourceType.LIVE_SEND,aa.obj);}});g.subscribe(h.getArbiterType('notifications_seen'),function(z,aa){var ba=k.tokenizeIDs(aa.obj.alert_ids);y.handleUpdate(j.PayloadSourceType.LIVE_SEND,{seenState:n(ba)});});g.subscribe(h.getArbiterType('notifications_read'),function(z,aa){var ba=k.tokenizeIDs(aa.obj.alert_ids);y.handleUpdate(j.PayloadSourceType.LIVE_SEND,{readState:n(ba)});});var y=m(new g(),{handleUpdate:function(z,aa){if(aa.servertime)l.restart(aa.servertime);if(Object.keys(aa).length)this.synchronizeInforms(function(){s.push(z);var ba=m({payloadsource:w()},aa);this.inform('update-notifications',ba);this.inform('update-seen',ba);this.inform('update-read',ba);this.inform('update-hidden',ba);}.bind(this));},didUpdateNotifications:function(z){m(o,n(z));v();},didUpdateSeenState:function(z){m(p,n(z));v();},didUpdateReadState:function(z){m(q,n(z));v();},didUpdateHiddenState:function(z){m(r,n(z));v();},synchronizeInforms:function(z){t++;try{z();}catch(aa){throw aa;}finally{t--;v();}}});e.exports=y;},null);
__d("NotificationSeenState",["NotificationConstants","NotificationUpdates","copyProperties","createObjectFrom","mergeObjects"],function(a,b,c,d,e,f,g,h,i,j,k){var l={},m=1,n=2,o=0,p=m,q=m|n,r=g.PayloadSourceType.INITIAL_LOAD,s={UNSEEN_AND_UNREAD:o,SEEN_BUT_UNREAD:p,SEEN_AND_READ:q};function t(w){var x=[],y=[];Object.keys(w).forEach(function(z){var aa=w[z],ba=l[z];l[z]=aa;if(ba===(void 0)){x.push(z);y.push(z);return;}var ca=ba^aa;if(ca&m)x.push(z);if(ca&n)y.push(z);});x.length&&h.didUpdateSeenState(x);y.length&&h.didUpdateReadState(y);}h.subscribe('update-notifications',function(w,x){var y=x.nodes;if(!y||!y.length)return;var z=x.payloadsource,aa=g.PayloadSourceType,ba=z==aa.ENDPOINT,ca={};x.nodes.forEach(function(da){var ea=da.alert_id;if(!ba||l[ea]===(void 0))ca[ea]=s[da.seen_state];});t(ca);});h.subscribe('update-seen',function(w,x){if(!x.seenState)return;var y=[],z={};Object.keys(x.seenState).forEach(function(ba){if(!x.seenState[ba]){y.push(ba);return;}var ca=l[ba];if(ca!==(void 0))z[ba]=ca|m;});var aa=k(j(y,o),z);t(aa);});h.subscribe('update-read',function(w,x){if(!x.readState)return;var y=[],z={};Object.keys(x.readState).forEach(function(ba){if(x.readState[ba]){y.push(ba);return;}var ca=l[ba];if(ca!==(void 0)){z[ba]=ca&~n;}else if(x.payloadsource==r)z[ba]=p;});var aa=k(j(y,q),z);t(aa);});function u(w){var x=l[w];return x;}var v={isRead:function(w){return u(w)===q;},isSeen:function(w){return u(w)!==o;},getUnseenCount:function(){return v.getUnseenIDs().length;},getUnseenIDs:function(){return Object.keys(l).filter(function(w){return l[w]===o;});},getUnreadCount:function(){return v.getUnreadIDs().length;},getUnreadIDs:function(){return Object.keys(l).filter(function(w){return l[w]!==q;});}};e.exports=v;},null);
__d("RangedCallbackManager",["CallbackManagerController","createObjectFrom"],function(a,b,c,d,e,f,g,h){function i(j,k,l){"use strict";this.$RangedCallbackManager0=[];this.$RangedCallbackManager1=false;this.$RangedCallbackManager2=false;this.$RangedCallbackManager3={};this.$RangedCallbackManager4=new g(this.$RangedCallbackManager5.bind(this));this.$RangedCallbackManager6=j;this.$RangedCallbackManager7=k;this.$RangedCallbackManager8=l;}i.prototype.executeOrEnqueue=function(j,k,l,m,n){"use strict";return this.$RangedCallbackManager4.executeOrEnqueue({start:j,limit:k},l,{strict:!!m,skipOnStrictHandler:n});};i.prototype.unsubscribe=function(j){"use strict";this.$RangedCallbackManager4.unsubscribe(j);};i.prototype.getUnavailableResources=function(j){"use strict";var k=this.$RangedCallbackManager4.getRequest(j),l=[];if(k&&!this.$RangedCallbackManager1){var m=k.request,n=this.$RangedCallbackManager9(k.options),o=m.start+m.limit;for(var p=n.length;p<o;p++)l.push(p);}return l;};i.prototype.addResources=function(j){"use strict";j.forEach(function(k){if(!this.$RangedCallbackManager3[k]){this.$RangedCallbackManager3[k]=true;this.$RangedCallbackManager0.push(k);this.$RangedCallbackManager2=null;}}.bind(this));this.resortResources();this.$RangedCallbackManager4.runPossibleCallbacks();};i.prototype.addResourcesWithoutSorting=function(j,k){"use strict";var l=this.$RangedCallbackManager0.slice(0,k);l=l.concat(j);l=l.concat(this.$RangedCallbackManager0.slice(k));this.$RangedCallbackManager0=l;Object.assign(this.$RangedCallbackManager3,h(j,true));this.$RangedCallbackManager2=null;this.$RangedCallbackManager4.runPossibleCallbacks();};i.prototype.removeResources=function(j){"use strict";j.forEach(function(k){if(this.$RangedCallbackManager3[k]){this.$RangedCallbackManager3[k]=false;var l=this.$RangedCallbackManager0.indexOf(k);if(l!=-1)this.$RangedCallbackManager0.splice(l,1);}}.bind(this));};i.prototype.removeAllResources=function(){"use strict";this.$RangedCallbackManager0=[];this.$RangedCallbackManager3={};};i.prototype.resortResources=function(){"use strict";this.$RangedCallbackManager0=this.$RangedCallbackManager0.sort(function(j,k){return this.$RangedCallbackManager7(this.$RangedCallbackManager6(j),this.$RangedCallbackManager6(k));}.bind(this));};i.prototype.setReachedEndOfArray=function(){"use strict";if(!this.$RangedCallbackManager1){this.$RangedCallbackManager1=true;this.$RangedCallbackManager2=null;this.$RangedCallbackManager4.runPossibleCallbacks();}};i.prototype.hasReachedEndOfArray=function(){"use strict";return this.$RangedCallbackManager1;};i.prototype.setError=function(j){"use strict";if(this.$RangedCallbackManager2!==j){this.$RangedCallbackManager2=j;this.$RangedCallbackManager4.runPossibleCallbacks();}};i.prototype.getError=function(j,k,l){"use strict";var m=this.$RangedCallbackManager9({strict:l});return j+k>m.length?this.$RangedCallbackManager2:null;};i.prototype.hasResource=function(j){"use strict";return this.$RangedCallbackManager3[j];};i.prototype.getResourceAtIndex=function(j){"use strict";return this.$RangedCallbackManager0[j];};i.prototype.getAllResources=function(){"use strict";return this.$RangedCallbackManager0.concat();};i.prototype.getCurrentArraySize=function(j){"use strict";return this.$RangedCallbackManager9(j).length;};i.prototype.$RangedCallbackManager9=function(j){"use strict";var k=this.$RangedCallbackManager0;if(j&&j.strict){var l=j.skipOnStrictHandler||this.$RangedCallbackManager8;if(l)k=k.filter(l);}return k;};i.prototype.$RangedCallbackManager5=function(j,k){"use strict";var l=this.$RangedCallbackManager9(k);if(!this.$RangedCallbackManager1&&!this.$RangedCallbackManager2&&j.start+j.limit>l.length){return false;}else{var m=l.slice(j.start,j.start+j.limit),n=j.start+j.limit>l.length?this.$RangedCallbackManager2:null;return [m,n];}};i.prototype.getElementsUntil=function(j){"use strict";var k=[];for(var l=0;l<this.$RangedCallbackManager0.length;l++){var m=this.$RangedCallbackManager6(this.$RangedCallbackManager0[l]);if(this.$RangedCallbackManager7(m,j)>0)break;k.push(this.$RangedCallbackManager0[l]);}return k;};e.exports=i;},null);
__d("NotificationStore",["KeyedCallbackManager","NotificationConstants","NotificationUpdates","RangedCallbackManager","MercuryServerDispatcher"],function(a,b,c,d,e,f,g,h,i,j,k){var l=new g(),m=new j(function(q){var r=l.getResource(q);return r.creation_time;},function(q,r){return r-q;}),n={},o=null;i.subscribe('update-notifications',function(q,r){if(r.page_info)n=r.page_info;if(r.nodes===(void 0))return;var s,t=[],u={},v=r.nodes||[],w;v.forEach(function(x){s=x.alert_id;w=l.getResource(s);if(!w||w.creation_time<x.creation_time){t.push(s);u[s]=x;}});l.addResourcesAndExecute(u);m.addResources(t);i.didUpdateNotifications(t);});k.registerEndpoints({'/ajax/notifications/client/get.php':{mode:k.IMMEDIATE,handler:function(q){i.handleUpdate(h.PayloadSourceType.ENDPOINT,q);}}});var p={getNotifications:function(q,r){var s=m.executeOrEnqueue(0,q,function(z){var aa=l.executeOrEnqueue(z,r);}),t=m.getUnavailableResources(s);if(t.length){m.unsubscribe(s);if(!p.canFetchMore()){l.executeOrEnqueue(m.getAllResources(),r);return;}var u=n,v=(u&&u.end_cursor)||null,w;if(v){var x=Math.max.apply(null,t),y=m.getCurrentArraySize();w=x-y+1;}else w=q;k.trySend('/ajax/notifications/client/get.php',{businessID:o,cursor:v,length:w});}},getAll:function(q){p.getNotifications(p.getCount(),q);},getCount:function(){return m.getAllResources().length;},canFetchMore:function(){var q=n;return (!q||!q.hasOwnProperty('has_next_page')||q.has_next_page);},setBusinessID:function(q){o=q;}};e.exports=p;},null);
__d("NotificationInitialLoadController",["Arbiter","NotificationConstants","NotificationUpdates","NotificationSeenState","NotificationStore"],function(a,b,c,d,e,f,g,h,i){b('NotificationSeenState');b('NotificationStore');function j(k){i.handleUpdate(h.PayloadSourceType.INITIAL_LOAD,k);g.inform('jewel/count-updated',{jewel:'notifications',count:k.nodes.length});}e.exports=j;},null);
__d("NotificationPhotoThumbnail",[],function(a,b,c,d,e,f){function g(i){if(!i.media||!i.style_list||!i.style_list.length)return null;switch(i.style_list[0]){case 'new_album':case 'album':case 'application':case 'photo':case 'video':case 'video_autoplay':case 'video_inline':return i.media.image;default:return null;}}var h={getThumbnail:function(i,j,k){var l;if(i&&i.length){l=g(i[0]);if(l)return l;}if(k){var m=k.relevant_comments;if(m&&m.length){var n=m[0].attachments;if(n&&n.length){l=g(n[0]);if(l)return l;}}}if(j){var o=j.attachments;if(o&&o.length)return g(o[0]);}return null;}};e.exports=h;},null);
__d("NotificationURI",["BusinessURI.brands","URI","isFacebookURI"],function(a,b,c,d,e,f,g,h,i){var j={localize:function(k){k=g(k);if(!i(k))return k.toString();var l=k.getSubdomain();return k.getUnqualifiedURI().getQualifiedURI().setSubdomain(l).toString();},snowliftable:function(k){if(!k)return false;k=h(k);var l=k.getQueryData();return i(k)&&('fbid' in l||'v' in l);},isVaultSetURI:function(k){return this._areEquals(k,'/ajax/vault/sharer_preview.php');},isAlbumDraftRecoveryDialogURI:function(k){return this._areEquals(k,'/ajax/photos/upload/overlay/');},_areEquals:function(k,l){if(!k)return false;k=h(k);return i(k)&&k.getPath()===l;}};e.exports=j;},null);
__d("XNotificationsGenericNegativeFeedbackController",["XController"],function(a,b,c,d,e,f){e.exports=b("XController").create("\/notifications\/feedback\/generic\/negative\/",{notif_id:{type:"Int",required:true},undo:{type:"Bool",defaultValue:false}});},null);
__d("NotificationUserActions",["AsyncRequest","AsyncSignal","NotificationConstants","NotificationStore","NotificationTokens","NotificationUpdates","URI","XNotificationsGenericNegativeFeedbackController","createObjectFrom","emptyFunction"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){var q=i.PayloadSourceType.USER_ACTION,r='mark_spam',s='turn_off',t='undo',u='original_subscription_level',v=false;function w(ca){var da=m('/ajax/notifications/mark_read.php').getQualifiedURI().toString();new h(da,ca).send();}function x(ca){var da={};ca.forEach(function(ea,fa){da['alert_ids['+fa+']']=ea;});return da;}function y(ca,da,ea,fa,ga){var ha=k.untokenizeIDs([ca])[0],ia={notification_id:ha,client_rendered:true,request_type:da};Object.assign(ia,ea);new g('/ajax/notifications/negative_req.php').setData(ia).setHandler(fa||p).setErrorHandler(ga||p).send();}function z(ca,da,ea,fa){var ga=n.getURIBuilder().setInt('notif_id',k.untokenizeIDs([ca])[0]).setBool('undo',fa).getURI();new g(ga).setHandler(da||p).setErrorHandler(ea||p).send();}function aa(ca,da,ea,fa,ga){var ha=ga?t:s;j.getAll(function(ia){var ja=Object.keys(ia).filter(function(ka){var la=ia[ka];return !!(la.application&&la.application.id&&la.application.id==da);});y(ca,ha,null,function(ka){ea(ka);l.handleUpdate(q,{hiddenState:o(ja,!ga)});},fa);});}var ba={markNotificationsAsSeen:function(ca){l.handleUpdate(q,{seenState:o(ca)});var da=k.untokenizeIDs(ca),ea=x(da);ea.seen=true;w(ea);if(a.presenceNotifications)a.presenceNotifications.alertList.markSeen(da);},setNextIsFromReadButton:function(ca){v=ca;},markNotificationsAsRead:function(ca){l.handleUpdate(q,{readState:o(ca)});var da=k.untokenizeIDs(ca),ea=x(da);if(v){ea.from_read_button=true;v=false;}w(ea);if(a.presenceNotifications)a.presenceNotifications.markRead(false,da);},giveGenericNegativeFeedback:function(ca,da,ea){l.handleUpdate(q,{hiddenState:o([ca])});z(ca,da,ea,false);},undoGenericNegativeFeedback:function(ca,da,ea){l.handleUpdate(q,{hiddenState:o([ca],false)});z(ca,da,ea,true);},markNotificationAsHidden:function(ca,da,ea){l.handleUpdate(q,{hiddenState:o([ca])});y(ca,s,null,da,ea);},markNotificationAsVisible:function(ca,da,ea,fa){l.handleUpdate(q,{hiddenState:o([ca],false)});var ga=null;if(da!==null){ga={};ga[u]=da;}y(ca,t,ga,ea,fa);},markNotificationAsSpam:function(ca,da,ea){l.handleUpdate(q,{hiddenState:o([ca],false)});y(ca,r,null,da,ea);},markAppAsHidden:function(ca,da,ea,fa){var ga=false;aa(ca,da,ea,fa,ga);},markAppAsVisible:function(ca,da,ea,fa){var ga=true;aa(ca,da,ea,fa,ga);}};e.exports=ba;},null);
__d("SplitImage.react",["React","Image.react","cx","joinClasses"],function(a,b,c,d,e,f,g,h,i,j){var k=g.createClass({displayName:"SplitImage",render:function(){var l=this.props.size;return (g.createElement("div",g.__spread({},this.props,{className:j(this.props.className,"_55lt"),style:Object.assign({},(this.props.style||{}),{width:l,height:l})}),this.renderImages()));},renderImages:function(){if(!this.props.srcs)return null;var l=this.props.srcs,m=Array.isArray(l);if(!m||l.length==1)return this.renderOne(m?l[0]:l);return l.length==2?this.renderTwo(l):this.renderThree(l);},renderOne:function(l){return (g.createElement(h,{src:l,width:this.props.size,height:this.props.size,alt:""}));},renderTwo:function(l){var m=this.props.size,n=Math.floor(m/2),o=-Math.floor(n/2),p=(("_55lu")+(this.props.border?' '+"_57xo":''));return (g.createElement("div",null,g.createElement("div",{className:"_55lu",style:{width:n}},g.createElement(h,{src:l[0],width:m,height:m,style:{marginLeft:o}})),g.createElement("div",{className:p,style:{width:n}},g.createElement(h,{src:l[1],width:m,height:m,style:{marginLeft:o}}))));},renderThree:function(l){var m=this.props.size,n=Math.floor(m/3*2),o=-Math.floor((m-n)/2),p=Math.floor(m/2),q=m-n,r=-Math.floor((p-q)/2),s=(("_55lu")+(this.props.border?' '+"_57pl":'')),t=(("_55lu")+(this.props.border?' '+"_57pm":''));return (g.createElement("div",null,g.createElement("div",{className:s,style:{width:n}},g.createElement(h,{src:l[0],width:m,height:m,style:{marginLeft:o}})),g.createElement("div",{className:t,style:{width:q,height:p}},g.createElement(h,{src:l[1],width:p,height:p,style:{marginLeft:r}})),g.createElement("div",{className:"_55lu",style:{width:q,height:p}},g.createElement(h,{src:l[2],width:p,height:p,style:{marginLeft:r}}))));}});e.exports=k;},null);
__d("FBOverlayBase.react",["React"],function(a,b,c,d,e,f,g){var h=g.createClass({displayName:"FBOverlayBase",render:function(){return g.Children.only(this.props.children);}});e.exports=h;},null);
__d("FBOverlayElement.react",["React","cloneWithProps","cx","joinClasses"],function(a,b,c,d,e,f,g,h,i,j){var k=g,l=k.PropTypes,m={horizontal:{left:"_32rg",right:"_32rh",fit:j("_32rg","_32rh")},vertical:{top:"_32ri",bottom:"_32rj",fit:j("_32ri","_32rj")}},n=g.createClass({displayName:"FBOverlayElement",propTypes:{horizontal:l.oneOf(['left','right','fit']),vertical:l.oneOf(['top','bottom','fit'])},getDefaultProps:function(){return {horizontal:'fit',vertical:'fit'};},render:function(){var o=j("_32rk",m.horizontal[this.props.horizontal],m.vertical[this.props.vertical]);return h(g.Children.only(this.props.children),{className:o});}});e.exports=n;},null);
__d("FBOverlayContainer.react",["FBOverlayBase.react","FBOverlayElement.react","React","cx","invariant","joinClasses"],function(a,b,c,d,e,f,g,h,i,j,k,l){var m=i.createClass({displayName:"FBOverlayContainer",propTypes:{children:function(n,o){var p=n[o],q=0;i.Children.forEach(p,function(r){if(r===null||r===(void 0))return;switch(r.type){case g:q++;break;case h:break;default:k(false);}});k(q===1);}},render:function(){return (i.createElement("div",i.__spread({},this.props,{className:l(this.props.className,"_23n-")}),this.props.children));}});e.exports=m;},null);
__d("AbstractDialog.react",["DialogX","LayerHideOnBlur","React","copyProperties","merge"],function(a,b,c,d,e,f,g,h,i,j,k){var l=i,m=l.PropTypes,n={createSpec:function(o){return {displayName:o.displayName,propTypes:{behaviors:m.object,className:m.string,modal:m.bool,autohide:m.number,width:m.number,titleID:m.string,causalElement:m.object,causalElementRef:m.string,shown:m.bool,layerHideOnBlur:m.bool,fixedTopPosition:m.number},createLayer:function(p){var q=this.props.className,r=j({width:this.props.width,xui:true,autohide:this.props.autohide,classNames:q?q.split(' '):null,titleID:this.props.titleID,causalElement:this._getCausalElement(),fixedTopPosition:this.props.fixedTopPosition},o||{}),s=k(o.addedBehaviors,this.props.behaviors);if(this.props.layerHideOnBlur!==false)s.LayerHideOnBlur=h;r.addedBehaviors=this.enumerateBehaviors(s);var t=new g(r,p);t.conditionShow(this.props.shown);return t;},receiveProps:function(p){this.updateBehaviors(p.behaviors);if(this.layer){this.layer.setCausalElement(this._getCausalElement());this.layer.conditionShow(p.shown);this.layer.setWidth(p.width);p.shown&&this.layer.updatePosition();}},_getCausalElement:function(){var p;if(this.props.causalElementRef){p=this.getNodeForOwnerRef(this.props.causalElementRef);}else p=this.props.causalElement;return p;}};}};e.exports=n;},null);
__d("ProgressBar.react",["React","cx","joinClasses"],function(a,b,c,d,e,f,g,h,i){var j=g.createClass({displayName:"UIProgressBar",propTypes:{value:g.PropTypes.number.isRequired,label:g.PropTypes.string,min:g.PropTypes.number,max:g.PropTypes.number,size:g.PropTypes.oneOf(['small','large']),typesetting:g.PropTypes.oneOf(['float','inline']),isRounded:g.PropTypes.bool},getDefaultProps:function(){return {min:0,max:100,size:'large',typesetting:'inline',isRounded:false};},_calculatePercentage:function(){var k=this.props,l=Math.min(Math.max((k.value-k.min)/(k.max-k.min)*100,0),100);return l;},_hasLabel:function(){return this.props.label!=null&&this.props.size!=='small';},_isFloatingLabel:function(){return this._hasLabel()&&this.props.typesetting==='float';},_getLabel:function(){if(!this._hasLabel())return null;return this.props.label;},_getSpacer:function(){if(this._isFloatingLabel())return g.createElement("div",{className:"_6a"}," ");return null;},_getFillArea:function(){var k=Math.round(this._calculatePercentage()),l=(("_5e4k")+(k===0?' '+"_5e2d":'')+(k===100?' '+"_5e4j":'')),m=this._getLabel();if(m)m=g.createElement("span",{className:"_5e2h"},m);var n=g.createElement("div",{className:l,style:{width:k+'%'}},this._getSpacer(),m);return n;},_getUnfillArea:function(){var k=this._getLabel();if(!k)return null;k=g.createElement("span",{className:"_5e2h _5e2n"},k);if(this._isFloatingLabel()){var l=this._calculatePercentage(),m={left:l+'%',width:l+'%'},n=g.createElement("div",{className:"_5e2g",style:m},this._getSpacer(),k);return n;}return k;},render:function(){var k=(("_5e4h")+(!this._isFloatingLabel()?' '+"_5e2k":'')+(this._isFloatingLabel()?' '+"_5e2j":'')+(this.props.size==='small'?' '+"_5e2l":'')+(this.props.isRounded===true?' '+"_5e2m":''));if(this._isFloatingLabel()){return (g.createElement("div",g.__spread({},this.props,{className:i(this.props.className,k)}),g.createElement("div",{className:"_5e2k"},this._getUnfillArea(),this._getFillArea())));}else return (g.createElement("div",g.__spread({},this.props,{className:i(this.props.className,k)}),this._getUnfillArea(),this._getFillArea()));}});e.exports=j;},null);
__d("XUIDialog.react",["AbstractDialog.react","LayerFadeOnShow","ReactLayer"],function(a,b,c,d,e,f,g,h,i){var j=i.createClass(g.createSpec({displayName:'XUIDialog',addedBehaviors:{LayerFadeOnShow:h}}));e.exports=j;},null);
__d("XUITextInput.react",["AbstractTextInput.react","React","XUIError.react","cx","joinClasses"],function(a,b,c,d,e,f,g,h,i,j,k){var l=h.createClass({displayName:"XUITextInput",propTypes:Object.assign({},g.propTypes,i.propTypes),render:function(){var m=(("_55r1")+(this.props.height=='tall'?' '+"_55r2":'')),n=(h.createElement(g,h.__spread({},this.props,{ref:"textInput",className:k(this.props.className,m)})));return (h.createElement(i,h.__spread({},this.props),n));},focusInput:function(){this.refs.textInput.focusInput();}});e.exports=l;},null);
__d("str2rstr",[],function(a,b,c,d,e,f){function g(h){var i="",j,k;for(var l=0;l<h.length;l++){j=h.charCodeAt(l);k=l+1<h.length?h.charCodeAt(l+1):0;if(55296<=j&&j<=56319&&56320<=k&&k<=57343){j=65536+((j&1023)<<10)+(k&1023);l++;}if(j<=127){i+=String.fromCharCode(j);}else if(j<=2047){i+=String.fromCharCode(192|((j>>>6)&31),128|(j&63));}else if(j<=65535){i+=String.fromCharCode(224|((j>>>12)&15),128|((j>>>6)&63),128|(j&63));}else if(j<=2097151)i+=String.fromCharCode(240|((j>>>18)&7),128|((j>>>12)&63),128|((j>>>6)&63),128|(j&63));}return i;}e.exports=g;},null);
__d("md5",["str2rstr"],function(a,b,c,d,e,f,g){function h(u,v){var w=u[0],x=u[1],y=u[2],z=u[3];w=j(w,x,y,z,v[0],7,-680876936);z=j(z,w,x,y,v[1],12,-389564586);y=j(y,z,w,x,v[2],17,606105819);x=j(x,y,z,w,v[3],22,-1044525330);w=j(w,x,y,z,v[4],7,-176418897);z=j(z,w,x,y,v[5],12,1200080426);y=j(y,z,w,x,v[6],17,-1473231341);x=j(x,y,z,w,v[7],22,-45705983);w=j(w,x,y,z,v[8],7,1770035416);z=j(z,w,x,y,v[9],12,-1958414417);y=j(y,z,w,x,v[10],17,-42063);x=j(x,y,z,w,v[11],22,-1990404162);w=j(w,x,y,z,v[12],7,1804603682);z=j(z,w,x,y,v[13],12,-40341101);y=j(y,z,w,x,v[14],17,-1502002290);x=j(x,y,z,w,v[15],22,1236535329);w=k(w,x,y,z,v[1],5,-165796510);z=k(z,w,x,y,v[6],9,-1069501632);y=k(y,z,w,x,v[11],14,643717713);x=k(x,y,z,w,v[0],20,-373897302);w=k(w,x,y,z,v[5],5,-701558691);z=k(z,w,x,y,v[10],9,38016083);y=k(y,z,w,x,v[15],14,-660478335);x=k(x,y,z,w,v[4],20,-405537848);w=k(w,x,y,z,v[9],5,568446438);z=k(z,w,x,y,v[14],9,-1019803690);y=k(y,z,w,x,v[3],14,-187363961);x=k(x,y,z,w,v[8],20,1163531501);w=k(w,x,y,z,v[13],5,-1444681467);z=k(z,w,x,y,v[2],9,-51403784);y=k(y,z,w,x,v[7],14,1735328473);x=k(x,y,z,w,v[12],20,-1926607734);w=l(w,x,y,z,v[5],4,-378558);z=l(z,w,x,y,v[8],11,-2022574463);y=l(y,z,w,x,v[11],16,1839030562);x=l(x,y,z,w,v[14],23,-35309556);w=l(w,x,y,z,v[1],4,-1530992060);z=l(z,w,x,y,v[4],11,1272893353);y=l(y,z,w,x,v[7],16,-155497632);x=l(x,y,z,w,v[10],23,-1094730640);w=l(w,x,y,z,v[13],4,681279174);z=l(z,w,x,y,v[0],11,-358537222);y=l(y,z,w,x,v[3],16,-722521979);x=l(x,y,z,w,v[6],23,76029189);w=l(w,x,y,z,v[9],4,-640364487);z=l(z,w,x,y,v[12],11,-421815835);y=l(y,z,w,x,v[15],16,530742520);x=l(x,y,z,w,v[2],23,-995338651);w=m(w,x,y,z,v[0],6,-198630844);z=m(z,w,x,y,v[7],10,1126891415);y=m(y,z,w,x,v[14],15,-1416354905);x=m(x,y,z,w,v[5],21,-57434055);w=m(w,x,y,z,v[12],6,1700485571);z=m(z,w,x,y,v[3],10,-1894986606);y=m(y,z,w,x,v[10],15,-1051523);x=m(x,y,z,w,v[1],21,-2054922799);w=m(w,x,y,z,v[8],6,1873313359);z=m(z,w,x,y,v[15],10,-30611744);y=m(y,z,w,x,v[6],15,-1560198380);x=m(x,y,z,w,v[13],21,1309151649);w=m(w,x,y,z,v[4],6,-145523070);z=m(z,w,x,y,v[11],10,-1120210379);y=m(y,z,w,x,v[2],15,718787259);x=m(x,y,z,w,v[9],21,-343485551);u[0]=s(w,u[0]);u[1]=s(x,u[1]);u[2]=s(y,u[2]);u[3]=s(z,u[3]);}function i(u,v,w,x,y,z){v=s(s(v,u),s(x,z));return s((v<<y)|(v>>>(32-y)),w);}function j(u,v,w,x,y,z,aa){return i((v&w)|((~v)&x),u,v,y,z,aa);}function k(u,v,w,x,y,z,aa){return i((v&x)|(w&(~x)),u,v,y,z,aa);}function l(u,v,w,x,y,z,aa){return i(v^w^x,u,v,y,z,aa);}function m(u,v,w,x,y,z,aa){return i(w^(v|(~x)),u,v,y,z,aa);}function n(u){var v=u.length,w=[1732584193,-271733879,-1732584194,271733878],x;for(x=64;x<=u.length;x+=64)h(w,o(u.substring(x-64,x)));u=u.substring(x-64);var y=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(x=0;x<u.length;x++)y[x>>2]|=u.charCodeAt(x)<<((x&3)<<3);y[x>>2]|=128<<((x&3)<<3);if(x>55){h(w,y);for(x=0;x<16;x++)y[x]=0;}y[14]=v*8;h(w,y);return w;}function o(u){var v=[],w=0;while(w<64)v[w>>2]=u.charCodeAt(w++)|(u.charCodeAt(w++)<<8)|(u.charCodeAt(w++)<<16)|(u.charCodeAt(w++)<<24);return v;}var p='0123456789abcdef'.split('');function q(u){var v='',w=0;for(;w<4;w++)v+=p[(u>>((w<<3)+4))&15]+p[(u>>(w<<3))&15];return v;}function r(u){for(var v=0;v<u.length;v++)u[v]=q(u[v]);return u.join('');}var s=function(u,v){return (u+v)&4294967295;};function t(u){if(null===u||(void 0)===u){return null;}else{for(var v=0;v<u.length;v++)if(u[v]>"\u007F"){u=g(u);break;}return r(n(u));}}if(t('hello')!='5d41402abc4b2a76b9719d911017c592')s=function(u,v){var w=(u&65535)+(v&65535),x=(u>>16)+(v>>16)+(w>>16);return (x<<16)|(w&65535);};e.exports=t;},null);
__d("mergeDeepInto",["invariant","mergeHelpers"],function(a,b,c,d,e,f,g,h){"use strict";var i=h.ArrayStrategies,j=h.checkArrayStrategy,k=h.checkMergeArrayArgs,l=h.checkMergeLevel,m=h.checkMergeObjectArgs,n=h.isTerminal,o=h.normalizeMergeArg,p=function(t,u,v,w){m(t,u);l(w);var x=u?Object.keys(u):[];for(var y=0;y<x.length;y++){var z=x[y];r(t,u,z,v,w);}},q=function(t,u,v,w){k(t,u);l(w);var x=Math.max(t.length,u.length);for(var y=0;y<x;y++)r(t,u,y,v,w);},r=function(t,u,v,w,x){var y=u[v],z=u.hasOwnProperty(v),aa=z&&n(y),ba=z&&Array.isArray(y),ca=z&&!ba&&!ba,da=t[v],ea=t.hasOwnProperty(v),fa=ea&&n(da),ga=ea&&Array.isArray(da),ha=ea&&!ga&&!ga;if(fa){if(aa){t[v]=y;}else if(ba){t[v]=[];q(t[v],y,w,x+1);}else if(ca){t[v]={};p(t[v],y,w,x+1);}else if(!z)t[v]=da;}else if(ga){if(aa){t[v]=y;}else if(ba){g(i[w]);if(w===i.Clobber)da.length=0;q(da,y,w,x+1);}else if(ca){t[v]={};p(t[v],y,w,x+1);}else !z;}else if(ha){if(aa){t[v]=y;}else if(ba){t[v]=[];q(t[v],y,w,x+1);}else if(ca){p(da,y,w,x+1);}else !z;}else if(!ea)if(aa){t[v]=y;}else if(ba){t[v]=[];q(t[v],y,w,x+1);}else if(ca){t[v]={};p(t[v],y,w,x+1);}else !z;},s=function(t,u,v){var w=o(u);j(v);p(t,w,v,0);};e.exports=s;},null);
__d("mergeDeep",["mergeHelpers","mergeDeepInto"],function(a,b,c,d,e,f,g,h){"use strict";var i=g.checkArrayStrategy,j=g.checkMergeObjectArgs,k=g.normalizeMergeArg,l=function(m,n,o){var p=k(m),q=k(n);j(p,q);i(o);var r={};h(r,p,o);h(r,q,o);return r;};e.exports=l;},null);
__d("getNormalizedClientRect",["getDocumentScrollElement"],function(a,b,c,d,e,f,g){'use strict';function h(i){var j=i.getBoundingClientRect(),k=0,l=0,m=g(i.ownerDocument),n=m.getBoundingClientRect();if(n.left>0){k=-n.left;}else{var o=m.scrollWidth+n.left,p=n.width;if(p>o)k=p-o;}if(n.top>0)l=-n.top;return {bottom:j.bottom+l,height:j.height,left:j.left+k,right:j.right+k,top:j.top+l,width:j.width};}e.exports=h;},null);
__d("Emscripten",[],function(a,b,c,d,e,f){e.exports={isSupported:function(){return (typeof Int32Array!=='undefined'&&typeof Float64Array!=='undefined'&&!!new Int32Array(1).subarray&&!!new Int32Array(1).set);}};},null);
__d("XHRHttpError",[],function(a,b,c,d,e,f){var g='HTTP_CLIENT_ERROR',h='HTTP_PROXY_ERROR',i='HTTP_SERVER_ERROR',j='HTTP_TRANSPORT_ERROR',k='HTTP_UNKNOWN_ERROR';function l(m,n){if(n===0){var o=m.getProtocol();if(o==='file'||o==='ftp')return null;return j;}else if(n>=100&&n<200){return h;}else if(n>=200&&n<300){return null;}else if(n>=400&&n<500){return g;}else if(n>=500&&n<600){return i;}else if(n>=12001&&n<12156){return j;}else return k;}e.exports={getErrorCode:l,HTTP_CLIENT_ERROR:g,HTTP_PROXY_ERROR:h,HTTP_SERVER_ERROR:i,HTTP_TRANSPORT_ERROR:j,HTTP_UNKNOWN_ERROR:k};},null);
__d("xhrSimpleDataSerializer",[],function(a,b,c,d,e,f){function g(h){var i=[],j;for(j in h)i.push(encodeURIComponent(j)+'='+encodeURIComponent(h[j]));return i.join('&');}e.exports=g;},null);
__d("XHRRequest",["ErrorUtils","TimeSlice","URI","XHRHttpError","getSameOriginTransport","invariant","xhrSimpleDataSerializer"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n={errorCode:null,errorMsg:null,errorType:null},o={loadedBytes:null,totalBytes:null};function p(q){"use strict";this.setURI(q);this.setMethod('POST');this.setTransportBuilder(k);this.setDataSerializer(m);this.$XHRRequest0=this.$XHRRequest0.bind(this);}p.prototype.setURI=function(q){"use strict";this.$XHRRequest1=new i(q);return this;};p.prototype.getURI=function(){"use strict";return this.$XHRRequest1;};p.prototype.setMethod=function(q){"use strict";this.$XHRRequest2=q;return this;};p.prototype.getMethod=function(){"use strict";return this.$XHRRequest2;};p.prototype.setData=function(q){"use strict";this.$XHRRequest3=q;return this;};p.prototype.getData=function(){"use strict";return this.$XHRRequest3;};p.prototype.setRawData=function(q){"use strict";this.$XHRRequest4=q;return this;};p.prototype.setRequestHeader=function(q,r){"use strict";if(!this.$XHRRequest5)this.$XHRRequest5={};this.$XHRRequest5[q]=r;return this;};p.prototype.setTimeout=function(q){"use strict";this.$XHRRequest6=q;return this;};p.prototype.setResponseHandler=function(q){"use strict";this.$XHRRequest7=q;return this;};p.prototype.setErrorHandler=function(q){"use strict";this.$XHRRequest8=q;return this;};p.prototype.setAbortHandler=function(q){"use strict";this.$XHRRequest9=q;return this;};p.prototype.setTimeoutHandler=function(q){"use strict";this.$XHRRequesta=q;return this;};p.prototype.setUploadProgressHandler=function(q){"use strict";this.$XHRRequestb=q;return this;};p.prototype.setTransportBuilder=function(q){"use strict";this.$XHRRequestc=q;return this;};p.prototype.setDataSerializer=function(q){"use strict";this.$XHRRequestd=q;return this;};p.prototype.send=function(){"use strict";var q=this.$XHRRequest6,r=this.$XHRRequestc(),s=this.getURI();this.$XHRRequeste=r;var t;l(this.$XHRRequest2==='POST'||!this.$XHRRequest4);if(this.$XHRRequest2==='GET'||this.$XHRRequest4){s.addQueryData(this.$XHRRequest3);t=this.$XHRRequest4;}else t=this.$XHRRequestd(this.$XHRRequest3);r.onreadystatechange=h.guard(this.$XHRRequest0,'XHRRequest onreadystatechange');if(r.upload&&this.$XHRRequestb)r.upload.onprogress=this.$XHRRequestf.bind(this);if(q)this.$XHRRequestg=setTimeout(this.$XHRRequesth.bind(this),q);r.open(this.$XHRRequest2,s.toString(),true);if(this.$XHRRequest5)for(var u in this.$XHRRequest5)r.setRequestHeader(u,this.$XHRRequest5[u]);r.send(t);};p.prototype.abort=function(){"use strict";this.$XHRRequesti();if(this.$XHRRequest9)g.applyWithGuard(this.$XHRRequest9,null,null,null,'XHRRequest:_abortHandler');};p.prototype.$XHRRequesti=function(){"use strict";var q=this.$XHRRequeste;if(q){q.onreadystatechange=null;q.abort();}this.$XHRRequestj();};p.prototype.$XHRRequesth=function(){"use strict";this.$XHRRequesti();if(this.$XHRRequesta)g.applyWithGuard(this.$XHRRequesta,null,null,null,'XHRRequest:_abortHandler');};p.prototype.$XHRRequest0=function(){"use strict";var q=this.$XHRRequeste,r=q,s=r.readyState;if(s>=2){var t=s===4,u=this.getURI(),v=j.getErrorCode(u,q.status),w=this.$XHRRequest7;if(v!==null){if(t){n.errorCode=v;n.errorMsg=q.responseText;n.errorType='HTTP';if(this.$XHRRequest8)g.applyWithGuard(this.$XHRRequest8,null,[n],null,'XHRRequest:_errorHandler');}}else if(w){var x=null;if(w.includeHeaders)x=q.getAllResponseHeaders();if(t||(w.parseStreaming&&s===3))g.applyWithGuard(w,null,[q.responseText,x,t],null,'XHRRequest:handler');}if(t)this.$XHRRequestj();}};p.prototype.$XHRRequestf=function(q){"use strict";o.loadedBytes=q.loaded;o.totalBytes=q.total;if(this.$XHRRequestb)g.applyWithGuard(this.$XHRRequestb,null,[o],null,'XHRRequest:_uploadProgressHandler');};p.prototype.$XHRRequestj=function(){"use strict";clearTimeout(this.$XHRRequestg);delete this.$XHRRequeste;};e.exports=p;},null);
__d("getCrossOriginTransport",["ex","invariant"],function(a,b,c,d,e,f,g,h){function i(){try{var k=new XMLHttpRequest();if(!('withCredentials' in k)&&typeof XDomainRequest!=='undefined')k=new XDomainRequest();return k;}catch(j){throw new Error(g('getCrossOriginTransport: %s',j.message));}}i.withCredentials=function(){var j=i();h('withCredentials' in j);var k=j.open;j.open=function(){k.apply(this,arguments);this.withCredentials=true;};return j;};e.exports=i;},null);
__d("WebWorker",["BanzaiLogger","WebWorkerConfig","BlobFactory","EventListener","URI","areSameOrigin","destroyOnUnload","SubscriptionsHandler","XHRRequest","arrayContains","emptyFunction","getCrossOriginTransport","performanceNow","invariant","memoize","merge","filterObject"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w){var x=a.URL||a.webkitURL;function y(ea){"use strict";this.$WebWorker0=false;this.$WebWorker1=null;this.$WebWorker2=ea;this.$WebWorker3=null;this.$WebWorker4=q;this.$WebWorker5=q;this.$WebWorker6=[];this.$WebWorker7=false;this.$WebWorker8=new n();m(function(){if(!this.$WebWorker7)this.terminate();}.bind(this));this.$WebWorker9('constructed');}y.prototype.setMessageHandler=function(ea){"use strict";this.$WebWorker4=ea||q;return this;};y.prototype.setErrorHandler=function(ea){"use strict";this.$WebWorker5=ea||q;return this;};y.prototype.postMessage=function(ea,fa){"use strict";t(!this.isCurrentState('constructed'));t(!this.isCurrentState('terminated'));if(this.isCurrentState('preparing')){this.$WebWorker6.push(this.postMessage.bind(this,ea,fa));return this;}var ga={type:'message',message:ea};if(fa){this.$WebWorker3.postMessage(ga,fa);}else this.$WebWorker3.postMessage(ga);return this;};y.prototype.terminate=function(){"use strict";if(this.isCurrentState('executing'))this.$WebWorker3.terminate();if(!this.isCurrentState('terminated')){this.$WebWorker9('terminated');this.$WebWorker3=null;this.$WebWorkera();this.$WebWorker6=[];}return this;};y.prototype.execute=function(){"use strict";t(!this.isCurrentState('terminated'));if(['preparing','executing'].some(this.isCurrentState,this))return this;this.$WebWorker9('preparing');y.prepareResource(this.$WebWorker2,this.$WebWorkerb.bind(this));return this;};y.prototype.setAllowCrossPageTransition=function(ea){"use strict";this.$WebWorker7=ea;return this;};y.prototype.isCurrentState=function(ea){"use strict";t(p(y.states,ea));return ea===this.$WebWorker1;};y.prototype.$WebWorkerb=function(){"use strict";t(!this.isCurrentState('executing'));if(this.isCurrentState('terminated'))return;t(this.$WebWorker2.sameOriginURL||this.$WebWorker2.source);if(this.$WebWorker2.sameOriginURL){this.$WebWorker3=new a.Worker(this.$WebWorker2.sameOriginURL);}else{this.$WebWorker3=new a.Worker(y.evalWorkerURL);this.$WebWorker3.postMessage(this.$WebWorker2.source);}this.$WebWorkerc('ping',Date.now());this.$WebWorkerd();this.$WebWorker9('executing');this.$WebWorker6.forEach(function(ea){return ea();});this.$WebWorker6=null;};y.prototype.$WebWorkera=function(){"use strict";this.$WebWorker8.release();};y.prototype.$WebWorkerc=function(ea){"use strict";for(var fa=[],ga=1,ha=arguments.length;ga<ha;ga++)fa.push(arguments[ga]);this.$WebWorker3.postMessage({type:ea,args:fa});};y.prototype.$WebWorkere=function(event,ea){"use strict";y.$WebWorkere(event,this.$WebWorker2.name,v(ea,{cross_page_transition:!!this.$WebWorker7,state:this.$WebWorker1}));};y.$WebWorkerf=function(){"use strict";return Object.keys(w({object_url:y.$WebWorkerg(),eval_url:ca(),data_url:y.$WebWorkerh(),worker:y.isSupported(),transferables:y.areTransferablesSupported()},function(ea){return !!ea;}));};y.prototype.$WebWorkerd=function(){"use strict";this.$WebWorker8.addSubscriptions(j.listen(this.$WebWorker3,'message',this.$WebWorkeri.bind(this)),j.listen(this.$WebWorker3,'error',this.$WebWorkerj.bind(this)));};y.prototype.$WebWorkerj=function(ea){"use strict";var fa=this.$WebWorker5(ea);if(!fa&&!ea.defaultPrevented)this.$WebWorkere('exception',{message:ea.message});};y.prototype.$WebWorkeri=function(event){"use strict";var ea=event.data;switch(ea.type){case 'message':this.$WebWorker4(ea.message);break;case 'pong':this.$WebWorker0=true;this.$WebWorkere('executed',{dt:Math.floor(ea.args[1]-ea.args[0]),bytes:this.$WebWorker2.source.length});break;case 'terminate':this.terminate();break;case 'haste-error':this.terminate();this.$WebWorkere('haste_error',{message:ea.message});break;case 'console':var fa=ea.args.shift();t(p(['log','error','info','debug','warn'],fa));a.console[fa].apply(a.console,ea.args);break;}};y.prototype.$WebWorker9=function(ea){"use strict";t(p(y.states,ea));this.$WebWorkere('transition',{next_state:ea});this.$WebWorker1=ea;};y.prepareResource=function(ea,fa){"use strict";fa=fa||q;t(ea.sameOriginURL||ea.url||ea.source);t(!!y.isSupported());if(ea.sameOriginURL){fa();}else if(ea.url&&l(new k(ea.url),new k(a.location.href))){ea.sameOriginURL=ea.url;fa();}else if(ea.source){if(y.$WebWorkerk())ea.sameOriginURL=y.$WebWorkerl(ea.source);fa();}else if(!ea.loading){var ga=s();ea.loading=[fa];y.$WebWorkerm(ea.url,function(ha){if(ha){ea.source=ha;if(y.$WebWorkerk())ea.sameOriginURL=y.$WebWorkerl(ha);}y.$WebWorkere('prepared',ea.name,{dt:Math.floor(s()-ga),bytes:ha.length});ea.loading.forEach(function(ia){return ia();});ea.loading=false;});}else ea.loading.push(fa);return ea;};y.releaseResource=function(ea){"use strict";if(ea.sameOriginURL.indexOf('blob:')===0){if(x.revokeObjectURL)x.revokeObjectURL(ea.sameOriginURL);ea.sameOriginURL=null;}return ea;};y.isSupported=function(){"use strict";return ba&&(y.$WebWorkerk()||ca());};y.areTransferablesSupported=function(){"use strict";return y.isSupported()&&da();};y.$WebWorkerm=function(ea,fa){"use strict";new o(ea).setTransportBuilder(r).setMethod('GET').setResponseHandler(function(ga){fa(ga);}).setErrorHandler(fa.bind(null,null)).send();};y.$WebWorkerl=function(ea){"use strict";t(y.$WebWorkerk());if(y.$WebWorkerg()){var fa=i.getBlob([ea],{type:'application/javascript'});return x.createObjectURL(fa);}if(y.$WebWorkerh())return 'data:application/javascript,'+encodeURIComponent(ea);};y.$WebWorkerg=function(){"use strict";return i.isSupported()&&z();};y.$WebWorkerh=function(){"use strict";return aa();};y.$WebWorkerk=function(){"use strict";return y.$WebWorkerg()||y.$WebWorkerh();};y.$WebWorkere=function(event,ea,fa){"use strict";if(!h.logging.enabled)return;g.log(h.logging.config,v(fa,{features_array:y.$WebWorkerf(),event:event,resource:ea}));};var z=u(function(){var ea,fa;if(!x||!x.createObjectURL)return false;try{ea=x.createObjectURL(i.getBlob([''],{type:'application/javascript'}));var ha=new a.Worker(ea);ha.terminate();fa=true;}catch(ga){fa=false;}finally{if(x.revokeObjectURL)x.revokeObjectURL(ea);}return fa;}),aa=u(function(){var ea;try{var ga=new a.Worker('data:application/javascript,');ga.terminate();ea=true;}catch(fa){ea=false;}return ea;}),ba=!!a.Worker,ca=u(function(){var ea;try{var ga=new a.Worker(y.evalWorkerURL);ga.terminate();ea=true;}catch(fa){ea=false;}return ea;}),da=u(function(){var ea;try{var ga=new a.Worker(y.evalWorkerURL),ha=new ArrayBuffer(0);ga.postMessage({buffer:ha},[ha]);ga.terminate();ea=true;}catch(fa){ea=false;}return ea;});y.states=['constructed','preparing','executing','terminated'];y.evalWorkerURL=h.evalWorkerURL;e.exports=y;},null);
__d("PooledWebWorker",["WebWorker"],function(a,b,c,d,e,f,g){for(var h in g)if(g.hasOwnProperty(h))j[h]=g[h];var i=g===null?null:g.prototype;j.prototype=Object.create(i);j.prototype.constructor=j;j.__superConstructor__=g;function j(k,l,m){"use strict";i.constructor.call(this,m);this.$PooledWebWorker0=l;this.$PooledWebWorker1=k;}j.prototype.getIndex=function(){"use strict";return this.$PooledWebWorker0;};j.prototype.getPool=function(){"use strict";return this.$PooledWebWorker1;};e.exports=j;},null);
__d("WebWorkerPool",["PooledWebWorker","emptyFunction"],function(a,b,c,d,e,f,g,h){i.isSupported=function(){"use strict";return g.isSupported();};function i(j,k){"use strict";this.$WebWorkerPool0=[];for(var l=0;l<k;l++)this.$WebWorkerPool0.push(new g(this,l,j).setErrorHandler(this.$WebWorkerPool1).setMessageHandler(this.$WebWorkerPool2).execute());this.$WebWorkerPool3=0;}i.prototype.setMessageHandler=function(j){"use strict";this.$WebWorkerPool4=j||h;return this;};i.prototype.setAllowCrossPageTransition=function(j){"use strict";this.$WebWorkerPool0.forEach(function(k){return k.setAllowCrossPageTransition(j);});return this;};i.prototype.setErrorHandler=function(j){"use strict";this.$WebWorkerPool5=j||h;return this;};i.prototype.postMessage=function(){"use strict";for(var j=[],k=0,l=arguments.length;k<l;k++)j.push(arguments[k]);var m=this.getWorker();m.postMessage.apply(m,j);return m;};i.prototype.$WebWorkerPool2=function(){"use strict";for(var j=[],k=0,l=arguments.length;k<l;k++)j.push(arguments[k]);j.unshift(this);this.getPool().$WebWorkerPool4.apply(this.getPool(),j);};i.prototype.$WebWorkerPool1=function(){"use strict";for(var j=[],k=0,l=arguments.length;k<l;k++)j.push(arguments[k]);j.unshift(this);return this.getPool().$WebWorkerPool5.apply(this.getPool(),j);};i.prototype.getWorker=function(){"use strict";var j=this.$WebWorkerPool0[this.$WebWorkerPool3];this.$WebWorkerPool3=(this.$WebWorkerPool3+1)%this.$WebWorkerPool0.length;return j;};e.exports=i;},null);
__d("JpegResizer",["Emscripten","JpegResizerConfig","JpegResizeWorkerResource","WebWorker","WebWorkerPool","PUWErrorCodes"],function(a,b,c,d,e,f,g,h,i,j,k,l){var m=null;n.isSupported=function(){"use strict";return k.isSupported()&&g.isSupported()&&!h.isGKBlacklisted;};n.getSingleton=function(){"use strict";if(!m)m=new n(n.DEFAULT_POOL_SIZE).setAllowCrossPageTransition(true);return m;};n.prepareResource=function(o){"use strict";j.prepareResource(i,o);};function n(o){"use strict";o=o||n.DEFAULT_POOL_SIZE;j.prepareResource(i);this.$JpegResizer0=(new k(i,o)).setErrorHandler(this.$JpegResizer1.bind(this)).setMessageHandler(this.$JpegResizer2.bind(this));this.$JpegResizer3={};this.$JpegResizer4=n.DEFAULT_RESIZE_HEIGHT;this.$JpegResizer5=n.DEFAULT_RESIZE_WIDTH;}n.prototype.setHighQuality=function(o){"use strict";if(o){this.$JpegResizer4=n.DEFAULT_RESIZE_HEIGHT;this.$JpegResizer5=n.DEFAULT_RESIZE_WIDTH;}else{this.$JpegResizer4=n.LOW_QUALITY_RESIZE_HEIGHT;this.$JpegResizer5=n.LOW_QUALITY_RESIZE_WIDTH;}return this;};n.prototype.setAllowCrossPageTransition=function(o){"use strict";this.$JpegResizer0.setAllowCrossPageTransition(o);return this;};n.prototype.resizeBlob=function(o,p,q){"use strict";var r=this.$JpegResizer0.getWorker();if(r.isCurrentState('terminated')){var s=new Error('Worker terminated');s.code=l.WORKER_TERMINATED;p(s);return this;}var t=r.postMessage({blob:o,height:this.$JpegResizer4,width:this.$JpegResizer5}).getIndex();this.$JpegResizer6(t).unshift({done:p,progress:q});return this;};n.prototype.$JpegResizer6=function(o){"use strict";if(!this.$JpegResizer3.hasOwnProperty(o))this.$JpegResizer3[o]=[];return this.$JpegResizer3[o];};n.prototype.$JpegResizer1=function(o,p){"use strict";o.terminate();var q=this.$JpegResizer6(o.getIndex());this.$JpegResizer7(p);q.forEach(function(r){return r.done(p);});q.length=0;};n.prototype.$JpegResizer2=function(o,p){"use strict";if(p.error)this.$JpegResizer7(p.error);if(p.done){this.$JpegResizer6(o.getIndex()).pop().done(p.error,p.blob,p.skipped);}else{var q=this.$JpegResizer6(o.getIndex()),r=q[q.length-1].progress;if(r)r({written:p.written,total:p.total});}};n.prototype.$JpegResizer7=function(o){"use strict";var p=o.message;if(p.indexOf('Not a JPEG file')!==-1){o.code=l.BAD_JPEG;}else if(p.indexOf('abort()')!==-1){o.code=l.WORKER_ABORT;}else o.code=l.UNKNOWN_RESIZE_ERROR;};n.DEFAULT_POOL_SIZE=3;n.DEFAULT_RESIZE_HEIGHT=2048;n.DEFAULT_RESIZE_WIDTH=2048;n.LOW_QUALITY_RESIZE_HEIGHT=960;n.LOW_QUALITY_RESIZE_WIDTH=960;e.exports=n;},null);
__d("PhotoStoreCore",[],function(a,b,c,d,e,f){var g={actions:{UPDATE:'update'},_photoCache:{},_postCreateCallbacks:{},getPhotoCache:function(h){if(!this._photoCache[h])throw new Error('Photo cache requested for unknown set ID');return this._photoCache[h];},hasBeenCreated:function(h){return !!this._photoCache[h];},clearSetCache:function(h){delete this._photoCache[h];delete this._postCreateCallbacks[h];},getByIndex:function(h,i,j){this.getPhotoCache(h).getItemAtIndex(i,j);},getByIndexImmediate:function(h,i){if(this._photoCache[h])return this._photoCache[h].getItemAtIndexImmediate(i);return (void 0);},getItemsInAvailableRange:function(h){var i=this.getAvailableRange(h),j=[];for(var k=i.offset;k<i.length;k++)j.push(this.getByIndexImmediate(h,k));return j;},getItemsAfterIndex:function(h,i,j,k){var l=this.getCursorByIndexImmediate(h,i);this.fetchForward(h,l,j,k);},getAllByIDImmediate:function(h){var i=Object.keys(this._photoCache);return i.map(function(j){return this.getByIndexImmediate(j,this.getIndexForID(j,h));}.bind(this)).filter(function(j){return !!j;});},getIndexForID:function(h,i){if(this._photoCache[h])return this._photoCache[h].getIndexForID(i);return (void 0);},getEndIndex:function(h){var i=this.getAvailableRange(h);return i.offset+i.length-1;},getCursorByIndexImmediate:function(h,i){var j=this.getByIndexImmediate(h,i);if(j)return this._photoCache[h].getCursorForID(j.id);return (void 0);},hasNextPage:function(h){var i=this.getCursorByIndexImmediate(h,this.getEndIndex(h));return this.getPhotoCache(h).hasNextPage(i);},getAvailableRange:function(h){return this.getPhotoCache(h).getAvailableRange();},hasLooped:function(h){return this.getPhotoCache(h).hasLooped();},fetchForward:function(h,i,j,k){this.getPhotoCache(h).getItemsAfterCursor(i,j,k);},fetchBackward:function(h,i,j,k){this.getPhotoCache(h).getItemsBeforeCursor(i,j,k);},executePostCreate:function(h,i){if(this._photoCache[h]){i&&i();}else this._postCreateCallbacks[h]=i;},runPostCreateCallback:function(h){var i=this._postCreateCallbacks[h];if(i){i();delete this._postCreateCallbacks[h];}},setPreFetchCallback:function(h,i){this.getPhotoCache(h).setPreFetchCallback(i);},updateData:function(h){var i=h.set_id;if(!this._photoCache[i]){this._photoCache[i]=new h.cache_class(h);this.runPostCreateCallback(i);}else if(h.query_metadata.action==g.actions.UPDATE){this._photoCache[i].updateData(h);}else this._photoCache[i].addData(h);},updateFeedbackData:function(h){var i=Object.keys(h);i.forEach(function(j){return g.getAllByIDImmediate(j).forEach(function(k){k.feedback=h[j].feedback;});});},reset:function(){Object.keys(this._photoCache).forEach(function(h){return this.clearSetCache(h);}.bind(this));}};e.exports=g;},null);
__d("flashLog",["AsyncSignal","swfobject"],function(a,b,c,d,e,f,g,h){e.exports.logPlayerVersion=function(){var i={c:'flash_version_log',m:JSON.stringify({flashVer:h.SWFObjectUtil.getPlayerVersion()})};new g('/common/scribe_endpoint.php',i).send();};},null);
__d("GamesRecGrid",["CSS","DOM","Event","Run","BanzaiODS","csx"],function(a,b,c,d,e,f,g,h,i,j,k,l){var m={handleSeeMore:function(n,o){var p=i.listen(n,'click',function(){p.remove();p=null;g.hide(n);var q=h.find(o,"._bva");g.show(q);h.scry(o,"._2iny").forEach(function(r){g.show(r);});k.bumpEntityKey('platform_www','games_homepage_rhc_unit.expand');});j.onLeave(function(){p&&p.remove();});}};e.exports=m;},null);
__d("GamesGogglesSwitch",[],function(a,b,c,d,e,f){var g=false,h={enable:function(){g=true;},isEnabled:function(){return g;}};e.exports=h;},null);
__d("GamesImpressionTracker",["VisibilityTracking","throttle","Event","Banzai","Arbiter","cx","GamesGogglesSwitch"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n='data-gamesegoimp',o=1000;function p(v){if(m.isEnabled())v.className=v.className+" "+"_1z5y";}for(var q in g)if(g.hasOwnProperty(q))s[q]=g[q];var r=g===null?null:g.prototype;s.prototype=Object.create(r);s.prototype.constructor=s;s.__superConstructor__=g;function s(){"use strict";if(g!==null)g.apply(this,arguments);}s.prototype.handleEvent=function(v,event){"use strict";if(event.name===g.EVENT.VISIBLE){var w=v.getAttribute(n);v.removeAttribute(n);if(w){p(v);j.post('games_ego_imp',{data:w});}}};var t=new s({selector:'[data-gamesegoimp]',handleAllVisibleEvents:true,skipVisibilityHiddenEvents:true,cacheTrackedElements:true}),u=h.acrossTransitions(function(){return t.fireEventCallback();},o,null);t.listeners.addSubscriptions(i.listen(document,'mousemove',u),i.listen(document,'click',u),k.subscribe('games_unit_loaded',function(){return t.refreshAllTrackedElements();}));},null);
__d("GiftCredits",["AsyncRequest","Dialog","URI"],function(a,b,c,d,e,f,g,h,i){var j={dialog:null,callback:null,purchaseLock:false,purchaseLockExpiryThreshold:5000,purchaseLockTimeoutId:null,getPurchaseCreditPrompt:function(k,l,m,n){j.main(k,null,null,null,m,null,null,null,'BuyCredits',{},n);},redeemGiftcard:function(k,l,m){var n=i(document.location).setPath('/giftcards').toString();j.main(k,null,null,n,null,null,null,null,l,{},m);},getPrompt:function(k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha){j.main(k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha);},main:function(k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha){if(j.isPurchaseLocked())return false;j.setPurchaseLock(true);var ia={_path:'pay',method:'pay',display:'async',app_id:k,receiver:l,api_key:q,credits_purchase:x,action:s,next:n,dev_purchase_params:JSON.stringify(t),additional_params:JSON.stringify(u),order_info:JSON.stringify(m),product:v,package_id:w,request_id:y,sdk:z,quantity:aa,quantity_min:ba,quantity_max:ca,test_currency:da,pricepoint_id:ea,user:fa,user_hash:ga,ingame_gift_data:ha},ja=new g().setURI('/fbml/ajax/dialog/').setData(ia).setMethod('GET').setReadOnly(true).setStatusElement('commerce_get_more_loading');j.callback=o;j.dialog=new h().setAsync(ja).setModal(true).setCloseHandler(function(ka){j.setPurchaseLock(false);o(ka);}).show();},isPurchaseLocked:function(){return j.purchaseLock;},setPurchaseLock:function(k){j.purchaseLock=k;if(k){j.purchaseLockTimeoutId=setTimeout(function(){j.setPurchaseLock(false);},j.purchaseLockExpiryThreshold);}else clearTimeout(j.purchaseLockTimeoutId);return true;}};e.exports=j;},null);
__d("AppRequestReminders",["AsyncRequest","CSS","DOM","ge"],function(a,b,c,d,e,f,g,h,i,j){var k=0,l={},m=1,n=j('OtherAppReqReminder'),o=function(u,v,w){l[v]={node:u,seq:m++,reqCount:w};},p=function(u){k=u;},q=function(u){return u.id.split('_')[1];},r=function(u){var v=j(u),w=v.nextSibling;if(w!==n){h.show(w);k-=l[q(w)].reqCount;}s(k);},s=function(u){new g().setURI('/ajax/reminders/update_count.php').setData({new_count:u}).setMethod('POST').send();},t=function(u,v){if(n&&v&&u>0){i.setContent(j('OtherAppReqLabel'),v);}else if(n){h.hide(n);}else h.hide(j('OtherAppReqReminder'));};f.initNode=o;f.handleRemove=r;f.updateCount=t;f.setTotalOtherCount=p;},null);
__d("TickerReadStateTracking",["Style","clickRefAction"],function(a,b,c,d,e,f,g,h){var i=73,j='ticker_hover',k=[];function l(n){if(!n)return null;var o=JSON.parse(n.getAttribute('data-ft'));if(!o)return null;if(o.mf_story_key)return o.mf_story_key;if(o.fbid)return o.fbid;return null;}function m(n){var o=l(n);if(!o||o in k)return;k[o]=true;var p={evt:i};h(j,n,null,'FORCE',{ft:p});}e.exports.log=m;},null);
__d("TickerController",["Event","Animation","Arbiter","AsyncRequest","AsyncSignal","Bootloader","ChannelConstants","LegacyContextualDialog","CSS","DOM","HTML","JSLogger","Keys","LayerFadeOnHide","LiveTimer","NavigationMessage","Parent","Rect","Run","ScrollableArea","SelectorDeprecated","Style","TickerReadStateTracking","Toggler","UIPagelet","URI","UserActivity","UserAgent_DEPRECATED","Vector","DOMVector","BanzaiODS","$","clickRefAction","collectDataAttributes","containsNode","copyProperties","cx","csx","ex","emptyFunction","ge","getElementText","goURI","throttle","tickerPhoteSnowLiftOpenStatus"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma,na,oa,pa,qa,ra,sa,ta,ua,va,wa,xa,ya){var za=1,ab=2,bb=3,cb=4,db=15000,eb=r.create('ticker_controller');function fb(gb,hb,ib){if(gb===(void 0))return;fb._instances[gb.id]=this;fb._activeInstance=this;this._root=gb;this._content=p.find(gb,'.ticker_stream');this._stories=p.find(this._root,'.tickerActivityStories');this._scrollableArea=hb;this._container=p.find(gb,'div.uiScrollableAreaWrap');this._newestStory={};this._storyIDs=[];this._objectIDs=[];this._fetchedStories={};this._fetchedStoriesDialog={};this._storyDialogResources={};this._removedStoryIDs=[];this._storiesToRemove=[];var jb=Date.now();this._initTime=jb;this._lastUpdate=jb;this._lastPull=jb;this._lastInsert=jb;this._lastCustomStory=0;this._pollOnly=false;this._needNonCustomStoryNum=0;this._doCustomUpdate=true;this._autoloadStoryIndex=1;this._scrollTopThreshold=100;this._scrollTopPrompt=p.find(this._root,'.scrollTopPrompt');this._scrollTopPromptVisible=false;this._maxStoriesToKeep=50;this._minStoriesToKeep=25;this._tickerInSidebarMode=!!w.byClass(this._root,'fbChatSidebar');this._loadStoriesWithActions();ma('ticker_flyout');ma('ticker_flyout_prefetch');ma('ticker_flyout_loadtime');ma('ticker_stream');this._uaCurStoryIDFetch=null;this._uaCurStoryIDPrefetch=null;var kb=p.create('div',{className:'storyQueue hidden_elem'});this._storyQueue=kb;p.appendContent(this._root,kb);this._lastKStories={head:null,tail:null,count:0,actors:{},apps:{},stories:{}};this._dedupeKeys={};this._initObjectIDs();this._initConfig(ib);this._resetMorePager();this._initListeners();this._initSubscriptions(ib);i.inform('ticker/init',this,i.BEHAVIOR_PERSISTENT);this._poll();}pa(fb,{_instances:{},_activeInstance:null,_placeholders:{},getInstance:function(gb){var hb=w.byClass(la(gb),'fbFeedTicker');return hb?fb._instances[hb.id]:null;},isLoaded:function(gb){var hb=fb._placeholders[gb.id];return !hb||hb.status==bb;},show:function(gb,hb){hb=hb||ta;for(var ib in fb._instances){var jb=ua(ib);if(!jb||jb.parentNode.id==gb.id)continue;fb.hide(jb.parentNode);}fb._doPositionChange(gb);o.show(gb);var kb=fb._placeholders[gb.id];if(kb&&kb.status==za){var lb=(ia.getElementDimensions(gb).y||0)>0,mb=gb.id==='pagelet_rhc_ticker'&&!o.hasClass(gb,'hidden_rhc_ticker');if(lb||mb){fb._fetchTickerForPlaceholder(gb,hb);}else i.subscribe('Ticker/resized',function(){if(kb.status==za)fb._fetchTickerForPlaceholder(gb,hb);});}else{var nb=p.scry(gb,'.fbFeedTicker')[0],ob=nb&&fb.getInstance(nb);fb._activeInstance=ob;ob&&ob._poll();fb._placeholders[gb.id]={status:cb,callback:hb};hb();}i.inform('ticker/show',{node:gb,callback:hb});},_doPositionChange:function(gb){if(o.shown(gb))return;new k('/common/ods_endpoint.php',{k:'ticker.render.switch.'+gb.id}).send();},hide:function(gb){var hb=p.scry(gb,'.fbFeedTicker')[0],ib=hb&&fb.getInstance(hb);ib&&ib.hideActiveStory();o.hide(gb);},hideStoriesByClass:function(gb){for(var hb in fb._instances)p.scry(la(hb),gb).forEach(o.hide);},hideStory:function(gb){var hb=gb&&fb.getInstance(gb);hb&&hb.hideStory(gb);},replaceStory:function(gb,hb){var ib=p.scry(document.body,'div.fbFeedTickerStory'),jb=fb.getInstance(ib[0]),kb=jb._findStoryById(gb);jb.handleRemoveStory();o.hide(kb);p.insertAfter(kb,hb);hb.setAttribute('data-story-id',kb.getAttribute('id'));var lb=setTimeout(function(){fb.removeMarkup(hb,kb);},db);hb.setAttribute('data-timeout-token',lb);},removeMarkup:function(gb,hb){o.addClass(gb,'removedStoryMarkup');new h(gb).to('height',0).duration(500).ondone(function(){p.remove(gb);}).go();},undoHideStory:function(gb){var hb=gb&&fb.getInstance(gb);hb&&hb.undoHideStory(gb);},insertStoriesAtBottom:function(gb){fb._activeInstance.insertStoriesAtBottom(gb);},_fetchTickerForPlaceholder:function(gb,hb){var ib={handler:function(){fb._placeholders[gb.id].status=bb;hb();}};ea.loadFromEndpoint('TickerEntStoryPagelet',gb.id,fb._placeholders[gb.id].pageletData,ib);fb._placeholders[gb.id].status=ab;},registerStoryDialog:function(gb,hb){i.subscribe('ticker/init',function(){var ib=ua(gb),jb=ib&&fb.getInstance(ib);jb&&jb.registerStoryDialog(ib,hb);},i.SUBSCRIBE_ALL);},registerPlaceholder:function(gb,hb){var ib=fb._placeholders[gb];fb._placeholders[gb]={status:za,pageletData:hb};if(ib&&ib.status==cb){fb.show(la(gb));ib.callback();}}});pa(fb.prototype,{ADS_IDLE_MS:300000,FLYOUT_MAX_HEIGHT:450,FLYOUT_OFFSET_THRESHOLD:20,FLYOUT_COMMENT_OFFSET:15,FLYOUT_VIEWPORT_PADDING:75,FLYOUT_ACTION_FOOTER_PADDING:8,FLYOUT_TARGET_HEIGHT_OFFSET:25,DEFAULT_LOOK_BEHIND:10,init:function(gb,hb,ib){new fb(gb,hb,ib);},_lastKStoriesInsert:function(gb){this._lastKStories.stories[gb.getAttribute("data-story-key")]=true;var hb={story:gb,next:null};if(this._lastKStories.head)this._lastKStories.head.next=hb;this._lastKStories.head=hb;this._lastKStories.count++;if(!this._lastKStories.tail)this._lastKStories.tail=this._lastKStories.head;var ib=gb.getAttribute("data-actor");if(!this._lastKStories.actors[ib])this._lastKStories.actors[ib]=0;this._lastKStories.actors[ib]++;var jb=gb.getAttribute("data-app");if(jb){if(!this._lastKStories.apps[jb])this._lastKStories.apps[jb]=0;this._lastKStories.apps[jb]++;}if(this._lastKStories.count>this.DEFAULT_LOOK_BEHIND){while(this._lastKStories.tail&&!this._lastKStoriesRemove(this._lastKStories.tail.story))this._lastKStories.tail=this._lastKStories.tail.next;if(!this._lastKStories.tail)this._lastKStories.head=null;}},_lastKStoriesRemove:function(gb){var hb=gb.getAttribute("data-story-key"),ib=gb.getAttribute("data-actor"),jb=gb.getAttribute("data-app");if(this._lastKStories.stories[hb]){delete this._lastKStories.stories[hb];this._lastKStories.actors[ib]--;if(jb)this._lastKStories.apps[jb]--;this._lastKStories.count--;return true;}else return false;},_loadStoriesWithActions:function(){var gb=ua('rightCol');if(!gb)return;this._toggleWrapper=p.scry(gb,'.tickerToggleWrapper')[0];if(this._toggleWrapper){var hb=p.scry(this._stories,'.tickerStoryWithButton');this._storiesWithActions={};for(var ib=0;ib<hb.length;ib++){var jb=hb[ib];this._storiesWithActions[jb.getAttribute('data-story-key')]=jb;}}},_initConfig:function(gb){pa(this,{_newest:gb.newest,_page_newest:gb.newest,_timeout:gb.timeout,_heartbeatTimeout:Math.min(5000,gb.heartbeatTimeout),_maxHeartbeatTimeout:Math.max(30000,gb.maxHeartbeatTimeout),_pullTimeout:Math.max(30000,gb.pullTimeout),_insertTimeout:gb.insertTimeout,_friendCount:gb.friendCount,_maxQueueLength:gb.maxQueueLength,_heartbeatEndpoint:gb.heartbeatEndpoint,_maxCustomQueueLength:gb.maxCustomQueueLength,_customStoryInsertTimeout:Math.max(5000,gb.customStoryInsertTimeout),_nonCustomToCustomStoryRatio:gb.nonCustomToCustomStoryRatio,_minForceUpdateInterval:Math.max(gb.insertTimeout,gb.minForceUpdateInterval),_popupOnHover:gb.popupOnHover,_priorityAppId:gb.priorityAppId,_userIdleTimeout:gb.userIdleTimeout,_firstCustomStoryDelay:gb.firstCustomStoryDelay,_pollOnly:gb.pollOnly,_tickerSource:gb.tickerSource,_logFlyouts:gb.logFlyouts,_userScrollGaurdDelay:gb.userScrollGaurdDelay,_rescheduleScrollToTopDelay:gb.rescheduleScrollToTopDelay,_aggressiveRegulator:gb.aggressiveRegulator});this._queueCustomStories(gb.customStories);},_initListeners:function(){this._listeners=g.listen(this._root,{click:this._handleClick.bind(this),keydown:this._handleKeydown.bind(this),mouseout:this._handleMouseout.bind(this),mouseover:this._handleMouseover.bind(this),mousedown:this._tickerDeClicker.bind(this),mouseup:this._handleMouseup.bind(this)});this._listeners.scroll=g.listen(this._container,'scroll',this._handleScroll.bind(this));setTimeout(this._initInfiniteScrollListener.bind(this),0);},_initSubscriptions:function(gb){y.onLeave(this._cleanup.bind(this));this._subscriptions=[i.subscribe(v.NAVIGATION_BEGIN,this._onNavHandler.bind(this)),i.subscribe('composer/publish',this._handleComposerPublish.bind(this)),i.subscribe('Ticker/storiesInserted',this._handleStoriesInserted.bind(this)),i.subscribe('Ticker/fixed',this._setFixed.bind(this,true)),i.subscribe('Ticker/unfixed',this._setFixed.bind(this,false)),i.subscribe('Ticker/resized',this._checkInfiniteScroll.bind(this)),i.subscribe('ufi/comment',this._scrollDialogToBottom.bind(this)),i.subscribe('ufi/changed',this._redrawFlyout.bind(this)),i.subscribe('Ticker/chatOpened',this._handleChatOpened.bind(this))];if(!gb.pollOnly)this._subscriptions.push(i.subscribe(m.getArbiterType('ticker_update'),this._handleTickerPush.bind(this)));if(gb.pushChannel&&!gb.pollOnly)this.setPushChannel(gb.pushChannel);},_handleClick:function(event){if(!(event.button===1||event.altKey||event.ctrlKey||event.metaKey))event.prevent();var gb=event.getTarget();if(this._getButtonFromNode(gb)){this._logUserAction(gb,'click',event);this._handleActionButton(event);return;}var hb=this._getStoryFromNode(gb),ib=w.byClass(gb,'tickerStoryAllowClick');if(!hb||hb==this._selectedStory||ib)return;if(this._storyIsHidden(hb))return;if(hb==this._activeStory&&!this._selectedStory)this._selecting=true;if(this._storyCanOpenExternally(hb)){var jb=hb.getAttribute('data-href');if(jb&&!gb.getAttribute('href')){var kb={href:jb},lb=na(gb,['ft','gt']);ma('click',kb,event,'FORCE',lb);}else this._logUserAction(gb,'click',event);this._openStoryExternally(hb,event);return;}this._logUserAction(gb,'flyout',event);this._activateStory(hb,'click');this._selectStory(hb);},_handleMouseover:function(event){this._setLocked(true);var gb=event.getTarget(),hb=this._getOpenableStory(gb);if(!hb){var ib=w.byClass(gb,"_5wvy");if(ib){clearTimeout(parseInt(ib.getAttribute('data-timeout-token'),10));var jb=setTimeout(function(){fb.removeMarkup(ib,hb);},db);ib.setAttribute('data-timeout-token',jb);}return;}event.kill();if(this._popupOnHover){if(!(hb.id in this._fetchedStories))this._uaCurStoryIDPrefetch=hb.id;this._fetchStory(hb);}if(this._selectedStory)return;if(this._popupOnHover){this._clearHoverTimeouts();var kb=this._storyCanOpenExternally(hb)?500:1000,lb=this._activeStory?75:kb;this._hoverShowTimeout=this._setTimeout(function(){this._activateStory(hb,'hover');this._logUserAction(gb,'flyout',event);}.bind(this),lb);}},_handleMouseout:function(event){var gb=event.getTarget();this._setLocked(false);if(gb==this._getStoryFromNode(gb)){var hb=p.scry(gb.parentNode,'.openToggler');for(var ib=0;ib<hb.length;ib++)aa.toggle(hb[ib]);}this._clearClickedStory();this._scheduleHide();},_handleKeydown:function(event){this._tickerDeClicker(event);var gb=this._activeStory;if(!gb)return;var hb=g.getKeyCode(event);switch(hb){case s.UP:case s.DOWN:var ib=this._getInsertedStories(),jb;if(event.getModifiers().any){jb=hb===s.UP?0:ib.length-1;}else jb=ib.indexOf(gb)+(hb===s.UP?-1:1);gb=ib[jb];break;case s.ESC:this._deactivateStory(true);return;default:return;}event.kill();if(!gb)return;this._activateStory(gb,'keypress');this._selectStory(gb);},_fadeTopmostStoryButton:function(){var gb=0,hb=15;if(this._storiesWithActions)for(var ib in this._storiesWithActions){var jb=this._storiesWithActions[ib],kb=p.scry(jb,'.tickerInlineActionButton')[0],lb=p.scry(kb,'.tickerActionIcon')[0],mb=ia.getElementPosition(kb).y-ia.getElementPosition(this._toggleWrapper).y;if(mb<gb){ba.set(kb,'opacity',0);ba.set(lb,'opacity',0);}else if(mb>=gb&&mb<hb){var nb=(mb-gb)/(hb-gb);ba.set(kb,'opacity',nb);ba.set(lb,'opacity',nb);break;}else{ba.set(kb,'opacity',1);ba.set(lb,'opacity',1);}}},_handleScroll:function(){var gb=ya.checkIsOpen();if(gb)this._preventFlyoutDismiss=true;if(!this._preventScrollDismiss&&!gb){if(!this._preventFlyoutDismiss){this._deactivateStory(true);}else this._preventFlyoutDismiss=false;}else this._preventScrollDismiss=false;if(!this._handleScrollThrottled)this._handleScrollThrottled=xa(this._handleScrollInner.bind(this));this._handleScrollThrottled();},_handleScrollInner:function(){this._fadeTopmostStoryButton();this._checkInfiniteScroll();this._setIsUserScrolling();if(!this._scrollLogged){this._scrollLogged=true;var gb=this._stories.childNodes.length,hb=this._stories.getAttribute('data-gt'),ib={ticker_scroll:1,number_stories:gb,source:hb};ma('scroll',null,null,'FORCE',{gt:ib});}},_setIsUserScrolling:function(){clearTimeout(this._userScrollingToken);if(this._isScrolledToTop()){this._userScrolling=false;return;}this._userScrolling=true;this._userScrollingToken=setTimeout(function(){this._userScrolling=false;this._userScrollingToken=null;}.bind(this),this._userScrollGaurdDelay);},_isUserScrolling:function(){return this._userScrolling;},_handleStoriesInserted:function(){this._initInfiniteScrollListener();if(this._scrollableArea instanceof z){this._scrollableArea.adjustGripper();}else eb.error('wrong_scrollable_area',{dump:this});},_handleActionButton:function(event){var gb=event.getTarget(),hb=this._getOpenableStory(gb),ib=this._getStoryDialog(hb);if(ib)var jb=ib.subscribe('beforehide',function(){ib.unsubscribe(jb);return false;});},_handleScrollToTopClick:function(){this._scrollToTop(this._poll.bind(this));},_scheduleScrollToTop:function(){this._scrollToTopToken&&clearTimeout(this._scrollToTopToken);this._scrollToTopToken=setTimeout(function(){if(this._isLocked()||this._isUserScrolling()){this._scheduleScrollToTop();}else{this._scrollToTopToken=null;this._scrollToTop();}}.bind(this),this._rescheduleScrollToTopDelay);},_scrollToTop:function(gb){new h(this._container).to('scrollTop',0).ease(h.ease.end).ondone(gb).go();},_clearHoverTimeouts:function(){clearTimeout(this._hoverShowTimeout);clearTimeout(this._hoverHideTimeout);},_getAllStories:function(){return p.scry(this._root,'div.fbFeedTickerStory');},_findStoryById:function(gb){var hb=p.scry(this._root,'.fbFeedTickerStory'),ib;for(story in hb){ib=hb[story];if(gb==this._getStoryDialogParams(ib).token)return ib;}return null;},_getInsertedStories:function(){return this._getAllStories().filter(function(gb){return !o.hasClass(gb,'queuedStory')&&!o.hasClass(gb,'customStory');});},_getQueuedStories:function(){return p.scry(this._storyQueue,'.fbFeedTickerStory.queuedStory');},_getQueuedCustomStories:function(){return p.scry(this._storyQueue,'.fbFeedTickerStory.customStory');},_getButtonFromNode:function(gb){return w.byClass(gb,'tickerInlineOverlay');},_getStoryFromNode:function(gb){return w.byClass(gb,'fbFeedTickerStory');},_getActionButtonFromStory:function(gb){return p.scry(gb,'.tickerInlineActionButton')[0];},_getOpenableStory:function(gb){var hb=this._getStoryFromNode(gb);return this._storyCanOpenDialog(hb)?hb:null;},_getStoryDialog:function(gb){return this._fetchedStoriesDialog[gb.id]||n.getInstance(gb);},_getStoryDialogParams:function(gb){var hb=gb&&gb.getAttribute('data-flyoutdata')||null;return hb&&JSON.parse(hb)||null;},_storyCanOpenDialog:function(gb){return !!this._getStoryDialogParams(gb)&&!this._storyIsHidden(gb);},_storyCanOpenExternally:function(gb){return !!gb.getAttribute('data-href')||!this._storyCanOpenDialog(gb);},_storyIsHidden:function(gb){return o.hasClass(gb,'tickerStoryHidden');},hideActiveStory:function(){this._activeStory&&this.hideStory(this._activeStory);},hideStory:function(gb){this._deactivateStory();if(va(gb)==='')p.remove(gb);o.addClass(gb,'tickerStoryHidden');o.removeClass(gb,'tickerStoryClickable');},undoHideStory:function(gb){o.addClass(gb,'tickerStoryClickable');o.removeClass(gb,'tickerStoryHidden');},insertStoriesAtBottom:function(gb){if(!gb)return;var hb=p.create('div');hb.appendChild(gb);var ib=p.scry(hb,'.fbFeedTickerStory'),jb=p.find(hb,'.tickerMorePager'),kb=[];for(var lb=0;lb<ib.length;lb++)if(!this.dedupeStory(ib[lb]))kb.push(ib[lb]);if(kb.length){kb.push(jb);p.replace(p.find(this._root,'.tickerMorePager'),kb);}i.inform('Ticker/storiesInserted');},_scheduleHide:function(){if(this._popupOnHover&&!this._selectedStory){this._clearHoverTimeouts();this._hoverHideTimeout=this._setTimeout(this._deactivateStory.bind(this),100);}},_setScrollTopPromptVisible:function(gb){this._scrollTopPromptVisible=gb;o.conditionShow(this._scrollTopPrompt,gb);if(gb&&!this._listeners.scrollTop){this._listeners.scrollTop=g.listen(this._scrollTopPrompt,{click:this._handleScrollToTopClick.bind(this)});}else if(!gb&&this._listeners.scrollTop){this._listeners.scrollTop.click.remove();this._listeners.scrollTop=null;}},_isUserIdle:function(){return !ga.isActive(this._userIdleTimeout);},_schedulePoll:function(){clearTimeout(this._pollToken);this._pollToken=this._setTimeout(this._poll.bind(this),this._timeout);},_poll:function(){if(!this._isTickerVisible())return;if(this._storiesToRemove.length>0){if(this._isInsertingStory)return this._schedulePoll();var gb=this._storiesToRemove.pop();this.removeStory(gb);}var hb=!this._isScrolledToTop()&&this._getQueuedStories().length;this._setScrollTopPromptVisible(hb);var ib=Date.now(),jb=ib-this._lastInsert;if(jb<this._insertTimeout||this._isLocked())return this._schedulePoll();var kb=this._getQueuedStories(),lb=this._getQueuedCustomStories(),mb=this._isUserIdle(),nb=kb.length>0,ob=lb.length>0&&!mb&&(ib-this._initTime>this._firstCustomStoryDelay)&&(this._needNonCustomStoryNum===0||(!nb&&(ib-this._lastCustomStory)>this._customStoryInsertTimeout));if(ob){this.insertStory(lb.shift());this._lastCustomStory=ib;this._needNonCustomStoryNum=this._nonCustomToCustomStoryRatio;return this._schedulePoll();}if(nb){var pb=kb.shift();this.insertStory(pb);this._needNonCustomStoryNum--;if(this._needNonCustomStoryNum<0)this._needNonCustomStoryNum=0;return this._schedulePoll();}if(mb)return ga.subscribeOnce(this._poll.bind(this));var qb=lb.length===0&&this._needNonCustomStoryNum===0&&this._nonCustomToCustomStoryRatio>0&&ga.isActive(this.ADS_IDLE_MS)&&((ib-this._lastUpdate)>this._minForceUpdateInterval),rb=false,sb=false;if(this._pollOnly){sb=ib-this._lastUpdate>this._heartbeatTimeout;}else rb=(ib-this._lastPull>this._pullTimeout);var tb=(qb&&this._doCustomUpdate)||rb||sb;if(!tb)return this._schedulePoll();if(qb)this._doCustomUpdate=false;this.update({pull:rb,fullpoll:sb,needcustomstory:qb});},_updatePollOnlyHeartbeatTimeout:function(){if(this._pollOnly&&this._heartbeatTimeout<this._maxHeartbeatTimeout)this._heartbeatTimeout=Math.min(this._heartbeatTimeout+5000,this._maxHeartbeatTimeout);},update:function(gb){this._updatePollOnlyHeartbeatTimeout();if(!this._pollOnly)return this._schedulePoll();var hb={newest:(gb.fullpoll||gb.cache_update)?this._newest:this._page_newest,storyids:this._storyIDs,friendcount:this._friendCount,priorityappid:this._priorityAppId,source:this._tickerSource,needcustomstory:this._nonCustomToCustomStoryRatio>0};if(!hb.newest||hb.newest==='0')throw new Error(sa('Trying to request new ticker stories with an invalid cursor %s, with'+' the settings fullpoll %s, cache_update %s, value coming from this.%s',typeof hb.newest==='string'?'"'+hb.newest+'"':hb.newest,gb.fullpoll,gb.cache_update,(gb.fullpoll||gb.cache_update)?'_newest':'_page_newest'));pa(hb,gb);new j().setURI(this._heartbeatEndpoint).setReadOnly(true).setOption('retries',0).setData(hb).setHandler(this._handleResponse.bind(this)).setFinallyHandler(this._poll.bind(this)).setAllowCrossPageTransition(true).send();this._lastUpdate=Date.now();if(hb.pull)this._lastPull=this._lastUpdate;this._storyIDs=[];},insertStory:function(gb,hb,ib){this._lastInsert=Date.now();window.LiveTimer&&u.addTimeStamps(gb);o.removeClass(gb,'queuedStory');o.removeClass(gb,'customStory');if(hb!==false){var jb=ib?this._fadeStoryIn:this._flyStoryIn;if(this._isUserScrolling()){var kb=function(){this._container.scrollTop=this._container.scrollTop+this._stories.firstChild.offsetHeight;this._scheduleScrollToTop();}.bind(this);this._fadeStoryIn(gb,kb);}else this._scrollToTop(jb.bind(this,gb));}else p.prependContent(this._stories,gb);if(this._storiesWithActions&&o.hasClass(gb,'tickerStoryWithButton'))this._storiesWithActions[gb.getAttribute('data-story-key')]=gb;this._removeOldStories();},_removeOldStories:function(){var gb=this._getInsertedStories();if(gb.length<=this._maxStoriesToKeep)return;var hb=this._minStoriesToKeep,ib=gb.slice(hb);ib.forEach(p.remove);if(this._storiesWithActions)for(var jb=0;jb<ib.length;jb++)delete this._storiesWithActions[ib[jb].getAttribute('data-story-key')];this._resetMorePager();},_resetMorePager:function(){var gb=this._getInsertedStories();if(!gb||!gb.length)return;var hb=gb[gb.length-1].getAttribute('data-ticker-timestamp'),ib=p.scry(this._root,'.tickerMorePager a')[0];if(!ib||!hb)return;var jb=new fa(ib.getAttribute('ajaxify'));jb.addQueryData({oldest:hb});ib.setAttribute('ajaxify',jb);},_setLocked:function(gb){this._locked=gb;},_isLocked:function(){return !!(this._locked||this._activeStory);},informAndRemoveStory:function(gb,hb,ib){var jb=this._getStoryFromNode(gb),kb=jb.getAttribute('data-story-key');p.setContent(jb,hb);o.addClass(jb,'highlightedStory');this._setTimeout(this.removeStory.bind(this,kb),ib||6000);},_getStoryByStoryKey:function(gb){var hb=this._getAllStories();for(var ib=0;ib<hb.length;ib++){var jb=hb[ib];if(jb.getAttribute('data-story-key')==gb)return jb;}return null;},removeStory:function(gb){this._removedStoryIDs[gb]=true;var hb=this._getStoryByStoryKey(gb);if(!hb)return;if(this._storiesWithActions)delete this._storiesWithActions[gb];if(hb==this._activeStory)this._deactivateStory();var ib=this._getStoryDialog(hb);ib&&ib.destroy();this._lastKStoriesRemove(hb);var jb=hb.getAttribute("data-dedupe-key");if(jb)delete this._dedupeKeys[jb];if(o.hasClass(hb,'queuedStory')){p.remove(hb);return;}this._animateStoryOut(hb);},_isScrolledToTop:function(){return this._container.scrollTop<=this._scrollTopThreshold;},_flyStoryIn:function(gb){var hb=p.create('div',{style:{marginTop:'-1000px'}},gb);ba.set(hb,'opacity',0);p.prependContent(this._stories,hb);var ib=ia.getElementDimensions(hb).y;ba.set(hb,'marginTop','-'+ib+'px');this._isInsertingStory=true;new h(hb).to('marginTop',0).ease(h.ease.end).checkpoint(.5).to('opacity',1).ondone(function(){p.replace(hb,gb);this._afterInsert(gb);this._isInsertingStory=false;}.bind(this)).go();},_fadeStoryIn:function(gb,hb){new h(this._stories).to('opacity',.5).ondone(function(){p.prependContent(this._stories,gb);if(hb)hb();new h(this._stories).to('opacity',1).ondone(function(){this._afterInsert(gb);}.bind(this)).go();}.bind(this)).go();},_animateStoryOut:function(gb){var hb=p.create('div',{style:{overflow:'hidden',position:'relative'}});p.insertBefore(gb,hb);p.appendContent(hb,gb);new h(hb).to('top',20).to('height',0).to('opacity',0).ease(h.ease.end).ondone(function(){p.remove(hb);i.inform('Ticker/animateOut');}.bind(this)).go();},_afterInsert:function(gb){i.inform('Ticker/afterInsert');},setPushChannel:function(gb){this._pushSubscription&&this._pushSubscription.unsubscribe();this._pushSubscription=i.subscribe(m.getArbiterType(gb),this._handleTickerPush.bind(this));d(['ChatConfig','ChannelConnection'],function(hb,ib){this._channelConnection=ib;this._checkChannelConnection();this._channelConnectionSubscription=this._channelConnection.subscribe([this._channelConnection.CONNECTED,this._channelConnection.RECONNECTING,this._channelConnection.SHUTDOWN,this._channelConnection.MUTE_WARNING,this._channelConnection.UNMUTE_WARNING],this._handleChannelConnection.bind(this));}.bind(this));},_checkChannelConnection:function(){o.conditionClass(this._root,'disconnected',this._channelConnection.disconnected());},setCurrentAppId:function(gb){this._priorityAppId=gb;},_handleTickerPush:function(gb,hb){var ib=hb.obj;if(ib.delete_id){this._storiesToRemove.push(ib.delete_id);return;}if(ib.fromups)if(ib.do_logging)this._logDarkLaunch(ib);var jb=ib.story_xhp;if(!jb)return;var kb=q(jb).getRootNode();if(!ib.story_time||ib.story_time==='0')throw new Error(sa('An invalid story time was pushed: %s, for ticker story: %s',typeof ib.story_time==='string'?'"'+ib.story_time+'"':ib.story_time,kb.getAttribute('data-flyoutdata')));this._newest=ib.story_time;this.queueStory(kb,ib.flyout_js_cmds);if(this._aggressiveRegulator&&ib.actor==this._newestStory.actorID){this.removeStory(this._newestStory.storyKey);new k('/common/ods_endpoint.php',{k:'ticker.aggr.remove'}).send();}this._newestStory={actorID:ib.actor,storyKey:kb.getAttribute('data-story-key')};},_handleComposerPublish:function(gb,hb){hb.tickerMarkup&&this.insertStory(hb.tickerMarkup);},_logDarkLaunch:function(gb){var hb={actor:gb.actor,story_time:gb.story_time,key:gb.story_obj_id,dark:1};new j().setURI('/alite/push/log.php').setData({msg:JSON.stringify(hb)}).send();},_logRender:function(){if(this._loggedRender)return;var gb=this._tickerInSidebarMode;if(gb||w.byClass(this._content,'home_right_column')){new k('/ajax/log_ticker_render.php',{sidebar_mode:gb}).send();this._loggedRender=true;}},_isTickerVisible:function(){var gb=(fb._activeInstance==this);gb&&this._logRender();return gb;},_handleResponse:function(gb){var hb=gb.getPayload();if(hb.newest)this._newest=this._page_newest=hb.newest;if(hb.content)if(hb.content instanceof Array){for(var ib=0;ib<hb.content.length;ib++)this.queueStoryMarkup(hb.content[ib]);}else this.queueStoryMarkup(hb.content);if(hb.custom_stories&&hb.custom_stories.length){this._queueCustomStories(hb.custom_stories);this._doCustomUpdate=true;}},queueStoryMarkup:function(gb){var hb=q(gb).getRootNode();this.queueStory(hb);},dedupeStory:function(gb){var hb=gb.getAttribute('data-story-key'),ib=hb&&(!!this._objectIDs[hb]||!!this._removedStoryIDs[hb]);ib=ib||!!this._lastKStories.actors[gb.getAttribute('data-actor')]||!!this._lastKStories.apps[gb.getAttribute('data-app')];var jb=gb.getAttribute('data-dedupe-key');ib=ib||jb&&this._dedupeKeys[jb];if(gb.getAttribute('data-force-push'))ib=false;hb&&(this._objectIDs[hb]=true);return ib;},queueStory:function(gb,hb){if(this.dedupeStory(gb))return;this._lastKStoriesInsert(gb);var ib=gb.getAttribute("data-dedupe-key");if(ib)this._dedupeKeys[ib]=true;o.addClass(gb,'queuedStory');p.appendContent(this._storyQueue,gb);var jb=hb&&hb.length;if(jb)hb.forEach(function(lb){new Function(lb).apply();});gb.setAttribute('id',gb.id+'_'+this._root.id);var kb=this._getQueuedStories();kb.slice(0,-this._maxQueueLength).forEach(p.remove);if(jb)this._fetchedStories[gb.id]=true;},_queueCustomStories:function(gb){while(gb.length){var hb=gb.shift();hb=q(hb).getRootNode();if(this.dedupeStory(hb))continue;o.addClass(hb,'customStory');p.appendContent(this._storyQueue,hb);}var ib=this._getQueuedCustomStories();ib.slice(0,-this._maxQueueLength).forEach(p.remove);},_cleanup:function(){fb._placeholders.pagelet_rhc_ticker=null;if(!w.byClass(this._content,'hasRightCol'))return;this._objectIDs=[];this._subscriptions.forEach(i.unsubscribe);this._channelConnectionSubscription&&this._channelConnection.unsubscribe(this._channelConnectionSubscription);this._pushSubscription&&this._pushSubscription.unsubscribe();for(var gb in this._listeners)this._listeners[gb]&&this._listeners[gb].remove();clearTimeout(this._pollToken);this._pollToken=null;this._cleanupInputFocusListener();this._cleanupContentResizeListener();i.inform('Ticker/cleanup');},_onNavHandler:function(gb,hb){var ib=hb.params.key;if(ib!='lf'&&ib!='h')this._cleanup();},registerStoryDialog:function(gb,hb){if(this._uaCurStoryIDFetch==gb.id)this._uaCurStoryIDFetch=null;if(this._uaCurStoryIDPrefetch==gb.id)this._uaCurStoryIDPrefetch=null;this._fetchedStories[gb.id]=true;this._fetchedStoriesDialog[gb.id]=hb;hb.setContext(gb);hb.subscribe('hide',this._deactivateStory.bind(this,true));hb.subscribe('success',this._focusStory.bind(this,gb));hb.subscribe('beforehide',function(){if(this._selecting){this._selecting=false;return false;}}.bind(this));if(this._popupOnHover){hb.subscribe('mouseenter',this._clearHoverTimeouts.bind(this));hb.subscribe('mouseleave',this._scheduleHide.bind(this));hb.subscribe('show',function(){setTimeout(this._highlightDialogScrollbar.bind(this,hb),0);var ib=g.listen(hb.getContent(),'mousedown',function(){this._selectStory(gb);ib.remove();}.bind(this));}.bind(this));}if(gb==this._activeStory)this._openDialog(hb);},_highlightDialogScrollbar:function(gb){var hb=p.scry(gb.getContent(),'.uiScrollableArea')[0];hb&&z.poke(hb);},_openStoryExternally:function(gb,event){var hb=gb.getAttribute('data-href');if(!hb||hb=='#')return;var ib=gb.getAttribute('data-story-rel');switch(ib){case 'theater':this._deactivateAndClearStory();l.loadModules(["PhotoViewer"],function(lb){lb.bootstrap(hb,gb);});return;case 'async':this._deactivateAndClearStory();j.bootstrap(hb,gb);return;}var jb=gb.getAttribute('data-target'),kb=(event.which!=1||event.getModifiers().any||jb=='_blank');kb?window.open(hb,'_blank'):wa(hb);},_deactivateAndClearStory:function(){this._clearHoverTimeouts();this._deactivateStory();},_focusStoryWillTriggerScroll:function(gb){var hb=this._container,ib=hb.clientHeight,jb=gb.offsetHeight,kb=hb.scrollTop,lb=kb+ib,mb=gb.offsetTop,nb=mb+jb;return mb<kb||nb>lb;},_focusStory:function(gb){if(this._focusStoryWillTriggerScroll(gb))this._preventScrollDismiss=true;var hb=new x(gb),ib=w.byClass(gb,'scrollable'),jb=hb.boundWithin(new x(ib)).getPositionVector(),kb=hb.getPositionVector().sub(jb);if(kb.y!==0)kb.scrollElementBy(ib);gb.focus();},_selectStory:function(gb){this._selectedStory=gb;o.addClass(gb,'tickerStorySelected');o.addClass(this._root,'tickerChildSelected');},_activateStory:function(gb,hb){this._clearHoverTimeouts();if(gb==this._activeStory||!this._storyCanOpenDialog(gb))return;this._deactivateStory();this._focusStory(gb);this._activeStory=gb;o.addClass(gb,'tickerStoryActive');window.Toggler&&da.hide();if(this._logFlyouts){hb=hb||'unknown';new k('/ajax/feed/ticker/flyout.php',{src:hb}).send();}ca.log(gb);var ib=this._getStoryDialog(gb);if(ib){if(this._storyDialogResources[gb.id])l.loadResources(this._storyDialogResources[gb.id]);this._openDialog(ib);ka.bumpEntityKey('ticker_stories','flyouts.open');return;}if(!(gb.id in this._fetchedStories))this._uaCurStoryIDFetch=gb.id;this._fetchStory(gb);},handleRemoveStory:function(){this._deactivateStory(true);},_deactivateStory:function(gb){if(this._activeStory===this._deactivatingStory)return;this._deactivatingStory=this._activeStory;if(this._dialog){if(gb===true){this._dialog.enableBehavior(t);}else this._dialog.disableBehavior(t);this._dialog.hide();}if(this._activeStory){o.removeClass(this._activeStory,'tickerStoryActive');o.removeClass(this._activeStory,'tickerStorySelected');o.removeClass(this._root,'tickerChildSelected');}this._dialog=this._selectedStory=this._activeStory=null;this._cleanupInputFocusListener();this._cleanupContentResizeListener();this._deactivatingStory=null;},_logUserAction:function(gb,hb,event){ma(hb,gb,event,'FORCE');},_fetchStory:function(gb){clearTimeout(this._fetchToken);var hb=[],ib=this._getInsertedStories(),jb=ib.indexOf(gb);[-1,0,1].forEach(function(kb){var lb=ib[jb+kb];lb&&hb.push(lb);},this);this._fetchToken=setTimeout(this._fetchStories.bind(this,hb),100);},_fetchStories:function(gb){var hb=[],ib,jb=function(kb){clearTimeout(ib);gb.forEach(function(lb){o.conditionClass(lb,'tickerStoryFetching',kb);});};gb=gb.filter(function(kb){if(kb.id in this._fetchedStories)return false;this._fetchedStories[kb.id]=true;var lb=this._getStoryDialogParams(kb);if(!lb)return false;lb.uniq_id=kb.getAttribute('id');lb.referrer=this._tickerSource;hb.push(lb);return true;},this);if(!hb.length)return;ib=this._setTimeout(jb.bind(null,true),500);new j('/ajax/feed/ticker/multi_story').setInitialHandler(this._handleDialogResponse.bind(this,hb)).setFinallyHandler(jb.bind(null,false)).setErrorHandler(ta).setData({stories:hb}).setAllowCrossPageTransition(this._tickerInSidebarMode).send();},_handleDialogResponse:function(gb,hb){if(hb&&hb.resource_map){var ib=[];for(var jb in hb.resource_map){var kb=hb.resource_map[jb];if(kb.type==='css'&&!kb.permanent)ib.push(jb);}if(ib.length>0)for(var lb=0;lb<gb.length;lb++)this._storyDialogResources[gb[lb].uniq_id]=ib;}},_tickerDeClicker:function(event){var gb=event.getTarget(),hb=w.byTag(gb,'a'),ib=this._getStoryFromNode(gb),jb=this._getButtonFromNode(gb);if(ib&&hb&&!jb&&o.hasClass(ib,'tickerStoryClickable')&&!o.hasClass(hb,'tickerStoryAllowClick')&&!this._storyIsHidden(ib))hb.setAttribute('rel','ignore');var kb=(event.button==2),lb=(event.type==='keydown'),mb=ib&&this._getActionButtonFromStory(ib);if(!kb&&mb&&!lb)this._setClickedStory(ib);},_handleMouseup:function(event){this._clearClickedStory();},_setClickedStory:function(gb){this._clearClickedStory();o.addClass(gb,'tickerStoryClicked');this._clickedStory=gb;},_clearClickedStory:function(){if(this._clickedStory){o.removeClass(this._clickedStory,'tickerStoryClicked');this._clickedStory=null;}},_initInfiniteScrollListener:function(){var gb=this._getInsertedStories();if(this._storiesWithActions)for(var hb=0;hb<gb.length;hb++){var ib=gb[hb];if(o.hasClass(ib,'tickerStoryWithButton'))this._storiesWithActions[ib.getAttribute('data-story-key')]=ib;}var jb=Math.max(0,gb.length-this._autoloadStoryIndex);this._infiniteScrollStory=gb[jb];this._checkInfiniteScroll();},_checkInfiniteScroll:function(){if(this._infiniteScrollStory){var gb=ia.getElementPosition(this._infiniteScrollStory).y,hb=ia.getElementPosition(this._container).y+ia.getElementDimensions(this._container).y;if(gb<hb){var ib=p.scry(this._root,'.tickerMorePager a')[0];if(ib){var jb=w.byClass(ib,'stat_elem')||ib;new j(ib.getAttribute('ajaxify')).setReadOnly(true).setRelativeTo(ib).setStatusElement(jb).setAllowCrossPageTransition(true).send();}this._infiniteScrollStory=null;this._autoloadStoryIndex=5;}}},_setFixed:function(gb){if(!this._selectedStory)return;var hb=this._getStoryDialog(this._selectedStory);if(hb){hb.setFixed&&hb.setFixed(gb);hb.updatePosition();}},_setTimeout:function(gb,hb){return setTimeout(gb,hb,!this._tickerInSidebarMode);},_scrollDialogToBottom:function(){var gb=this._dialog&&this._dialog.getContent(),hb=gb&&p.scry(gb,'.uiScrollableAreaWrap')[0],ib=hb&&z.getInstance(hb);ib&&ib.scrollToBottom();},_redrawFlyout:function(gb,hb){if(this._hasUFIUpdated)return;var ib=this._dialog;if(ib&&ib.isShown()&&oa(ib.getContent(),hb.form)){this._hasUFIUpdated=true;this._updateDialogPosition();}},_openDialog:function(gb){if(!this._tickerInSidebarMode)o.addClass(gb.getRoot(),'tickerStoryOverlayOnTop');this._hasUFIUpdated=false;var hb=ja.getScrollPosition();this._dialog=gb.show();window.scrollTo(hb.x,hb.y);this._updateDialogPosition();this._writeSwfFrame(gb);setTimeout(this._initCommentFocusListener.bind(this),0);setTimeout(this._initContentResizeListener.bind(this),0);this._stupidIE7VideoResizeHack(gb);},_stupidIE7VideoResizeHack:function(gb){if(ha.ie()===7){var hb=p.scry(gb.getContent(),'.uiVideoThumb .img');hb.forEach(function(ib){ba.set(ib,'width','');});}},_updateDialogPosition:function(){var gb=this._tickerInSidebarMode||!!w.byClass(this._root,'fixed_elem');this._dialog.setFixed&&this._dialog.setFixed(gb);this._adjustFlyoutContentHeight();this._dialog.updatePosition();},_writeSwfFrame:function(gb){var hb=this._dialog&&this._dialog.getContent(),ib=p.scry(hb,'.swfObject')[0];if(!ib)return;var jb=ib.getAttribute('data-swfid');if(jb&&window[jb]){var kb=window[jb];kb.write(ib);}},_initCommentFocusListener:function(){var gb=this._dialog&&this._dialog.getContent(),hb=gb&&p.scry(gb,'.tickerDialogFooter textarea')[0];if(!hb)return;this._listeners.inputFocus=g.listen(hb,'focus',this._scrollDialogToBottom.bind(this));},_cleanupInputFocusListener:function(){if(this._listeners.inputFocus){this._listeners.inputFocus.remove();this._listeners.inputFocus=null;}},_initContentResizeListener:function(){var gb=this._dialog&&this._dialog.getContent();if(!gb)return;this._listeners.contentResize=g.listen(gb,'click',function(){setTimeout(this._dialog.updatePosition.bind(this._dialog),0);}.bind(this));},_cleanupContentResizeListener:function(){if(this._listeners.contentResize){this._listeners.contentResize.remove();this._listeners.contentResize=null;}},_adjustFlyoutContentHeight:function(){var gb=this._dialog&&this._dialog.getContent(),hb=gb&&p.scry(gb,'.uiScrollableAreaWrap')[0];if(!hb)return;var ib=ia.getElementDimensions(hb),jb=ia.getElementPosition(hb),kb=p.scry(hb,'.uiUfi .uiUfiComment'),lb=p.scry(hb,"._12tg")[0],mb=p.scry(hb,".UFILikeSentence")[0],nb=this.FLYOUT_MAX_HEIGHT;if(lb||mb){var ob=this._getUfiItemAndTop(lb,mb),pb=ob[0],qb=ob[1];nb=Math.max(nb,this.FLYOUT_TARGET_HEIGHT_OFFSET+hb.scrollTop+qb+pb.offsetHeight-jb.y);}var rb=ia.getViewportDimensions().y-this.FLYOUT_VIEWPORT_PADDING;nb=Math.min(nb,rb);var sb=nb-this.FLYOUT_TARGET_HEIGHT_OFFSET;for(var tb=0;tb<kb.length;tb++){var ub=kb[tb],vb=ia.getElementPosition(ub),wb=vb.y-jb.y;if(Math.abs(wb-sb)<=this.FLYOUT_OFFSET_THRESHOLD){sb=wb+this.FLYOUT_COMMENT_OFFSET;break;}}if(ib.y>=sb){ba.set(hb,'height',sb+'px');ba.set(hb,'max-height',null);}else{ba.set(hb,'max-height',nb+'px');ba.set(hb,'height',null);}},_getUfiItemAndTop:function(gb,hb){var ib=(gb&&ia.getElementPosition(gb).y)||0,jb=(hb&&ia.getElementPosition(hb).y)||0,kb=[gb,ib+this.FLYOUT_ACTION_FOOTER_PADDING],lb=[hb,jb];return ib>jb?kb:lb;},_initObjectIDs:function(){var gb=this._getAllStories();for(var hb=gb.length-1;hb>=0;hb--){var ib=gb[hb].getAttribute('data-story-key');if(ib){this._objectIDs[ib]=true;this._lastKStoriesInsert(gb[hb]);var jb=gb[hb].getAttribute("data-dedupe-key");if(jb)this._dedupeKeys[jb]=true;}}},_handleChatOpened:function(){this._deactivateStory(true);},_handleChannelConnection:function(){this._checkChannelConnection();},getNewest:function(){return this._newest;}});e.exports=fb;},null);
__d("TickerRightColumnController",["Arbiter","CSS","DOM","Event","NavigationMessage","Run","Style","SubscriptionsHandler","TickerController","Vector","ge","throttle"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){var s;function t(){var y=q('pagelet_rhc_ticker');y&&o.show(y,v);}function u(){var y=q('pagelet_rhc_ticker');y&&o.hide(y);}function v(){var y=q('pagelet_rhc_ticker'),z=i.scry(y,'.ticker_container')[0],aa=i.scry(y,'.ticker_stream')[0],ba=q('rightCol');if(!y||!z||!aa||!ba)return;m.set(z,'height','0');var ca=75,da=p.getViewportDimensions().y,ea=p.getElementDimensions(ba).y,fa=da-ea-ca,ga=p.getElementDimensions(aa).y,ha=Math.max(Math.min(fa,ga,s.tickerMaxHeight||425),s.tickerMinHeight||225);m.set(z,'height',ha+'px');}function w(y){var z=q('pagelet_reminders'),aa=q('pagelet_rhc_ticker'),ba=z&&i.scry(z,'div.tickerToggleWrapper')[0],ca=aa&&i.scry(aa,'div.tickerToggleWrapper')[0];ba&&h.conditionClass(ba,'displayedTickerToggleWrapper',!y);ca&&h.conditionClass(ca,'displayedTickerToggleWrapper',y);aa&&h.conditionClass(aa,'hidden_rhc_ticker',!y);if(y){v();var da=q('fbTickerClosedEd');da&&h.hide(da);}}var x={init:function(y){s=y;var z=new n();if(s.enableSidebar)z.addSubscriptions(g.subscribe('sidebar/hide',t),g.subscribe('sidebar/show',u),g.subscribe('minisidebar/show',t),g.subscribe('LitestandClassicRHC/loaded',v),j.listen(window,'scroll',r(function(){var ba=i.scry(q('pagelet_rhc_ticker'),'.fbFeedTicker')[0],ca=ba&&o.getInstance(ba);ca&&ca.handleRemoveStory();})));if(!h.hasClass(document.documentElement,'sidebarMode')){t();}else if(s.enableSidebar)h.hasClass(document.documentElement,'miniSidebar')?t():u();var aa=function(){z.release();};g.subscribeOnce(k.NAVIGATION_BEGIN,aa);l.onLeave(aa);},initRHCTickerHider:function(y){j.listen(y,'click',this.hideRHCTicker);},showRHCTicker:function(){w(true);},hideRHCTicker:function(){w(false);}};e.exports=x;},null);
__d("MercuryLocalIDs",["PresenceUtil","randomInt"],function(a,b,c,d,e,f,g,h){'use strict';var i={generateMessageID:function(j){var k=j||Date.now(),l=h(0,4294967295),m=g.getSessionID();return ("<"+k+":"+l+"-"+m+"@mail.projektitan.com>");},generateThreadID:function(j){return 'root:'+i.generateMessageID(j);}};e.exports=i;},null);
__d("MercuryMessageObject",["MercuryActionStatus","MercuryActionType","MercuryIDs","MercuryLocalIDs","MercuryMessageClientState","MercuryMessageSourceTags","MercurySingletonMixin","MercurySourceType","MercuryTimePassed","MercurySendMessageFields","fbt","formatDate"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){function s(v){"use strict";this.$MercuryMessageObject0=v;}s.prototype.constructUserGeneratedMessageObject=function(v,w,x,y,z){"use strict";var aa=t(this.$MercuryMessageObject0,h.USER_GENERATED_MESSAGE,w,x);if(typeof v=='string')v=v.replace(/^\s+/,'').replace(/\s+$/,'');aa.body=v;aa.has_attachment=false;aa.html_body=false;aa.attachments=[];aa.specific_to_list=y||[];aa.creator_info=z;return aa;};s.prototype.constructStickerMessageObject=function(v,w,x){"use strict";var y=t(this.$MercuryMessageObject0,h.USER_GENERATED_MESSAGE,w,x);y.has_attachment=true;y.html_body=false;y.attachments=[];y.sticker_id=v;y.specific_to_list=[];return y;};s.prototype.constructAttachmentMessageObject=function(v,w){"use strict";var x=t(this.$MercuryMessageObject0,h.USER_GENERATED_MESSAGE,v,w);x.attachments=[];x.specific_to_list=[];return x;};s.prototype.constructLogMessageObject=function(v,w,x,y){"use strict";var z=t(this.$MercuryMessageObject0,h.LOG_MESSAGE,v,w);z.log_message_type=x;z.log_message_data=y;return z;};s.prototype.normalizeNewMessage=function(v){"use strict";if(v.status===undefined)v.status=g.UNSENT;v.timestamp_absolute="Today";v.message_id=v.message_id||j.generateMessageID(v.timestamp);var w=i.getParticipantIDFromUserID(this.$MercuryMessageObject0);v.specific_to_list=v.specific_to_list||[];if(v.specific_to_list.length&&v.specific_to_list.indexOf(w)===-1)v.specific_to_list.push(w);if(!v.thread_id){if(v.specific_to_list.length==1){v.thread_id='user:'+this.$MercuryMessageObject0;}else if(v.specific_to_list.length==2){var x=v.specific_to_list[0]==w?v.specific_to_list[1]:v.specific_to_list[0];v.thread_id=i.getThreadIDFromParticipantID(x);}v.thread_id=v.thread_id||'root:'+v.message_id;}if(!v.specific_to_list.length){var y=i.tokenize(v.thread_id),z=y.type,aa=y.value;if(z=='user')v.specific_to_list=['fbid:'+aa,w];}if(!v[p.MANUAL_RETRY_CNT])v[p.MANUAL_RETRY_CNT]=0;};s.prototype.normalizeResendMessage=function(v){"use strict";v.status=g.RESENDING;v.timestamp=Date.now();v[p.MANUAL_RETRY_CNT]+=1;};s.prototype.normalizeAddAttachmentPlaceholder=function(v,w,x){"use strict";if(x.preview_attachments.length>0){v.has_attachment=true;v.preview_attachments=x.preview_attachments;}v.client_state=k.DO_NOT_SEND_TO_SERVER;v.status=g.RESENDING;v.upload_id=w;};function t(v,w,x,y){var z=u(x)?[l.CHAT]:[],aa=Date.now(),ba=r(new Date(aa),'g:ia'),ca={action_type:w,thread_id:y,author:i.getParticipantIDFromUserID(v),author_email:null,coordinates:null,timestamp:aa,timestamp_absolute:(new Date(aa)).toLocaleDateString(),timestamp_relative:ba,timestamp_time_passed:o.TODAY,is_unread:false,is_cleared:false,is_forward:false,is_filtered_content:false,is_spoof_warning:false,source:x,source_tags:z};return ca;}function u(v){switch(v){case n.CHAT_WEB:case n.CHAT_JABBER:case n.CHAT_IPHONE:case n.CHAT_MEEBO:case n.CHAT_ORCA:case n.CHAT_TEST:case n.CHAT:case n.DESKTOP:return true;default:return false;}}Object.assign(s,m);e.exports=s;},null);
__d("MercuryMessageActions",["CurrentUser","MercuryActionType","MercuryMessageObject","MercuryPayloadSource","MercuryServerRequests","MercurySingletonMixin"],function(a,b,c,d,e,f,g,h,i,j,k,l){'use strict';function m(n){this.$MercuryMessageActions0=n;this.$MercuryMessageActions1=i.getForFBID(this.$MercuryMessageActions0);this.$MercuryMessageActions2=k.getForFBID(this.$MercuryMessageActions0);}m.prototype.send=function(n,o,p){o=o||Function.prototype;this.$MercuryMessageActions1.normalizeNewMessage(n);this.$MercuryMessageActions2.handleUpdate(this.$MercuryMessageActions3(Object.assign({},n),j.CLIENT_SEND_MESSAGE));this.$MercuryMessageActions2.sendNewMessage(n,p);o(n.thread_id);};m.prototype.resend=function(n,o){var p=Object.assign({},n);this.$MercuryMessageActions1.normalizeResendMessage(p);this.send(p,(void 0),o);};m.prototype.addAttachmentPlaceholder=function(n,o,p){this.$MercuryMessageActions1.normalizeAddAttachmentPlaceholder(n,o,p);this.$MercuryMessageActions1.normalizeNewMessage(n);this.$MercuryMessageActions2.handleUpdate(this.$MercuryMessageActions3(Object.assign({},n),j.CLIENT_SEND_MESSAGE));};m.prototype.cancelAttachmentPlaceholder=function(n,o){this.$MercuryMessageActions2.handleUpdate(this.$MercuryMessageActions3({upload_id:n,upload_data:o,action_type:h.CANCEL_ATTACHMENT_PLACEHOLDER},j.CLIENT_SEND_MESSAGE));};m.prototype.confirmAttachmentPlaceholder=function(n,o){this.$MercuryMessageActions2.handleUpdate(this.$MercuryMessageActions3({upload_id:n,upload_data:o,action_type:h.CONFIRM_ATTACHMENT_PLACEHOLDER},j.CLIENT_SEND_MESSAGE));};m.addShareDataToExistingMessage=function(n,o,p,q){q=q||g.getID();m.getForFBID(q).addShareDataToExistingMessage(n,o,p);};m.prototype.addShareDataToExistingMessage=function(n,o,p){this.$MercuryMessageActions2.handleUpdate(this.$MercuryMessageActions4({server_id:n,attach_key:o,attach_data:p,action_type:h.ADD_SHARE_DATA_TO_EXISTING_MESSAGE},j.SERVER_ADD_SHARE_DATA_TO_EXISTING_MESSAGE));};m.prototype.markSpam=function(n,o){this.$MercuryMessageActions2.handleUpdate(this.$MercuryMessageActions5(n,o,h.MARK_MESSAGES_SPAM,j.CLIENT_MARK_MESSAGES_SPAM));};m.prototype["delete"]=function(n,o,p){this.$MercuryMessageActions2.handleUpdate(this.$MercuryMessageActions5(n,o,h.DELETE_MESSAGES,p||j.CLIENT_DELETE_MESSAGES));};m.prototype.$MercuryMessageActions3=function(n,o){return {actions:[n],from_client:true,payload_source:o};};m.prototype.$MercuryMessageActions4=function(n,o){return {actions:[n],from_client:false,payload_source:o};};m.prototype.$MercuryMessageActions5=function(n,o,p,q){return {actions:[{action_type:p,action_id:null,thread_id:n,message_ids:o}],from_client:true,payload_source:q};};Object.assign(m,l);e.exports=m;},null);
__d("MercuryThreadActions",["MercuryActionType","MercuryPayloadSource","MercuryServerRequests","MercurySingletonMixin","MessagingTag","merge"],function(a,b,c,d,e,f,g,h,i,j,k,l){'use strict';function m(n){this.$MercuryThreadActions0=n;this.$MercuryThreadActions1=i.getForFBID(this.$MercuryThreadActions0);}m.prototype.markRead=function(n,o){this.batchMarkRead([n],o);};m.prototype.batchMarkRead=function(n,o){this.$MercuryThreadActions1.handleUpdate(this.$MercuryThreadActions2(n,true,o));};m.prototype.markUnread=function(n,o){this.batchMarkUnread([n],o);};m.prototype.batchMarkUnread=function(n,o){this.$MercuryThreadActions1.handleUpdate(this.$MercuryThreadActions2(n,false,o));};m.prototype.markSeen=function(n,o){this.$MercuryThreadActions1.handleUpdate(this.$MercuryThreadActions3([n],g.MARK_THREAD_SEEN,h.CLIENT_MARK_THREAD_SEEN,{persistent:o}));};m.prototype.archive=function(n,o){this.batchArchive([n],o);};m.prototype.batchArchive=function(n,o){n.forEach(function(p){this.$MercuryThreadActions1.changeThreadArchivedStatus(p,true,o);}.bind(this));this.$MercuryThreadActions1.handleUpdate(this.$MercuryThreadActions4(n,true));};m.prototype.unarchive=function(n,o){this.batchUnarchive([n],o);};m.prototype.batchUnarchive=function(n,o){n.forEach(function(p){this.$MercuryThreadActions1.changeThreadArchivedStatus(p,false,o);}.bind(this));this.$MercuryThreadActions1.handleUpdate(this.$MercuryThreadActions4(n,false));};m.prototype.markSpam=function(n,o){this.batchMarkSpam([n],o);};m.prototype.batchMarkSpam=function(n,o){n.forEach(function(p){this.$MercuryThreadActions1.markThreadSpam(p,o);}.bind(this));this.$MercuryThreadActions1.handleUpdate(this.$MercuryThreadActions5(n,k.SPAM));};m.prototype.unmarkSpam=function(n,o){this.batchUnmarkSpam([n],o);};m.prototype.batchUnmarkSpam=function(n,o){n.forEach(function(p){this.$MercuryThreadActions1.unmarkThreadSpam(p,o);}.bind(this));this.$MercuryThreadActions1.handleUpdate(this.$MercuryThreadActions5(n,k.INBOX));};m.prototype.changeFolder=function(n,o){this.batchChangeFolder([n],o);};m.prototype.batchChangeFolder=function(n,o){n.forEach(function(p){this.$MercuryThreadActions1.changeThreadFolder(p,o);}.bind(this));this.$MercuryThreadActions1.handleUpdate(this.$MercuryThreadActions5(n,o));};m.prototype["delete"]=function(n,o){this.batchDelete([n],o);};m.prototype.batchDelete=function(n,o){n.forEach(function(p){this.$MercuryThreadActions1.deleteThread(p,o);}.bind(this));this.$MercuryThreadActions1.handleUpdate(this.$MercuryThreadActions3(n,g.DELETE_THREAD,h.CLIENT_DELETE_THREAD));};m.prototype.unmute=function(n){this.updateMuteSetting(n,0);};m.prototype.updateMuteSetting=function(n,o){this.$MercuryThreadActions1.changeMutingOnThread(n,o);this.$MercuryThreadActions1.handleUpdate(this.$MercuryThreadActions3([n],g.CHANGE_MUTE_SETTINGS,h.CLIENT_CHANGE_MUTE_SETTINGS,{mute_settings:o}));};m.prototype.addParticipants=function(n,o){this.$MercuryThreadActions1.handleUpdate(this.$MercuryThreadActions3([n],g.ADD_PARTICIPANTS,h.CLIENT_ADD_PARTICIPANTS,{participants:o}));};m.prototype.unpinThread=function(n){this.$MercuryThreadActions1.unpinThread(n);this.$MercuryThreadActions1.handleUpdate(this.$MercuryThreadActions3([n],g.UNPIN_THREAD,h.CLIENT_UNPIN_THREAD));};m.prototype.$MercuryThreadActions2=function(n,o,p){return this.$MercuryThreadActions3(n,g.CHANGE_READ_STATUS,h.CLIENT_CHANGE_READ_STATUS,{mark_as_read:o,source:p});};m.prototype.$MercuryThreadActions4=function(n,o){return this.$MercuryThreadActions3(n,g.CHANGE_ARCHIVED_STATUS,h.CLIENT_CHANGE_ARCHIVED_STATUS,{archived:o});};m.prototype.$MercuryThreadActions5=function(n,o){return this.$MercuryThreadActions3(n,g.CHANGE_FOLDER,h.CLIENT_CHANGE_FOLDER,{new_folder:o});};m.prototype.$MercuryThreadActions3=function(n,o,p,q){return {actions:n.map(function(r){return l({action_type:o,action_id:null,thread_id:r},q);}),from_client:true,payload_source:p};};Object.assign(m,j);e.exports=m;},null);
__d("MercuryFolders",["MessagingTag","arrayContains"],function(a,b,c,d,e,f,g,h){var i=[g.INBOX,g.OTHER,g.ACTION_ARCHIVED,g.SPAM],j={getSupportedFolders:function(){return i.concat();},isSupportedFolder:function(k){return h(i,k);},getFromMeta:function(k){var l=k.folder;if(k.is_archived)l=g.ACTION_ARCHIVED;return l;}};e.exports=j;},null);
__d("MercuryUnreadState",["MercuryFolders","LogHistory","KeyedCallbackManager","MercuryActionType","MercuryGlobalActionType","MercurySingletonMixin","MercuryThreadlistConstants","MessagingTag","ReportState","MercuryServerRequests","MercuryThreadInformer","MercuryThreads","arrayContains","copyProperties","createObjectFrom"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){var v=(g.getSupportedFolders()||[]).filter(function(na){return na!=n.ACTION_ARCHIVED;}),w='unread_thread_hash',x='unseen_thread_list',y=m.MAX_UNREAD_COUNT,z=h.getInstance('mercury_unread_state');function aa(na){this._fbid=na;this._serverRequests=p.getForFBID(this._fbid);this._threadInformer=q.getForFBID(this._fbid);this._threads=r.getForFBID(this._fbid);this._allReadTimestamp={};this._threadReadTimestamp={};this._initialUnreadCount={};this._maxCount={};this._unreadResources={};v.forEach(function(oa){this._initialUnreadCount[oa]=0;this._maxCount[oa]=false;this._unreadResources[oa]=new i();}.bind(this));this._serverRequests.subscribe('update-unread',function(oa,pa){fa(this,pa);var qa=pa.global_actions||[];for(var ra=0;ra<qa.length;ra++){var sa=qa[ra];if(sa.action_type==k.MARK_ALL_READ)ia(this,sa.folder,sa.timestamp);}}.bind(this));this._serverRequests.subscribe('update-thread-ids',function(oa,pa){ka(this,pa);}.bind(this));}t(aa.prototype,{getUnreadCount:function(na){if(this.exceedsMaxCount(na)){z.error('unguarded_unread_count_fetch',{});return 0;}return ea(this,na);},exceedsMaxCount:function(na){return this._maxCount[na]||(ea(this,na)>y);},markFolderAsRead:function(na){if(this._maxCount[na]||ea(this,na)>0)this._serverRequests.markFolderAsRead(na);}});t(aa,l);function ba(na,oa,pa){na._unreadResources[oa].setResource(w,pa);na._unreadResources[oa].setResource(x,Object.keys(pa));}function ca(na,oa,pa){var qa=na._unreadResources[oa].executeOrEnqueue(w,pa),ra=na._unreadResources[oa].getUnavailableResources(qa);if(ra.length)na._serverRequests.fetchUnreadThreadIDs(oa);}function da(na,oa){return na._unreadResources[oa].getResource(w);}function ea(na,oa){var pa=na._unreadResources[oa].getResource(x);if(pa){return pa.length;}else return na._initialUnreadCount[oa];}function fa(na,oa){var pa;(oa.unread_thread_fbids||[]).forEach(function(qa){pa=qa.folder;if(!ma(pa))return;var ra=qa.thread_fbids||[];ra=ra.concat(qa.other_user_fbids||[]);var sa=ja(na,ra);ba(na,pa,u(sa,true));if(sa.length>y)na._maxCount[pa]=true;na._threadInformer.updatedUnreadState();});(oa.message_counts||[]).forEach(function(qa){if(qa.unread_count===(void 0))return;pa=qa.folder;if(qa.unread_count>y){na._maxCount[pa]=true;ba(na,pa,{});na._threadInformer.updatedUnreadState();}else{na._initialUnreadCount[pa]=qa.unread_count;if(na._initialUnreadCount[pa]===0)ba(na,pa,{});na._threadInformer.updatedUnreadState();}});(oa.actions||[]).forEach(function(qa){if(qa.is_forward)return;var ra=j,sa=qa.other_user_fbid?qa.other_user_fbid:qa.thread_fbid,ta=qa.thread_id?qa.thread_id:sa;if(qa.action_type==ra.DELETE_THREAD){v.forEach(function(va){ha(na,va,ta);});}else if(qa.action_type==ra.CHANGE_ARCHIVED_STATUS||qa.action_type==ra.CHANGE_FOLDER){var ua=na._threads.getThreadMetaNow(qa.thread_id);pa=g.getFromMeta(ua);if(ma(pa)&&ua.unread_count>0)ga(na,pa,ta);v.forEach(function(va){if(va!=pa)ha(na,va,ta);});}else{pa=la(na,qa);if(!ma(pa))return;if(qa.action_type==ra.CHANGE_READ_STATUS){if(qa.mark_as_read){ha(na,pa,ta,qa.timestamp);}else ga(na,pa,ta,qa.timestamp);}else if(qa.action_type==ra.USER_GENERATED_MESSAGE||qa.action_type==ra.LOG_MESSAGE)if(qa.is_unread)ga(na,pa,ta,qa.timestamp);}});}function ga(na,oa,pa,qa){if(na._maxCount[oa])return;ca(na,oa,function(ra){var sa=na._allReadTimestamp[oa]||0,ta=na._threadReadTimestamp[pa]||0,ua=qa||Number.POSITIVE_INFINITY;if(ua>=sa&&ua>=ta&&!ra[pa]){ra[pa]=qa||0;ba(na,oa,ra);na._threadInformer.updatedUnreadState();}});}function ha(na,oa,pa,qa){if(na._maxCount[oa])return;ca(na,oa,function(ra){if(qa){var sa=na._threadReadTimestamp[pa];if(!sa||sa<qa)na._threadReadTimestamp[pa]=qa;}var ta=ra[pa];if(qa&&typeof ta=='number'&&qa<ta)return;if(pa in ra){delete ra[pa];ba(na,oa,ra);na._threadInformer.updatedUnreadState();}});}function ia(na,oa,pa){na._maxCount[oa]=false;ba(na,oa,{});na._allReadTimestamp[oa]=Math.max(na._allReadTimestamp[oa]||0,pa||0);na._threadInformer.updatedUnreadState();}function ja(na,oa){return oa.map(na._serverRequests.convertThreadIDIfAvailable,na._serverRequests);}function ka(na,oa){v.forEach(function(pa){var qa=da(na,pa);if(!qa)return;for(var ra in oa){var sa=oa[ra];if(qa[ra]){qa[sa]=qa[ra];delete qa[ra];}}ba(na,pa,qa);});}function la(na,oa){var pa=oa.thread_id?na._threads.getThreadMetaNow(oa.thread_id):null;return pa?g.getFromMeta(pa):oa.folder;}function ma(na){return s(v,na);}o.registerCallback('mercury-unread-state',function(){var na={};na.unread={};na.unread_max_count={};var oa=aa._getInstances();for(var pa in oa){na.unread[pa]={};na.unread_max_count[pa]={};v.forEach(function(qa){na.unread[pa][qa]=t({},da(oa[pa],qa));na.unread_max_count[pa][qa]=oa[pa]._maxCount[qa];});}return na;});e.exports=aa;},null);
__d("MercuryLeftNav",["Arbiter","MessagingTag","NavigationMessage","MercuryThreadInformer","MercuryUnreadState"],function(a,b,c,d,e,f,g,h,i){var j=b('MercuryThreadInformer').get(),k=b('MercuryUnreadState').get(),l=false;function m(){var o=k.getUnreadCount(h.INBOX);g.inform(i.NAVIGATION_COUNT_UPDATE,{key:'inbox',hide:true});g.inform(i.NAVIGATION_COUNT_UPDATE,{key:'inbox',count:o});}var n={bootstrap:function(){if(l)return;j.subscribe('unread-updated',m);l=true;}};e.exports=n;},null);
__d("MercuryThreadMuter",["AsyncDialog","AsyncRequest","CurrentUser","DOM"],function(a,b,c,d,e,f,g,h,i,j){var k={getUserIDEmail:function(){return i.getID()+'@facebook.com';},getThreadMuteSettingForUser:function(l){return l.mute_settings&&l.mute_settings[k.getUserIDEmail()];},isThreadMuted:function(l){return k.getThreadMuteSettingForUser(l)!==(void 0);},showMuteChangeDialog:function(l,m){g.send(new h('/ajax/mercury/mute_thread_dialog.php').setRelativeTo(m),function(n){n.subscribe('confirm',function(){this.hide();var o;j.scry(this.getRoot(),'input[type="radio"]').forEach(function(p){if(p.checked)o=p.value;});o=k.convertRawMuteSetting(o);d(['MercuryThreadActions'],function(p){p.get().updateMuteSetting(l,o);});}.bind(n));});},convertRawMuteSetting:function(l){switch(l){case 'always':return -1;case '1hour':return 3600;case '8am':var m,n=new Date(),o=new Date();o.setHours(8);o.setMinutes(0);o.setSeconds(0);if(o>n){m=o-n;}else m=o-n+(24*3600*1000);return m/1000;default:return 0;}}};e.exports=k;},null);
__d("ImageSourceType",[],function(a,b,c,d,e,f){var g={PROFILE_PICTURE:'profile_picture',IMAGE:'image'};e.exports=g;},null);
__d("ImageSourceRequest",["CurrentUser","ImageSourceType","KeyedCallbackManager","PhotoResizeModeConst","MercuryServerDispatcher","arrayContains","extendArray"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){function n(){"use strict";this._request={fbid:null,type:null,width:null,height:null,resize_mode:null};this._callback=null;}n.prototype.setFBID=function(r){"use strict";this._request.fbid=r;return this;};n.prototype.setType=function(r){"use strict";if(!l([h.PROFILE_PICTURE,h.IMAGE],r))throw new TypeError('ImageSourceRequest.setType: invalid type '+r);this._request.type=r;return this;};n.prototype.setDimensions=function(r,s){"use strict";this._request.width=r;this._request.height=s;return this;};n.prototype.setResizeMode=function(r){"use strict";if(!l([j.COVER,j.CONTAIN],r))throw new TypeError('ImageSourceRequest.setResizeMode: invalid resize mode '+r);this._request.resize_mode=r;return this;};n.prototype.setCallback=function(r){"use strict";this._callback=r;return this;};n.prototype.send=function(){"use strict";if(!this._request.fbid||!this._request.width||!this._request.height||!this._request.type||!this._request.resize_mode||!this._callback)throw new Error('ImageSourceRequest: You must set all the fields');var r=p(),s=q(this._request);r.executeOrEnqueue(s,this._callback);if(r.getUnavailableResourcesFromRequest(s).length===1){k.trySend('/ajax/image_source.php',{requests:[this._request]});return true;}return false;};var o=null;function p(){if(o)return o;var r=new i();o=r;k.registerEndpoints({'/ajax/image_source.php':{request_user_id:g.getID(),mode:k.BATCH_DEFERRED_MULTI,batch_function:function(s,t){m(s.requests,t.requests);return s;},handler:function(s,t){var u=t.getData().requests;for(var v=0;v<u.length;++v)r.setResource(q(u[v]),s[v]);}}});return r;}function q(r){return [r.fbid,r.type,r.width,r.height,r.resize_mode].join('|');}e.exports=n;},null);
__d("MercuryParticipantFetcher",["MercuryIDs","MercuryPayloadSource","MercuryServerRequests","Set","ShortProfiles","setImmediate"],function(a,b,c,d,e,f,g,h,i,j,k,l){'use strict';function m(o){this.$MercuryParticipantFetcher0=i.getForFBID(o);this.$MercuryParticipantFetcher1=false;this.$MercuryParticipantFetcher2=new j();this.$MercuryParticipantFetcher3=new j();}m.prototype.fetch=function(o){this.$MercuryParticipantFetcher4(o);this.$MercuryParticipantFetcher5();};m.prototype.fetchMulti=function(o){o.forEach(function(p){return this.$MercuryParticipantFetcher4(p);}.bind(this));this.$MercuryParticipantFetcher5();};m.prototype.$MercuryParticipantFetcher4=function(o){if(!this.$MercuryParticipantFetcher3.has(o))this.$MercuryParticipantFetcher2.add(o);};m.prototype.$MercuryParticipantFetcher5=function(){if(this.$MercuryParticipantFetcher1||this.$MercuryParticipantFetcher2.size===0)return;this.$MercuryParticipantFetcher1=true;l(function(){this.$MercuryParticipantFetcher1=false;this.$MercuryParticipantFetcher2.forEach(function(o){return this.$MercuryParticipantFetcher3.add(o);}.bind(this));this.$MercuryParticipantFetcher6(this.$MercuryParticipantFetcher2,function(o){o.forEach(function(p){return this.$MercuryParticipantFetcher3["delete"](p.id);}.bind(this));this.$MercuryParticipantFetcher7(o);}.bind(this));this.$MercuryParticipantFetcher2.clear();}.bind(this));};m.prototype.$MercuryParticipantFetcher6=function(o,p){var q=[];o.forEach(function(r){var s=g.tokenize(r),t=s.type,u=s.value;t==='fbid'&&q.push(u);});if(q.length>0)k.getMulti(q,function(r){var s=[];for(var t in r)s.push(n(r[t],t));p(s);});};m.prototype.$MercuryParticipantFetcher7=function(o){this.$MercuryParticipantFetcher0.handleUpdate({participants:o,from_client:false,payload_source:h.SERVER_FETCH_PARTICIPANTS});};function n(o,p){var q=Object.assign({gender:o.gender,href:o.uri,id:g.getParticipantIDFromUserID(o.id||p),image_src:o.thumbSrc,name:o.name,short_name:o.firstName,employee:o.employee,is_employee_away:o.is_employee_away,type:o.type,vanity:o.vanity,is_friend:o.is_friend,orion_eligible:o.orionEligible,social_snippets:o.social_snippets},{});if(o.officeStatus){q.officeStatus=o.officeStatus;q.officeStatusStartDate=o.officeStatusStartDate;q.officeStatusEndDate=o.officeStatusEndDate;q.officeStatusComment=o.officeStatusComment;q.officeStatusLocation=o.officeStatusLocation;}return q;}e.exports=m;},null);
__d("MercuryParticipants",["CurrentUser","EventEmitter","ImageSourceRequest","ImageSourceType","ImmutableObject","KeyedCallbackManager","Map","MercuryAssert","MercuryIDs","MercuryParticipantFetcher","MercuryParticipantTypes","MercuryParticipantsConstants","MercuryServerRequests","PhotoResizeModeConst","Set","fbt","mapObject"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w){'use strict';var x='change';function y(aa){this.$MercuryParticipants0=aa;this.$MercuryParticipants1=new h();this.$MercuryParticipants2=new l();this.$MercuryParticipants3=new p(this.$MercuryParticipants0);this.$MercuryParticipants4=new m();this.$MercuryParticipants5=s.getForFBID(this.$MercuryParticipants0);this.$MercuryParticipants5.subscribe('update-participants',function(ba,ca){if(ca.participants&&ca.participants.length>0){var da={};ca.participants.forEach(function(ea){da[ea.id]=ea;});this.$MercuryParticipants6(da);}}.bind(this));}y.prototype.addListener=function(aa,ba){return this.$MercuryParticipants1.addListener(aa,ba);};y.prototype.getIDFromVanityOrFBID=function(aa){if(!aa)return;if(this.$MercuryParticipants4.has(aa))return this.$MercuryParticipants4.get(aa);if(/^\d+$/.test(aa))return o.getParticipantIDFromUserID(aa);};y.prototype.getNow=function(aa){return this.$MercuryParticipants7(aa);};y.prototype.getOrFetch=function(aa){var ba=this.$MercuryParticipants7(aa);if(!ba)this.$MercuryParticipants3.fetch(aa);return ba;};y.prototype.get=function(aa,ba){n.isParticipantID(aa);return this.$MercuryParticipants8([aa],function(ca){ba(ca[aa]);});};y.prototype.getMulti=function(aa,ba){return this.$MercuryParticipants8(aa,ba);};y.prototype.getBigImageMulti=function(aa,ba){n.allParticipantIDs(aa);var ca=r.BIG_IMAGE_SIZE;return this.$MercuryParticipants8(aa,function(da){var ea={},fa=0,ga=new u(),ha=function(la,ma){fa++;ea[la]=ma;if(fa===aa.length){ba(ea);if(ga.size>0)this.$MercuryParticipants9(ga);}}.bind(this),ia=function(la,ma){this.$MercuryParticipants2.setResource(la,k.set(this.$MercuryParticipants2.getResource(la),{big_image_src:ma.uri}));ga.add(la);ha(la,ma.uri);}.bind(this);for(var ja in da){var ka=da[ja];if(!ka.big_image_src){new i().setFBID(o.getUserIDFromParticipantID(ja)).setType(j.PROFILE_PICTURE).setDimensions(ca,ca).setResizeMode(t.COVER).setCallback(ia.bind(null,ja)).send();}else ha(ka.id,ka.big_image_src);}}.bind(this));};y.prototype.getOrderedBigImageMulti=function(aa,ba){return this.getBigImageMulti(aa,function(ca){ba(aa.map(function(da){return ca[da];}));});};y.prototype.$MercuryParticipants8=function(aa,ba){n.allParticipantIDs(aa);var ca=this.$MercuryParticipants2.executeOrEnqueue(aa,ba),da=this.$MercuryParticipants2.getUnavailableResources(ca).filter(function(ea){var fa=o.tokenize(ea),ga=fa.type,ha=fa.value;if(ga==='email'){this.$MercuryParticipantsa(ea,ha);return false;}return true;}.bind(this));this.$MercuryParticipants3.fetchMulti(da);return this.$MercuryParticipantsb(ca);};y.prototype.$MercuryParticipants7=function(aa){var ba=this.$MercuryParticipants2.getResource(aa);if(!ba){var ca=o.tokenize(aa),da=ca.type,ea=ca.value;if(da==='email')ba=this.$MercuryParticipantsa(aa,ea);}return ba;};y.prototype.$MercuryParticipantsa=function(aa,ba){var ca=new k(z(aa,ba));this.$MercuryParticipants2.setResource(aa,ca);return ca;};y.prototype.$MercuryParticipants9=function(aa){this.$MercuryParticipants1.emit(x,aa);};y.prototype.$MercuryParticipants6=function(aa){aa=w(aa,function(ba,ca){if(ba.vanity)this.$MercuryParticipants4.set(ba.vanity,ca);return new k(this.$MercuryParticipantsc(ba));}.bind(this));this.$MercuryParticipants2.addResourcesAndExecute(aa);this.$MercuryParticipants9(new u(Object.keys(aa)));};y.prototype.$MercuryParticipantsc=function(aa){var ba=aa.type===q.USER||aa.type===q.FRIEND;if(!ba)return aa;if(!aa.name&&!aa.href&&!aa.vanity){var ca="Facebook User";aa.name=ca;aa.short_name=ca;}return aa;};y.prototype.$MercuryParticipantsb=function(aa){return {remove:function(){this.$MercuryParticipants2.unsubscribe(aa);}.bind(this)};};function z(aa,ba){return {gender:r.UNKNOWN_GENDER,href:null,id:aa,image_src:r.EMAIL_IMAGE,big_image_src:r.EMAIL_IMAGE,name:ba,short_name:ba,employee:false};}e.exports=new y(g.getID());},null);
__d("MercuryAttachmentSnippet.react",["EmoticonsList","Image.react","MercuryAttachment","MercuryAttachmentType","MercuryConstants","MercuryIDs","MercuryParticipants","React","StickerConstants","TextWithEmoticons.react","cx","fbt","ix","joinClasses","OrionMercuryAttachmentSnippet"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){'use strict';var u=b('OrionMercuryAttachmentSnippet').module,v=n.createClass({displayName:"MercuryAttachmentSnippet",propTypes:{thread:n.PropTypes.object.isRequired,viewer:n.PropTypes.string.isRequired},componentWillMount:function(){this._ensureParticipant(this.props.thread.snippet_sender);this._setVariables(this.props);},componentWillReceiveProps:function(aa){this._ensureParticipant(aa.thread.snippet_sender);this._setVariables(aa);},componentWillUnmount:function(){this._cancelParticipantFetch();},render:function(){var aa=this._getSenderName();if(this._hasOnlyPhotos())return this._renderPhotoSnippet(aa);if(this._hasOnlyAnimatedImages())return this._renderAnimatedImageSnippet(aa);if(this._hasOnlyVideo())return this._renderVideoSnippet(aa);if(this._hasAudioClip())return this._renderAudioClipSnippet(aa);if(this._hasSticker())return this._renderStickerSnippet(aa);if(this._hasOrion())return this._renderOrionSnippet(aa);if(this._hasShoerackInvitation())return this._renderShoerackInvitationSnippet(aa);if(this._hasShare())return this._renderShareSnippet(aa);return this._renderMixedSnippet(aa);},_renderPhotoSnippet:function(aa){var ba;if(this._photos.length===1){if(this._isViewerSender){ba=("You sent a photo.");}else ba=(r._("{name} sent a photo.",[r.param("name",aa)]));}else if(this._isViewerSender){ba=(r._("You sent {num_photos} photos.",[r.param("num_photos",this._photos.length)]));}else ba=(r._("{name} sent {num_photos} photos.",[r.param("name",aa),r.param("num_photos",this._photos.length)]));return this._renderSnippet(ba);},_renderAnimatedImageSnippet:function(aa){var ba;if(this._animatedImages.length===1){if(this._isViewerSender){ba=("You sent a GIF.");}else ba=(r._("{name} sent a GIF.",[r.param("name",aa)]));}else if(this._isViewerSender){ba=(r._("You sent {num_animated_images} GIFs.",[r.param("num_animated_images",this._animatedImages.length)]));}else ba=(r._("{name} sent {num_animated_images} GIFs.",[r.param("name",aa),r.param("num_animated_images",this._animatedImages.length)]));return this._renderSnippet(ba);},_renderVideoSnippet:function(aa){var ba;if(this._isViewerSender){ba=("You sent a video.");}else ba=(r._("{sender name} sent a video.",[r.param("sender name",aa)]));return this._renderSnippet(ba);},_renderAudioClipSnippet:function(aa){var ba;if(this._isViewerSender){ba=("You sent a voice message.");}else ba=(r._("{name} sent a voice message.",[r.param("name",aa)]));return this._renderSnippet(ba);},_renderStickerSnippet:function(aa){if(y(this._attachments[0].metadata.stickerID)){return (n.createElement(p,{renderEmoticons:true,text:g.symbols.like}));}else if(this._isViewerSender){return (n.createElement("span",null,"You sent a sticker."));}else return (n.createElement("span",null,r._("{name} sent a sticker.",[r.param("name",aa)])));},_renderOrionSnippet:function(aa){if(!u)return null;return (n.createElement("span",null,n.createElement(u,n.__spread({},this._attachments[0].metadata))));},_renderShoerackInvitationSnippet:function(aa){var ba;if(this._isViewerSender){ba=("You sent a Moments invitation.");}else ba=(r._("{sender name} invited you to share photos using Moments.",[r.param("sender name",aa)]));return this._renderSnippet(ba);},_renderShareSnippet:function(aa){var ba;if(this._isViewerSender){ba=("You shared a link.");}else ba=(r._("{sender name} shared a link.",[r.param("sender name",aa)]));return this._renderSnippet(ba);},_renderMixedSnippet:function(aa){return (n.createElement("span",null,this._attachments.filter(function(ba){return ba.attach_type===j.FILE||ba.attach_type===j.PHOTO||ba.attach_type===j.VIDEO;}).map(function(ba){return this._renderSnippet(ba.name,ba.icon_type);}.bind(this))));},_renderSnippet:function(aa,ba){var ca=i.getAttachIconClass(ba||this._attachments[0].icon_type),da=t(ca,"uiIconText _3l6h");return (n.createElement("span",{className:da},n.createElement(h,{src:s('/images/messaging/docs/generic.png')}),aa));},_hasOnlyPhotos:function(){return this._photos.length===this._attachments.length;},_hasOnlyAnimatedImages:function(){return this._animatedImages.length===this._attachments.length;},_hasOnlyVideo:function(){return (this._attachments.length===1&&this._attachments[0].attach_type===j.VIDEO);},_hasAudioClip:function(){return !!(this._attachments.length===1&&this._attachments[0].metadata&&i.isVoiceMessage(this._attachments[0].metadata.type));},_hasSticker:function(){return (this._attachments.length===1&&this._attachments[0].attach_type===j.STICKER);},_hasOrion:function(){return this._hasSingleAttachmentOfShareDataType(k.MercurySupportedShareType.FB_ORION);},_hasShoerackInvitation:function(){return this._hasSingleAttachmentOfShareDataType(k.MercurySupportedShareType.FB_SHOERACK_INVITATION);},_hasSingleAttachmentOfShareDataType:function(aa){return (this._attachments.length===1&&this._attachments[0].share_data_type===aa);},_hasShare:function(){return (this._attachments.length===1&&this._attachments[0].attach_type===j.SHARE);},_setVariables:function(aa){this._viewer=aa.viewer;this._sender=aa.thread.snippet_sender;this._attachments=aa.thread.snippet_attachments;this._photos=w(this._attachments);this._animatedImages=x(this._attachments);this._isViewerSender=z(this._sender,this._viewer);},_getSenderName:function(){if(!this._sender||this._isViewerSender)return null;var aa=m.getNow(this._sender);if(!aa)return null;return aa.short_name;},_ensureParticipant:function(aa){if(!aa)return;this._cancelParticipantFetch();if(!m.getNow(aa))this._sub=m.get(aa,function(ba){return this.forceUpdate();}.bind(this));},_cancelParticipantFetch:function(){this._sub&&this._sub.remove();}});function w(aa){if(!aa)return [];return aa.filter(function(ba){return ba.attach_type===j.PHOTO;});}function x(aa){if(!aa)return [];return aa.filter(function(ba){return ba.attach_type===j.ANIMATED_IMAGE;});}function y(aa){return (aa==o.LIKE_STICKER_ID||aa==o.HOT_LIKE_SMALL_STICKER_ID||aa==o.HOT_LIKE_MEDIUM_STICKER_ID||aa==o.HOT_LIKE_LARGE_STICKER_ID);}function z(aa,ba){return !!(aa&&l.getParticipantIDFromUserID(ba)==aa);}e.exports=v;},null);
__d("MercuryThreadImage.react",["ImmutableObject","MercuryIDs","MercuryParticipants","MercuryParticipantsConstants","Pixelz.react","React","SplitImage.react","areEqual"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){'use strict';var o=l.createClass({displayName:"MercuryThreadImage",propTypes:{thread:l.PropTypes.instanceOf(g).isRequired,viewer:l.PropTypes.string.isRequired,size:l.PropTypes.number},getInitialState:function(){return {participantImages:[]};},componentDidMount:function(){this._getParticipantImages(this.props);},componentWillReceiveProps:function(p,q){this._getParticipantImages(p);},shouldComponentUpdate:function(p,q){return (p.thread.image_src!==this.props.thread.image_src||p.size!==this.props.size||!n(q.participantImages,this.state.participantImages));},render:function(){var p=this.props.size||j.BIG_IMAGE_SIZE;if(this.props.thread.image_src)return (l.createElement(k,{height:p,resizeMode:'cover',src:this.props.thread.image_src,width:p}));if(this.state.participantImages.length>0)return (l.createElement(m,{srcs:this.state.participantImages,border:true,size:p}));return null;},_getParticipantImages:function(p){var q=p.thread,r=p.viewer;if(q.image_src)return;var s=h.getParticipantIDFromUserID(r),t=q.participants.filter(function(v){return v!=s;}),u=[];if(!t.length){u=[s];}else if(t.length==1){u=t;}else u=t.slice(0,3);i.getOrderedBigImageMulti(u,function(v){this.isMounted()&&this.setState({participantImages:v});}.bind(this));}});e.exports=o;},null);
__d("MercuryParticipantListRenderer",["fbt"],function(a,b,c,d,e,f,g){'use strict';function h(){this.$MercuryParticipantListRenderer0=false;this.$MercuryParticipantListRenderer1=false;this.$MercuryParticipantListRenderer2=false;this.$MercuryParticipantListRenderer3=function(r){return this.$MercuryParticipantListRenderer1?r.short_name:r.name;}.bind(this);}h.prototype.renderParticipantList=function(r){var s=r.map(this.$MercuryParticipantListRenderer3);switch(s.length){case 0:return i(this.$MercuryParticipantListRenderer0);case 1:return j(s);case 2:return this.$MercuryParticipantListRenderer2?l(s):k(s);case 3:return this.$MercuryParticipantListRenderer2?n(s):m(s);default:return this.$MercuryParticipantListRenderer2?p(s):o(s);}};h.prototype.setIsNewThread=function(r){this.$MercuryParticipantListRenderer0=r;return this;};h.prototype.setNameRenderer=function(r){this.$MercuryParticipantListRenderer3=r;return this;};h.prototype.setUseShortName=function(r){this.$MercuryParticipantListRenderer1=r;return this;};h.prototype.setUseAndSeparator=function(r){this.$MercuryParticipantListRenderer2=r;return this;};function i(r){if(r){return ("New Message");}else return ("No Participants");}function j(r){return r[0];}function k(r){return (g._("{participant1}, {participant2}",[g.param("participant1",r[0]),g.param("participant2",r[1])]));}function l(r){return (g._("{participant1} and {participant2}",[g.param("participant1",r[0]),g.param("participant2",r[1])]));}function m(r){return (g._("{participant1}, {participant2}, {participant3}",[g.param("participant1",r[0]),g.param("participant2",r[1]),g.param("participant3",r[2])]));}function n(r){return (g._("{participant1}, {participant2} and {participant3}",[g.param("participant1",r[0]),g.param("participant2",r[1]),g.param("participant3",r[2])]));}function o(r){return (g._("{participant1}, {participant2}, {participant3}, {others_link}",[g.param("participant1",r[0]),g.param("participant2",r[1]),g.param("participant3",r[2]),g.param("others_link",q(r.length-3))]));}function p(r){return (g._("{participant1}, {participant2} and {others_link}",[g.param("participant1",r[0]),g.param("participant2",r[1]),g.param("others_link",q(r.length-2))]));}function q(r){if(r>1){return (g._("{others_count} others",[g.param("others_count",r)]));}else return ("1 other");}e.exports=h;},null);
__d("MercuryThreadTitle.react",["MercuryIDs","MercuryParticipantListRenderer","MercuryParticipants","React","TextWithEmoticons.react","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l){'use strict';var m=j.createClass({displayName:"MercuryThreadTitle",propTypes:{isNewThread:j.PropTypes.bool,thread:j.PropTypes.object.isRequired,viewer:j.PropTypes.string.isRequired,showUnreadCount:j.PropTypes.bool,useShortName:j.PropTypes.bool,useAndSeparator:j.PropTypes.bool},getDefaultProps:function(){return {isNewThread:false,showUnreadCount:false,useShortName:false,useAndSeparator:false};},getInitialState:function(){return {participantNames:''};},componentDidMount:function(){this._renderParticipantsList(this.props);},componentWillReceiveProps:function(n){this._renderParticipantsList(n);},render:function(){return (j.createElement("span",{className:this.props.className},this.props.thread.name?this._renderThreadTitle():this.state.participantNames));},getTitle:function(){return this.state.participantNames;},_renderThreadTitle:function(){var n=this.props.thread,o=j.createElement(k,{renderEmoticons:true,renderEmoji:true,text:n.name});if(!n.unread_count||!this.props.showUnreadCount)return o;return this._renderTitleWithUnreadCount(o,n.unread_count);},_renderParticipantsList:function(n){if(n.thread.name)return;var o=g.getParticipantIDFromUserID(n.viewer),p=n.thread.participants;if(p.length>1)p=p.filter(function(q){return q!=o;});i.getMulti(p,function(q){if(!this.isMounted())return;var r=p.map(function(u){return q[u];}),s=new h().setUseShortName(this.props.useShortName).setUseAndSeparator(this.props.useAndSeparator).setIsNewThread(this.props.isNewThread).renderParticipantList(r),t=(n.showUnreadCount&&n.thread.unread_count)?this._renderTitleWithUnreadCount(s,n.thread.unread_count):s;this.setState({participantNames:t});}.bind(this));},_renderTitleWithUnreadCount:function(n,o){return (l._("{conversation-title} ({unread-count})",[l.param("conversation-title",n),l.param("unread-count",o)]));}});e.exports=m;},null);
__d("WebMessengerThreadPermalinks",["MercuryIDs","MessagingTag","URI","WebMessengerPermalinkConstants","WWWBase","requireWeak"],function(a,b,c,d,e,f,g,h,i,j,k,l){'use strict';var m={getThreadURI:function(q,r,s){if(g.isCanonical(q)){n(q,r,s);}else o(q,r,s);}};function n(q,r,s){var t=new i(k.uri),u=g.tokenize(q).value;t.setPath(p(s)+'/'+u);r&&r(t.toString());}function o(q,r,s){l(['MercuryServerRequests'],function(t){var u=t.get();u.getServerThreadID(q,function(v){var w=new i(k.uri);w.setPath(j.getURIPathForThreadID(v,p(s)));r&&r(w.toString());});});}function p(q){var r=j.BASE_PATH;if(q&&q!=h.INBOX)r+='/'+q;return r;}e.exports=m;},null);
__d("MercuryViewer",["CurrentUser","MercuryAssert"],function(a,b,c,d,e,f,g,h){'use strict';var i='fbid:'+g.getID(),j={getID:function(){return i;},isViewer:function(k){h.isParticipantID(k);return k===i;}};e.exports=j;},null);
__d("MercuryMessages",["AsyncRequest","BanzaiODS","CurrentUser","LogHistory","Map","MercuryActionStatus","MercuryActionType","MercuryAssert","MercuryAttachmentType","MercuryLogMessageType","MercuryMessageClientState","MercuryPayloadSource","MercurySingletonMixin","MercuryViewer","MercuryMessageActions","MercuryMessageIDs","RangedCallbackManager","ReportState","MercurySendMessageFields","MercuryServerRequests","MercuryThreadActions","MercuryThreadInformer","MercuryThreads","copyProperties","debounceAcrossTransitions","invariant","isNode","mergeDeep"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha){'use strict';var ia=j.getInstance('mercury_messages');function ja(wa,xa){var ya=xa;if(wa._localIdsMap[xa])ya=wa._localIdsMap[xa];return wa._messages.get(ya);}function ka(wa){switch(wa){case r.UNKNOWN:case r.SERVER_INITIAL_DATA:case r.SERVER_FETCH_THREAD_INFO:case r.SERVER_THREAD_SYNC:return true;}return false;}function la(wa){return wa&&wa.substr(0,6)==='server';}function ma(wa,xa){if(!wa._threadsToMessages[xa])wa._threadsToMessages[xa]=new w(function(ya){return ja(wa,ya).timestamp;},function(ya,za){return za-ya;});return wa._threadsToMessages[xa];}function na(wa){var xa=[];return JSON.stringify(wa,function(ya,za){if(typeof za==='object'&&za!==null){if(ga(za))return '<'+za.nodeName+'>';if(xa.indexOf(za)!==-1)return 'CIRCULAR';xa.push(za);}return za;});}x.registerCallback('mercury-messages',function(){var wa={},xa={},ya=pa._getInstances();for(var za in ya){wa[za]={};ya[za]._messages.forEach(function(bb,cb){if(Object.keys(bb).length===0)return;var db=bb.thread_id;wa[za][db]=wa[za][db]||{};wa[za][db][bb.message_id]=JSON.parse(na(bb));});xa[za]=Object.assign({},ya[za]._localIdsMap);}var ab={};ab.local_message_ids=xa;ab.messages=wa;return ab;});function oa(wa,xa,ya){xa.forEach(function(za){var ab=ma(wa,za);ab.setReachedEndOfArray();wa._threadInformer.reorderedMessages(za,ya);});}function pa(wa){this._fbid=wa;this._messageActions=u.getForFBID(this._fbid);this._serverRequests=z.getForFBID(this._fbid);this._threadInformer=ba.getForFBID(this._fbid);this._threads=ca.getForFBID(this._fbid);this._threadActions=aa.getForFBID(this._fbid);this._failedHistoryFetchThreads={};this._threadsToMessages={};this._localTitanMessagesCount={};this._messages=new k();this._attachmentData={};this._messagesNeedingAttachmentData={};this._localIdsMap={};this._serverRequests.subscribe('update-messages',function(xa,ya){var za=(ya.actions||[]).filter(function(bb){var cb=bb.action_type,db=((bb.is_forward||bb.thread_id)&&(cb==m.LOG_MESSAGE||cb==m.USER_GENERATED_MESSAGE||cb==m.SEND_MESSAGE||cb==m.CLEAR_CHAT||cb==m.DELETE_THREAD||cb==m.DELETE_MESSAGES||cb==m.MARK_MESSAGES_SPAM)),eb=((bb.upload_id&&bb.upload_data)&&(cb==m.CANCEL_ATTACHMENT_PLACEHOLDER||cb==m.CONFIRM_ATTACHMENT_PLACEHOLDER)),fb=(cb==m.ADD_SHARE_DATA_TO_EXISTING_MESSAGE&&(bb.server_id&&bb.attach_key&&bb.attach_data));return (db||eb||fb);}),ab=ka(ya.payload_source);if(la(ya.payload_source))za.forEach(function(bb){if(!bb.is_forward&&bb.action_type!==m.ADD_SHARE_DATA_TO_EXISTING_MESSAGE){var cb=this._threads.getThreadMetaNow(bb.thread_id);if(cb)bb.is_cleared=bb.timestamp<cb.chat_clear_time;}}.bind(this));this.handleUpdates(za,ab,ya.payload_source,ya.from_client);if(ya.end_of_history)oa(this,ya.end_of_history,ya.payload_source);}.bind(this));ia.debug('constructed',{fbid:this._fbid});}da(pa.prototype,{getMessagesFromIDs:function(wa){return (wa||[]).map(ja.bind(null,this)).filter(function(xa){return xa;});},hasLoadedNMessages:function(wa,xa){var ya=ma(this,wa);return ya.hasReachedEndOfArray()||ya.getCurrentArraySize()>=xa;},hasLoadedExactlyNMessages:function(wa,xa){var ya=ma(this,wa);return ya.getCurrentArraySize()==xa;},clearMercuryInternalState_DO_NOT_USE:function(){this._failedHistoryFetchThreads={};this._threadsToMessages={};this._localTitanMessagesCount={};this._messages=new k();this._attachmentData={};this._messagesNeedingAttachmentData={};this._localIdsMap={};},getThreadMessagesRange:function(wa,xa,ya,za,ab,bb){var cb=ma(this,wa),db=function(lb){za(qa(this,lb));}.bind(this),eb=cb.executeOrEnqueue(xa,ya,db),fb=cb.getUnavailableResources(eb),gb=this._failedHistoryFetchThreads[wa];if(fb.length&&!gb){var hb=cb.getCurrentArraySize(),ib=this._localTitanMessagesCount[wa]||0,jb=hb-ib,kb=fb.length+ib;ia.debug('fetch_missing_messages',{threadID:wa,offset:xa,limit:ya,missingIndices:fb,messageCount:hb,localMessageCount:ib});this._serverRequests.fetchThreadMessages(wa,jb,kb,ab,bb);}else this._failedHistoryFetchThreads[wa]=false;return eb;},getThreadMessagesSinceTimestamp:function(wa,xa){var ya=ma(this,wa),za=ya.getElementsUntil(xa);return qa(this,za);},hasLoadedAllMessages:function(wa){return ma(this,wa).hasReachedEndOfArray();},getCurrentlyLoadedMessages:function(wa){var xa=ma(this,wa).getAllResources();return qa(this,xa);},unsubscribe:function(wa,xa){n.isThreadID(xa);var ya=ma(this,xa);ya.unsubscribe(wa);},_addNewMessage:function(wa,xa){ta(this,xa);this._messages.set(wa,xa);},_addAttachmentData:function(wa,xa,ya){var za=ja(this,wa);if(za){var ab=za.attachments.indexOf(xa);if(ab!=-1){this._messages.set(wa,Object.assign({},za,{attachments:za.attachments.map(function(bb,cb){return cb===ab?ya:bb;})}));this._threadInformer.updatedMessage(za.thread_id,za.message_id,'attach');}}else{if(!this._attachmentData[wa])this._attachmentData[wa]=[];this._attachmentData[wa].push({attach_key:xa,data:ya});}},_shouldSortOutOfOrderMessages:function(wa,xa,ya){if(wa==r.CLIENT_CHANNEL_MESSAGE){var za=this.getThreadMessagesSinceTimestamp(xa,ya);if(za.length>0){h.bumpEntityKey('chat.web','channel.messages_reordered');return true;}}return false;},_preprocessIncomingAction:function(wa,xa){var ya=wa.action_type;if(xa==r.CLIENT_CHANNEL_MESSAGE&&ya==m.USER_GENERATED_MESSAGE&&wa.threading_id&&this._localIdsMap[wa.threading_id]===wa.threading_id){wa.client_message_id=wa.threading_id;wa.status=l.SUCCESS;wa.action_type=m.SEND_MESSAGE;ya=wa.action_type;}if(xa===r.CLIENT_CHANNEL_MESSAGE&&ya==m.USER_GENERATED_MESSAGE){var za=this._threads.getThreadMetaNow(wa.thread_id);if(za&&za.folder)wa.folder=za.folder;}return wa;},handleUpdates:function(wa,xa,ya,za){var ab,bb={},cb={};for(var db=0;db<wa.length;db++){var eb=this._preprocessIncomingAction(wa[db],ya),fb=eb.action_type,gb=ja(this,eb.message_id);if(eb.is_forward||ya==r.SERVER_SEARCH){if(!this._messages.has(eb.message_id))this._addNewMessage(eb.message_id,eb);continue;}else if(eb.client_state===q.SEND_TO_SERVER){this._addNewMessage(eb.message_id,eb);continue;}else if(fb==m.SEND_MESSAGE){var hb=eb.client_message_id;if(hb&&this._localIdsMap[hb]&&eb.status){var ib=ja(this,hb),jb=ib.status;if(ib.status==l.SUCCESS)continue;if(eb.status==l.UNCONFIRMED){if(!cb[eb.thread_id])cb[eb.thread_id]=[];cb[eb.thread_id].push(hb);}else if(!bb[eb.thread_id])bb[eb.thread_id]=[];this._updateLocalMessage(eb);if(typeof jb!==(void 0)||eb.status==l.FAILED_UNKNOWN_REASON||eb.status==l.UNABLE_TO_CONFIRM||eb.status==l.SUCCESS||eb.status==l.ERROR)this._threadInformer.updatedMessage(eb.thread_id,ja(this,hb).message_id,ya);}continue;}else if(fb==m.DELETE_THREAD){ma(this,eb.thread_id).removeAllResources();continue;}else if(fb==m.DELETE_MESSAGES){this._deleteMessages(eb.thread_id,eb.message_ids,ya);continue;}else if(fb==m.CLEAR_CHAT){var kb=ma(this,eb.thread_id).getAllResources();kb.map(ja.bind(null,this)).forEach(function(qb){qb.is_cleared=true;});continue;}else if(fb===m.MARK_MESSAGES_SPAM){this._markMessagesSpam(eb,ya);continue;}else if((eb.threading_id&&this._localIdsMap[eb.threading_id])||(gb&&!gb.is_forward)){if(gb&&eb.ranges&&eb.ranges.length>0){var lb=gb.message_id;this._messages.set(this._localIdsMap[lb]||lb,Object.assign({},gb,{ranges:eb.ranges}));this._threadInformer.updatedMessage(gb.thread_id,gb.message_id,'link_shim');}continue;}else if(fb===m.CONFIRM_ATTACHMENT_PLACEHOLDER){this._confirmAttachmentPlaceholder(eb.upload_id,eb.upload_data);continue;}else if(fb===m.CANCEL_ATTACHMENT_PLACEHOLDER){this._cancelAttachmentPlaceholder(eb.upload_id,eb.upload_data);continue;}else if(fb===m.ADD_SHARE_DATA_TO_EXISTING_MESSAGE){this._addAttachmentData(eb.server_id,eb.attach_key,eb.attach_data);continue;}else{if(ya===r.CLIENT_SEND_MESSAGE){this._localIdsMap[eb.message_id]=eb.message_id;if(eb.thread_id=='root:'+eb.message_id)ma(this,eb.thread_id).setReachedEndOfArray();}if(fb==m.LOG_MESSAGE&&eb.log_message_type==p.SERVER_ERROR)this._failedHistoryFetchThreads[eb.thread_id]=true;if(eb.client_state===q.DO_NOT_SEND_TO_SERVER&&eb.upload_id)this._uploadMessages[eb.upload_id]=eb;if(!bb[eb.thread_id])bb[eb.thread_id]=[];bb[eb.thread_id].push(eb.message_id);this._addNewMessage(eb.message_id,eb);if(eb.threading_id&&eb.threading_id!=eb.message_id)v.addServerID(eb.threading_id,eb.message_id);if(eb[y.MANUAL_RETRY_CNT]>0){ab=ma(this,eb.thread_id);ab.resortResources([eb.message_id]);this._threadInformer.reorderedMessages(eb.thread_id,r.CLIENT_SEND_MESSAGE);}xa=xa||this._shouldSortOutOfOrderMessages(ya,eb.thread_id,eb.timestamp);if(!xa)this._threadInformer.receivedMessage(eb);continue;}}for(var mb in bb){ab=ma(this,mb);var nb=ab.getAllResources(),ob=nb.filter(function(qb){var rb=this._messages.get(qb);return rb.action_type==m.LOG_MESSAGE&&rb.log_message_type==p.SERVER_ERROR;}.bind(this));ab.removeResources(ob);if(za)ra(this,mb,bb[mb]);if(xa){ab.addResources(bb[mb]);this._threadInformer.reorderedMessages(mb,ya);}else ab.addResourcesWithoutSorting(bb[mb].reverse(),0);this._threadInformer.updatedThread(mb);}var pb=Object.keys(cb);if(pb.length)this._serverRequests.requestMessageConfirmation(cb);ia.debug('handle_updates',{localMessageCounts:ha(this._localTitanMessagesCount)});},isOutbound:function(wa){return wa.author==t.getID();},isInbound:function(wa){return !this.isOutbound(wa);},isSending:function(wa){return (wa.status===l.UNSENT||wa.status===l.UNCONFIRMED||wa.status===l.UNABLE_TO_CONFIRM||wa.status===l.RESENDING);},isFirstMessage:function(wa){var xa=ma(this,wa.thread_id);if(xa.getCurrentArraySize()===0)return false;var ya=xa.getResourceAtIndex(xa.getCurrentArraySize()-1),za=ja(this,ya).message_id,ab=ja(this,wa.message_id).message_id;return xa.hasReachedEndOfArray()&&za==ab;},_markMessagesSpam:function(wa,xa){var ya=wa,za=ya.thread_id,ab=ya.message_ids;if(!ab.length)return;this._deleteIndividualMessages(za,ab,xa);this._serverRequests.markMessagesSpam(za,ab);},_deleteMessages:function(wa,xa,ya){if(!xa.length)return;this._deleteIndividualMessages(wa,xa,ya);if(ya!==r.CLIENT_CHANNEL_MESSAGE)this._serverRequests.deleteMessages(wa,xa);},_deleteIndividualMessages:function(wa,xa,ya){var za=xa.map(function(bb){return ja(this,bb).message_id;},this),ab=ma(this,wa);ab.removeResources(za);this._threadInformer.reorderedMessages(wa,ya);},_updateLocalMessage:function(wa){var xa=ja(this,wa.client_message_id),ya={};ya.status=wa.status;if(wa.status===l.SUCCESS||wa.error_data)ya.error_data=wa.error_data;var za=wa.message_id,ab=wa.client_message_id;if(this._messages.has(za)){this._messages.set(za,Object.assign({},xa,ya));return false;}if(wa.timestamp)ya.timestamp=wa.timestamp;if(wa.log_message_data)ya.log_message_data=wa.log_message_data;if(wa.ranges&&wa.ranges.length)ya.ranges=wa.ranges;if(wa.attachments&&wa.attachments.length){ya.raw_attachments=null;ya.attachments=wa.attachments;ta(this,ya,za);}this._localIdsMap[ab]=za;v.addServerID(ab,za);var bb=Object.assign({},xa,ya);this._messages.set(za,bb);this._messages.set(ab,{});if(sa(bb))this._localTitanMessagesCount[bb.thread_id]--;return true;},getNumberLocalMessages:function(wa){return this._localTitanMessagesCount[wa]||0;},_uploadMessages:{},_confirmAttachmentPlaceholder:function(wa,xa){var ya=this._popPendingAttachmentMessage(wa,xa);this._serverRequests.sendNewMessage(ya);},_cancelAttachmentPlaceholder:function(wa,xa){var ya=this._popPendingAttachmentMessage(wa,xa);this._deleteIndividualMessages(ya.thread_id,[ya.message_id]);if(this._localTitanMessagesCount[ya.thread_id])this._localTitanMessagesCount[ya.thread_id]--;},_popPendingAttachmentMessage:function(wa,xa){var ya=this._uploadMessages[wa];fa(ya);ya.image_ids=xa.image_ids;ya.file_ids=xa.file_ids;ya.audio_ids=xa.audio_ids;ya.gif_ids=xa.gif_ids;ya.client_state=q.SEND_TO_SERVER;delete this._uploadMessages[wa];return ya;}});Object.assign(pa,s);function qa(wa,xa){var ya=xa.map(ja.bind(null,wa));return ya.reverse();}function ra(wa,xa,ya){var za=ya.filter(function(ab){return sa(ja(wa,ab));});if(!wa._localTitanMessagesCount[xa])wa._localTitanMessagesCount[xa]=0;wa._localTitanMessagesCount[xa]+=za.length;}function sa(wa){var xa=wa.action_type;if(xa==m.USER_GENERATED_MESSAGE)return true;switch(wa.log_message_type){case p.SUBSCRIBE:case p.UNSUBSCRIBE:case p.SERVER_ERROR:case p.LIVE_LISTEN:return false;default:return true;}}function ta(wa,xa,ya){ya=ya||xa.message_id;var za=wa._attachmentData[ya];if(za){za.forEach(function(ab){var bb=xa.attachments.indexOf(ab.attach_key);if(bb!==-1)xa.attachments[bb]=ab.data;});delete wa._attachmentData[ya];}else if(!xa.is_forward&&ua(wa,xa)){wa._messagesNeedingAttachmentData[ya]=true;va(wa);}}function ua(wa,xa){if(!xa||!xa.attachments)return false;for(var ya=0;ya<xa.attachments.length;ya++){var za=xa.attachments[ya];if(typeof za==='string'&&za.indexOf(o.SHARE)===0)return true;}var ab=xa.forward_message_ids||[];for(ya=0;ya<ab.length;ya++){var bb=ja(wa,ab[ya]);if(ua(wa,bb))return true;}return false;}var va=ea(function(wa){var xa={};for(var ya in wa._messagesNeedingAttachmentData){var za=ja(wa,ya);if(ua(wa,za))xa[ya]=true;}var ab=Object.keys(xa);if(ab.length){var bb={message_ids:ab};if(wa._fbid!=i.getID())bb.request_user_id=wa._fbid;new g('/ajax/mercury/attachments/fetch_shares.php').setData(bb).setAllowCrossPageTransition(true).send();}wa._messagesNeedingAttachmentData={};},0,this);e.exports=pa;},null);
__d("MercuryChannelHandler",["Arbiter","ChannelConstants","MercuryActionType","MercuryGlobalActionType","MercuryMessages","MercuryPayloadSource","MercuryServerRequests","MercurySingletonMixin","MercuryThreadInformer","MercuryViewer","MessagingEvent","MessagingReliabilityLogger","MessagingTag","PresenceUtil","copyProperties","mixin"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){var w=v(n);for(var x in w)if(w.hasOwnProperty(x))z[x]=w[x];var y=w===null?null:w.prototype;z.prototype=Object.create(y);z.prototype.constructor=z;z.__superConstructor__=w;function z(aa){"use strict";this.$MercuryChannelHandler0=aa;this.$MercuryChannelHandler1=m.getForFBID(this.$MercuryChannelHandler0);this.$MercuryChannelHandler2=o.getForFBID(this.$MercuryChannelHandler0);this.$MercuryChannelHandler3=k.getForFBID(this.$MercuryChannelHandler0);this.$MercuryChannelHandler4=[];}z.prototype.getInstanceFBID=function(){"use strict";return this.$MercuryChannelHandler0;};z.prototype.$MercuryChannelHandler5=function(aa,ba){"use strict";if(!this.$MercuryChannelHandler6(aa)||!ba.obj||!ba.obj.message){r.addEntry('channel_receive','invalid_data');return;}var ca=ba.obj.message,da=ca.other_user_fbid?ca.other_user_fbid:ca.thread_fbid,ea={author:ca.mercury_author_id,author_email:ca.mercury_author_email,body:ca.body,subject:ca.subject,has_attachment:ca.has_attachment,attachments:ca.attachments,html_body:ca.html_body,thread_id:ca.tid,thread_fbid:ca.thread_fbid,other_user_fbid:ca.other_user_fbid,message_id:ca.mid,coordinates:ca.mercury_coordinates,is_spoof_warning:ca.is_spoof_warning,ranges:ca.ranges,source:ca.mercury_source,source_tags:ca.mercury_source_tags,threading_id:ca.threading_id,timestamp:ca.timestamp,timestamp_absolute:ca.timestamp_absolute,timestamp_relative:ca.timestamp_relative,timestamp_time_passed:ca.timestamp_time_passed,action_type:i.USER_GENERATED_MESSAGE,is_unread:ca.is_unread,is_forward:false,forward_count:ca.forward_count||ca.forward,forward_message_ids:ca.forward_msg_ids,location_text:ca.location_text,folder:ba.obj.folder};if("sync_id" in ca){ea.sync_id=ca.sync_id;}else ea.action_id=ca.action_id;var fa=[u({},ea)];fa=fa.concat(ca.forward_actions||[]);var ga=l.CLIENT_CHANNEL_MESSAGE;this.$MercuryChannelHandler1.handleUpdateWaitForThread({actions:fa,payload_source:ga},da);if(!ca.is_unread&&p.isViewer(ca.mercury_author_id)){var ha={};ha[da]=ba.obj.folder;this.$MercuryChannelHandler7(this.__getMessagingPayloadType(),{obj:{event:q.READ,thread_fbids:ca.thread_fbid?[ca.thread_fbid]:[],other_user_fbids:ca.other_user_fbid?[ca.other_user_fbid]:[],folder_info:ha,timestamp:ca.timestamp}});}r.addEntry('channel_receive','success',[da,ea.message_id,t.getSessionID()]);};z.prototype.$MercuryChannelHandler7=function(aa,ba){"use strict";if(!this.$MercuryChannelHandler6(aa)||!ba.obj||(!ba.obj.thread_fbids&&!ba.obj.other_user_fbids))return;var ca=[],da=ba.obj.event==q.READ;(ba.obj.thread_fbids||[]).forEach(function(ea){ca.push({action_type:i.CHANGE_READ_STATUS,action_id:null,thread_fbid:ea,mark_as_read:da,timestamp:ba.obj.timestamp||0,folder:ba.obj.folder_info[ea]});});(ba.obj.other_user_fbids||[]).forEach(function(ea){ca.push({action_type:i.CHANGE_READ_STATUS,action_id:null,other_user_fbid:ea,mark_as_read:da,timestamp:ba.obj.timestamp||0,folder:ba.obj.folder_info[ea]});});this.$MercuryChannelHandler1.handleUpdate({actions:ca,payload_source:l.CLIENT_CHANNEL_MESSAGE});};z.prototype.$MercuryChannelHandler8=function(aa,ba){"use strict";if(!this.$MercuryChannelHandler6(aa)||!ba.obj||!(ba.obj.thread_fbids||ba.obj.other_user_fbids))return;var ca=[];(ba.obj.thread_fbids||[]).forEach(function(da){ca.push({action_type:i.DELETE_THREAD,action_id:null,thread_fbid:da});});(ba.obj.other_user_fbids||[]).forEach(function(da){ca.push({action_type:i.DELETE_THREAD,action_id:null,other_user_fbid:da});});this.$MercuryChannelHandler1.handleUpdate({actions:ca,payload_source:l.CLIENT_CHANNEL_MESSAGE});};z.prototype.$MercuryChannelHandler9=function(aa,ba){"use strict";if(!this.$MercuryChannelHandler6(aa)||!ba.obj||(!ba.obj.thread_fbids&&!ba.obj.other_user_fbids)||!ba.obj.mids)return;var ca=ba.obj.thread_fbids.length?ba.obj.thread_fbids[0]:null,da=ba.obj.other_user_fbids.length?ba.obj.other_user_fbids[0]:null,ea={action_type:i.DELETE_MESSAGES,action_id:null,thread_fbid:ca,other_user_fbid:da,message_ids:ba.obj.mids};this.$MercuryChannelHandler1.handleUpdate({actions:[ea],threads:[ba.obj.updated_thread],payload_source:l.CLIENT_CHANNEL_MESSAGE});};z.prototype.$MercuryChannelHandlera=function(aa,ba){"use strict";if(!this.$MercuryChannelHandler6(aa)||!ba.obj||!ba.obj.folder)return;var ca={action_type:j.MARK_ALL_READ,action_id:ba.obj.action_id,folder:ba.obj.folder};this.$MercuryChannelHandler1.handleUpdate({global_actions:[ca]});};z.prototype.$MercuryChannelHandlerb=function(aa,ba){"use strict";if(!this.$MercuryChannelHandler6(aa)||(!ba.obj.thread_fbids&&!ba.obj.other_user_fbids))return;var ca=l.CLIENT_CHANNEL_MESSAGE;(ba.obj.thread_fbids||[]).forEach(function(da){var ea={action_type:i.CHANGE_ARCHIVED_STATUS,action_id:null,thread_fbid:da,other_user_fbid:null,archived:ba.obj.state};this.$MercuryChannelHandler1.handleUpdateWaitForThread({actions:[u({},ea)],payload_source:ca},da);},this);(ba.obj.other_user_fbids||[]).forEach(function(da){var ea={action_type:i.CHANGE_ARCHIVED_STATUS,action_id:null,thread_fbid:null,other_user_fbid:da,archived:ba.obj.state};this.$MercuryChannelHandler1.handleUpdateWaitForThread({actions:[u({},ea)],payload_source:ca},da);},this);};z.prototype.$MercuryChannelHandlerc=function(aa,ba){"use strict";if(!this.$MercuryChannelHandler6(aa)||(!ba.obj.thread_fbids&&!ba.obj.other_user_fbids))return;var ca=l.CLIENT_CHANNEL_MESSAGE,da;(ba.obj.thread_fbids||[]).forEach(function(ea){if(ba.obj.event==q.TAG){da=ba.obj.tag;}else da=ba.obj.marked_as_spam?s.SPAM:s.INBOX;var fa={action_type:i.CHANGE_FOLDER,action_id:null,thread_fbid:ea,other_user_fbid:null,new_folder:da};this.$MercuryChannelHandler1.handleUpdateWaitForThread({actions:[u({},fa)],payload_source:ca},ea);},this);(ba.obj.other_user_fbids||[]).forEach(function(ea){if(ba.obj.event==q.TAG){da=ba.obj.tag;}else da=ba.obj.marked_as_spam?s.SPAM:s.INBOX;var fa={action_type:i.CHANGE_FOLDER,action_id:null,other_user_fbid:ea,thread_fbid:null,new_folder:da};this.$MercuryChannelHandler1.handleUpdateWaitForThread({actions:[u({},fa)],payload_source:ca},ea);},this);};z.prototype.$MercuryChannelHandlerd=function(aa,ba){"use strict";if(!this.$MercuryChannelHandler6(aa)||!ba.obj.tag)return;switch(ba.obj.tag){case s.ACTION_ARCHIVED:this.$MercuryChannelHandlerb(aa,ba);break;case s.INBOX:case s.OTHER:this.$MercuryChannelHandlerc(aa,ba);break;}};z.prototype.__markAsSeen=function(aa,ba){"use strict";if(!this.$MercuryChannelHandlere(aa)||!ba.obj||!ba.obj.seen_timestamp)return;this.$MercuryChannelHandler1.handleUpdate({message_counts:[{seen_timestamp:ba.obj.seen_timestamp,folder:s.INBOX}],unseen_thread_fbids:[{thread_fbids:[],other_user_fbids:[],folder:s.INBOX}],payload_source:l.CLIENT_CHANNEL_MESSAGE});};z.prototype.__updateModelsFromMercuryPayload=function(aa,ba){"use strict";if(!this.$MercuryChannelHandlerf(aa)||!ba.obj)return;this.$MercuryChannelHandler2.synchronizeInforms(function(){var ca=ba.obj,da=[];(ca.actions||[]).forEach(function(ea){var fa=i.USER_GENERATED_MESSAGE;if(ea.action_type==i.LOG_MESSAGE){var ga=l.CLIENT_CHANNEL_MESSAGE,ha;ha=ea.other_user_fbid||ea.thread_fbid;this.$MercuryChannelHandler1.handleUpdateWaitForThread({actions:[u({},ea)],payload_source:ga},ha);}else if(ea.action_type!=fa)da.push(ea);},this);ca.actions=da;ca.payload_source=l.CLIENT_CHANNEL_MESSAGE;this.$MercuryChannelHandler1.handleUpdate(ca);}.bind(this));};z.prototype.$MercuryChannelHandlerg=function(aa,ba){"use strict";this.$MercuryChannelHandler1.handleRoger(ba.obj);};z.prototype.$MercuryChannelHandlerh=function(aa,ba){"use strict";if(!this.$MercuryChannelHandler6(aa)||!ba.obj||ba.obj.mute_settings===(void 0)||(!ba.obj.thread_fbid&&!ba.obj.other_user_fbid))return;var ca=i.CHANGE_MUTE_SETTINGS,da=[{action_type:ca,action_id:null,thread_fbid:ba.obj.thread_fbid,other_user_fbid:ba.obj.other_user_fbid,mute_settings:ba.obj.mute_settings}];this.$MercuryChannelHandler1.handleUpdate({actions:da,payload_source:l.CLIENT_CHANNEL_MESSAGE});};z.prototype.__handleMessagingPayload=function(aa,ba){"use strict";switch(ba.obj.event){case q.DELIVER:this.$MercuryChannelHandler5(aa,ba);break;case q.READ:case q.UNREAD:this.$MercuryChannelHandler7(aa,ba);break;case q.READ_ALL:this.$MercuryChannelHandlera(aa,ba);break;case q.DELETE:this.$MercuryChannelHandler8(aa,ba);break;case q.DELETE_MESSAGES:this.$MercuryChannelHandler9(aa,ba);break;case q.TAG:this.$MercuryChannelHandlerd(aa,ba);break;case q.REPORT_SPAM:this.$MercuryChannelHandlerc(aa,ba);break;case q.READ_RECEIPT:this.$MercuryChannelHandlerg(aa,ba);break;case q.CHANGE_MUTE_SETTINGS:this.$MercuryChannelHandlerh(aa,ba);break;}};z.prototype.getRouting=function(){"use strict";return {mercury:this.__updateModelsFromMercuryPayload,messaging:this.__handleMessagingPayload,inbox:this.__markAsSeen};};z.prototype.__getMessagingPayloadType=function(){"use strict";return h.getArbiterType('messaging');};z.prototype.__getMercuryPayloadType=function(){"use strict";return h.getArbiterType('mercury');};z.prototype.__getInboxPayloadType=function(){"use strict";return h.getArbiterType('inbox');};z.prototype.$MercuryChannelHandler6=function(aa){"use strict";return (aa==this.__getMessagingPayloadType());};z.prototype.$MercuryChannelHandlerf=function(aa){"use strict";return (aa==this.__getMercuryPayloadType());};z.prototype.$MercuryChannelHandlere=function(aa){"use strict";return (aa==this.__getInboxPayloadType());};z.prototype.turnOn=function(){"use strict";if(!this.$MercuryChannelHandler4.length){var aa=this.getRouting();for(var ba in aa)this.$MercuryChannelHandler4.push(g.subscribe(h.getArbiterType(ba),aa[ba].bind(this)));}return this;};z.prototype.turnOff=function(){"use strict";if(this.$MercuryChannelHandler4.length){this.$MercuryChannelHandler4.forEach(g.unsubscribe);this.$MercuryChannelHandler4=[];}return this;};u(z,n);e.exports=z;},null);
__d("MercuryRoger",["Arbiter","ArbiterMixin","immutable","JSLogger","MercuryActionStatus","mapObject","MercuryServerRequests","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k,l){var m=b('MercuryServerRequests').get(),n=b('MercuryThreads').get(),o={},p=[],q=k.SUCCESS,r={getSeenBy:function(u,v){if(!u)return [];var w=[],x=o[u.thread_id];if(!x)return w;x.forEach(function(y,z){if(s(u,y,z,v))w.push(z);});return w;},wasSeenByAll:function(u){if(!u)return false;var v=o[u.thread_id];if(!v)return false;return v.every(function(w,x){return s(u,w,x);});},getSeenTimestamps:function(u){var v=o[u];if(!v){v=i.OrderedMap();o[u]=v;}return v;},getSeenTimestamp:function(u,v){var w=o[u];return w?w.get(v):null;}};Object.assign(r,h);function s(u,v,w,x){return !!(v>u.timestamp&&(u.status===(void 0)||u.status===q)&&(!x||w!=u.author));}m.subscribe('update-roger',function(u,v){for(var w in v){var x=o[w]||i.OrderedMap();x=x.withMutations(function(y){for(var z in v[w]){var aa=n.getThreadMetaNow(w);if(aa&&aa.participants)if(aa.participants.indexOf(z)==-1){p.push(t(o));continue;}var ba=y.get(z),ca=v[w][z];if(!ba||ca>ba)y.set(z,ca);}});o[w]=x.sort();}v&&r.inform('change',v);});g.subscribe(j.DUMP_EVENT,function(u,v){v.bad_read_receipts={receipts:p};});function t(u){return l(u,function(v){return v.toJS();});}e.exports=r;},null);
__d("MercuryDelayedRoger",["ArbiterMixin","LiveTimer","MercuryActionStatus","MercuryConfig","MercuryRoger","setTimeoutAcrossTransitions","MercuryMessages","MercuryThreadInformer","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k,l){var m=b('MercuryMessages').get(),n=b('MercuryThreadInformer').get(),o=b('MercuryThreads').get(),p={},q={},r=j['roger.seen_delay'],s={getSeenBy:function(x,y){if(q[x])return [];return k.getSeenBy(t(x),y);},wasSeenByAll:function(x){if(q[x])return false;return k.wasSeenByAll(t(x));}};Object.assign(s,g);function t(x){if(!p[x]){var y=o.getThreadMetaNow(x);if(y)p[x]={thread_id:x,author:y.participants[0],timestamp:y.timestamp};}return p[x];}function u(x){var y=false;m.getThreadMessagesRange(x,0,1,function(z){var aa=z[0];if(!aa)return;var ba=aa.timestamp;if(aa.action_id||aa.status==i.SUCCESS)ba-=h.getServerTimeOffset();var ca=s.getSeenBy(x);if(q[x]){clearTimeout(q[x]);delete q[x];}var da=ba+r,ea=da-Date.now();if(ea>0)q[x]=l(function(){delete q[x];v(x);},ea);p[x]=aa;var fa=s.getSeenBy(x);if(ca.length||fa.length)y=true;});return y;}function v(x){var y={};y[x]=true;s.inform('state-changed',y);}function w(event,x){var y={};for(var z in x)if(u(z))y[z]=true;for(var aa in y){s.inform('state-changed',y);break;}}k.subscribe('change',function(x,y){for(var z in y)!q[z]&&v(z);});n.subscribe('messages-received',w);n.subscribe('messages-reordered',w);n.subscribe('messages-updated',w);e.exports=s;},null);
__d("AsyncLayout",["AjaxPipeRequest","Arbiter","AsyncRequest","AsyncResponse","CSS","DOM","HTML","NavigationMessage","PageTransitions","URI","$","emptyFunction","ge","goURI"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){function u(v){"use strict";this.canvasID=v;if(s('rightCol'))this.auxiliaryID='rightCol';if(s('headerArea'))this.headerID='headerArea';if(s('toolbarContainer'))this.toolbarID='toolbarContainer';this.waitingForAux=false;o.registerHandler(this.catchPageTransition.bind(this));this.subscription=h.subscribe(n.NAVIGATION_BEGIN,this.onNavigate.bind(this));h.inform('AsyncLayout/initialized',null,h.BEHAVIOR_STATE);}u.prototype.catchPageTransition=function(v){"use strict";this.subscription.unsubscribe();return false;};u.prototype.getCanvasID=function(v){"use strict";return v.sidecol?'contentCol':'contentArea';};u.prototype.onNavigate=function(v,w){"use strict";var x=w.useAjaxPipe;w=w.params;if(w.endpoint){if(this.request){this.request.setFinallyHandler(r);this.request.abort();}if(this.sideRequest)this.sideRequest.abort();if(x){this.request=new g().setURI(w.endpoint).setData(w).setCanvasId(this.getCanvasID(w)).setFinallyHandler(this.finallyHandler.bind(this)).setErrorHandler(this.errorHandler.bind(this)).setFirstResponseCallback(this.firstResponseCallback.bind(this)).send();}else{w.handled=true;this.waitingForAux=w.sidecol;var y=!!w.iframe,z=new i().setOption('useIframeTransport',y).setURI(new p(w.endpoint)).setReadOnly(true).setMethod('GET').setData(w).setHandler(this.onResponse.bind(this)).setErrorHandler(this.errorHandler.bind(this)).setFinallyHandler(this.finallyHandler.bind(this));this.request=z;z.send();}}};u.prototype.onSideResponse=function(v){"use strict";var w=v.getPayload();if(w&&this.auxiliaryID)this.receivedAux(w);};u.prototype.receivedAux=function(v){"use strict";!this.waitingForAux;this.waitingForAux=false;l.setContent(q(this.auxiliaryID),m(v));};u.prototype.onResponse=function(v){"use strict";var w=v.getPayload();if(w.redirect){t(w.redirect);}else{var x=w.html||w;l.setContent(q(this.canvasID),m(x));if(w.side_html&&this.auxiliaryID)this.receivedAux(w.side_html);if(this.headerID&&!w.keep_header){var y=q(this.headerID);l.setContent(y,m(w.header_html||''));k.conditionShow(y,w.header_html);}if(w.toolbar_html&&this.toolbarID)l.setContent(q(this.toolbarID),m(w.toolbar_html));if(w.js)(new Function(w.js))();k.conditionClass('contentCol','hasRightCol',this.auxiliaryID&&!w.noRightSide);var z=s('rightCol');if(z&&w.noRightSide)l.empty(z);}var aa=v.getRequest().getData();h.inform(n.NAVIGATION_COMPLETED,aa.key);};u.prototype.errorHandler=function(v){"use strict";j.verboseErrorHandler(v);h.inform(n.NAVIGATION_FAILED);this.request=null;};u.prototype.firstResponseCallback=function(v){"use strict";window.scrollTo(0,0);h.inform(n.NAVIGATION_FIRST_RESPONSE);};u.prototype.finallyHandler=function(v){"use strict";this.request=null;o.transitionComplete(true);h.inform(n.NAVIGATION_COMPLETED);};e.exports=u;},null);
__d("FileFormResetOnSubmit",["DOMQuery","Event","emptyFunction"],function(a,b,c,d,e,f,g,h,i){function j(l,m){var n=h.listen(l,'change',i.thatReturnsFalse,h.Priority.URGENT);try{m();}catch(o){throw o;}finally{n.remove();}}function k(l){"use strict";this._form=l;}k.prototype.enable=function(){"use strict";var l=this._reset.bind(this);this._subscription=this._form.subscribe('submit',function(){setTimeout(l,0);});};k.prototype.disable=function(){"use strict";this._subscription.unsubscribe();this._subscription=null;};k.prototype._reset=function(){"use strict";var l=this._form.getRoot();j(l,function(){var m=g.scry(l,'input[type="file"]');m.forEach(function(n){n.value='';});});};e.exports=k;},null);
__d("MusicButtonStore",[],function(a,b,c,d,e,f){var g={},h={addButton:function(i,j){g[i]=j;return j;},getButton:function(i){return g[i];},getButtons:function(){return g;},removeButton:function(i){g[i]&&g[i].resetLoadingTimers();delete g[i];}};e.exports=h;},null);
__d("MusicConstants",["URI"],function(a,b,c,d,e,f,g){var h={DEBUG:false,CONFIG:{PARTNER_TIMEOUT:8000},LIVE_LISTEN_MIN_SPOTIFY_VERSION:'spotify-0.6.6.0.g5a9eaca5',enableDebug:function(){this.DEBUG=true;},sameURLs:function(i,j){var k=/\/$/;if(i&&j){i=g(i);j=g(j);return i.getDomain()==j.getDomain()&&i.getPath()==j.getPath();}return false;},greaterOrEqualToMinimumVersion:function(i,j){var k=/(?:\d+\.)+/,l=i.match(k)[0].split('.').slice(0,-1),m=j.match(k)[0].split('.').slice(0,-1);if(l.length!==m.length)return false;for(var n=0;n<m.length;n++)if(+l[n]<+m[n]){return false;}else if(+l[n]>+m[n])return true;return true;},sanitizeForProviders:function(i){var j={};for(var k in i)if(this.ALLOWED_EXTERNAL_CONTEXT_PARAMS[k])j[k]=i[k];return j;},OP:{RESUME:'RESUME',PAUSE:'PAUSE',PLAY:'PLAY',VERSION:'VERSION'},STATUS_CHANGE_OP:{STATUS:'STATUS',LOGIN:'LOGIN',REINFORM:'REINFORM'},STATUS_CHANGE_EVENT:{playing:'PLAY_STATE_CHANGED',track:'TRACK_CHANGED'},DIAGNOSTIC_EVENT:{ALL_PAUSED:'ALL_PAUSED',ALL_OFFLINE:'ALL_OFFLINE',OFFLINE:'OFFLINE',ONLINE:'ONLINE',SEARCHING:'SEARCHING',HIT:'HIT',MISS:'MISS',RESIGN:'RESIGN',IFRAME_POLLING:'IFRAME_POLLING',RELAUNCH:'RELAUNCH',STATE_CHANGE:'STATE_CHANGE',WRONG_VERSION:'WRONG_VERSION',SERVICE_ERROR:'SERVICE_ERROR',INCORRECT_ONLINE_STATE:'INCORRECT_ONLINE_STATE',LOG_SEND_OP:'LOG_SEND_OP',REQUEUE_OP:'REQUEUE_OP'},ALLOWED_STATUS_PARAMS:{playing:'playing',track:'track',context:'context',client_version:'client_version',start_time:'start_time',expires_in:'expires_in',open_graph_state:'open_graph_state'},ALLOWED_EXTERNAL_CONTEXT_PARAMS:{uri:true,song:true,radio_station:true,album:true,playlist:true,musician:true,song_list:true,offset:true,title:true,request_id:true,listen_with_friends:true,needs_tos:true},LIVE_LISTEN_OP:{NOW_LEADING:'NOW_LEADING',NOW_LISTENING:'NOW_LISTENING',END_SESSION:'END_SESSION',SONG_PLAYING:'SONG_PLAYING',LISTENER_UPDATE:'LISTENER_UPDATE',QUEUE_SESSION:'QUEUE_SESSION',PLAY_ERROR:'PLAY_ERROR',SESSION_UPDATED:'SESSION_UPDATED',QUEUING_SESSION:'QUEUING_SESSION'},MUSIC_BUTTON:{ACTIVATE:'ACTIVATE'},ERROR:{1:'SERVICE_UNAVAILABLE_WITHOUT_PREMIUM',2:'SERVICE_UNAVAILABLE_WITHOUT_PREMIUM_OR_WAIT',3:'SERVICE_UNAVAILABLE_BILLING_ISSUE',4:'SERVICE_UNAVAILABLE_TECHNICAL_ISSUE',5:'AUDIO_AD_PLAYING',99:'SERVICE_TEMPORARILY_UNAVAILABLE',101:'SONG_UNAVAILABLE_WITHOUT_PURCHASE',102:'SONG_UNAVAILABLE_WITHOUT_PREMIUM',103:'SONG_UNAVAILABLE_INDEFINITELY'}};e.exports=a.MusicConstants||h;},null);
__d("MusicEvents",["Arbiter"],function(a,b,c,d,e,f,g){e.exports=a.MusicEvents=new g();},null);
__d("MusicButton",["BanzaiODS","Bootloader","copyProperties","CSS","DOM","MusicButtonStore","MusicConstants","MusicEvents","Parent","BanzaiScuba","Tooltip","cx","setTimeoutAcrossTransitions"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){var t=function(u,v,w,x,y,z){this.provider=u;this.buttonElem=v;this.url=w;this.context=x||{};this.mediaType=y;this.setState(this.STATES.OFFLINE);this.tooltip=z||'';n.subscribe(m.MUSIC_BUTTON.ACTIVATE,this.processClick.bind(this));};i(t,{tracksetableTypes:[]});i(t.prototype,{SHOW_LOADING_TIMEOUT:500,HIDE_LOADING_TIMEOUT:m.CONFIG.PARTNER_TIMEOUT,RECENTLY_ONLINE_TIMEOUT:6000,STATES:{PLAYING:'music_playing',PAUSED:'music_paused',LOADING:'music_loading',DISABLED:'music_disabled',OFFLINE:'music_offline'},setState:function(u){if(u!==this.STATES.LOADING){this.resetLoadingTimers();this.previousState=this.state||u;}if(u===this.STATES.PLAYING){q.set(this.buttonElem,this.tooltip);}else q.set(this.buttonElem,'');var v=this.buttonElem.parentNode;this.state&&j.removeClass(v,this.state);this.state=u;j.addClass(v,this.state);},isTracksetable:function(u){return t.tracksetableTypes.indexOf(this.mediaType)!==-1;},handleIncomingEvent:function(u,v){clearTimeout(this._showLoadingTimer);if(v&&v.provider&&v.provider!=this.provider)return;switch(u){case m.DIAGNOSTIC_EVENT.ONLINE:case m.STATUS_CHANGE_EVENT.track:case m.STATUS_CHANGE_EVENT.playing:var w=v&&v.track&&v.track.uri,x=v&&v.context&&v.context.uri;if(v&&v.playing&&(m.sameURLs(w,this.url)||m.sameURLs(x,this.url))){this.setState(this.STATES.PLAYING);}else if(this.state===this.STATES.LOADING&&(this.previousState===this.STATES.PAUSED||this.previousState===this.STATES.OFFLINE)){clearTimeout(this._attemptingPlayTimer);this._attemptingPlayTimer=s(this.setState.bind(this,this.STATES.PAUSED),this.RECENTLY_ONLINE_TIMEOUT);}else if(!this._attemptingPlayTimer)this.setState(this.STATES.PAUSED);break;case m.DIAGNOSTIC_EVENT.OFFLINE:this.setState(this.STATES.OFFLINE);break;case m.DIAGNOSTIC_EVENT.ALL_OFFLINE:this.setState(this.STATES.OFFLINE);break;}},processClick:function(u,v){if(v!=this.buttonElem){if(this.state===this.STATES.LOADING)this.previousState&&this.setState(this.previousState);return;}var w=new p('music_play_button_click',null,{addBrowserFields:true,addPredictedGeographyFields:true,addUser:true});w.addNormal('uses_bridge','1');w.addNormal('state',this.state);w.addNormal('provider',this.provider);w.addNormal('class','MusicButton');w.addNormal('insights_source',this.context.appear_source_log_str);w.addDenorm('url',this.url);w.post();if(this.state!=this.STATES.PLAYING){g.bumpEntityKey('music_play_button','music_play_button_click');g.bumpEntityKey('music_play_button','music_play_button_click.'+this.provider);var x=o.byClass(this.buttonElem,"_4--s");if(x){j.addClass(x,"_4--t");setTimeout(j.removeClass.bind(null,x,"_4--t"),3000);}}var y=this.isTracksetable()&&o.byClass(this.buttonElem,'music_trackset_container'),z=[];if(y){var aa=y.getAttribute('data-trackset-title'),ba=this.provider,ca=k.scry(y,'.music_button');for(var da=0;da<ca.length;da++){var ea=l.getButton([ca[da].id]);if(ea&&ea.provider==ba&&ea.isTracksetable())z.push(ea.url);}}if(!a.Music)this.showLoading(true);h.loadModules(["Music"],function(fa){var ga=(y&&z.length>1)?fa.playPauseSongList(this.provider,this.url,z,aa,this.context):fa.playPauseSong(this.provider,this.url,this.context);this.showLoading(!ga);}.bind(this));},showLoading:function(u){this.resetLoadingTimers();this._hideLoadingTimer=s(this._timeout.bind(this,u),this.HIDE_LOADING_TIMEOUT);this._showLoadingTimer=s(this.setState.bind(this,this.STATES.LOADING),this.SHOW_LOADING_TIMEOUT);},resetLoadingTimers:function(){clearTimeout(this._hideLoadingTimer);clearTimeout(this._showLoadingTimer);clearTimeout(this._attemptingPlayTimer);this._attemptingPlayTimer=null;},destroy:function(){this.resetLoadingTimers();this.buttonElem=null;},_timeout:function(u){a.Music&&a.Music.reInform([this.provider]);if(!u&&this.state===this.STATES.LOADING)this.setState(this.STATES.PAUSED);}});e.exports=t;},null);
__d("MusicButtonManager",["Event","DOM","KeyedCallbackManager","Layer","MusicButton","MusicButtonStore","MusicConstants","MusicEvents","Parent","$","copyProperties","ge"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){var s=new i(),t=null,u={},v=0;function w(da){var ea=da.getTarget(),fa=o.byClass(ea,'music_button');fa=fa||(!(da.getModifiers&&da.getModifiers().any)&&x(ea));if(!fa)return;return y(fa,da);}function x(da){var ea=o.byClass(da,'music_button_trigger')&&o.byClass(da,'music_button_trigger_group');if(ea){var fa=h.scry(ea,'.music_button');if(fa.length)return fa[0];}return null;}function y(da,event){event&&event.stop();n.inform(m.MUSIC_BUTTON.ACTIVATE,da);return false;}function z(da){a.Music&&a.Music.reInform(da);}function aa(da,ea){var fa=l.getButtons();for(var ga in fa)if(fa[ga].noGC||r(ga)){fa[ga].handleIncomingEvent(da,ea);}else l.removeButton(ga);}var ba={init:function(da){if(t)return;t=true;k.tracksetableTypes=da||[];g.listen(document.body,'click',w);n.subscribe([m.STATUS_CHANGE_EVENT.playing,m.STATUS_CHANGE_EVENT.track,m.DIAGNOSTIC_EVENT.OFFLINE,m.DIAGNOSTIC_EVENT.ALL_OFFLINE,m.DIAGNOSTIC_EVENT.ONLINE],aa);},add:function(da,ea,fa,ga,ha,ia){t||ba.init();var ja=ea.id,ka=l.getButton(ja);if(ka)return ka;ka=l.addButton(ja,new k(da,ea,fa,q({button_id:ja},ga),ha,ia));var la=o.byClass(ea,'uiOverlay');if(la){ka.noGC=true;var ma=j.subscribe('destroy',function(na,oa){if(h.contains(oa.getRoot(),ea)){l.removeButton(ja);j.unsubscribe(ma);}});}if(da&&!u[da])u[da]=setTimeout(function(){var na=Object.keys(u);na.length&&z(na);u={};},0);return ka;},addButton:function(da,ea,fa,ga,ha,ia){if(!r(ea))return;var ja=p(ea);return ba.add(da,ja,fa,ga,ha,ia);},asyncAddMusicButton:function(da,ea){da.setAttribute('id','music_button_'+v++);ca(da,ea);},tryAddButtonInDOM:function(da,ea){var fa=r(da);fa&&ca(fa,ea);},addMusicData:function(da,ea,fa,ga,ha,ia){s.setResource(da,{provider:ea,uri:fa,context:ga,media_type:ha,tooltip:ia});}};function ca(da,ea){var fa=h.find(da,'a.button_anchor').getAttribute('href');s.executeOrEnqueue(fa,function(ga){return ba.add(ga.provider,da,ga.uri,ga.context,ga.media_type,ea?ga.tooltip:'');});}e.exports=a.MusicButtonManager||ba;},null);
__d("PhotoStore",["Arbiter","PhotoStoreCore"],function(a,b,c,d,e,f,g,h){g.subscribe('update-photos',function(i,j){h.updateData(j);});e.exports=h;},null);
__d("PhotoUtils",["Event","URI"],function(a,b,c,d,e,f,g,h){var i={getImagesFromData:function(j){var k=[];for(var l in j)if(l.indexOf('image')===0)k.push(j[l]);return k;},getFBIDFromData:function(j){return j&&j.id;},getOriginalImageFromData:function(j){return j.original||j.download_image;},getDownloadURLFromData:function(j){var k=this.getOriginalImageFromData(j);if(!k)return null;var l=new h(k.uri);l.addQueryData({dl:1});return l;},getPermalinkFromData:function(j){return j.permalink;},canViewerMakeCoverPhoto:function(j){return !!j.can_viewer_make_cover_photo;},getCoverPhotoURLFromData:function(j){return new h('/profile.php').addQueryData({preview_cover:i.getFBIDFromData(j)});},preload:function(j,k,l){var m=j.getDimensions();for(var n=0;n<k.length;++n){var o=m.getBestFitImageFromPhoto(k[n],m.getMaxStageDimensions()),p=new Image();l&&g.listen(p,'load',l.bind(null,k[n]));j.getLogger().log(o.uri);p.src=o.uri;}}};e.exports=i;},null);
__d("PhotoViewState",["ArbiterMixin","PhotoStore","PhotoUtils","SpotlightViewerLoggingEvents","copyProperties","mixin"],function(a,b,c,d,e,f,g,h,i,j,k,l){var m=l(g);for(var n in m)if(m.hasOwnProperty(n))p[n]=m[n];var o=m===null?null:m.prototype;p.prototype=Object.create(o);p.prototype.constructor=p;p.__superConstructor__=m;function p(q,r,s,t,u){"use strict";this._viewer=q;this._setID=r;this._updateCallback=t;this._position=s||0;this._preloaded={};this._reverse=u;}p.prototype._fetchCallback=function(q){"use strict";if(!this._viewer.isOpen())return;this._preload(q);this._log(j.DATA_FETCH_COMPLETE);};p.prototype._preload=function(q){"use strict";i.preload(this._viewer,q,function(r){this._preloaded[i.getFBIDFromData(r)]=true;}.bind(this));};p.prototype._preloadPhotosInRange=function(q,r){"use strict";var s=[];for(var t=q;t<=r;++t){var u=h.getByIndexImmediate(this._setID,t);if(u&&!this._isPreloaded(u))s.push(u);}this._preload(s);};p.prototype._isPreloaded=function(q){"use strict";return this._preloaded[i.getFBIDFromData(q)];};p.prototype.getPosition=function(){"use strict";return this._position;};p.prototype.isValidMovement=function(q){"use strict";if(!h.hasBeenCreated(this._setID))return false;if(h.hasLooped(this._setID))return true;var r=this._position+q,s=h.getAvailableRange(this._setID),t=s.offset+s.length-1;return r>=s.offset-1&&r<=t+1;};p.prototype.getRelativeMovement=function(q){"use strict";return h.getIndexForID(this._setID,q)-this._position;};p.prototype.moveCursor=function(q){"use strict";if(!this.isValidMovement(q))return false;this._position+=q;return true;};p.prototype._page=function(q){"use strict";if(!this.moveCursor(q))return;this._log(j.PAGE_BEGIN);var r=h.getByIndexImmediate(this._setID,this._position);if(!r){this.inform('photo_fetch');this._log(j.PHOTO_FETCH);}else if(!this._isPreloaded(r))this._preload([r]);h.getByIndex(this._setID,this._position,this._updateCallback);this._loadMoreIfNecessary(q>0,p.BUFFER_SIZE);this._log(j.PAGE_COMPLETE);};p.prototype.loadMoreForwardIfNecessary=function(q){"use strict";var r=h.getAvailableRange(this._setID),s=r.offset+r.length-1,t=this._position+q;if(t>s&&!h.hasLooped(this._setID)){var u=h.getCursorByIndexImmediate(this._setID,s);h.fetchForward(this._setID,u,q,this._fetchCallback.bind(this));}else this._preloadPhotosInRange(this._position+1,t);};p.prototype.loadMoreBackwardIfNecessary=function(q){"use strict";var r=h.getAvailableRange(this._setID),s=this._position-q;if(s<r.offset&&!h.hasLooped(this._setID)){var t=h.getCursorByIndexImmediate(this._setID,r.offset);h.fetchBackward(this._setID,t,q,this._fetchCallback.bind(this));}else this._preloadPhotosInRange(s,this._position-1);};p.prototype._loadMoreIfNecessary=function(q,r){"use strict";if(q){this.loadMoreForwardIfNecessary(r);}else this.loadMoreBackwardIfNecessary(r);};p.prototype.displayFirst=function(){"use strict";if(!this._viewer.isOpen())return;h.setPreFetchCallback(this._setID,function(){this._log(j.DATA_FETCH_BEGIN);}.bind(this));var q=function(r){if(!this._isPreloaded(r))this._preload([r]);this._updateCallback(r);}.bind(this);h.getByIndex(this._setID,this._position,q);if(this._reverse){this.loadMoreBackwardIfNecessary(p.BUFFER_SIZE);}else this.loadMoreForwardIfNecessary(p.BUFFER_SIZE);};p.prototype.backward=function(){"use strict";this._page(this._reverse?1:-1);};p.prototype.forward=function(){"use strict";this._page(this._reverse?-1:1);};p.prototype._log=function(q){"use strict";this._viewer.log(q);};k(p,{BUFFER_SIZE:4});e.exports=p;},null);
__d("SpotlightViewerClose",["React","TooltipLink.react","cx","fbt","joinClasses"],function(a,b,c,d,e,f,g,h,i,j,k){var l=g,m=l.PropTypes,n=g.createClass({displayName:"SpotlightViewerClose",propTypes:{position:m.oneOf(['left','right'])},getDefaultProps:function(){return {position:'right'};},render:function(){var o=(this.props.position=='left')?"_5wx3":"_5wx4",p=g.createElement("span",null,"Press Esc to close");return (g.createElement(h,{className:k("_4-o9 _50-m _51an",o),onClick:this.props.onClick,tooltip:p}));}});e.exports=n;},null);
__d("SpotlightViewerImage",["React","cx"],function(a,b,c,d,e,f,g,h){var i=g.createClass({displayName:"SpotlightViewerImage",render:function(){return (g.createElement("img",{className:"_4-od",src:this.props.src,style:{width:this.props.dimensions.x,height:this.props.dimensions.y}}));}});e.exports=i;},null);
__d("SpotlightViewerCoreMixin",["PhotoLogger","PhotoStore","PhotoUtils","PhotoViewState","React","SpotlightViewerImage","SpotlightViewerLoggingEvents"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n={_displayFirstPhoto:function(){h.executePostCreate(this.props.setid,this.viewState.displayFirst.bind(this.viewState));},_getInitialPosition:function(){var o;if(!this.props.clearcache)o=h.getIndexForID(this.props.setid,this.props.photoid);if(o===(void 0)){h.clearSetCache(this.props.setid);o=0;}return o;},__displayPhoto:function(){var o=this._getInitialPosition();this.viewState=new j(this,this.props.setid,o,this._updatePhoto,this.props.reverse);this.inform('open');this._displayFirstPhoto();},componentWillMount:function(){this._logger=new g(this.getViewerID());this.log(m.OPEN_BEGIN);this.__displayPhoto();},componentDidMount:function(){this._enableSubscriptions&&this._enableSubscriptions();this.log(m.OPEN_COMPLETE);},isOpen:function(){return this.state.open;},close:function(){if(!this.isOpen())return;this.log(m.CLOSE_BEGIN);this.setState({open:false},function(){this.inform('close');this.log(m.CLOSE_COMPLETE);});},componentWillUnmount:function(){this.viewState=null;},_onClickViewport:function(o){o?this.viewState.forward():this.viewState.backward();},_getMedia:function(o,p){return (k.createElement(l,{ref:"image",src:o.uri,dimensions:p.imageDimensions}));},_getCurrentFBID:function(){return i.getFBIDFromData(this.state.photoData);},_updatePhoto:function(o){this.log(m.PHOTO_CHANGE_BEGIN);this.setState({photoData:o},function(){this.inform('photo_change',this.state.photoData);this.log(m.PHOTO_CHANGE_COMPLETE);});},getLogger:function(){return this._logger;},log:function(o){this._logger&&this._logger.logEvent(o);}};e.exports=n;},null);
__d("SpotlightViewerStageResizer",["Event","SubscriptionsHandler","Vector"],function(a,b,c,d,e,f,g,h,i){var j=520;function k(l,m){"use strict";this._subscriptionsHandler=new h();this._subscriptionsHandler.addSubscriptions(g.listen(window,'resize',this._resetStageDimensions.bind(this)));this._dimensions=l;this._minHeight=m.minHeight||j;this._minWidth=m.minWidth||j;this._resetStageDimensions();}k.prototype.destroy=function(){"use strict";this._dimensions=null;this._subscriptionsHandler.release();};k.prototype._resetStageDimensions=function(){"use strict";this._currentStageDimensions=new i(this._minWidth,this._minHeight);};k.prototype.getImageAndStageDimensions=function(l){"use strict";var m=this._dimensions.getBestFitDimensionsFromPhoto(l,this._dimensions.getMaxStageDimensions()),n=this._dimensions.getStageDimensions(m);this._currentStageDimensions=new i(Math.max(n.x,this._minWidth,this._currentStageDimensions.x),Math.max(n.y,this._minHeight,this._currentStageDimensions.y));var o=this._dimensions.getImageDimensionsForStage(m,this._currentStageDimensions);return {stageDimensions:this._currentStageDimensions,imageDimensions:o};};k.prototype.getCurrentStageDimensions=function(){"use strict";return this._currentStageDimensions;};e.exports=k;},null);
__d("PhotoViewerDimensions",["Event","PhotoUtils","Vector","copyProperties"],function(a,b,c,d,e,f,g,h,i,j){var k={verticalPadding:'number',horizontalPadding:'number',normalResDim:'object'};function l(m){"use strict";for(var n in m){if(!k[n])throw new Error("Unsupported extraData value '"+n+"' should not be used");if(typeof m[n]===k[n])this['_'+n]=m[n];}this._listener=g.listen(window,'resize',this._resetMaxStageDimensions.bind(this));}l.prototype.destroy=function(){"use strict";this._listener.remove();};l.prototype.getStageDimensions=function(m){"use strict";var n=this.getMaxStageDimensions(),o=new i(Math.min(m.x,n.x),Math.min(m.y,n.y)),p=o.x/o.y,q=m.x/m.y;if(p<q){o.y=Math.round(o.x/q);}else o.x=Math.round(o.y*q);return o;};l.prototype.getImageDimensionsForStage=function(m,n){"use strict";var o=m.x,p=m.y,q=n.x,r=n.y;if(o>=q||p>=r){var s=o/p,t=q/r;if(t<s){o=q;p=Math.round(q/s);}else if(t>s){o=Math.round(r*s);p=r;}else{o=q;p=r;}}return new i(o,p);};l.prototype.getMaxStageDimensions=function(){"use strict";if(!this._maxStageDimensions)this._maxStageDimensions=new i(i.getViewportDimensions().x-this._horizontalPadding,i.getViewportDimensions().y-this._verticalPadding);return this._maxStageDimensions;};l.prototype._resetMaxStageDimensions=function(){"use strict";this._maxStageDimensions=null;};l.prototype.getBestFitImageFromPhoto=function(m,n){"use strict";var o=null,p=h.getImagesFromData(m);p=p.sort(function(r,s){return s.width-r.width;});if(window.devicePixelRatio&&window.devicePixelRatio>1)n=new i(n.x*window.devicePixelRatio,n.y*window.devicePixelRatio);for(var q=0;q<p.length;q++)if(!o||p[q].width>=n.x||p[q].height>=n.y)o=p[q];return o;};l.prototype.getOriginalDimensionsFromPhoto=function(m){"use strict";var n=h.getOriginalImageFromData(m);return new i(n.width,n.height);};l.prototype.getBestFitDimensionsFromPhoto=function(m,n){"use strict";var o=this.getBestFitImageFromPhoto(m,n);return new i(o.width,o.height);};l.prototype.getVerticalPadding=function(){"use strict";return this._verticalPadding;};l.prototype.getHorizontalPadding=function(){"use strict";return this._horizontalPadding;};j(l.prototype,{_verticalPadding:40,_horizontalPadding:60,_normalResDim:{x:960,y:960}});e.exports=l;},null);
__d("SpotlightViewerDimensionMixin",["SpotlightViewerStageResizer","PhotoViewerDimensions"],function(a,b,c,d,e,f,g,h){var i={getInitialState:function(){this._dimensions=new h({verticalPadding:this.props.verticalPadding,horizontalPadding:this.props.horizontalPadding});this._resizer=new g(this._dimensions,{minHeight:this.props.minHeight,minWidth:this.props.minWidth});return {maxStageDimensions:this._dimensions.getMaxStageDimensions()};},componentWillUnmount:function(){this._resizer&&this._resizer.destroy();this._resizer=null;this._dimensions&&this._dimensions.destroy();this._dimensions=null;},getMedia:function(){if(this.state.photoData){var j=this._resizer.getImageAndStageDimensions(this.state.photoData),k=this._dimensions.getBestFitImageFromPhoto(this.state.photoData,this.state.maxStageDimensions);return this._getMedia(k,j);}else return null;},getDimensions:function(){return this._dimensions;},getStageDimensions:function(){if(this.state.photoData){return this._resizer.getImageAndStageDimensions(this.state.photoData).stageDimensions;}else return this._dimensions.getMaxStageDimensions();},getImageDimensions:function(){if(!this.state.photoData)return null;return this._resizer.getImageAndStageDimensions(this.state.photoData).imageDimensions;},onResize:function(){this.setState({maxStageDimensions:this._dimensions.getMaxStageDimensions()});}};e.exports=i;},null);
__d("SpotlightViewport",["Locale","Parent","React","Vector","cx","joinClasses"],function(a,b,c,d,e,f,g,h,i,j,k,l){var m=i,n=m.PropTypes,o=i.createClass({displayName:"SpotlightViewport",propTypes:{stageDimensions:n.object.isRequired,snapToPhoto:n.bool},PAGE_TO_PREV_PERCENTAGE:.2,sections:{NONE:null,FORWARD:1,BACKWARD:2},getInitialState:function(){return {currentActiveSection:this.sections.NONE,active:true};},_onMouseMove:function(event){var p=j.getEventPosition(event.nativeEvent),q=j.getElementPosition(this.getDOMNode()),r,s=p.x-q.x,t=s/this.props.stageDimensions.x;if(g.isRTL()){r=t>(1-this.PAGE_TO_PREV_PERCENTAGE);}else r=t<this.PAGE_TO_PREV_PERCENTAGE;if(r){this.setState({currentActiveSection:this.sections.BACKWARD});}else this.setState({currentActiveSection:this.sections.FORWARD});},_onClick:function(event){var p=this.state.currentActiveSection==this.sections.FORWARD,q=event.target;if(!h.byClass(q,"_51an"))this.props.onClick&&this.props.onClick(p);},_onMouseEnter:function(){this.setState({active:true});},_onMouseLeave:function(){this.setState({active:false});},render:function(){var p=(("_4-of")+(!this.state.active&&!this.props.active?' '+"_50-l":'')+(this.state.currentActiveSection===this.sections.BACKWARD?' '+"_516a":'')+(this.state.currentActiveSection===this.sections.FORWARD?' '+"_516b":'')+(this.props.showLoadingIndicator?' '+"_51jp":''));if(this.props.className)p=l(p,this.props.className);var q={};if(this.props.stageDimensions){var r=this.props.snapToPhoto?['maxHeight','maxWidth']:['height','width'];q[r[0]]=this.props.stageDimensions.y;q[r[1]]=this.props.stageDimensions.x;}return (i.createElement("div",{className:p,style:q,onClick:this._onClick,onMouseMove:this._onMouseMove,onMouseEnter:this._onMouseEnter,onMouseLeave:this._onMouseLeave},this.props.children,i.createElement("div",{className:"_4-og"},i.createElement("span",{className:"_4-oh"}),this.props.media,i.createElement("div",{className:"_4-oi"}))));}});e.exports=o;},null);
__d("DirectionalDockingElement",["ArbiterMixin","CSS","DOM","DOMDimensions","Event","Run","Style","SubscriptionsHandler","ViewportBounds","getElementPosition","mixin","queryThenMutateDOM","removeFromArray"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){var t,u=[],v=true,w=false,x='unfixed',y='fixed_top',z='fixed_middle',aa=q(g);for(var ba in aa)if(aa.hasOwnProperty(ba))da[ba]=aa[ba];var ca=aa===null?null:aa.prototype;da.prototype=Object.create(ca);da.prototype.constructor=da;da.__superConstructor__=aa;function da(ea){"use strict";this.$DirectionalDockingElement0=ea;this.$DirectionalDockingElement1=0;if(!t){var fa=r.bind(null,function(){for(var ga=0,ha=u.length;ga<ha;ga++)u[ga].$DirectionalDockingElement2();},function(){for(var ga=0,ha=u.length;ga<ha;ga++)u[ga].$DirectionalDockingElement3();},'DirectionalDockingElement');t=new n();t.addSubscriptions(k.listen(window,'scroll',fa),k.listen(window,'resize',fa));l.onLeave(function(){while(u.length)u.pop().destroy();t.release();t=null;});}u.push(this);this.$DirectionalDockingElement4=o.getTop();this.$DirectionalDockingElement5=y;m.set(this.$DirectionalDockingElement0,'width',j.getElementDimensions(this.$DirectionalDockingElement0).width+'px');this.$DirectionalDockingElement6=i.create('div');m.set(this.$DirectionalDockingElement6,'position','relative');i.replace(this.$DirectionalDockingElement0,this.$DirectionalDockingElement6);i.appendContent(this.$DirectionalDockingElement6,this.$DirectionalDockingElement0);this.update();}da.prototype.$DirectionalDockingElement2=function(){"use strict";var ea=-p(this.$DirectionalDockingElement6).y;if(ea!==this.$DirectionalDockingElement7){this.$DirectionalDockingElement8=ea>this.$DirectionalDockingElement7?w:v;this.$DirectionalDockingElement7=ea;}this.$DirectionalDockingElement9=j.getElementDimensions(this.$DirectionalDockingElement0);this.$DirectionalDockingElementa=h.hasClass(document.documentElement,'tinyViewport');this.$DirectionalDockingElementb=document.body.scrollTop+document.documentElement.clientHeight>document.documentElement.scrollHeight;};da.prototype.$DirectionalDockingElementc=function(ea,fa){"use strict";if(this.$DirectionalDockingElementd!==ea||this.$DirectionalDockingElemente!==fa){m.apply(this.$DirectionalDockingElement0,{position:ea,top:fa+'px'});this.$DirectionalDockingElementd=ea;this.$DirectionalDockingElemente=fa;}};da.prototype.$DirectionalDockingElementf=function(){"use strict";this.$DirectionalDockingElement5=y;this.$DirectionalDockingElementc('fixed',this.$DirectionalDockingElement4);};da.prototype.$DirectionalDockingElementg=function(){"use strict";this.$DirectionalDockingElement5=z;this.$DirectionalDockingElementc('fixed',this.$DirectionalDockingElement1);};da.prototype.$DirectionalDockingElementh=function(){"use strict";this.$DirectionalDockingElement5=x;this.$DirectionalDockingElementc('absolute',this.$DirectionalDockingElementi);};da.prototype.$DirectionalDockingElement3=function(){"use strict";var ea=this.$DirectionalDockingElement9.height;if(ea!==this.$DirectionalDockingElementj){m.set(this.$DirectionalDockingElement6,'height',ea+'px');this.$DirectionalDockingElementj=ea;this.inform('changedheight');}if(this.$DirectionalDockingElement5===y){this.$DirectionalDockingElementi=this.$DirectionalDockingElement7+this.$DirectionalDockingElement4;}else if(this.$DirectionalDockingElement5===z)this.$DirectionalDockingElementi=this.$DirectionalDockingElement7+this.$DirectionalDockingElement1;if(this.$DirectionalDockingElementb)return;if(this.$DirectionalDockingElement7+this.$DirectionalDockingElement4<=0||this.$DirectionalDockingElementa){this.$DirectionalDockingElementi=0;this.$DirectionalDockingElementh();return;}if(this.$DirectionalDockingElement8===w&&this.$DirectionalDockingElement7+this.$DirectionalDockingElement1>=this.$DirectionalDockingElementi){this.$DirectionalDockingElementg();}else if(this.$DirectionalDockingElement8===v&&this.$DirectionalDockingElement7+this.$DirectionalDockingElement4<=this.$DirectionalDockingElementi){this.$DirectionalDockingElementf();}else this.$DirectionalDockingElementh();};da.prototype.update=function(){"use strict";this.$DirectionalDockingElement2();this.$DirectionalDockingElement3();};da.prototype.destroy=function(){"use strict";if(u.indexOf(this)===-1)return;s(u,this);if(this.$DirectionalDockingElement6&&this.$DirectionalDockingElement6.parentNode){i.remove(this.$DirectionalDockingElement6);this.$DirectionalDockingElement6=null;}};da.prototype.setOffset=function(ea){"use strict";this.$DirectionalDockingElement1=ea;this.update();return this;};e.exports=da;},null);
__d("DockingElement",["ArbiterMixin","CSS","DOM","DOMDimensions","Event","Run","Style","SubscriptionsHandler","getElementPosition","mixin","queryThenMutateDOM","removeFromArray"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){var s,t=[],u=p(g);for(var v in u)if(u.hasOwnProperty(v))x[v]=u[v];var w=u===null?null:u.prototype;x.prototype=Object.create(w);x.prototype.constructor=x;x.__superConstructor__=u;function x(y){"use strict";this.$DockingElement0=y;this.$DockingElement1=0;if(!t.length){var z=q.bind(null,function(){for(var aa=0,ba=t.length;aa<ba;aa++)t[aa].getRect();},function(){for(var aa=0,ba=t.length;aa<ba;aa++)t[aa].updateWithCache();},'DockingElement');s=new n();s.addSubscriptions(k.listen(window,'scroll',z),k.listen(window,'resize',z));l.onLeave(function(){while(t.length)t.pop().destroy();});}t.push(this);this.update();}x.prototype.getRect=function(){"use strict";var y=this.$DockingElement2?this.getPlaceholder():this.$DockingElement0;this.$DockingElement3=o(y);this.$DockingElement4=j.getElementDimensions(y);this.$DockingElement5=h.hasClass(document.documentElement,'tinyViewport');};x.prototype.updateWithCache=function(){"use strict";var y=this.$DockingElement1,z=this.getPlaceholder();if(!this.$DockingElement5&&this.$DockingElement3.y<=y){if(!this.$DockingElement2){if(!this.$DockingElement6){i.insertAfter(this.$DockingElement0,z);this.$DockingElement6=true;}h.addClass(this.$DockingElement0,'fixed_elem');h.show(z);this.$DockingElement2=true;}var aa;if(this.$DockingElement7!==y){aa={};aa.top=y+'px';this.$DockingElement7=y;}var ba=this.$DockingElement4.width;if(ba!==this.$DockingElement8){aa=aa||{};aa.width=ba+'px';this.$DockingElement8=ba;}aa&&m.apply(this.$DockingElement0,aa);var ca=this.$DockingElement4.height;if(ca!==this.$DockingElement9){m.set(z,'height',ca+'px');this.$DockingElement9=ca;this.inform('changedheight');}}else if(this.$DockingElement2){m.apply(this.$DockingElement0,{top:'',width:''});h.removeClass(this.$DockingElement0,'fixed_elem');h.hide(z);this.$DockingElement2=false;this.$DockingElement8=null;this.$DockingElement7=null;}};x.prototype.update=function(){"use strict";this.getRect();this.updateWithCache();};x.prototype.getPlaceholder=function(){"use strict";if(!this.$DockingElementa)this.$DockingElementa=i.create('div');return this.$DockingElementa;};x.prototype.destroy=function(){"use strict";if(t.indexOf(this)===-1)return;r(t,this);if(this.$DockingElementa&&this.$DockingElementa.parentNode){i.remove(this.$DockingElementa);this.$DockingElementa=null;}if(!t.length){s.release();s=null;}};x.prototype.setOffset=function(y){"use strict";this.$DockingElement1=y;this.update();return this;};e.exports=x;},null);
__d("StickyRHC",["Arbiter","DirectionalDockingElement","DockingElement","DOM","DOMDimensions","Event","LitestandMessages","Run","SubscriptionsHandler","ViewportBounds","$","csx","ge","getElementPosition","removeFromArray","throttle"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){var w=35,x=[],y;function z(da,ea){if(!ea||!ea.dom_id){x.forEach(aa);return;}var fa=q(ea.dom_id);for(var ga=0;ga<x.length;ga++)if(j.contains(x[ga].getRoot(),fa)){aa(x[ga]);return;}}function aa(da){var ea=da.getRoot(),fa=da.updateOffset.bind(da),ga=j.scry(ea,'img.img');ga.forEach(function(ha){if(ha.complete||ha.getAttribute('height')||(typeof ha.naturalHeight!=='undefined'&&ha.naturalHeight!==0))return;var ia=function(){fa();ja.remove();ka.remove();la.remove();},ja=l.listen(ha,'load',ia),ka=l.listen(ha,'error',ia),la=l.listen(ha,'abort',ia);});fa();}function ba(){x.forEach(function(da){da.updateOffset();});}function ca(da,ea){"use strict";this.$StickyRHC0=da;this.$StickyRHC1=ea?new h(da):new i(da);this.$StickyRHC2=0;this.$StickyRHC1.subscribe('changedheight',this.updateOffset.bind(this));this.updateOffset();aa(this);if(!x.length){y=new o();y.addSubscriptions(g.subscribe('header_loaded',ba),g.subscribe('netego_loaded',z),g.subscribe(m.RHC_RELOADED,function(){ba();x.forEach(aa);}),l.listen(window,'resize',v(ba)));}n.onLeave(this.destroy.bind(this));x.push(this);}ca.getInstances=function(){"use strict";return x;};ca.prototype.getRoot=function(){"use strict";return this.$StickyRHC0;};ca.prototype.destroy=function(){"use strict";this.$StickyRHC1.destroy();u(x,this);if(!x.length){y.release();y=null;}};ca.prototype.updateOffset=function(){"use strict";var da=j.scry(this.$StickyRHC0,"._4-u2"),ea=j.scry(this.$StickyRHC0,"._4-u3"),fa=j.scry(this.$StickyRHC0,"._5eh2"),ga=j.scry(this.$StickyRHC0,'.uiHeader'),ha=j.scry(this.$StickyRHC0,'.ego_unit'),ia=[].concat(da,ea,fa,ga,ha),ja=[];ia.forEach(function(ta){ja.push(t(ta).y);});ja.sort(function(ta,ua){return ta-ua;});var ka=t(this.$StickyRHC0).y,la=k.getElementDimensions(this.$StickyRHC0).height;la+=this.$StickyRHC2;var ma=p.getTop(),na=k.getViewportDimensions().height-ma;na-=w;if(typeof this.$StickyRHC3==='undefined'){var oa=s('pageFooter');this.$StickyRHC3=oa?k.getElementDimensions(oa).height:0;}na-=this.$StickyRHC3;var pa=na-la;if(la<na){pa=ma;}else for(var qa=0,ra=ja.length;qa<ra;qa++){var sa=ja[qa]-ka;if(la-sa<na){pa=ma-sa;break;}}this.$StickyRHC1.setOffset(pa+this.$StickyRHC2);};ca.prototype.setOffset=function(da){"use strict";this.$StickyRHC2=da;this.updateOffset();};ca.prototype.getOffset=function(da){"use strict";return this.$StickyRHC2;};e.exports=ca;},null);
__d("legacy:adware-scanner",["AdwareScaner"],function(a,b,c,d){a.AdwareScaner=b('AdwareScaner');},3);
__d("ProgressBarBase",["emptyFunction","requestAnimationFrame","removeFromArray","arrayContains"],function(a,b,c,d,e,f,g,h,i,j){var k=[];function l(m,n){"use strict";this._min=m||0;this._max=n||100;this._initialPosition=0;this._position=0;this._initialVelocity=0;this._velocity=0;this._acceleration=0;this.useAcceleration=true;this._targetPosition=0;this._targetTime=0;this._startTime=null;this._onComplete=g;}l.prototype.setPosition=function(m){"use strict";m=this._normalizePosition(m);this._initialPosition=m;this._position=m;this.updateMeter(this._position);this.stop();return this;};l.prototype.setCompleteHandler=function(m){"use strict";this._onComplete=m||g;return this;};l.prototype.setTarget=function(m,n){"use strict";this._stopAnimating();this._clearOnCompleteTimeout();this._targetPosition=m;var o=this._normalizePosition(m);this._targetTime=n;this._initialVelocity=this._velocity;this._initialPosition=this._position;if(this.useAcceleration){this._acceleration=2*(o-this._initialPosition-this._initialVelocity*n)/(n*n);}else{this._acceleration=0;this._velocity=this._initialVelocity=(o-this._initialPosition)/n;}if(this._position>=o){this._onComplete();}else this._start();return this;};l.prototype.setNoAcceleration=function(m){"use strict";this.useAcceleration=!m;return this;};l.prototype._clearOnCompleteTimeout=function(){"use strict";a.clearTimeout(this._onCompleteTimeout);};l.prototype.stop=function(){"use strict";this._clearOnCompleteTimeout();this._velocity=0;this._initialVelocity=0;this._acceleration=0;this._stopAnimating();return this;};l.prototype._start=function(){"use strict";this._startTime=Date.now();this._onCompleteTimeout=a.setTimeout(function(){this.setPosition(this._targetPosition);this._onComplete();}.bind(this),this._targetTime);this._startAnimating();return this;};l.prototype._loop=function(){"use strict";var m=Date.now()-this._startTime;this._position=(.5*this._acceleration*m*m)+(this._initialVelocity*m)+this._initialPosition;var n=this._velocity;this._velocity=this._acceleration*m+this._initialVelocity;var o=n<0!==this._velocity<0;if(this._position>this._normalizePosition(this._targetPosition)||o){this.setPosition(this._targetPosition);this._onComplete();}else this.updateMeter(this._position);};l.prototype.updateMeter=function(m){"use strict";throw "Unimplemented function: updateMeter";};l.prototype._normalizePosition=function(m){"use strict";return Math.min(Math.max((m-this._min)/(this._max-this._min),0),1);};l.prototype._startAnimating=function(){"use strict";if(!j(k,this)){k.push(this);if(k.length===1)h(l.prototype._requestAnimationFrameCallback);}};l.prototype._stopAnimating=function(){"use strict";i(k,this);};l.prototype._requestAnimationFrameCallback=function(){"use strict";k.forEach(function(m){m._loop();});if(k.length)h(l.prototype._requestAnimationFrameCallback);};l.setPosition=function(m,n){"use strict";m.setPosition(n);};l.setTarget=function(m,n,o){"use strict";m.setTarget(n,o);};e.exports=l;},null);
__d("ProgressBar",["ProgressBarBase","CSS","Style","cx","csx","DOM"],function(a,b,c,d,e,f,g,h,i,j,k,l){for(var m in g)if(g.hasOwnProperty(m))o[m]=g[m];var n=g===null?null:g.prototype;o.prototype=Object.create(n);o.prototype.constructor=o;o.__superConstructor__=g;function o(p,q,r){"use strict";g.call(this,q,r);this._root=p;this._meter=l.find(p,"div._5e4k");this._meter2=l.scry(p,"div._5e2g")[0];}o.prototype.getRoot=function(){"use strict";return this._root;};o.prototype.updateMeter=function(p){"use strict";var q=Math.min(Math.max(p,0),1);h.conditionClass(this._meter,"_5e2d",q<=0);h.conditionClass(this._meter,"_5e4j",q>=1);q=q*100+'%';i.set(this._meter,'width',q);if(this._meter2){i.set(this._meter2,'left',q);i.set(this._meter2,'width',q);}};o.prototype.changeLabel=function(p){"use strict";var q=l.scry(this._root,"span._5e2h");q.forEach(function(r){l.setContent(r,p);});return this;};e.exports=o;},null);
__d("FormSubmitOnChange",["Event","copyProperties","submitForm"],function(a,b,c,d,e,f,g,h,i){function j(k){"use strict";this._form=k;}j.prototype.enable=function(){"use strict";this._listener=g.listen(this._form.getRoot(),'change',this._submit.bind(this));};j.prototype.disable=function(){"use strict";this._listener.remove();this._listener=null;};j.prototype._submit=function(){"use strict";i(this._form.getRoot());};h(j.prototype,{_listener:null});e.exports=j;},null);
__d("StickyArea",["CSS","DOM","DOMQuery","Event","Run","Style","ViewportBounds","cx","getNormalizedClientRect","getOverlayZIndex","removeFromArray","throttle"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){var s=[],t=null,u=null,v=null,w=r.acrossTransitions(x,1000);function x(){s.sort(function(da,ea){var fa=da.getNode(),ga=ea.getNode();if(fa.compareDocumentPosition){return 3-(fa.compareDocumentPosition(ga)&6);}else return fa.sourceIndex-ga.sourceIndex;});}function y(da,ea,fa){var ga=da.getPlaceholder(),ha=da.getNode(),ia=l.get(ha,'float'),ja=da.getData();if(ja.placeholderWidth!==ea||ja.placeholderHeight!==fa||ja.placeholderFloat!==ia){l.apply(ga,{'float':ia,height:fa+'px',width:ea+'px'});ja.placeholderHeight=fa;ja.placeholderWidth=ea;}if(ha.nextSibling!==ga)h.insertAfter(ha,ga);}function z(da,ea){var fa=da.getData();if(fa.fixed!==ea){l.apply(da.getNode(),fa.styles);g.conditionShow(da.getPlaceholder(),ea);fa.fixed=ea;}}function aa(da,ea){if(!da){return 0;}else if(ea.right<=da.rect.left||ea.left>=da.rect.right){return aa(da.prev,ea);}else return da.bottom;}function ba(){var da=0,ea=s.length,fa=100;function ga(ha,ia){var ja=fa;while(da<ea){var ka=s[da],la=ka.getNode();if(ia&&!i.contains(ia,la))break;fa=Math.max(ja,ka.getZIndex());var ma=ka.getData(),na=la.parentNode,oa=ma.styles;for(var pa in oa)oa[pa]='';z(ka,false);var qa=la.offsetHeight,ra=la.offsetWidth,sa=o(la),ta=aa(ha,sa)+ka.getOffset();if(sa.top<=ta){oa.width=ra+'px';var ua=parseInt(l.get(na,'padding-bottom'),10),va=o(na);if(va.bottom-ua>ta+qa){var wa=parseInt(l.get(la,'margin-left'),10);oa.position='fixed';oa.bottom='auto';oa.top=ta+'px';oa.left=sa.left-wa+'px';}else{if(!ma.parent||na!==ma.parent){if(l.get(na,'position')==='static')l.set(na,'position','relative');ma.parent=na;}oa.position='absolute';oa.top='auto';oa.bottom=ua+'px';var xa=parseInt(l.get(na,'border-left-width'),10);oa.left=(sa.left-va.left-xa)+'px';}y(ka,ra,qa);z(ka,true);}da++;ga({bottom:ta+qa,prev:ha,rect:sa},na);l.set(la,'z-index',fa++);}}ga(null,null);}function ca(da,ea,fa){"use strict";this._node=da;this._data={fixed:false,placeholderFloat:null,placeholderHeight:null,placeholderWidth:null,styles:{}};this._offset=fa;g.addClass(da,"_k");if(!ea)k.onLeave(this.destroy.bind(this));if(!s.length){t=j.listen(window,'scroll',function(){w();ba();});u=j.listen(window,'resize',function(){w();ba();});v=m.subscribe('change',function(){w();ba();});}s.push(this);ca.reflow();}ca.prototype.destroy=function(){"use strict";q(s,this);if(!s.length){t.remove();t=null;u.remove();u=null;}if(this._placeholder)h.remove(this._placeholder);var da=0;for(var ea in this._data.styles){this._data.styles[ea]='';da++;}if(da)l.apply(this._node,this._data.styles);};ca.prototype.getData=function(){"use strict";return this._data;};ca.prototype.getNode=function(){"use strict";return this._node;};ca.prototype.getOffset=function(){"use strict";return this._offset||0;};ca.prototype.getPlaceholder=function(){"use strict";if(!this._placeholder)this._placeholder=h.create('div');return this._placeholder;};ca.prototype.getZIndex=function(){"use strict";if(!this._zIndex)this._zIndex=p(this._node);return this._zIndex;};ca.prototype.setOffset=function(da){"use strict";this._offset=da;};ca.reflow=r.acrossTransitions(function(){x();ba();},100);e.exports=ca;},null);
__d("SearchTypeaheadRenderer",["BadgeHelper","DOM","fbt","MusicButtonManager","TokenizeUtil","TypeaheadFacepile","URI","WWWBase"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){var o=' \u00B7 ';function p(q,r){var s=[],t=q.photos||q.photo;if(t){if(t instanceof Array){t=l.render(t);}else t=h.create('img',{alt:'',src:t});s.push(t);if(q.song){s.push(h.create('span',{className:'playButton'}));s.push(h.create('span',{className:'playLoader'}));}}var u;if(q.text){var v=q.alias,w=this.value,x=q.text;u=[x];if(v&&k.isQueryMatch(w,v)&&!k.isQueryMatch(w,x))u.push(h.create('span',{className:'alias'},[' \xB7 '+v]));if(q.is_verified){u.push(g.renderBadge('xsmall','verified'));}else if(q.is_work_user)u.push(g.renderBadge('xsmall','work'));s.push(h.create('span',{className:'text'},u));}if(q.category){var y=[q.category];if(q.is_external)y.push(h.create('span',{className:'arrow'}));var z=q.message?'preCategory':'category';s.push(h.create('span',{className:z},y));}if(q.message)s.push(h.create('span',{className:'category'},[q.message]));var aa=q.subtextOverride||q.subtext;if(aa){var ba=[aa];if(q.saved_context){var ca=h.create('span',{className:'saved'},[q.saved_context]);ba.unshift(ca,o);}s.push(h.create('span',{className:'subtext'},ba));}var da=q.classNames||q.type||'',ea=q.is_external?'_blank':'',fa=!q.song&&q.path||'';if(fa){if(!(/^https?\:\/\//).test(fa))fa=n.uri+fa.substr(1);fa+=(fa.indexOf('?')>0?'&':'?')+'ref=ts&fref=ts';}var ga=h.create('a',{href:fa,rel:'ignore',target:ea},s);if(q.song){ga.id='mb_'+(Math.random()*1e+06|0);setTimeout(j.addButton.bind(null,q.song.provider,ga.id,q.song.url,q.song.context,q.song.media_type),0);ga.onclick=this.ignoreClick;}var ha=null;if(q.uid==='recent'&&q.type==='header'){var ia=new m('/profile.php');ia.setQueryData({sk:'allactivity',log_filter:'search'});ha=h.create('a',{href:ia,className:'recentSearchEditLink'},"EDIT");ga.setAttribute('class','recentSearchHeaderLink');da=da+' recentHeader';}var ja=h.create('li',{className:da},[ga,ha]);if(q.text){ja.setAttribute('title',q.text);ja.setAttribute('aria-label',q.text);}return ja;}p.className='search';e.exports=p;},null);