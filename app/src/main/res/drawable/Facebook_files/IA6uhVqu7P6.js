/*!CK:807250433!*//*1424152309,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["g4tf0"]); }

__d("FeedAdsGapRuleViolationDetection",["Banzai","CSS","csx","cx","DOM","ge","isEmpty","merge"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){var o='ei',p='qid',q='gap rule violation',r='non violating ads gap',s='first position violation',t='feed load',u='first position invalidation',v='spacing invalidation',w=[],x=[],y=[],z={},aa={registerFeedStories:function(ba,ca){if(ba.containerID=='substream_0'){w=[];x=[];}var da=l(ba.containerID);if(!da)return;z=n(ba.demoAdChecks,z);var ea=k.scry(da,"div._5jmm").map(this._convertStoryNodeToObject).filter(function(fa){return fa!==null;});if(ba.isLoggingEnabled&&ea.length!==0)this._logFeedLoad();if(ba.isNewerStories){w=ea.concat(w);}else w=w.concat(ea);if(m(z)){if(ba.isLoggingEnabled||ba.isFirstPosInvalidationEnabled)this._checkFirstPosViolation(ba,da);if(ba.isLoggingEnabled||ba.isGapRuleInvalidationEnabled)this._checkGapRuleViolation(ba);}},_convertStoryNodeToObject:function(ba){if(h.hasClass(ba,"_170y"))return null;var ca=ba.getAttribute('data-dedupekey');if(z[ca])return null;var da=k.scry(ba,"div._hye"),ea=k.scry(ba,"li._170x"),fa=[];if(da.length!==0){fa=da.map(function(ia){return ia.getAttribute('data-ft');}).filter(function(ia){return ia!==null;});}else if(ea.length!==0){fa=ea.map(function(ia){return ia.getAttribute('data-ft');}).filter(function(ia){return ia!==null;});}else if(ba.getAttribute('data-ft'))fa=[ba.getAttribute('data-ft')];if(!fa.length)return null;var ga=JSON.parse(fa[0]),ha={dataFTArray:fa,dedupKey:ca,isSponsored:!!ga[o],height:ba.offsetHeight,qid:parseInt(ga[p],10),nodeID:ba.id};return ha;},_checkFirstPosViolation:function(ba,ca){while(w.length>0&&w[0].isSponsored){var da={ftArray:w[0].dataFTArray,qid:w[0].qid,nodeid:w[0].nodeID,firstStoryType:ba.firstStoryType},ea=k.scry(ca,'.uiBoxRed')[0];if(ea){var fa=ea.textContent||ea.innerText;if(fa)da.error_msg=fa;}if(ba.isLoggingEnabled&&!(w[0].dedupKey in y)){this._logFirstPosViolation(da);y[w[0].dedupKey]=da;}if(ba.isFirstPosInvalidationEnabled){this._invalidateFirstPosAd(da);w.splice(0,1);}else break;}},_getMinGap:function(ba,ca,da){var ea=Math.min(ba?ba:Number.MAX_VALUE,ca?ca:Number.MAX_VALUE);return ea!==Number.MAX_VALUE?ea:da;},_getStoryDedupKeysJSONString:function(ba,ca){var da=[];for(var ea=ba;ea<=ca;ea++)da.push(w[ea].dedupKey);return JSON.stringify(da);},_checkGapRuleViolation:function(ba){var ca=null,da=null,ea=0;for(var fa=0;fa<w.length;fa++){var ga=w[fa];ea+=ga.height;if(ga.isSponsored){ea-=ga.height;var ha=false;if(ca!==null){var ia=fa-ca,ja=null,ka=this._getMinGap(ba.minGaps[da.dedupKey],ba.minGaps[ga.dedupKey],ba.defaultMinGap);if(ia<ka){ja=q;}else ja=r;var la={ftArray_A:da.dataFTArray,ftArray_B:ga.dataFTArray,dist:ia,pdist:ea,pos:fa+1,qid_A:da.qid,qid_B:ga.qid,event_type:ja,nodeid:ga.nodeID,dedupKeys:this._getStoryDedupKeysJSONString(ca,fa)};if(ba.isLoggingEnabled)if(!(ga.dedupKey in x)||x[ga.dedupKey].event_type!==ja){this._logGapRuleViolation(la);x[ga.dedupKey]=la;}if(ba.isGapRuleInvalidationEnabled&&ja==q){this._invalidateGapRuleViolatedAd(la);ha=true;w.splice(fa--,1);}}if(!ha){ca=fa;da=ga;ea=0;}}}},_logFirstPosViolation:function(ba){var ca={ft:ba.ftArray[0],event_type:s,intValues:{qid:ba.qid},first_story_type:ba.firstStoryType};if(ba.error_msg)ca.error_msg=ba.error_msg;g.post('feed_ads_gap_rule_violation',ca);},_logGapRuleViolation:function(ba){var ca={ft_A:ba.ftArray_A[0],ft_B:ba.ftArray_B[0],event_type:ba.event_type,intValues:{dist:ba.dist,pdist:ba.pdist,pos:ba.pos,qid_A:ba.qid_A,qid_B:ba.qid_B},dedup_keys:ba.dedupKeys};g.post('feed_ads_gap_rule_violation',ca);},_logFeedLoad:function(){var ba={event_type:t};g.post('feed_ads_gap_rule_violation',ba);},_invalidateFirstPosAd:function(ba){h.hide(l(ba.nodeid));var ca={ft_array:ba.ftArray,event_type:u};g.post('feed_ads_gap_rule_violation',ca);},_invalidateGapRuleViolatedAd:function(ba){h.hide(l(ba.nodeid));var ca={ft_array_A:ba.ftArray_A,ft_array_B:ba.ftArray_B,event_type:v};g.post('feed_ads_gap_rule_violation',ca);}};e.exports=aa;},null);
__d("XGiveThanksFriendSelectAsyncController",["XController"],function(a,b,c,d,e,f){e.exports=b("XController").create("\/thanks\/select\/",{});},null);